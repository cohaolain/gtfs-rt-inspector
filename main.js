(()=>{var xK=Object.create;var DO=Object.defineProperty;var bK=Object.getOwnPropertyDescriptor;var wK=Object.getOwnPropertyNames;var TK=Object.getPrototypeOf,EK=Object.prototype.hasOwnProperty;var M=(s,n)=>()=>(n||s((n={exports:{}}).exports,n),n.exports);var SK=(s,n,l,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of wK(n))!EK.call(s,c)&&c!==l&&DO(s,c,{get:()=>n[c],enumerable:!(o=bK(n,c))||o.enumerable});return s};var Ni=(s,n,l)=>(l=s!=null?xK(TK(s)):{},SK(n||!s||!s.__esModule?DO(l,"default",{value:s,enumerable:!0}):l,s));var Ct=M((M3e,LO)=>{var Iy=function(s){return s&&s.Math==Math&&s};LO.exports=Iy(typeof globalThis=="object"&&globalThis)||Iy(typeof window=="object"&&window)||Iy(typeof self=="object"&&self)||Iy(typeof global=="object"&&global)||function(){return this}()||Function("return this")()});var ft=M((q3e,kO)=>{kO.exports=function(s){try{return!!s()}catch{return!0}}});var $t=M((R3e,zO)=>{var IK=ft();zO.exports=!IK(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})});var th=M((D3e,BO)=>{var AK=ft();BO.exports=!AK(function(){var s=function(){}.bind();return typeof s!="function"||s.hasOwnProperty("prototype")})});var ar=M((L3e,FO)=>{var OK=th(),Ay=Function.prototype.call;FO.exports=OK?Ay.bind(Ay):function(){return Ay.apply(Ay,arguments)}});var Qf=M(jO=>{"use strict";var NO={}.propertyIsEnumerable,UO=Object.getOwnPropertyDescriptor,CK=UO&&!NO.call({1:2},1);jO.f=CK?function(n){var l=UO(this,n);return!!l&&l.enumerable}:NO});var Fn=M((z3e,VO)=>{VO.exports=function(s,n){return{enumerable:!(s&1),configurable:!(s&2),writable:!(s&4),value:n}}});var Kx=M((B3e,WO)=>{var GO=th(),$O=Function.prototype,Yx=$O.call,PK=GO&&$O.bind.bind(Yx,Yx);WO.exports=GO?PK:function(s){return function(){return Yx.apply(s,arguments)}}});var on=M((F3e,HO)=>{var ZO=Kx(),MK=ZO({}.toString),qK=ZO("".slice);HO.exports=function(s){return qK(MK(s),8,-1)}});var _t=M((N3e,XO)=>{var RK=on(),DK=Kx();XO.exports=function(s){if(RK(s)==="Function")return DK(s)}});var _u=M((U3e,YO)=>{var LK=_t(),kK=ft(),zK=on(),Jx=Object,BK=LK("".split);YO.exports=kK(function(){return!Jx("z").propertyIsEnumerable(0)})?function(s){return zK(s)=="String"?BK(s,""):Jx(s)}:Jx});var an=M((j3e,KO)=>{KO.exports=function(s){return s==null}});var mi=M((V3e,JO)=>{var FK=an(),NK=TypeError;JO.exports=function(s){if(FK(s))throw NK("Can't call method on "+s);return s}});var sn=M((G3e,QO)=>{var UK=_u(),jK=mi();QO.exports=function(s){return UK(jK(s))}});var e1=M(($3e,eC)=>{var Qx=typeof document=="object"&&document.all,VK=typeof Qx>"u"&&Qx!==void 0;eC.exports={all:Qx,IS_HTMLDDA:VK}});var fr=M((W3e,rC)=>{var tC=e1(),GK=tC.all;rC.exports=tC.IS_HTMLDDA?function(s){return typeof s=="function"||s===GK}:function(s){return typeof s=="function"}});var sr=M((Z3e,oC)=>{var iC=fr(),nC=e1(),$K=nC.all;oC.exports=nC.IS_HTMLDDA?function(s){return typeof s=="object"?s!==null:iC(s)||s===$K}:function(s){return typeof s=="object"?s!==null:iC(s)}});var Hr=M((H3e,aC)=>{var t1=Ct(),WK=fr(),ZK=function(s){return WK(s)?s:void 0};aC.exports=function(s,n){return arguments.length<2?ZK(t1[s]):t1[s]&&t1[s][n]}});var Nn=M((X3e,sC)=>{var HK=_t();sC.exports=HK({}.isPrototypeOf)});var aa=M((Y3e,lC)=>{var XK=Hr();lC.exports=XK("navigator","userAgent")||""});var sa=M((K3e,dC)=>{var fC=Ct(),r1=aa(),uC=fC.process,cC=fC.Deno,hC=uC&&uC.versions||cC&&cC.version,pC=hC&&hC.v8,Oo,Oy;pC&&(Oo=pC.split("."),Oy=Oo[0]>0&&Oo[0]<4?1:+(Oo[0]+Oo[1]));!Oy&&r1&&(Oo=r1.match(/Edge\/(\d+)/),(!Oo||Oo[1]>=74)&&(Oo=r1.match(/Chrome\/(\d+)/),Oo&&(Oy=+Oo[1])));dC.exports=Oy});var yu=M((J3e,_C)=>{var mC=sa(),YK=ft();_C.exports=!!Object.getOwnPropertySymbols&&!YK(function(){var s=Symbol();return!String(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&mC&&mC<41})});var i1=M((Q3e,yC)=>{var KK=yu();yC.exports=KK&&!Symbol.sham&&typeof Symbol.iterator=="symbol"});var Gs=M((eBe,gC)=>{var JK=Hr(),QK=fr(),eJ=Nn(),tJ=i1(),rJ=Object;gC.exports=tJ?function(s){return typeof s=="symbol"}:function(s){var n=JK("Symbol");return QK(n)&&eJ(n.prototype,rJ(s))}});var $s=M((tBe,vC)=>{var iJ=String;vC.exports=function(s){try{return iJ(s)}catch{return"Object"}}});var Ti=M((rBe,xC)=>{var nJ=fr(),oJ=$s(),aJ=TypeError;xC.exports=function(s){if(nJ(s))return s;throw aJ(oJ(s)+" is not a function")}});var la=M((iBe,bC)=>{var sJ=Ti(),lJ=an();bC.exports=function(s,n){var l=s[n];return lJ(l)?void 0:sJ(l)}});var s1=M((nBe,wC)=>{var n1=ar(),o1=fr(),a1=sr(),uJ=TypeError;wC.exports=function(s,n){var l,o;if(n==="string"&&o1(l=s.toString)&&!a1(o=n1(l,s))||o1(l=s.valueOf)&&!a1(o=n1(l,s))||n!=="string"&&o1(l=s.toString)&&!a1(o=n1(l,s)))return o;throw uJ("Can't convert object to primitive value")}});var li=M((oBe,TC)=>{TC.exports=!1});var Cy=M((aBe,SC)=>{var EC=Ct(),cJ=Object.defineProperty;SC.exports=function(s,n){try{cJ(EC,s,{value:n,configurable:!0,writable:!0})}catch{EC[s]=n}return n}});var Py=M((sBe,AC)=>{var hJ=Ct(),pJ=Cy(),IC="__core-js_shared__",fJ=hJ[IC]||pJ(IC,{});AC.exports=fJ});var gu=M((lBe,CC)=>{var dJ=li(),OC=Py();(CC.exports=function(s,n){return OC[s]||(OC[s]=n!==void 0?n:{})})("versions",[]).push({version:"3.26.0",mode:dJ?"pure":"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})});var Mr=M((uBe,PC)=>{var mJ=mi(),_J=Object;PC.exports=function(s){return _J(mJ(s))}});var _r=M((cBe,MC)=>{var yJ=_t(),gJ=Mr(),vJ=yJ({}.hasOwnProperty);MC.exports=Object.hasOwn||function(n,l){return vJ(gJ(n),l)}});var vu=M((hBe,qC)=>{var xJ=_t(),bJ=0,wJ=Math.random(),TJ=xJ(1 .toString);qC.exports=function(s){return"Symbol("+(s===void 0?"":s)+")_"+TJ(++bJ+wJ,36)}});var cr=M((pBe,zC)=>{var EJ=Ct(),SJ=gu(),RC=_r(),IJ=vu(),DC=yu(),kC=i1(),rh=SJ("wks"),xu=EJ.Symbol,LC=xu&&xu.for,AJ=kC?xu:xu&&xu.withoutSetter||IJ;zC.exports=function(s){if(!RC(rh,s)||!(DC||typeof rh[s]=="string")){var n="Symbol."+s;DC&&RC(xu,s)?rh[s]=xu[s]:kC&&LC?rh[s]=LC(n):rh[s]=AJ(n)}return rh[s]}});var ed=M((fBe,NC)=>{var OJ=ar(),BC=sr(),FC=Gs(),CJ=la(),PJ=s1(),MJ=cr(),qJ=TypeError,RJ=MJ("toPrimitive");NC.exports=function(s,n){if(!BC(s)||FC(s))return s;var l=CJ(s,RJ),o;if(l){if(n===void 0&&(n="default"),o=OJ(l,s,n),!BC(o)||FC(o))return o;throw qJ("Can't convert object to primitive value")}return n===void 0&&(n="number"),PJ(s,n)}});var Xa=M((dBe,UC)=>{var DJ=ed(),LJ=Gs();UC.exports=function(s){var n=DJ(s,"string");return LJ(n)?n:n+""}});var td=M((mBe,VC)=>{var kJ=Ct(),jC=sr(),l1=kJ.document,zJ=jC(l1)&&jC(l1.createElement);VC.exports=function(s){return zJ?l1.createElement(s):{}}});var u1=M((_Be,GC)=>{var BJ=$t(),FJ=ft(),NJ=td();GC.exports=!BJ&&!FJ(function(){return Object.defineProperty(NJ("div"),"a",{get:function(){return 7}}).a!=7})});var Ui=M(WC=>{var UJ=$t(),jJ=ar(),VJ=Qf(),GJ=Fn(),$J=sn(),WJ=Xa(),ZJ=_r(),HJ=u1(),$C=Object.getOwnPropertyDescriptor;WC.f=UJ?$C:function(n,l){if(n=$J(n),l=WJ(l),HJ)try{return $C(n,l)}catch{}if(ZJ(n,l))return GJ(!jJ(VJ.f,n,l),n[l])}});var c1=M((gBe,ZC)=>{var XJ=$t(),YJ=ft();ZC.exports=XJ&&YJ(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})});var Qt=M((vBe,HC)=>{var KJ=sr(),JJ=String,QJ=TypeError;HC.exports=function(s){if(KJ(s))return s;throw QJ(JJ(s)+" is not an object")}});var qr=M(YC=>{var eQ=$t(),tQ=u1(),rQ=c1(),My=Qt(),XC=Xa(),iQ=TypeError,h1=Object.defineProperty,nQ=Object.getOwnPropertyDescriptor,p1="enumerable",f1="configurable",d1="writable";YC.f=eQ?rQ?function(n,l,o){if(My(n),l=XC(l),My(o),typeof n=="function"&&l==="prototype"&&"value"in o&&d1 in o&&!o[d1]){var c=nQ(n,l);c&&c[d1]&&(n[l]=o.value,o={configurable:f1 in o?o[f1]:c[f1],enumerable:p1 in o?o[p1]:c[p1],writable:!1})}return h1(n,l,o)}:h1:function(n,l,o){if(My(n),l=XC(l),My(o),tQ)try{return h1(n,l,o)}catch{}if("get"in o||"set"in o)throw iQ("Accessors not supported");return"value"in o&&(n[l]=o.value),n}});var ln=M((bBe,KC)=>{var oQ=$t(),aQ=qr(),sQ=Fn();KC.exports=oQ?function(s,n,l){return aQ.f(s,n,sQ(1,l))}:function(s,n,l){return s[n]=l,s}});var bu=M((wBe,QC)=>{var m1=$t(),lQ=_r(),JC=Function.prototype,uQ=m1&&Object.getOwnPropertyDescriptor,_1=lQ(JC,"name"),cQ=_1&&function(){}.name==="something",hQ=_1&&(!m1||m1&&uQ(JC,"name").configurable);QC.exports={EXISTS:_1,PROPER:cQ,CONFIGURABLE:hQ}});var qy=M((TBe,eP)=>{var pQ=_t(),fQ=fr(),y1=Py(),dQ=pQ(Function.toString);fQ(y1.inspectSource)||(y1.inspectSource=function(s){return dQ(s)});eP.exports=y1.inspectSource});var g1=M((EBe,rP)=>{var mQ=Ct(),_Q=fr(),tP=mQ.WeakMap;rP.exports=_Q(tP)&&/native code/.test(String(tP))});var rd=M((SBe,nP)=>{var yQ=gu(),gQ=vu(),iP=yQ("keys");nP.exports=function(s){return iP[s]||(iP[s]=gQ(s))}});var ih=M((IBe,oP)=>{oP.exports={}});var _i=M((ABe,lP)=>{var vQ=g1(),sP=Ct(),xQ=sr(),bQ=ln(),v1=_r(),x1=Py(),wQ=rd(),TQ=ih(),aP="Object already initialized",b1=sP.TypeError,EQ=sP.WeakMap,Ry,id,Dy,SQ=function(s){return Dy(s)?id(s):Ry(s,{})},IQ=function(s){return function(n){var l;if(!xQ(n)||(l=id(n)).type!==s)throw b1("Incompatible receiver, "+s+" required");return l}};vQ||x1.state?(Co=x1.state||(x1.state=new EQ),Co.get=Co.get,Co.has=Co.has,Co.set=Co.set,Ry=function(s,n){if(Co.has(s))throw b1(aP);return n.facade=s,Co.set(s,n),n},id=function(s){return Co.get(s)||{}},Dy=function(s){return Co.has(s)}):(wu=wQ("state"),TQ[wu]=!0,Ry=function(s,n){if(v1(s,wu))throw b1(aP);return n.facade=s,bQ(s,wu,n),n},id=function(s){return v1(s,wu)?s[wu]:{}},Dy=function(s){return v1(s,wu)});var Co,wu;lP.exports={set:Ry,get:id,has:Dy,enforce:SQ,getterFor:IQ}});var zy=M((OBe,cP)=>{var AQ=ft(),OQ=fr(),Ly=_r(),w1=$t(),CQ=bu().CONFIGURABLE,PQ=qy(),uP=_i(),MQ=uP.enforce,qQ=uP.get,ky=Object.defineProperty,RQ=w1&&!AQ(function(){return ky(function(){},"length",{value:8}).length!==8}),DQ=String(String).split("String"),LQ=cP.exports=function(s,n,l){String(n).slice(0,7)==="Symbol("&&(n="["+String(n).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!Ly(s,"name")||CQ&&s.name!==n)&&(w1?ky(s,"name",{value:n,configurable:!0}):s.name=n),RQ&&l&&Ly(l,"arity")&&s.length!==l.arity&&ky(s,"length",{value:l.arity});try{l&&Ly(l,"constructor")&&l.constructor?w1&&ky(s,"prototype",{writable:!1}):s.prototype&&(s.prototype=void 0)}catch{}var o=MQ(s);return Ly(o,"source")||(o.source=DQ.join(typeof n=="string"?n:"")),s};Function.prototype.toString=LQ(function(){return OQ(this)&&qQ(this).source||PQ(this)},"toString")});var Qr=M((CBe,hP)=>{var kQ=fr(),zQ=qr(),BQ=zy(),FQ=Cy();hP.exports=function(s,n,l,o){o||(o={});var c=o.enumerable,t=o.name!==void 0?o.name:n;if(kQ(l)&&BQ(l,t,o),o.global)c?s[n]=l:FQ(n,l);else{try{o.unsafe?s[n]&&(c=!0):delete s[n]}catch{}c?s[n]=l:zQ.f(s,n,{value:l,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return s}});var T1=M((PBe,pP)=>{var NQ=Math.ceil,UQ=Math.floor;pP.exports=Math.trunc||function(n){var l=+n;return(l>0?UQ:NQ)(l)}});var Ei=M((MBe,fP)=>{var jQ=T1();fP.exports=function(s){var n=+s;return n!==n||n===0?0:jQ(n)}});var ua=M((qBe,dP)=>{var VQ=Ei(),GQ=Math.max,$Q=Math.min;dP.exports=function(s,n){var l=VQ(s);return l<0?GQ(l+n,0):$Q(l,n)}});var wn=M((RBe,mP)=>{var WQ=Ei(),ZQ=Math.min;mP.exports=function(s){return s>0?ZQ(WQ(s),9007199254740991):0}});var Vr=M((DBe,_P)=>{var HQ=wn();_P.exports=function(s){return HQ(s.length)}});var nh=M((LBe,gP)=>{var XQ=sn(),YQ=ua(),KQ=Vr(),yP=function(s){return function(n,l,o){var c=XQ(n),t=KQ(c),g=YQ(o,t),I;if(s&&l!=l){for(;t>g;)if(I=c[g++],I!=I)return!0}else for(;t>g;g++)if((s||g in c)&&c[g]===l)return s||g||0;return!s&&-1}};gP.exports={includes:yP(!0),indexOf:yP(!1)}});var S1=M((kBe,xP)=>{var JQ=_t(),E1=_r(),QQ=sn(),eee=nh().indexOf,tee=ih(),vP=JQ([].push);xP.exports=function(s,n){var l=QQ(s),o=0,c=[],t;for(t in l)!E1(tee,t)&&E1(l,t)&&vP(c,t);for(;n.length>o;)E1(l,t=n[o++])&&(~eee(c,t)||vP(c,t));return c}});var By=M((zBe,bP)=>{bP.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]});var Ya=M(wP=>{var ree=S1(),iee=By(),nee=iee.concat("length","prototype");wP.f=Object.getOwnPropertyNames||function(n){return ree(n,nee)}});var nd=M(TP=>{TP.f=Object.getOwnPropertySymbols});var Fy=M((NBe,EP)=>{var oee=Hr(),aee=_t(),see=Ya(),lee=nd(),uee=Qt(),cee=aee([].concat);EP.exports=oee("Reflect","ownKeys")||function(n){var l=see.f(uee(n)),o=lee.f;return o?cee(l,o(n)):l}});var od=M((UBe,IP)=>{var SP=_r(),hee=Fy(),pee=Ui(),fee=qr();IP.exports=function(s,n,l){for(var o=hee(n),c=fee.f,t=pee.f,g=0;g<o.length;g++){var I=o[g];!SP(s,I)&&!(l&&SP(l,I))&&c(s,I,t(n,I))}}});var oh=M((jBe,AP)=>{var dee=ft(),mee=fr(),_ee=/#|\.prototype\./,ad=function(s,n){var l=gee[yee(s)];return l==xee?!0:l==vee?!1:mee(n)?dee(n):!!n},yee=ad.normalize=function(s){return String(s).replace(_ee,".").toLowerCase()},gee=ad.data={},vee=ad.NATIVE="N",xee=ad.POLYFILL="P";AP.exports=ad});var we=M((VBe,OP)=>{var I1=Ct(),bee=Ui().f,wee=ln(),Tee=Qr(),Eee=Cy(),See=od(),Iee=oh();OP.exports=function(s,n){var l=s.target,o=s.global,c=s.stat,t,g,I,P,q,L;if(o?g=I1:c?g=I1[l]||Eee(l,{}):g=(I1[l]||{}).prototype,g)for(I in n){if(q=n[I],s.dontCallGetSet?(L=bee(g,I),P=L&&L.value):P=g[I],t=Iee(o?I:l+(c?".":"#")+I,s.forced),!t&&P!==void 0){if(typeof q==typeof P)continue;See(q,P)}(s.sham||P&&P.sham)&&wee(q,"sham",!0),Tee(g,I,q,s)}}});var Ny=M((GBe,PP)=>{var Aee=cr(),Oee=Aee("toStringTag"),CP={};CP[Oee]="z";PP.exports=String(CP)==="[object z]"});var Po=M(($Be,MP)=>{var Cee=Ny(),Pee=fr(),Uy=on(),Mee=cr(),qee=Mee("toStringTag"),Ree=Object,Dee=Uy(function(){return arguments}())=="Arguments",Lee=function(s,n){try{return s[n]}catch{}};MP.exports=Cee?Uy:function(s){var n,l,o;return s===void 0?"Undefined":s===null?"Null":typeof(l=Lee(n=Ree(s),qee))=="string"?l:Dee?Uy(n):(o=Uy(n))=="Object"&&Pee(n.callee)?"Arguments":o}});var hr=M((WBe,qP)=>{var kee=Po(),zee=String;qP.exports=function(s){if(kee(s)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return zee(s)}});var ah=M((ZBe,RP)=>{var Bee=S1(),Fee=By();RP.exports=Object.keys||function(n){return Bee(n,Fee)}});var jy=M(DP=>{var Nee=$t(),Uee=c1(),jee=qr(),Vee=Qt(),Gee=sn(),$ee=ah();DP.f=Nee&&!Uee?Object.defineProperties:function(n,l){Vee(n);for(var o=Gee(l),c=$ee(l),t=c.length,g=0,I;t>g;)jee.f(n,I=c[g++],o[I]);return n}});var A1=M((XBe,LP)=>{var Wee=Hr();LP.exports=Wee("document","documentElement")});var Tn=M((YBe,jP)=>{var Zee=Qt(),Hee=jy(),kP=By(),Xee=ih(),Yee=A1(),Kee=td(),Jee=rd(),zP=">",BP="<",C1="prototype",P1="script",NP=Jee("IE_PROTO"),O1=function(){},UP=function(s){return BP+P1+zP+s+BP+"/"+P1+zP},FP=function(s){s.write(UP("")),s.close();var n=s.parentWindow.Object;return s=null,n},Qee=function(){var s=Kee("iframe"),n="java"+P1+":",l;return s.style.display="none",Yee.appendChild(s),s.src=String(n),l=s.contentWindow.document,l.open(),l.write(UP("document.F=Object")),l.close(),l.F},Vy,Gy=function(){try{Vy=new ActiveXObject("htmlfile")}catch{}Gy=typeof document<"u"?document.domain&&Vy?FP(Vy):Qee():FP(Vy);for(var s=kP.length;s--;)delete Gy[C1][kP[s]];return Gy()};Xee[NP]=!0;jP.exports=Object.create||function(n,l){var o;return n!==null?(O1[C1]=Zee(n),o=new O1,O1[C1]=null,o[NP]=n):o=Gy(),l===void 0?o:Hee.f(o,l)}});var ca=M((KBe,VP)=>{"use strict";var ete=Xa(),tte=qr(),rte=Fn();VP.exports=function(s,n,l){var o=ete(n);o in s?tte.f(s,o,rte(0,l)):s[o]=l}});var sh=M((JBe,$P)=>{var GP=ua(),ite=Vr(),nte=ca(),ote=Array,ate=Math.max;$P.exports=function(s,n,l){for(var o=ite(s),c=GP(n,o),t=GP(l===void 0?o:l,o),g=ote(ate(t-c,0)),I=0;c<t;c++,I++)nte(g,I,s[c]);return g.length=I,g}});var $y=M((QBe,HP)=>{var ste=on(),lte=sn(),WP=Ya().f,ute=sh(),ZP=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],cte=function(s){try{return WP(s)}catch{return ute(ZP)}};HP.exports.f=function(n){return ZP&&ste(n)=="Window"?cte(n):WP(lte(n))}});var M1=M(XP=>{var hte=cr();XP.f=hte});var q1=M((tFe,YP)=>{var pte=Ct();YP.exports=pte});var un=M((rFe,JP)=>{var KP=q1(),fte=_r(),dte=M1(),mte=qr().f;JP.exports=function(s){var n=KP.Symbol||(KP.Symbol={});fte(n,s)||mte(n,s,{value:dte.f(s)})}});var R1=M((iFe,QP)=>{var _te=ar(),yte=Hr(),gte=cr(),vte=Qr();QP.exports=function(){var s=yte("Symbol"),n=s&&s.prototype,l=n&&n.valueOf,o=gte("toPrimitive");n&&!n[o]&&vte(n,o,function(c){return _te(l,this)},{arity:1})}});var En=M((nFe,tM)=>{var xte=qr().f,bte=_r(),wte=cr(),eM=wte("toStringTag");tM.exports=function(s,n,l){s&&!l&&(s=s.prototype),s&&!bte(s,eM)&&xte(s,eM,{configurable:!0,value:n})}});var Qn=M((oFe,iM)=>{var rM=_t(),Tte=Ti(),Ete=th(),Ste=rM(rM.bind);iM.exports=function(s,n){return Tte(s),n===void 0?s:Ete?Ste(s,n):function(){return s.apply(n,arguments)}}});var Ka=M((aFe,nM)=>{var Ite=on();nM.exports=Array.isArray||function(n){return Ite(n)=="Array"}});var Tu=M((sFe,uM)=>{var Ate=_t(),Ote=ft(),oM=fr(),Cte=Po(),Pte=Hr(),Mte=qy(),aM=function(){},qte=[],sM=Pte("Reflect","construct"),D1=/^\s*(?:class|function)\b/,Rte=Ate(D1.exec),Dte=!D1.exec(aM),sd=function(n){if(!oM(n))return!1;try{return sM(aM,qte,n),!0}catch{return!1}},lM=function(n){if(!oM(n))return!1;switch(Cte(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Dte||!!Rte(D1,Mte(n))}catch{return!0}};lM.sham=!0;uM.exports=!sM||Ote(function(){var s;return sd(sd.call)||!sd(Object)||!sd(function(){s=!0})||s})?lM:sd});var fM=M((lFe,pM)=>{var cM=Ka(),Lte=Tu(),kte=sr(),zte=cr(),Bte=zte("species"),hM=Array;pM.exports=function(s){var n;return cM(s)&&(n=s.constructor,Lte(n)&&(n===hM||cM(n.prototype))?n=void 0:kte(n)&&(n=n[Bte],n===null&&(n=void 0))),n===void 0?hM:n}});var lh=M((uFe,dM)=>{var Fte=fM();dM.exports=function(s,n){return new(Fte(s))(n===0?0:n)}});var Mi=M((cFe,_M)=>{var Nte=Qn(),Ute=_t(),jte=_u(),Vte=Mr(),Gte=Vr(),$te=lh(),mM=Ute([].push),Ws=function(s){var n=s==1,l=s==2,o=s==3,c=s==4,t=s==6,g=s==7,I=s==5||t;return function(P,q,L,V){for(var oe=Vte(P),ne=jte(oe),Ie=Nte(q,L),Se=Gte(ne),Re=0,Ze=V||$te,et=n?Ze(P,Se):l||g?Ze(P,0):void 0,He,It;Se>Re;Re++)if((I||Re in ne)&&(He=ne[Re],It=Ie(He,Re,oe),s))if(n)et[Re]=It;else if(It)switch(s){case 3:return!0;case 5:return He;case 6:return Re;case 2:mM(et,He)}else switch(s){case 4:return!1;case 7:mM(et,He)}return t?-1:o||c?c:et}};_M.exports={forEach:Ws(0),map:Ws(1),filter:Ws(2),some:Ws(3),every:Ws(4),find:Ws(5),findIndex:Ws(6),filterReject:Ws(7)}});var qM=M(()=>{"use strict";var Wy=we(),V1=Ct(),G1=ar(),Wte=_t(),Zte=li(),uh=$t(),ch=yu(),Hte=ft(),qi=_r(),Xte=Nn(),B1=Qt(),Zy=sn(),$1=Xa(),Yte=hr(),F1=Fn(),ud=Tn(),vM=ah(),Kte=Ya(),xM=$y(),Jte=nd(),bM=Ui(),wM=qr(),Qte=jy(),TM=Qf(),L1=Qr(),W1=gu(),ere=rd(),EM=ih(),yM=vu(),tre=cr(),rre=M1(),ire=un(),nre=R1(),ore=En(),SM=_i(),Hy=Mi().forEach,Sn=ere("hidden"),Xy="Symbol",cd="prototype",are=SM.set,gM=SM.getterFor(Xy),eo=Object[cd],Eu=V1.Symbol,ld=Eu&&Eu[cd],sre=V1.TypeError,k1=V1.QObject,IM=bM.f,Zs=wM.f,AM=xM.f,lre=TM.f,OM=Wte([].push),Ja=W1("symbols"),hd=W1("op-symbols"),ure=W1("wks"),N1=!k1||!k1[cd]||!k1[cd].findChild,U1=uh&&Hte(function(){return ud(Zs({},"a",{get:function(){return Zs(this,"a",{value:7}).a}})).a!=7})?function(s,n,l){var o=IM(eo,n);o&&delete eo[n],Zs(s,n,l),o&&s!==eo&&Zs(eo,n,o)}:Zs,z1=function(s,n){var l=Ja[s]=ud(ld);return are(l,{type:Xy,tag:s,description:n}),uh||(l.description=n),l},Yy=function(n,l,o){n===eo&&Yy(hd,l,o),B1(n);var c=$1(l);return B1(o),qi(Ja,c)?(o.enumerable?(qi(n,Sn)&&n[Sn][c]&&(n[Sn][c]=!1),o=ud(o,{enumerable:F1(0,!1)})):(qi(n,Sn)||Zs(n,Sn,F1(1,{})),n[Sn][c]=!0),U1(n,c,o)):Zs(n,c,o)},Z1=function(n,l){B1(n);var o=Zy(l),c=vM(o).concat(MM(o));return Hy(c,function(t){(!uh||G1(j1,o,t))&&Yy(n,t,o[t])}),n},cre=function(n,l){return l===void 0?ud(n):Z1(ud(n),l)},j1=function(n){var l=$1(n),o=G1(lre,this,l);return this===eo&&qi(Ja,l)&&!qi(hd,l)?!1:o||!qi(this,l)||!qi(Ja,l)||qi(this,Sn)&&this[Sn][l]?o:!0},CM=function(n,l){var o=Zy(n),c=$1(l);if(!(o===eo&&qi(Ja,c)&&!qi(hd,c))){var t=IM(o,c);return t&&qi(Ja,c)&&!(qi(o,Sn)&&o[Sn][c])&&(t.enumerable=!0),t}},PM=function(n){var l=AM(Zy(n)),o=[];return Hy(l,function(c){!qi(Ja,c)&&!qi(EM,c)&&OM(o,c)}),o},MM=function(s){var n=s===eo,l=AM(n?hd:Zy(s)),o=[];return Hy(l,function(c){qi(Ja,c)&&(!n||qi(eo,c))&&OM(o,Ja[c])}),o};ch||(Eu=function(){if(Xte(ld,this))throw sre("Symbol is not a constructor");var n=!arguments.length||arguments[0]===void 0?void 0:Yte(arguments[0]),l=yM(n),o=function(c){this===eo&&G1(o,hd,c),qi(this,Sn)&&qi(this[Sn],l)&&(this[Sn][l]=!1),U1(this,l,F1(1,c))};return uh&&N1&&U1(eo,l,{configurable:!0,set:o}),z1(l,n)},ld=Eu[cd],L1(ld,"toString",function(){return gM(this).tag}),L1(Eu,"withoutSetter",function(s){return z1(yM(s),s)}),TM.f=j1,wM.f=Yy,Qte.f=Z1,bM.f=CM,Kte.f=xM.f=PM,Jte.f=MM,rre.f=function(s){return z1(tre(s),s)},uh&&(Zs(ld,"description",{configurable:!0,get:function(){return gM(this).description}}),Zte||L1(eo,"propertyIsEnumerable",j1,{unsafe:!0})));Wy({global:!0,constructor:!0,wrap:!0,forced:!ch,sham:!ch},{Symbol:Eu});Hy(vM(ure),function(s){ire(s)});Wy({target:Xy,stat:!0,forced:!ch},{useSetter:function(){N1=!0},useSimple:function(){N1=!1}});Wy({target:"Object",stat:!0,forced:!ch,sham:!uh},{create:cre,defineProperty:Yy,defineProperties:Z1,getOwnPropertyDescriptor:CM});Wy({target:"Object",stat:!0,forced:!ch},{getOwnPropertyNames:PM});nre();ore(Eu,Xy);EM[Sn]=!0});var H1=M((fFe,RM)=>{var hre=yu();RM.exports=hre&&!!Symbol.for&&!!Symbol.keyFor});var LM=M(()=>{var pre=we(),fre=Hr(),dre=_r(),mre=hr(),DM=gu(),_re=H1(),X1=DM("string-to-symbol-registry"),yre=DM("symbol-to-string-registry");pre({target:"Symbol",stat:!0,forced:!_re},{for:function(s){var n=mre(s);if(dre(X1,n))return X1[n];var l=fre("Symbol")(n);return X1[n]=l,yre[l]=n,l}})});var zM=M(()=>{var gre=we(),vre=_r(),xre=Gs(),bre=$s(),wre=gu(),Tre=H1(),kM=wre("symbol-to-string-registry");gre({target:"Symbol",stat:!0,forced:!Tre},{keyFor:function(n){if(!xre(n))throw TypeError(bre(n)+" is not a symbol");if(vre(kM,n))return kM[n]}})});var Un=M((gFe,UM)=>{var Ere=th(),NM=Function.prototype,BM=NM.apply,FM=NM.call;UM.exports=typeof Reflect=="object"&&Reflect.apply||(Ere?FM.bind(BM):function(){return FM.apply(BM,arguments)})});var Hs=M((vFe,jM)=>{var Sre=_t();jM.exports=Sre([].slice)});var Y1=M(()=>{var Ire=we(),XM=Hr(),YM=Un(),Are=ar(),pd=_t(),KM=ft(),Ore=Ka(),Cre=fr(),Pre=sr(),VM=Gs(),JM=Hs(),Mre=yu(),Xs=XM("JSON","stringify"),Ky=pd(/./.exec),GM=pd("".charAt),qre=pd("".charCodeAt),Rre=pd("".replace),Dre=pd(1 .toString),Lre=/[\uD800-\uDFFF]/g,$M=/^[\uD800-\uDBFF]$/,WM=/^[\uDC00-\uDFFF]$/,ZM=!Mre||KM(function(){var s=XM("Symbol")();return Xs([s])!="[null]"||Xs({a:s})!="{}"||Xs(Object(s))!="{}"}),HM=KM(function(){return Xs("\uDF06\uD834")!=='"\\udf06\\ud834"'||Xs("\uDEAD")!=='"\\udead"'}),kre=function(s,n){var l=JM(arguments),o=n;if(!(!Pre(n)&&s===void 0||VM(s)))return Ore(n)||(n=function(c,t){if(Cre(o)&&(t=Are(o,this,c,t)),!VM(t))return t}),l[1]=n,YM(Xs,null,l)},zre=function(s,n,l){var o=GM(l,n-1),c=GM(l,n+1);return Ky($M,s)&&!Ky(WM,c)||Ky(WM,s)&&!Ky($M,o)?"\\u"+Dre(qre(s,0),16):s};Xs&&Ire({target:"JSON",stat:!0,arity:3,forced:ZM||HM},{stringify:function(n,l,o){var c=JM(arguments),t=YM(ZM?kre:Xs,null,c);return HM&&typeof t=="string"?Rre(t,Lre,zre):t}})});var eq=M(()=>{var Bre=we(),Fre=yu(),Nre=ft(),QM=nd(),Ure=Mr(),jre=!Fre||Nre(function(){QM.f(1)});Bre({target:"Object",stat:!0,forced:jre},{getOwnPropertySymbols:function(n){var l=QM.f;return l?l(Ure(n)):[]}})});var tq=M(()=>{qM();LM();zM();Y1();eq()});var lq=M(()=>{"use strict";var Vre=we(),Gre=$t(),$re=Ct(),Jy=_t(),Wre=_r(),Zre=fr(),Hre=Nn(),Xre=hr(),Yre=qr().f,Kre=od(),Qa=$re.Symbol,Su=Qa&&Qa.prototype;Gre&&Zre(Qa)&&(!("description"in Su)||Qa().description!==void 0)&&(K1={},fd=function(){var n=arguments.length<1||arguments[0]===void 0?void 0:Xre(arguments[0]),l=Hre(Su,this)?new Qa(n):n===void 0?Qa():Qa(n);return n===""&&(K1[l]=!0),l},Kre(fd,Qa),fd.prototype=Su,Su.constructor=fd,rq=String(Qa("test"))=="Symbol(test)",iq=Jy(Su.valueOf),nq=Jy(Su.toString),oq=/^Symbol\((.*)\)[^)]+$/,aq=Jy("".replace),sq=Jy("".slice),Yre(Su,"description",{configurable:!0,get:function(){var n=iq(this);if(Wre(K1,n))return"";var l=nq(n),o=rq?sq(l,7,-1):aq(l,oq,"$1");return o===""?void 0:o}}),Vre({global:!0,constructor:!0,forced:!0},{Symbol:fd}));var K1,fd,rq,iq,nq,oq,aq,sq});var uq=M(()=>{var Jre=un();Jre("asyncIterator")});var cq=M(()=>{var Qre=un();Qre("hasInstance")});var hq=M(()=>{var eie=un();eie("isConcatSpreadable")});var pq=M(()=>{var tie=un();tie("iterator")});var fq=M(()=>{var rie=un();rie("match")});var dq=M(()=>{var iie=un();iie("matchAll")});var mq=M(()=>{var nie=un();nie("replace")});var _q=M(()=>{var oie=un();oie("search")});var yq=M(()=>{var aie=un();aie("species")});var gq=M(()=>{var sie=un();sie("split")});var vq=M(()=>{var lie=un(),uie=R1();lie("toPrimitive");uie()});var xq=M(()=>{var cie=Hr(),hie=un(),pie=En();hie("toStringTag");pie(cie("Symbol"),"Symbol")});var bq=M(()=>{var fie=un();fie("unscopables")});var J1=M((eNe,wq)=>{var die=fr(),mie=String,_ie=TypeError;wq.exports=function(s){if(typeof s=="object"||die(s))return s;throw _ie("Can't set "+mie(s)+" as a prototype")}});var Mo=M((tNe,Tq)=>{var yie=_t(),gie=Qt(),vie=J1();Tq.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var s=!1,n={},l;try{l=yie(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),l(n,[]),s=n instanceof Array}catch{}return function(c,t){return gie(c),vie(t),s?l(c,t):c.__proto__=t,c}}():void 0)});var Q1=M((rNe,Eq)=>{var xie=qr().f;Eq.exports=function(s,n,l){l in s||xie(s,l,{configurable:!0,get:function(){return n[l]},set:function(o){n[l]=o}})}});var Iu=M((iNe,Iq)=>{var bie=fr(),wie=sr(),Sq=Mo();Iq.exports=function(s,n,l){var o,c;return Sq&&bie(o=n.constructor)&&o!==l&&wie(c=o.prototype)&&c!==l.prototype&&Sq(s,c),s}});var hh=M((nNe,Aq)=>{var Tie=hr();Aq.exports=function(s,n){return s===void 0?arguments.length<2?"":n:Tie(s)}});var eb=M((oNe,Oq)=>{var Eie=sr(),Sie=ln();Oq.exports=function(s,n){Eie(n)&&"cause"in n&&Sie(s,"cause",n.cause)}});var dd=M((aNe,Mq)=>{var Iie=_t(),Cq=Error,Aie=Iie("".replace),Oie=function(s){return String(Cq(s).stack)}("zxcasd"),Pq=/\n\s*at [^:]*:[^\n]*/,Cie=Pq.test(Oie);Mq.exports=function(s,n){if(Cie&&typeof s=="string"&&!Cq.prepareStackTrace)for(;n--;)s=Aie(s,Pq,"");return s}});var Qy=M((sNe,qq)=>{var Pie=ft(),Mie=Fn();qq.exports=!Pie(function(){var s=Error("a");return"stack"in s?(Object.defineProperty(s,"stack",Mie(1,7)),s.stack!==7):!0})});var rb=M((lNe,Bq)=>{"use strict";var Rq=Hr(),qie=_r(),tb=ln(),Rie=Nn(),Dq=Mo(),Lq=od(),kq=Q1(),Die=Iu(),Lie=hh(),kie=eb(),zie=dd(),Bie=Qy(),Fie=$t(),zq=li();Bq.exports=function(s,n,l,o){var c="stackTraceLimit",t=o?2:1,g=s.split("."),I=g[g.length-1],P=Rq.apply(null,g);if(!!P){var q=P.prototype;if(!zq&&qie(q,"cause")&&delete q.cause,!l)return P;var L=Rq("Error"),V=n(function(oe,ne){var Ie=Lie(o?ne:oe,void 0),Se=o?new P(oe):new P;return Ie!==void 0&&tb(Se,"message",Ie),Bie&&tb(Se,"stack",zie(Se.stack,2)),this&&Rie(q,this)&&Die(Se,this,V),arguments.length>t&&kie(Se,arguments[t]),Se});if(V.prototype=q,I!=="Error"?Dq?Dq(V,L):Lq(V,L,{name:!0}):Fie&&c in P&&(kq(V,P,c),kq(V,P,"prepareStackTrace")),Lq(V,P),!zq)try{q.name!==I&&tb(q,"name",I),q.constructor=V}catch{}return V}}});var jq=M(()=>{var Nq=we(),Nie=Ct(),ha=Un(),Uq=rb(),ib="WebAssembly",Fq=Nie[ib],eg=Error("e",{cause:7}).cause!==7,Au=function(s,n){var l={};l[s]=Uq(s,n,eg),Nq({global:!0,constructor:!0,arity:1,forced:eg},l)},nb=function(s,n){if(Fq&&Fq[s]){var l={};l[s]=Uq(ib+"."+s,n,eg),Nq({target:ib,stat:!0,constructor:!0,arity:1,forced:eg},l)}};Au("Error",function(s){return function(l){return ha(s,this,arguments)}});Au("EvalError",function(s){return function(l){return ha(s,this,arguments)}});Au("RangeError",function(s){return function(l){return ha(s,this,arguments)}});Au("ReferenceError",function(s){return function(l){return ha(s,this,arguments)}});Au("SyntaxError",function(s){return function(l){return ha(s,this,arguments)}});Au("TypeError",function(s){return function(l){return ha(s,this,arguments)}});Au("URIError",function(s){return function(l){return ha(s,this,arguments)}});nb("CompileError",function(s){return function(l){return ha(s,this,arguments)}});nb("LinkError",function(s){return function(l){return ha(s,this,arguments)}});nb("RuntimeError",function(s){return function(l){return ha(s,this,arguments)}})});var ob=M((hNe,Gq)=>{"use strict";var Uie=$t(),jie=ft(),Vie=Qt(),Gie=Tn(),Vq=hh(),tg=Error.prototype.toString,$ie=jie(function(){if(Uie){var s=Gie(Object.defineProperty({},"name",{get:function(){return this===s}}));if(tg.call(s)!=="true")return!0}return tg.call({message:1,name:2})!=="2: 1"||tg.call({})!=="Error"});Gq.exports=$ie?function(){var n=Vie(this),l=Vq(n.name,"Error"),o=Vq(n.message);return l?o?l+": "+o:l:o}:tg});var Zq=M(()=>{var Wie=Qr(),$q=ob(),Wq=Error.prototype;Wq.toString!==$q&&Wie(Wq,"toString",$q)});var rg=M((dNe,Hq)=>{var Zie=ft();Hq.exports=!Zie(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype})});var jn=M((mNe,Yq)=>{var Hie=_r(),Xie=fr(),Yie=Mr(),Kie=rd(),Jie=rg(),Xq=Kie("IE_PROTO"),ab=Object,Qie=ab.prototype;Yq.exports=Jie?ab.getPrototypeOf:function(s){var n=Yie(s);if(Hie(n,Xq))return n[Xq];var l=n.constructor;return Xie(l)&&n instanceof l?l.prototype:n instanceof ab?Qie:null}});var ph=M((_Ne,Kq)=>{Kq.exports={}});var ig=M((yNe,Jq)=>{var ene=cr(),tne=ph(),rne=ene("iterator"),ine=Array.prototype;Jq.exports=function(s){return s!==void 0&&(tne.Array===s||ine[rne]===s)}});var fh=M((gNe,eR)=>{var nne=Po(),Qq=la(),one=an(),ane=ph(),sne=cr(),lne=sne("iterator");eR.exports=function(s){if(!one(s))return Qq(s,lne)||Qq(s,"@@iterator")||ane[nne(s)]}});var md=M((vNe,tR)=>{var une=ar(),cne=Ti(),hne=Qt(),pne=$s(),fne=fh(),dne=TypeError;tR.exports=function(s,n){var l=arguments.length<2?fne(s):n;if(cne(l))return hne(une(l,s));throw dne(pne(s)+" is not iterable")}});var sb=M((xNe,iR)=>{var mne=ar(),rR=Qt(),_ne=la();iR.exports=function(s,n,l){var o,c;rR(s);try{if(o=_ne(s,"return"),!o){if(n==="throw")throw l;return l}o=mne(o,s)}catch(t){c=!0,o=t}if(n==="throw")throw l;if(c)throw o;return rR(o),l}});var qo=M((bNe,sR)=>{var yne=Qn(),gne=ar(),vne=Qt(),xne=$s(),bne=ig(),wne=Vr(),nR=Nn(),Tne=md(),Ene=fh(),oR=sb(),Sne=TypeError,ng=function(s,n){this.stopped=s,this.result=n},aR=ng.prototype;sR.exports=function(s,n,l){var o=l&&l.that,c=!!(l&&l.AS_ENTRIES),t=!!(l&&l.IS_RECORD),g=!!(l&&l.IS_ITERATOR),I=!!(l&&l.INTERRUPTED),P=yne(n,o),q,L,V,oe,ne,Ie,Se,Re=function(et){return q&&oR(q,"normal",et),new ng(!0,et)},Ze=function(et){return c?(vne(et),I?P(et[0],et[1],Re):P(et[0],et[1])):I?P(et,Re):P(et)};if(t)q=s.iterator;else if(g)q=s;else{if(L=Ene(s),!L)throw Sne(xne(s)+" is not iterable");if(bne(L)){for(V=0,oe=wne(s);oe>V;V++)if(ne=Ze(s[V]),ne&&nR(aR,ne))return ne;return new ng(!1)}q=Tne(s,L)}for(Ie=t?s.next:q.next;!(Se=gne(Ie,q)).done;){try{ne=Ze(Se.value)}catch(et){oR(q,"throw",et)}if(typeof ne=="object"&&ne&&nR(aR,ne))return ne}return new ng(!1)}});var uR=M(()=>{"use strict";var Ine=we(),Ane=Nn(),One=jn(),ag=Mo(),Cne=od(),lR=Tn(),og=ln(),lb=Fn(),Pne=dd(),Mne=eb(),qne=qo(),Rne=hh(),Dne=cr(),Lne=Qy(),kne=Dne("toStringTag"),sg=Error,zne=[].push,_d=function(n,l){var o=arguments.length>2?arguments[2]:void 0,c=Ane(ub,this),t;ag?t=ag(sg(),c?One(this):ub):(t=c?this:lR(ub),og(t,kne,"Error")),l!==void 0&&og(t,"message",Rne(l)),Lne&&og(t,"stack",Pne(t.stack,1)),Mne(t,o);var g=[];return qne(n,zne,{that:g}),og(t,"errors",g),t};ag?ag(_d,sg):Cne(_d,sg,{name:!0});var ub=_d.prototype=lR(sg.prototype,{constructor:lb(1,_d),message:lb(1,""),name:lb(1,"AggregateError")});Ine({global:!0,constructor:!0,arity:2},{AggregateError:_d})});var cR=M(()=>{uR()});var dR=M(()=>{var Bne=we(),Fne=Hr(),Nne=Un(),hR=ft(),Une=rb(),cb="AggregateError",pR=Fne(cb),fR=!hR(function(){return pR([1]).errors[0]!==1})&&hR(function(){return pR([1],cb,{cause:7}).cause!==7});Bne({global:!0,constructor:!0,arity:2,forced:fR},{AggregateError:Une(cb,function(s){return function(l,o){return Nne(s,this,arguments)}},fR,!0)})});var to=M((ONe,mR)=>{var jne=cr(),Vne=Tn(),Gne=qr().f,hb=jne("unscopables"),pb=Array.prototype;pb[hb]==null&&Gne(pb,hb,{configurable:!0,value:Vne(null)});mR.exports=function(s){pb[hb][s]=!0}});var _R=M(()=>{"use strict";var $ne=we(),Wne=Mr(),Zne=Vr(),Hne=Ei(),Xne=to();$ne({target:"Array",proto:!0},{at:function(n){var l=Wne(this),o=Zne(l),c=Hne(n),t=c>=0?c:o+c;return t<0||t>=o?void 0:l[t]}});Xne("at")});var dh=M((MNe,yR)=>{var Yne=TypeError,Kne=9007199254740991;yR.exports=function(s){if(s>Kne)throw Yne("Maximum allowed index exceeded");return s}});var mh=M((qNe,gR)=>{var Jne=ft(),Qne=cr(),eoe=sa(),toe=Qne("species");gR.exports=function(s){return eoe>=51||!Jne(function(){var n=[],l=n.constructor={};return l[toe]=function(){return{foo:1}},n[s](Boolean).foo!==1})}});var wR=M(()=>{"use strict";var roe=we(),ioe=ft(),noe=Ka(),ooe=sr(),aoe=Mr(),soe=Vr(),vR=dh(),xR=ca(),loe=lh(),uoe=mh(),coe=cr(),hoe=sa(),bR=coe("isConcatSpreadable"),poe=hoe>=51||!ioe(function(){var s=[];return s[bR]=!1,s.concat()[0]!==s}),foe=uoe("concat"),doe=function(s){if(!ooe(s))return!1;var n=s[bR];return n!==void 0?!!n:noe(s)},moe=!poe||!foe;roe({target:"Array",proto:!0,arity:1,forced:moe},{concat:function(n){var l=aoe(this),o=loe(l,0),c=0,t,g,I,P,q;for(t=-1,I=arguments.length;t<I;t++)if(q=t===-1?l:arguments[t],doe(q))for(P=soe(q),vR(c+P),g=0;g<P;g++,c++)g in q&&xR(o,c,q[g]);else vR(c+1),xR(o,c++,q);return o.length=c,o}})});var yd=M((LNe,ER)=>{"use strict";var TR=$s(),_oe=TypeError;ER.exports=function(s,n){if(!delete s[n])throw _oe("Cannot delete property "+TR(n)+" of "+TR(s))}});var db=M((kNe,SR)=>{"use strict";var yoe=Mr(),fb=ua(),goe=Vr(),voe=yd(),xoe=Math.min;SR.exports=[].copyWithin||function(n,l){var o=yoe(this),c=goe(o),t=fb(n,c),g=fb(l,c),I=arguments.length>2?arguments[2]:void 0,P=xoe((I===void 0?c:fb(I,c))-g,c-t),q=1;for(g<t&&t<g+P&&(q=-1,g+=P-1,t+=P-1);P-- >0;)g in o?o[t]=o[g]:voe(o,t),t+=q,g+=q;return o}});var IR=M(()=>{var boe=we(),woe=db(),Toe=to();boe({target:"Array",proto:!0},{copyWithin:woe});Toe("copyWithin")});var pa=M((FNe,AR)=>{"use strict";var Eoe=ft();AR.exports=function(s,n){var l=[][s];return!!l&&Eoe(function(){l.call(null,n||function(){return 1},1)})}});var OR=M(()=>{"use strict";var Soe=we(),Ioe=Mi().every,Aoe=pa(),Ooe=Aoe("every");Soe({target:"Array",proto:!0,forced:!Ooe},{every:function(n){return Ioe(this,n,arguments.length>1?arguments[1]:void 0)}})});var lg=M((jNe,PR)=>{"use strict";var Coe=Mr(),CR=ua(),Poe=Vr();PR.exports=function(n){for(var l=Coe(this),o=Poe(l),c=arguments.length,t=CR(c>1?arguments[1]:void 0,o),g=c>2?arguments[2]:void 0,I=g===void 0?o:CR(g,o);I>t;)l[t++]=n;return l}});var MR=M(()=>{var Moe=we(),qoe=lg(),Roe=to();Moe({target:"Array",proto:!0},{fill:qoe});Roe("fill")});var qR=M(()=>{"use strict";var Doe=we(),Loe=Mi().filter,koe=mh(),zoe=koe("filter");Doe({target:"Array",proto:!0,forced:!zoe},{filter:function(n){return Loe(this,n,arguments.length>1?arguments[1]:void 0)}})});var DR=M(()=>{"use strict";var Boe=we(),Foe=Mi().find,Noe=to(),mb="find",RR=!0;mb in[]&&Array(1)[mb](function(){RR=!1});Boe({target:"Array",proto:!0,forced:RR},{find:function(n){return Foe(this,n,arguments.length>1?arguments[1]:void 0)}});Noe(mb)});var kR=M(()=>{"use strict";var Uoe=we(),joe=Mi().findIndex,Voe=to(),_b="findIndex",LR=!0;_b in[]&&Array(1)[_b](function(){LR=!1});Uoe({target:"Array",proto:!0,forced:LR},{findIndex:function(n){return joe(this,n,arguments.length>1?arguments[1]:void 0)}});Voe(_b)});var gd=M((KNe,BR)=>{var Goe=Qn(),$oe=_u(),Woe=Mr(),Zoe=Vr(),zR=function(s){var n=s==1;return function(l,o,c){for(var t=Woe(l),g=$oe(t),I=Goe(o,c),P=Zoe(g),q,L;P-- >0;)if(q=g[P],L=I(q,P,t),L)switch(s){case 0:return q;case 1:return P}return n?-1:void 0}};BR.exports={findLast:zR(0),findLastIndex:zR(1)}});var FR=M(()=>{"use strict";var Hoe=we(),Xoe=gd().findLast,Yoe=to();Hoe({target:"Array",proto:!0},{findLast:function(n){return Xoe(this,n,arguments.length>1?arguments[1]:void 0)}});Yoe("findLast")});var NR=M(()=>{"use strict";var Koe=we(),Joe=gd().findLastIndex,Qoe=to();Koe({target:"Array",proto:!0},{findLastIndex:function(n){return Joe(this,n,arguments.length>1?arguments[1]:void 0)}});Qoe("findLastIndex")});var yb=M((r4e,jR)=>{"use strict";var eae=Ka(),tae=Vr(),rae=dh(),iae=Qn(),UR=function(s,n,l,o,c,t,g,I){for(var P=c,q=0,L=g?iae(g,I):!1,V,oe;q<o;)q in l&&(V=L?L(l[q],q,n):l[q],t>0&&eae(V)?(oe=tae(V),P=UR(s,n,V,oe,P,t-1)-1):(rae(P+1),s[P]=V),P++),q++;return P};jR.exports=UR});var VR=M(()=>{"use strict";var nae=we(),oae=yb(),aae=Mr(),sae=Vr(),lae=Ei(),uae=lh();nae({target:"Array",proto:!0},{flat:function(){var n=arguments.length?arguments[0]:void 0,l=aae(this),o=sae(l),c=uae(l,0);return c.length=oae(c,l,l,o,0,n===void 0?1:lae(n)),c}})});var GR=M(()=>{"use strict";var cae=we(),hae=yb(),pae=Ti(),fae=Mr(),dae=Vr(),mae=lh();cae({target:"Array",proto:!0},{flatMap:function(n){var l=fae(this),o=dae(l),c;return pae(n),c=mae(l,0),c.length=hae(c,l,l,o,0,1,n,arguments.length>1?arguments[1]:void 0),c}})});var gb=M((s4e,$R)=>{"use strict";var _ae=Mi().forEach,yae=pa(),gae=yae("forEach");$R.exports=gae?[].forEach:function(n){return _ae(this,n,arguments.length>1?arguments[1]:void 0)}});var ZR=M(()=>{"use strict";var vae=we(),WR=gb();vae({target:"Array",proto:!0,forced:[].forEach!=WR},{forEach:WR})});var XR=M((c4e,HR)=>{var xae=Qt(),bae=sb();HR.exports=function(s,n,l,o){try{return o?n(xae(l)[0],l[1]):n(l)}catch(c){bae(s,"throw",c)}}});var vb=M((h4e,JR)=>{"use strict";var wae=Qn(),Tae=ar(),Eae=Mr(),Sae=XR(),Iae=ig(),Aae=Tu(),Oae=Vr(),YR=ca(),Cae=md(),Pae=fh(),KR=Array;JR.exports=function(n){var l=Eae(n),o=Aae(this),c=arguments.length,t=c>1?arguments[1]:void 0,g=t!==void 0;g&&(t=wae(t,c>2?arguments[2]:void 0));var I=Pae(l),P=0,q,L,V,oe,ne,Ie;if(I&&!(this===KR&&Iae(I)))for(oe=Cae(l,I),ne=oe.next,L=o?new this:[];!(V=Tae(ne,oe)).done;P++)Ie=g?Sae(oe,t,[V.value,P],!0):V.value,YR(L,P,Ie);else for(q=Oae(l),L=o?new this(q):KR(q);q>P;P++)Ie=g?t(l[P],P):l[P],YR(L,P,Ie);return L.length=P,L}});var vd=M((p4e,rD)=>{var Mae=cr(),eD=Mae("iterator"),tD=!1;try{QR=0,xb={next:function(){return{done:!!QR++}},return:function(){tD=!0}},xb[eD]=function(){return this},Array.from(xb,function(){throw 2})}catch{}var QR,xb;rD.exports=function(s,n){if(!n&&!tD)return!1;var l=!1;try{var o={};o[eD]=function(){return{next:function(){return{done:l=!0}}}},s(o)}catch{}return l}});var iD=M(()=>{var qae=we(),Rae=vb(),Dae=vd(),Lae=!Dae(function(s){Array.from(s)});qae({target:"Array",stat:!0,forced:Lae},{from:Rae})});var nD=M(()=>{"use strict";var kae=we(),zae=nh().includes,Bae=ft(),Fae=to(),Nae=Bae(function(){return!Array(1).includes()});kae({target:"Array",proto:!0,forced:Nae},{includes:function(n){return zae(this,n,arguments.length>1?arguments[1]:void 0)}});Fae("includes")});var aD=M(()=>{"use strict";var Uae=we(),jae=_t(),Vae=nh().indexOf,Gae=pa(),bb=jae([].indexOf),oD=!!bb&&1/bb([1],1,-0)<0,$ae=Gae("indexOf");Uae({target:"Array",proto:!0,forced:oD||!$ae},{indexOf:function(n){var l=arguments.length>1?arguments[1]:void 0;return oD?bb(this,n,l)||0:Vae(this,n,l)}})});var sD=M(()=>{var Wae=we(),Zae=Ka();Wae({target:"Array",stat:!0},{isArray:Zae})});var Sb=M((b4e,cD)=>{"use strict";var Hae=ft(),Xae=fr(),Yae=sr(),Kae=Tn(),lD=jn(),Jae=Qr(),Qae=cr(),ese=li(),Eb=Qae("iterator"),uD=!1,es,wb,Tb;[].keys&&(Tb=[].keys(),"next"in Tb?(wb=lD(lD(Tb)),wb!==Object.prototype&&(es=wb)):uD=!0);var tse=!Yae(es)||Hae(function(){var s={};return es[Eb].call(s)!==s});tse?es={}:ese&&(es=Kae(es));Xae(es[Eb])||Jae(es,Eb,function(){return this});cD.exports={IteratorPrototype:es,BUGGY_SAFARI_ITERATORS:uD}});var ug=M((w4e,hD)=>{"use strict";var rse=Sb().IteratorPrototype,ise=Tn(),nse=Fn(),ose=En(),ase=ph(),sse=function(){return this};hD.exports=function(s,n,l,o){var c=n+" Iterator";return s.prototype=ise(rse,{next:nse(+!o,l)}),ose(s,c,!1,!0),ase[c]=sse,s}});var pg=M((T4e,bD)=>{"use strict";var lse=we(),use=ar(),cg=li(),vD=bu(),cse=fr(),hse=ug(),pD=jn(),fD=Mo(),pse=En(),fse=ln(),Ib=Qr(),dse=cr(),dD=ph(),xD=Sb(),mse=vD.PROPER,_se=vD.CONFIGURABLE,mD=xD.IteratorPrototype,hg=xD.BUGGY_SAFARI_ITERATORS,xd=dse("iterator"),_D="keys",bd="values",yD="entries",gD=function(){return this};bD.exports=function(s,n,l,o,c,t,g){hse(l,n,o);var I=function(Ze){if(Ze===c&&oe)return oe;if(!hg&&Ze in L)return L[Ze];switch(Ze){case _D:return function(){return new l(this,Ze)};case bd:return function(){return new l(this,Ze)};case yD:return function(){return new l(this,Ze)}}return function(){return new l(this)}},P=n+" Iterator",q=!1,L=s.prototype,V=L[xd]||L["@@iterator"]||c&&L[c],oe=!hg&&V||I(c),ne=n=="Array"&&L.entries||V,Ie,Se,Re;if(ne&&(Ie=pD(ne.call(new s)),Ie!==Object.prototype&&Ie.next&&(!cg&&pD(Ie)!==mD&&(fD?fD(Ie,mD):cse(Ie[xd])||Ib(Ie,xd,gD)),pse(Ie,P,!0,!0),cg&&(dD[P]=gD))),mse&&c==bd&&V&&V.name!==bd&&(!cg&&_se?fse(L,"name",bd):(q=!0,oe=function(){return use(V,this)})),c)if(Se={values:I(bd),keys:t?oe:I(_D),entries:I(yD)},g)for(Re in Se)(hg||q||!(Re in L))&&Ib(L,Re,Se[Re]);else lse({target:n,proto:!0,forced:hg||q},Se);return(!cg||g)&&L[xd]!==oe&&Ib(L,xd,oe,{name:c}),dD[n]=oe,Se}});var wd=M((E4e,wD)=>{wD.exports=function(s,n){return{value:s,done:n}}});var Td=M((S4e,AD)=>{"use strict";var yse=sn(),Ab=to(),TD=ph(),SD=_i(),gse=qr().f,vse=pg(),fg=wd(),xse=li(),bse=$t(),ID="Array Iterator",wse=SD.set,Tse=SD.getterFor(ID);AD.exports=vse(Array,"Array",function(s,n){wse(this,{type:ID,target:yse(s),index:0,kind:n})},function(){var s=Tse(this),n=s.target,l=s.kind,o=s.index++;return!n||o>=n.length?(s.target=void 0,fg(void 0,!0)):l=="keys"?fg(o,!1):l=="values"?fg(n[o],!1):fg([o,n[o]],!1)},"values");var ED=TD.Arguments=TD.Array;Ab("keys");Ab("values");Ab("entries");if(!xse&&bse&&ED.name!=="values")try{gse(ED,"name",{value:"values"})}catch{}});var OD=M(()=>{"use strict";var Ese=we(),Sse=_t(),Ise=_u(),Ase=sn(),Ose=pa(),Cse=Sse([].join),Pse=Ise!=Object,Mse=Ose("join",",");Ese({target:"Array",proto:!0,forced:Pse||!Mse},{join:function(n){return Cse(Ase(this),n===void 0?",":n)}})});var Cb=M((O4e,PD)=>{"use strict";var qse=Un(),Rse=sn(),Dse=Ei(),Lse=Vr(),kse=pa(),zse=Math.min,Ob=[].lastIndexOf,CD=!!Ob&&1/[1].lastIndexOf(1,-0)<0,Bse=kse("lastIndexOf"),Fse=CD||!Bse;PD.exports=Fse?function(n){if(CD)return qse(Ob,this,arguments)||0;var l=Rse(this),o=Lse(l),c=o-1;for(arguments.length>1&&(c=zse(c,Dse(arguments[1]))),c<0&&(c=o+c);c>=0;c--)if(c in l&&l[c]===n)return c||0;return-1}:Ob});var qD=M(()=>{var Nse=we(),MD=Cb();Nse({target:"Array",proto:!0,forced:MD!==[].lastIndexOf},{lastIndexOf:MD})});var RD=M(()=>{"use strict";var Use=we(),jse=Mi().map,Vse=mh(),Gse=Vse("map");Use({target:"Array",proto:!0,forced:!Gse},{map:function(n){return jse(this,n,arguments.length>1?arguments[1]:void 0)}})});var LD=M(()=>{"use strict";var $se=we(),Wse=ft(),Zse=Tu(),Hse=ca(),DD=Array,Xse=Wse(function(){function s(){}return!(DD.of.call(s)instanceof s)});$se({target:"Array",stat:!0,forced:Xse},{of:function(){for(var n=0,l=arguments.length,o=new(Zse(this)?this:DD)(l);l>n;)Hse(o,n,arguments[n++]);return o.length=l,o}})});var dg=M((L4e,kD)=>{"use strict";var Yse=$t(),Kse=Ka(),Jse=TypeError,Qse=Object.getOwnPropertyDescriptor,ele=Yse&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(s){return s instanceof TypeError}}();kD.exports=ele?function(s,n){if(Kse(s)&&!Qse(s,"length").writable)throw Jse("Cannot set read only .length");return s.length=n}:function(s,n){return s.length=n}});var zD=M(()=>{"use strict";var tle=we(),rle=Mr(),ile=Vr(),nle=dg(),ole=dh(),ale=ft(),sle=ale(function(){return[].push.call({length:4294967296},1)!==4294967297}),lle=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(s){return s instanceof TypeError}}();tle({target:"Array",proto:!0,arity:1,forced:sle||lle},{push:function(n){var l=rle(this),o=ile(l),c=arguments.length;ole(o+c);for(var t=0;t<c;t++)l[o]=arguments[t],o++;return nle(l,o),o}})});var Ed=M((B4e,FD)=>{var ule=Ti(),cle=Mr(),hle=_u(),ple=Vr(),fle=TypeError,BD=function(s){return function(n,l,o,c){ule(l);var t=cle(n),g=hle(t),I=ple(t),P=s?I-1:0,q=s?-1:1;if(o<2)for(;;){if(P in g){c=g[P],P+=q;break}if(P+=q,s?P<0:I<=P)throw fle("Reduce of empty array with no initial value")}for(;s?P>=0:I>P;P+=q)P in g&&(c=l(c,g[P],P,t));return c}};FD.exports={left:BD(!1),right:BD(!0)}});var fa=M((F4e,ND)=>{var dle=on(),mle=Ct();ND.exports=dle(mle.process)=="process"});var jD=M(()=>{"use strict";var _le=we(),yle=Ed().left,gle=pa(),UD=sa(),vle=fa(),xle=gle("reduce"),ble=!vle&&UD>79&&UD<83;_le({target:"Array",proto:!0,forced:!xle||ble},{reduce:function(n){var l=arguments.length;return yle(this,n,l,l>1?arguments[1]:void 0)}})});var GD=M(()=>{"use strict";var wle=we(),Tle=Ed().right,Ele=pa(),VD=sa(),Sle=fa(),Ile=Ele("reduceRight"),Ale=!Sle&&VD>79&&VD<83;wle({target:"Array",proto:!0,forced:!Ile||Ale},{reduceRight:function(n){return Tle(this,n,arguments.length,arguments.length>1?arguments[1]:void 0)}})});var WD=M(()=>{"use strict";var Ole=we(),Cle=_t(),Ple=Ka(),Mle=Cle([].reverse),$D=[1,2];Ole({target:"Array",proto:!0,forced:String($D)===String($D.reverse())},{reverse:function(){return Ple(this)&&(this.length=this.length),Mle(this)}})});var XD=M(()=>{"use strict";var qle=we(),ZD=Ka(),Rle=Tu(),Dle=sr(),HD=ua(),Lle=Vr(),kle=sn(),zle=ca(),Ble=cr(),Fle=mh(),Nle=Hs(),Ule=Fle("slice"),jle=Ble("species"),Pb=Array,Vle=Math.max;qle({target:"Array",proto:!0,forced:!Ule},{slice:function(n,l){var o=kle(this),c=Lle(o),t=HD(n,c),g=HD(l===void 0?c:l,c),I,P,q;if(ZD(o)&&(I=o.constructor,Rle(I)&&(I===Pb||ZD(I.prototype))?I=void 0:Dle(I)&&(I=I[jle],I===null&&(I=void 0)),I===Pb||I===void 0))return Nle(o,t,g);for(P=new(I===void 0?Pb:I)(Vle(g-t,0)),q=0;t<g;t++,q++)t in o&&zle(P,q,o[t]);return P.length=q,P}})});var YD=M(()=>{"use strict";var Gle=we(),$le=Mi().some,Wle=pa(),Zle=Wle("some");Gle({target:"Array",proto:!0,forced:!Zle},{some:function(n){return $le(this,n,arguments.length>1?arguments[1]:void 0)}})});var mg=M((Y4e,JD)=>{var KD=sh(),Hle=Math.floor,Mb=function(s,n){var l=s.length,o=Hle(l/2);return l<8?Xle(s,n):Yle(s,Mb(KD(s,0,o),n),Mb(KD(s,o),n),n)},Xle=function(s,n){for(var l=s.length,o=1,c,t;o<l;){for(t=o,c=s[o];t&&n(s[t-1],c)>0;)s[t]=s[--t];t!==o++&&(s[t]=c)}return s},Yle=function(s,n,l,o){for(var c=n.length,t=l.length,g=0,I=0;g<c||I<t;)s[g+I]=g<c&&I<t?o(n[g],l[I])<=0?n[g++]:l[I++]:g<c?n[g++]:l[I++];return s};JD.exports=Mb});var qb=M((K4e,eL)=>{var Kle=aa(),QD=Kle.match(/firefox\/(\d+)/i);eL.exports=!!QD&&+QD[1]});var Rb=M((J4e,tL)=>{var Jle=aa();tL.exports=/MSIE|Trident/.test(Jle)});var _g=M((Q4e,iL)=>{var Qle=aa(),rL=Qle.match(/AppleWebKit\/(\d+)\./);iL.exports=!!rL&&+rL[1]});var pL=M(()=>{"use strict";var eue=we(),cL=_t(),tue=Ti(),rue=Mr(),nL=Vr(),iue=yd(),oL=hr(),Db=ft(),nue=mg(),oue=pa(),aL=qb(),aue=Rb(),sL=sa(),lL=_g(),Ys=[],uL=cL(Ys.sort),sue=cL(Ys.push),lue=Db(function(){Ys.sort(void 0)}),uue=Db(function(){Ys.sort(null)}),cue=oue("sort"),hL=!Db(function(){if(sL)return sL<70;if(!(aL&&aL>3)){if(aue)return!0;if(lL)return lL<603;var s="",n,l,o,c;for(n=65;n<76;n++){switch(l=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(c=0;c<47;c++)Ys.push({k:l+c,v:o})}for(Ys.sort(function(t,g){return g.v-t.v}),c=0;c<Ys.length;c++)l=Ys[c].k.charAt(0),s.charAt(s.length-1)!==l&&(s+=l);return s!=="DGBEFHACIJK"}}),hue=lue||!uue||!cue||!hL,pue=function(s){return function(n,l){return l===void 0?-1:n===void 0?1:s!==void 0?+s(n,l)||0:oL(n)>oL(l)?1:-1}};eue({target:"Array",proto:!0,forced:hue},{sort:function(n){n!==void 0&&tue(n);var l=rue(this);if(hL)return n===void 0?uL(l):uL(l,n);var o=[],c=nL(l),t,g;for(g=0;g<c;g++)g in l&&sue(o,l[g]);for(nue(o,pue(n)),t=nL(o),g=0;g<t;)l[g]=o[g++];for(;g<c;)iue(l,g++);return l}})});var Ou=M((rUe,dL)=>{"use strict";var fue=Hr(),due=qr(),mue=cr(),_ue=$t(),fL=mue("species");dL.exports=function(s){var n=fue(s),l=due.f;_ue&&n&&!n[fL]&&l(n,fL,{configurable:!0,get:function(){return this}})}});var mL=M(()=>{var yue=Ou();yue("Array")});var _L=M(()=>{"use strict";var gue=we(),vue=Mr(),xue=ua(),bue=Ei(),wue=Vr(),Tue=dg(),Eue=dh(),Sue=lh(),Iue=ca(),Lb=yd(),Aue=mh(),Oue=Aue("splice"),Cue=Math.max,Pue=Math.min;gue({target:"Array",proto:!0,forced:!Oue},{splice:function(n,l){var o=vue(this),c=wue(o),t=xue(n,c),g=arguments.length,I,P,q,L,V,oe;for(g===0?I=P=0:g===1?(I=0,P=c-t):(I=g-2,P=Pue(Cue(bue(l),0),c-t)),Eue(c+I-P),q=Sue(o,P),L=0;L<P;L++)V=t+L,V in o&&Iue(q,L,o[V]);if(q.length=P,I<P){for(L=t;L<c-P;L++)V=L+P,oe=L+I,V in o?o[oe]=o[V]:Lb(o,oe);for(L=c;L>c-P+I;L--)Lb(o,L-1)}else if(I>P)for(L=c-P;L>t;L--)V=L+P-1,oe=L+I-1,V in o?o[oe]=o[V]:Lb(o,oe);for(L=0;L<I;L++)o[L+t]=arguments[L+2];return Tue(o,c-P+I),q}})});var yL=M(()=>{var Mue=to();Mue("flat")});var gL=M(()=>{var que=to();que("flatMap")});var vL=M(()=>{"use strict";var Rue=we(),Due=Mr(),Lue=Vr(),kue=dg(),zue=yd(),Bue=dh(),Fue=[].unshift(0)!==1,Nue=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(s){return s instanceof TypeError}}();Rue({target:"Array",proto:!0,arity:1,forced:Fue||Nue},{unshift:function(n){var l=Due(this),o=Lue(l),c=arguments.length;if(c){Bue(o+c);for(var t=o;t--;){var g=t+c;t in l?l[g]=l[t]:zue(l,g)}for(var I=0;I<c;I++)l[I]=arguments[I]}return kue(l,o+c)}})});var yg=M((fUe,xL)=>{xL.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"});var _h=M((dUe,bL)=>{var Uue=Qr();bL.exports=function(s,n,l){for(var o in n)Uue(s,o,n[o],l);return s}});var Ro=M((mUe,wL)=>{var jue=Nn(),Vue=TypeError;wL.exports=function(s,n){if(jue(n,s))return s;throw Vue("Incorrect invocation")}});var kb=M((_Ue,TL)=>{var Gue=Ei(),$ue=wn(),Wue=RangeError;TL.exports=function(s){if(s===void 0)return 0;var n=Gue(s),l=$ue(n);if(n!==l)throw Wue("Wrong length or index");return l}});var SL=M((yUe,EL)=>{var Zue=Array,Hue=Math.abs,ts=Math.pow,Xue=Math.floor,Yue=Math.log,Kue=Math.LN2,Jue=function(s,n,l){var o=Zue(l),c=l*8-n-1,t=(1<<c)-1,g=t>>1,I=n===23?ts(2,-24)-ts(2,-77):0,P=s<0||s===0&&1/s<0?1:0,q=0,L,V,oe;for(s=Hue(s),s!=s||s===1/0?(V=s!=s?1:0,L=t):(L=Xue(Yue(s)/Kue),oe=ts(2,-L),s*oe<1&&(L--,oe*=2),L+g>=1?s+=I/oe:s+=I*ts(2,1-g),s*oe>=2&&(L++,oe/=2),L+g>=t?(V=0,L=t):L+g>=1?(V=(s*oe-1)*ts(2,n),L=L+g):(V=s*ts(2,g-1)*ts(2,n),L=0));n>=8;)o[q++]=V&255,V/=256,n-=8;for(L=L<<n|V,c+=n;c>0;)o[q++]=L&255,L/=256,c-=8;return o[--q]|=P*128,o},Que=function(s,n){var l=s.length,o=l*8-n-1,c=(1<<o)-1,t=c>>1,g=o-7,I=l-1,P=s[I--],q=P&127,L;for(P>>=7;g>0;)q=q*256+s[I--],g-=8;for(L=q&(1<<-g)-1,q>>=-g,g+=n;g>0;)L=L*256+s[I--],g-=8;if(q===0)q=1-t;else{if(q===c)return L?NaN:P?-1/0:1/0;L=L+ts(2,n),q=q-t}return(P?-1:1)*L*ts(2,q-n)};EL.exports={pack:Jue,unpack:Que}});var Id=M((gUe,GL)=>{"use strict";var Eg=Ct(),Vb=_t(),zb=$t(),ece=yg(),zL=bu(),IL=ln(),AL=_h(),Bb=ft(),gg=Ro(),tce=Ei(),rce=wn(),bg=kb(),BL=SL(),ice=jn(),OL=Mo(),nce=Ya().f,oce=qr().f,ace=lg(),sce=sh(),FL=En(),NL=_i(),lce=zL.PROPER,CL=zL.CONFIGURABLE,vh=NL.get,PL=NL.set,wg="ArrayBuffer",UL="DataView",gh="prototype",uce="Wrong length",jL="Wrong index",ro=Eg[wg],Vn=ro,yh=Vn&&Vn[gh],da=Eg[UL],Cu=da&&da[gh],ML=Object.prototype,cce=Eg.Array,Tg=Eg.RangeError,hce=Vb(ace),pce=Vb([].reverse),VL=BL.pack,qL=BL.unpack,RL=function(s){return[s&255]},DL=function(s){return[s&255,s>>8&255]},LL=function(s){return[s&255,s>>8&255,s>>16&255,s>>24&255]},kL=function(s){return s[3]<<24|s[2]<<16|s[1]<<8|s[0]},fce=function(s){return VL(s,23,4)},dce=function(s){return VL(s,52,8)},vg=function(s,n){oce(s[gh],n,{get:function(){return vh(this)[n]}})},Ks=function(s,n,l,o){var c=bg(l),t=vh(s);if(c+n>t.byteLength)throw Tg(jL);var g=vh(t.buffer).bytes,I=c+t.byteOffset,P=sce(g,I,I+n);return o?P:pce(P)},Js=function(s,n,l,o,c,t){var g=bg(l),I=vh(s);if(g+n>I.byteLength)throw Tg(jL);for(var P=vh(I.buffer).bytes,q=g+I.byteOffset,L=o(+c),V=0;V<n;V++)P[q+V]=L[t?V:n-V-1]};if(!ece)Vn=function(n){gg(this,yh);var l=bg(n);PL(this,{bytes:hce(cce(l),0),byteLength:l}),zb||(this.byteLength=l)},yh=Vn[gh],da=function(n,l,o){gg(this,Cu),gg(n,yh);var c=vh(n).byteLength,t=tce(l);if(t<0||t>c)throw Tg("Wrong offset");if(o=o===void 0?c-t:rce(o),t+o>c)throw Tg(uce);PL(this,{buffer:n,byteLength:o,byteOffset:t}),zb||(this.buffer=n,this.byteLength=o,this.byteOffset=t)},Cu=da[gh],zb&&(vg(Vn,"byteLength"),vg(da,"buffer"),vg(da,"byteLength"),vg(da,"byteOffset")),AL(Cu,{getInt8:function(n){return Ks(this,1,n)[0]<<24>>24},getUint8:function(n){return Ks(this,1,n)[0]},getInt16:function(n){var l=Ks(this,2,n,arguments.length>1?arguments[1]:void 0);return(l[1]<<8|l[0])<<16>>16},getUint16:function(n){var l=Ks(this,2,n,arguments.length>1?arguments[1]:void 0);return l[1]<<8|l[0]},getInt32:function(n){return kL(Ks(this,4,n,arguments.length>1?arguments[1]:void 0))},getUint32:function(n){return kL(Ks(this,4,n,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(n){return qL(Ks(this,4,n,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(n){return qL(Ks(this,8,n,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(n,l){Js(this,1,n,RL,l)},setUint8:function(n,l){Js(this,1,n,RL,l)},setInt16:function(n,l){Js(this,2,n,DL,l,arguments.length>2?arguments[2]:void 0)},setUint16:function(n,l){Js(this,2,n,DL,l,arguments.length>2?arguments[2]:void 0)},setInt32:function(n,l){Js(this,4,n,LL,l,arguments.length>2?arguments[2]:void 0)},setUint32:function(n,l){Js(this,4,n,LL,l,arguments.length>2?arguments[2]:void 0)},setFloat32:function(n,l){Js(this,4,n,fce,l,arguments.length>2?arguments[2]:void 0)},setFloat64:function(n,l){Js(this,8,n,dce,l,arguments.length>2?arguments[2]:void 0)}});else{if(Fb=lce&&ro.name!==wg,!Bb(function(){ro(1)})||!Bb(function(){new ro(-1)})||Bb(function(){return new ro,new ro(1.5),new ro(NaN),ro.length!=1||Fb&&!CL})){for(Vn=function(n){return gg(this,yh),new ro(bg(n))},Vn[gh]=yh,Nb=nce(ro),Ub=0;Nb.length>Ub;)(xg=Nb[Ub++])in Vn||IL(Vn,xg,ro[xg]);yh.constructor=Vn}else Fb&&CL&&IL(ro,"name",wg);OL&&ice(Cu)!==ML&&OL(Cu,ML),Sd=new da(new Vn(2)),jb=Vb(Cu.setInt8),Sd.setInt8(0,2147483648),Sd.setInt8(1,2147483649),(Sd.getInt8(0)||!Sd.getInt8(1))&&AL(Cu,{setInt8:function(n,l){jb(this,n,l<<24>>24)},setUint8:function(n,l){jb(this,n,l<<24>>24)}},{unsafe:!0})}var Fb,Nb,Ub,xg,Sd,jb;FL(Vn,wg);FL(da,UL);GL.exports={ArrayBuffer:Vn,DataView:da}});var WL=M(()=>{"use strict";var mce=we(),_ce=Ct(),yce=Id(),gce=Ou(),Gb="ArrayBuffer",$L=yce[Gb],vce=_ce[Gb];mce({global:!0,constructor:!0,forced:vce!==$L},{ArrayBuffer:$L});gce(Gb)});var yr=M((bUe,rk)=>{"use strict";var xce=yg(),Hb=$t(),cn=Ct(),YL=fr(),Ag=sr(),el=_r(),Xb=Po(),bce=$s(),wce=ln(),$b=Qr(),Tce=qr().f,Ece=Nn(),Og=jn(),bh=Mo(),Sce=cr(),Ice=vu(),KL=_i(),JL=KL.enforce,Ace=KL.get,Sg=cn.Int8Array,Wb=Sg&&Sg.prototype,ZL=cn.Uint8ClampedArray,HL=ZL&&ZL.prototype,ma=Sg&&Og(Sg),Do=Wb&&Og(Wb),Oce=Object.prototype,Yb=cn.TypeError,XL=Sce("toStringTag"),Zb=Ice("TYPED_ARRAY_TAG"),Ig="TypedArrayConstructor",rs=xce&&!!bh&&Xb(cn.opera)!=="Opera",QL=!1,In,Qs,xh,is={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Kb={BigInt64Array:8,BigUint64Array:8},Cce=function(n){if(!Ag(n))return!1;var l=Xb(n);return l==="DataView"||el(is,l)||el(Kb,l)},ek=function(s){var n=Og(s);if(!!Ag(n)){var l=Ace(n);return l&&el(l,Ig)?l[Ig]:ek(n)}},tk=function(s){if(!Ag(s))return!1;var n=Xb(s);return el(is,n)||el(Kb,n)},Pce=function(s){if(tk(s))return s;throw Yb("Target is not a typed array")},Mce=function(s){if(YL(s)&&(!bh||Ece(ma,s)))return s;throw Yb(bce(s)+" is not a typed array constructor")},qce=function(s,n,l,o){if(!!Hb){if(l)for(var c in is){var t=cn[c];if(t&&el(t.prototype,s))try{delete t.prototype[s]}catch{try{t.prototype[s]=n}catch{}}}(!Do[s]||l)&&$b(Do,s,l?n:rs&&Wb[s]||n,o)}},Rce=function(s,n,l){var o,c;if(!!Hb){if(bh){if(l){for(o in is)if(c=cn[o],c&&el(c,s))try{delete c[s]}catch{}}if(!ma[s]||l)try{return $b(ma,s,l?n:rs&&ma[s]||n)}catch{}else return}for(o in is)c=cn[o],c&&(!c[s]||l)&&$b(c,s,n)}};for(In in is)Qs=cn[In],xh=Qs&&Qs.prototype,xh?JL(xh)[Ig]=Qs:rs=!1;for(In in Kb)Qs=cn[In],xh=Qs&&Qs.prototype,xh&&(JL(xh)[Ig]=Qs);if((!rs||!YL(ma)||ma===Function.prototype)&&(ma=function(){throw Yb("Incorrect invocation")},rs))for(In in is)cn[In]&&bh(cn[In],ma);if((!rs||!Do||Do===Oce)&&(Do=ma.prototype,rs))for(In in is)cn[In]&&bh(cn[In].prototype,Do);rs&&Og(HL)!==Do&&bh(HL,Do);if(Hb&&!el(Do,XL)){QL=!0,Tce(Do,XL,{get:function(){return Ag(this)?this[Zb]:void 0}});for(In in is)cn[In]&&wce(cn[In],Zb,In)}rk.exports={NATIVE_ARRAY_BUFFER_VIEWS:rs,TYPED_ARRAY_TAG:QL&&Zb,aTypedArray:Pce,aTypedArrayConstructor:Mce,exportTypedArrayMethod:qce,exportTypedArrayStaticMethod:Rce,getTypedArrayConstructor:ek,isView:Cce,isTypedArray:tk,TypedArray:ma,TypedArrayPrototype:Do}});var nk=M(()=>{var Dce=we(),ik=yr(),Lce=ik.NATIVE_ARRAY_BUFFER_VIEWS;Dce({target:"ArrayBuffer",stat:!0,forced:!Lce},{isView:ik.isView})});var Cg=M((EUe,ok)=>{var kce=Tu(),zce=$s(),Bce=TypeError;ok.exports=function(s){if(kce(s))return s;throw Bce(zce(s)+" is not a constructor")}});var Pu=M((SUe,sk)=>{var ak=Qt(),Fce=Cg(),Nce=an(),Uce=cr(),jce=Uce("species");sk.exports=function(s,n){var l=ak(s).constructor,o;return l===void 0||Nce(o=ak(l)[jce])?n:Fce(o)}});var fk=M(()=>{"use strict";var Vce=we(),Qb=_t(),Gce=ft(),hk=Id(),lk=Qt(),uk=ua(),$ce=wn(),Wce=Pu(),ew=hk.ArrayBuffer,Jb=hk.DataView,pk=Jb.prototype,ck=Qb(ew.prototype.slice),Zce=Qb(pk.getUint8),Hce=Qb(pk.setUint8),Xce=Gce(function(){return!new ew(2).slice(1,void 0).byteLength});Vce({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Xce},{slice:function(n,l){if(ck&&l===void 0)return ck(lk(this),n);for(var o=lk(this).byteLength,c=uk(n,o),t=uk(l===void 0?o:l,o),g=new(Wce(this,ew))($ce(t-c)),I=new Jb(this),P=new Jb(g),q=0;c<t;)Hce(P,q++,Zce(I,c++));return g}})});var dk=M(()=>{var Yce=we(),Kce=Id(),Jce=yg();Yce({global:!0,constructor:!0,forced:!Jce},{DataView:Kce.DataView})});var mk=M(()=>{dk()});var _k=M(()=>{"use strict";var Qce=we(),ehe=_t(),the=ft(),rhe=the(function(){return new Date(16e11).getYear()!==120}),ihe=ehe(Date.prototype.getFullYear);Qce({target:"Date",proto:!0,forced:rhe},{getYear:function(){return ihe(this)-1900}})});var gk=M(()=>{var nhe=we(),ohe=_t(),yk=Date,ahe=ohe(yk.prototype.getTime);nhe({target:"Date",stat:!0},{now:function(){return ahe(new yk)}})});var bk=M(()=>{"use strict";var she=we(),vk=_t(),lhe=Ei(),xk=Date.prototype,uhe=vk(xk.getTime),che=vk(xk.setFullYear);she({target:"Date",proto:!0},{setYear:function(n){uhe(this);var l=lhe(n),o=0<=l&&l<=99?l+1900:l;return che(this,o)}})});var wk=M(()=>{var hhe=we();hhe({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString})});var Ad=M((NUe,Tk)=>{"use strict";var phe=Ei(),fhe=hr(),dhe=mi(),mhe=RangeError;Tk.exports=function(n){var l=fhe(dhe(this)),o="",c=phe(n);if(c<0||c==1/0)throw mhe("Wrong number of repetitions");for(;c>0;(c>>>=1)&&(l+=l))c&1&&(o+=l);return o}});var Pg=M((UUe,Ak)=>{var Ik=_t(),_he=wn(),Ek=hr(),yhe=Ad(),ghe=mi(),vhe=Ik(yhe),xhe=Ik("".slice),bhe=Math.ceil,Sk=function(s){return function(n,l,o){var c=Ek(ghe(n)),t=_he(l),g=c.length,I=o===void 0?" ":Ek(o),P,q;return t<=g||I==""?c:(P=t-g,q=vhe(I,bhe(P/I.length)),q.length>P&&(q=xhe(q,0,P)),s?c+q:q+c)}};Ak.exports={start:Sk(!1),end:Sk(!0)}});var Pk=M((jUe,Ck)=>{"use strict";var tl=_t(),Ok=ft(),Mu=Pg().start,whe=RangeError,The=isFinite,Ehe=Math.abs,ns=Date.prototype,tw=ns.toISOString,She=tl(ns.getTime),Ihe=tl(ns.getUTCDate),Ahe=tl(ns.getUTCFullYear),Ohe=tl(ns.getUTCHours),Che=tl(ns.getUTCMilliseconds),Phe=tl(ns.getUTCMinutes),Mhe=tl(ns.getUTCMonth),qhe=tl(ns.getUTCSeconds);Ck.exports=Ok(function(){return tw.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!Ok(function(){tw.call(new Date(NaN))})?function(){if(!The(She(this)))throw whe("Invalid time value");var n=this,l=Ahe(n),o=Che(n),c=l<0?"-":l>9999?"+":"";return c+Mu(Ehe(l),c?6:4,0)+"-"+Mu(Mhe(n)+1,2,0)+"-"+Mu(Ihe(n),2,0)+"T"+Mu(Ohe(n),2,0)+":"+Mu(Phe(n),2,0)+":"+Mu(qhe(n),2,0)+"."+Mu(o,3,0)+"Z"}:tw});var qk=M(()=>{var Rhe=we(),Mk=Pk();Rhe({target:"Date",proto:!0,forced:Date.prototype.toISOString!==Mk},{toISOString:Mk})});var Rk=M(()=>{"use strict";var Dhe=we(),Lhe=ft(),khe=Mr(),zhe=ed(),Bhe=Lhe(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});Dhe({target:"Date",proto:!0,arity:1,forced:Bhe},{toJSON:function(n){var l=khe(this),o=zhe(l,"number");return typeof o=="number"&&!isFinite(o)?null:l.toISOString()}})});var Lk=M((ZUe,Dk)=>{"use strict";var Fhe=Qt(),Nhe=s1(),Uhe=TypeError;Dk.exports=function(s){if(Fhe(this),s==="string"||s==="default")s="string";else if(s!=="number")throw Uhe("Incorrect hint");return Nhe(this,s)}});var Bk=M(()=>{var jhe=_r(),Vhe=Qr(),Ghe=Lk(),$he=cr(),kk=$he("toPrimitive"),zk=Date.prototype;jhe(zk,kk)||Vhe(zk,kk,Ghe)});var jk=M(()=>{var Nk=_t(),Whe=Qr(),rw=Date.prototype,Fk="Invalid Date",Uk="toString",Zhe=Nk(rw[Uk]),Hhe=Nk(rw.getTime);String(new Date(NaN))!=Fk&&Whe(rw,Uk,function(){var n=Hhe(this);return n===n?Zhe(this):Fk})});var Gk=M(()=>{"use strict";var Xhe=we(),Od=_t(),Yhe=hr(),Khe=Od("".charAt),Jhe=Od("".charCodeAt),Qhe=Od(/./.exec),epe=Od(1 .toString),tpe=Od("".toUpperCase),rpe=/[\w*+\-./@]/,Vk=function(s,n){for(var l=epe(s,16);l.length<n;)l="0"+l;return l};Xhe({global:!0},{escape:function(n){for(var l=Yhe(n),o="",c=l.length,t=0,g,I;t<c;)g=Khe(l,t++),Qhe(rpe,g)?o+=g:(I=Jhe(g,0),I<256?o+="%"+Vk(I,2):o+="%u"+tpe(Vk(I,4)));return o}})});var nw=M((e5e,Hk)=>{"use strict";var Wk=_t(),ipe=Ti(),npe=sr(),ope=_r(),$k=Hs(),ape=th(),Zk=Function,spe=Wk([].concat),lpe=Wk([].join),iw={},upe=function(s,n,l){if(!ope(iw,n)){for(var o=[],c=0;c<n;c++)o[c]="a["+c+"]";iw[n]=Zk("C,a","return new C("+lpe(o,",")+")")}return iw[n](s,l)};Hk.exports=ape?Zk.bind:function(n){var l=ipe(this),o=l.prototype,c=$k(arguments,1),t=function(){var I=spe(c,$k(arguments));return this instanceof t?upe(l,I.length,I):l.apply(n,I)};return npe(o)&&(t.prototype=o),t}});var Yk=M(()=>{var cpe=we(),Xk=nw();cpe({target:"Function",proto:!0,forced:Function.bind!==Xk},{bind:Xk})});var Qk=M(()=>{"use strict";var hpe=fr(),Kk=sr(),ppe=qr(),fpe=jn(),dpe=cr(),mpe=zy(),ow=dpe("hasInstance"),Jk=Function.prototype;ow in Jk||ppe.f(Jk,ow,{value:mpe(function(s){if(!hpe(this)||!Kk(s))return!1;var n=this.prototype;if(!Kk(n))return s instanceof this;for(;s=fpe(s);)if(n===s)return!0;return!1},ow)})});var iz=M(()=>{var _pe=$t(),ype=bu().EXISTS,ez=_t(),gpe=qr().f,tz=Function.prototype,vpe=ez(tz.toString),rz=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,xpe=ez(rz.exec),bpe="name";_pe&&!ype&&gpe(tz,bpe,{configurable:!0,get:function(){try{return xpe(rz,vpe(this))[1]}catch{return""}}})});var nz=M(()=>{var wpe=we(),aw=Ct();wpe({global:!0,forced:aw.globalThis!==aw},{globalThis:aw})});var oz=M(()=>{var Tpe=Ct(),Epe=En();Epe(Tpe.JSON,"JSON",!0)});var Mg=M((h5e,az)=>{var Spe=ft();az.exports=Spe(function(){if(typeof ArrayBuffer=="function"){var s=new ArrayBuffer(8);Object.isExtensible(s)&&Object.defineProperty(s,"a",{value:8})}})});var Cd=M((p5e,lz)=>{var Ipe=ft(),Ape=sr(),Ope=on(),sz=Mg(),qg=Object.isExtensible,Cpe=Ipe(function(){qg(1)});lz.exports=Cpe||sz?function(n){return!Ape(n)||sz&&Ope(n)=="ArrayBuffer"?!1:qg?qg(n):!0}:qg});var wh=M((f5e,uz)=>{var Ppe=ft();uz.exports=!Ppe(function(){return Object.isExtensible(Object.preventExtensions({}))})});var rl=M((d5e,pz)=>{var Mpe=we(),qpe=_t(),Rpe=ih(),Dpe=sr(),sw=_r(),Lpe=qr().f,cz=Ya(),kpe=$y(),lw=Cd(),zpe=vu(),Bpe=wh(),hz=!1,os=zpe("meta"),Fpe=0,uw=function(s){Lpe(s,os,{value:{objectID:"O"+Fpe++,weakData:{}}})},Npe=function(s,n){if(!Dpe(s))return typeof s=="symbol"?s:(typeof s=="string"?"S":"P")+s;if(!sw(s,os)){if(!lw(s))return"F";if(!n)return"E";uw(s)}return s[os].objectID},Upe=function(s,n){if(!sw(s,os)){if(!lw(s))return!0;if(!n)return!1;uw(s)}return s[os].weakData},jpe=function(s){return Bpe&&hz&&lw(s)&&!sw(s,os)&&uw(s),s},Vpe=function(){Gpe.enable=function(){},hz=!0;var s=cz.f,n=qpe([].splice),l={};l[os]=1,s(l).length&&(cz.f=function(o){for(var c=s(o),t=0,g=c.length;t<g;t++)if(c[t]===os){n(c,t,1);break}return c},Mpe({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:kpe.f}))},Gpe=pz.exports={enable:Vpe,fastKey:Npe,getWeakData:Upe,onFreeze:jpe};Rpe[os]=!0});var Pd=M((m5e,dz)=>{"use strict";var $pe=we(),Wpe=Ct(),Zpe=_t(),fz=oh(),Hpe=Qr(),Xpe=rl(),Ype=qo(),Kpe=Ro(),Jpe=fr(),Qpe=an(),cw=sr(),hw=ft(),efe=vd(),tfe=En(),rfe=Iu();dz.exports=function(s,n,l){var o=s.indexOf("Map")!==-1,c=s.indexOf("Weak")!==-1,t=o?"set":"add",g=Wpe[s],I=g&&g.prototype,P=g,q={},L=function(Ze){var et=Zpe(I[Ze]);Hpe(I,Ze,Ze=="add"?function(It){return et(this,It===0?0:It),this}:Ze=="delete"?function(He){return c&&!cw(He)?!1:et(this,He===0?0:He)}:Ze=="get"?function(It){return c&&!cw(It)?void 0:et(this,It===0?0:It)}:Ze=="has"?function(It){return c&&!cw(It)?!1:et(this,It===0?0:It)}:function(It,Yt){return et(this,It===0?0:It,Yt),this})},V=fz(s,!Jpe(g)||!(c||I.forEach&&!hw(function(){new g().entries().next()})));if(V)P=l.getConstructor(n,s,o,t),Xpe.enable();else if(fz(s,!0)){var oe=new P,ne=oe[t](c?{}:-0,1)!=oe,Ie=hw(function(){oe.has(1)}),Se=efe(function(Ze){new g(Ze)}),Re=!c&&hw(function(){for(var Ze=new g,et=5;et--;)Ze[t](et,et);return!Ze.has(-0)});Se||(P=n(function(Ze,et){Kpe(Ze,I);var He=rfe(new g,Ze,P);return Qpe(et)||Ype(et,He[t],{that:He,AS_ENTRIES:o}),He}),P.prototype=I,I.constructor=P),(Ie||Re)&&(L("delete"),L("has"),o&&L("get")),(Re||ne)&&L(t),c&&I.clear&&delete I.clear}return q[s]=P,$pe({global:!0,constructor:!0,forced:P!=g},q),tfe(P,s),c||l.setStrong(P,s,o),P}});var fw=M((_5e,vz)=>{"use strict";var ife=qr().f,nfe=Tn(),mz=_h(),ofe=Qn(),afe=Ro(),sfe=an(),lfe=qo(),ufe=pg(),Rg=wd(),cfe=Ou(),Md=$t(),_z=rl().fastKey,gz=_i(),yz=gz.set,pw=gz.getterFor;vz.exports={getConstructor:function(s,n,l,o){var c=s(function(q,L){afe(q,t),yz(q,{type:n,index:nfe(null),first:void 0,last:void 0,size:0}),Md||(q.size=0),sfe(L)||lfe(L,q[o],{that:q,AS_ENTRIES:l})}),t=c.prototype,g=pw(n),I=function(q,L,V){var oe=g(q),ne=P(q,L),Ie,Se;return ne?ne.value=V:(oe.last=ne={index:Se=_z(L,!0),key:L,value:V,previous:Ie=oe.last,next:void 0,removed:!1},oe.first||(oe.first=ne),Ie&&(Ie.next=ne),Md?oe.size++:q.size++,Se!=="F"&&(oe.index[Se]=ne)),q},P=function(q,L){var V=g(q),oe=_z(L),ne;if(oe!=="F")return V.index[oe];for(ne=V.first;ne;ne=ne.next)if(ne.key==L)return ne};return mz(t,{clear:function(){for(var L=this,V=g(L),oe=V.index,ne=V.first;ne;)ne.removed=!0,ne.previous&&(ne.previous=ne.previous.next=void 0),delete oe[ne.index],ne=ne.next;V.first=V.last=void 0,Md?V.size=0:L.size=0},delete:function(q){var L=this,V=g(L),oe=P(L,q);if(oe){var ne=oe.next,Ie=oe.previous;delete V.index[oe.index],oe.removed=!0,Ie&&(Ie.next=ne),ne&&(ne.previous=Ie),V.first==oe&&(V.first=ne),V.last==oe&&(V.last=Ie),Md?V.size--:L.size--}return!!oe},forEach:function(L){for(var V=g(this),oe=ofe(L,arguments.length>1?arguments[1]:void 0),ne;ne=ne?ne.next:V.first;)for(oe(ne.value,ne.key,this);ne&&ne.removed;)ne=ne.previous},has:function(L){return!!P(this,L)}}),mz(t,l?{get:function(L){var V=P(this,L);return V&&V.value},set:function(L,V){return I(this,L===0?0:L,V)}}:{add:function(L){return I(this,L=L===0?0:L,L)}}),Md&&ife(t,"size",{get:function(){return g(this).size}}),c},setStrong:function(s,n,l){var o=n+" Iterator",c=pw(n),t=pw(o);ufe(s,n,function(g,I){yz(this,{type:o,target:g,state:c(g),kind:I,last:void 0})},function(){for(var g=t(this),I=g.kind,P=g.last;P&&P.removed;)P=P.previous;return!g.target||!(g.last=P=P?P.next:g.state.first)?(g.target=void 0,Rg(void 0,!0)):I=="keys"?Rg(P.key,!1):I=="values"?Rg(P.value,!1):Rg([P.key,P.value],!1)},l?"entries":"values",!l,!0),cfe(n)}}});var xz=M(()=>{"use strict";var hfe=Pd(),pfe=fw();hfe("Map",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},pfe)});var bz=M(()=>{xz()});var dw=M((b5e,wz)=>{var ffe=Math.log;wz.exports=Math.log1p||function(n){var l=+n;return l>-1e-8&&l<1e-8?l-l*l/2:ffe(1+l)}});var Ez=M(()=>{var dfe=we(),mfe=dw(),mw=Math.acosh,_fe=Math.log,Tz=Math.sqrt,yfe=Math.LN2,gfe=!mw||Math.floor(mw(Number.MAX_VALUE))!=710||mw(1/0)!=1/0;dfe({target:"Math",stat:!0,forced:gfe},{acosh:function(n){var l=+n;return l<1?NaN:l>9490626562425156e-8?_fe(l)+yfe:mfe(l-1+Tz(l-1)*Tz(l+1))}})});var Az=M(()=>{var vfe=we(),Sz=Math.asinh,xfe=Math.log,bfe=Math.sqrt;function Iz(s){var n=+s;return!isFinite(n)||n==0?n:n<0?-Iz(-n):xfe(n+bfe(n*n+1))}vfe({target:"Math",stat:!0,forced:!(Sz&&1/Sz(0)>0)},{asinh:Iz})});var Cz=M(()=>{var wfe=we(),Oz=Math.atanh,Tfe=Math.log;wfe({target:"Math",stat:!0,forced:!(Oz&&1/Oz(-0)<0)},{atanh:function(n){var l=+n;return l==0?l:Tfe((1+l)/(1-l))/2}})});var Dg=M((O5e,Pz)=>{Pz.exports=Math.sign||function(n){var l=+n;return l==0||l!=l?l:l<0?-1:1}});var Mz=M(()=>{var Efe=we(),Sfe=Dg(),Ife=Math.abs,Afe=Math.pow;Efe({target:"Math",stat:!0},{cbrt:function(n){var l=+n;return Sfe(l)*Afe(Ife(l),1/3)}})});var qz=M(()=>{var Ofe=we(),Cfe=Math.floor,Pfe=Math.log,Mfe=Math.LOG2E;Ofe({target:"Math",stat:!0},{clz32:function(n){var l=n>>>0;return l?31-Cfe(Pfe(l+.5)*Mfe):32}})});var Rd=M((R5e,Rz)=>{var qd=Math.expm1,qfe=Math.exp;Rz.exports=!qd||qd(10)>22025.465794806718||qd(10)<22025.465794806718||qd(-2e-17)!=-2e-17?function(n){var l=+n;return l==0?l:l>-1e-6&&l<1e-6?l+l*l/2:qfe(l)-1}:qd});var Lz=M(()=>{var Rfe=we(),Dfe=Rd(),Dz=Math.cosh,Lfe=Math.abs,_w=Math.E;Rfe({target:"Math",stat:!0,forced:!Dz||Dz(710)===1/0},{cosh:function(n){var l=Dfe(Lfe(n)-1)+1;return(l+1/(l*_w*_w))*(_w/2)}})});var zz=M(()=>{var kfe=we(),kz=Rd();kfe({target:"Math",stat:!0,forced:kz!=Math.expm1},{expm1:kz})});var Fz=M((B5e,Bz)=>{var zfe=Dg(),Bfe=Math.abs,kg=Math.pow,gw=kg(2,-52),Lg=kg(2,-23),Ffe=kg(2,127)*(2-Lg),yw=kg(2,-126),Nfe=function(s){return s+1/gw-1/gw};Bz.exports=Math.fround||function(n){var l=+n,o=Bfe(l),c=zfe(l),t,g;return o<yw?c*Nfe(o/yw/Lg)*yw*Lg:(t=(1+Lg/gw)*o,g=t-(t-o),g>Ffe||g!=g?c*(1/0):c*g)}});var Nz=M(()=>{var Ufe=we(),jfe=Fz();Ufe({target:"Math",stat:!0},{fround:jfe})});var jz=M(()=>{var Vfe=we(),Uz=Math.hypot,Gfe=Math.abs,$fe=Math.sqrt,Wfe=!!Uz&&Uz(1/0,NaN)!==1/0;Vfe({target:"Math",stat:!0,arity:2,forced:Wfe},{hypot:function(n,l){for(var o=0,c=0,t=arguments.length,g=0,I,P;c<t;)I=Gfe(arguments[c++]),g<I?(P=g/I,o=o*P*P+1,g=I):I>0?(P=I/g,o+=P*P):o+=I;return g===1/0?1/0:g*$fe(o)}})});var Gz=M(()=>{var Zfe=we(),Hfe=ft(),Vz=Math.imul,Xfe=Hfe(function(){return Vz(4294967295,5)!=-5||Vz.length!=2});Zfe({target:"Math",stat:!0,forced:Xfe},{imul:function(n,l){var o=65535,c=+n,t=+l,g=o&c,I=o&t;return 0|g*I+((o&c>>>16)*I+g*(o&t>>>16)<<16>>>0)}})});var vw=M(($5e,$z)=>{var Yfe=Math.log,Kfe=Math.LOG10E;$z.exports=Math.log10||function(n){return Yfe(n)*Kfe}});var Wz=M(()=>{var Jfe=we(),Qfe=vw();Jfe({target:"Math",stat:!0},{log10:Qfe})});var Zz=M(()=>{var ede=we(),tde=dw();ede({target:"Math",stat:!0},{log1p:tde})});var Hz=M(()=>{var rde=we(),ide=Math.log,nde=Math.LN2;rde({target:"Math",stat:!0},{log2:function(n){return ide(n)/nde}})});var Xz=M(()=>{var ode=we(),ade=Dg();ode({target:"Math",stat:!0},{sign:ade})});var Jz=M(()=>{var sde=we(),lde=ft(),Yz=Rd(),ude=Math.abs,Kz=Math.exp,cde=Math.E,hde=lde(function(){return Math.sinh(-2e-17)!=-2e-17});sde({target:"Math",stat:!0,forced:hde},{sinh:function(n){var l=+n;return ude(l)<1?(Yz(l)-Yz(-l))/2:(Kz(l-1)-Kz(-l-1))*(cde/2)}})});var t3=M(()=>{var pde=we(),Qz=Rd(),e3=Math.exp;pde({target:"Math",stat:!0},{tanh:function(n){var l=+n,o=Qz(l),c=Qz(-l);return o==1/0?1:c==1/0?-1:(o-c)/(e3(l)+e3(-l))}})});var r3=M(()=>{var fde=En();fde(Math,"Math",!0)});var i3=M(()=>{var dde=we(),mde=T1();dde({target:"Math",stat:!0},{trunc:mde})});var Dd=M((l6e,n3)=>{var _de=_t();n3.exports=_de(1 .valueOf)});var Ld=M((u6e,o3)=>{o3.exports=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`});var qu=M((c6e,s3)=>{var yde=_t(),gde=mi(),vde=hr(),xde=Ld(),a3=yde("".replace),zg="["+xde+"]",bde=RegExp("^"+zg+zg+"*"),wde=RegExp(zg+zg+"*$"),xw=function(s){return function(n){var l=vde(gde(n));return s&1&&(l=a3(l,bde,"")),s&2&&(l=a3(l,wde,"")),l}};s3.exports={start:xw(1),end:xw(2),trim:xw(3)}});var h3=M(()=>{"use strict";var Tde=$t(),Ew=Ct(),u3=_t(),Ede=oh(),Sde=Qr(),l3=_r(),Ide=Iu(),Ade=Nn(),Ode=Gs(),c3=ed(),Cde=ft(),Pde=Ya().f,Mde=Ui().f,qde=qr().f,Rde=Dd(),Dde=qu().trim,Tw="Number",il=Ew[Tw],bw=il.prototype,Lde=Ew.TypeError,kde=u3("".slice),Bg=u3("".charCodeAt),zde=function(s){var n=c3(s,"number");return typeof n=="bigint"?n:Bde(n)},Bde=function(s){var n=c3(s,"number"),l,o,c,t,g,I,P,q;if(Ode(n))throw Lde("Cannot convert a Symbol value to a number");if(typeof n=="string"&&n.length>2){if(n=Dde(n),l=Bg(n,0),l===43||l===45){if(o=Bg(n,2),o===88||o===120)return NaN}else if(l===48){switch(Bg(n,1)){case 66:case 98:c=2,t=49;break;case 79:case 111:c=8,t=55;break;default:return+n}for(g=kde(n,2),I=g.length,P=0;P<I;P++)if(q=Bg(g,P),q<48||q>t)return NaN;return parseInt(g,c)}}return+n};if(Ede(Tw,!il(" 0o1")||!il("0b1")||il("+0x1"))){for(Ru=function(n){var l=arguments.length<1?0:il(zde(n)),o=this;return Ade(bw,o)&&Cde(function(){Rde(o)})?Ide(Object(l),o,Ru):l},ww=Tde?Pde(il):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Fg=0;ww.length>Fg;Fg++)l3(il,kd=ww[Fg])&&!l3(Ru,kd)&&qde(Ru,kd,Mde(il,kd));Ru.prototype=bw,bw.constructor=Ru,Sde(Ew,Tw,Ru,{constructor:!0})}var Ru,ww,Fg,kd});var p3=M(()=>{var Fde=we();Fde({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})});var d3=M((m6e,f3)=>{var Nde=Ct(),Ude=Nde.isFinite;f3.exports=Number.isFinite||function(n){return typeof n=="number"&&Ude(n)}});var m3=M(()=>{var jde=we(),Vde=d3();jde({target:"Number",stat:!0},{isFinite:Vde})});var Ng=M((g6e,_3)=>{var Gde=sr(),$de=Math.floor;_3.exports=Number.isInteger||function(n){return!Gde(n)&&isFinite(n)&&$de(n)===n}});var y3=M(()=>{var Wde=we(),Zde=Ng();Wde({target:"Number",stat:!0},{isInteger:Zde})});var g3=M(()=>{var Hde=we();Hde({target:"Number",stat:!0},{isNaN:function(n){return n!=n}})});var v3=M(()=>{var Xde=we(),Yde=Ng(),Kde=Math.abs;Xde({target:"Number",stat:!0},{isSafeInteger:function(n){return Yde(n)&&Kde(n)<=9007199254740991}})});var x3=M(()=>{var Jde=we();Jde({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})});var b3=M(()=>{var Qde=we();Qde({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})});var Sw=M((C6e,S3)=>{var E3=Ct(),eme=ft(),tme=_t(),rme=hr(),ime=qu().trim,nme=Ld(),ome=tme("".charAt),Ug=E3.parseFloat,w3=E3.Symbol,T3=w3&&w3.iterator,ame=1/Ug(nme+"-0")!==-1/0||T3&&!eme(function(){Ug(Object(T3))});S3.exports=ame?function(n){var l=ime(rme(n)),o=Ug(l);return o===0&&ome(l,0)=="-"?-0:o}:Ug});var A3=M(()=>{var sme=we(),I3=Sw();sme({target:"Number",stat:!0,forced:Number.parseFloat!=I3},{parseFloat:I3})});var Iw=M((q6e,R3)=>{var M3=Ct(),lme=ft(),ume=_t(),cme=hr(),hme=qu().trim,O3=Ld(),zd=M3.parseInt,C3=M3.Symbol,P3=C3&&C3.iterator,q3=/^[+-]?0x/i,pme=ume(q3.exec),fme=zd(O3+"08")!==8||zd(O3+"0x16")!==22||P3&&!lme(function(){zd(Object(P3))});R3.exports=fme?function(n,l){var o=hme(cme(n));return zd(o,l>>>0||(pme(q3,o)?16:10))}:zd});var L3=M(()=>{var dme=we(),D3=Iw();dme({target:"Number",stat:!0,forced:Number.parseInt!=D3},{parseInt:D3})});var N3=M(()=>{"use strict";var mme=we(),Aw=_t(),_me=Ei(),yme=Dd(),gme=Ad(),vme=vw(),jg=ft(),xme=RangeError,k3=String,bme=isFinite,wme=Math.abs,Tme=Math.floor,z3=Math.pow,Eme=Math.round,_a=Aw(1 .toExponential),Sme=Aw(gme),B3=Aw("".slice),F3=_a(-69e-12,4)==="-6.9000e-11"&&_a(1.255,2)==="1.25e+0"&&_a(12345,3)==="1.235e+4"&&_a(25,0)==="3e+1",Ime=jg(function(){_a(1,1/0)})&&jg(function(){_a(1,-1/0)}),Ame=!jg(function(){_a(1/0,1/0)})&&!jg(function(){_a(NaN,1/0)}),Ome=!F3||!Ime||!Ame;mme({target:"Number",proto:!0,forced:Ome},{toExponential:function(n){var l=yme(this);if(n===void 0)return _a(l);var o=_me(n);if(!bme(l))return String(l);if(o<0||o>20)throw xme("Incorrect fraction digits");if(F3)return _a(l,o);var c="",t="",g=0,I="",P="";if(l<0&&(c="-",l=-l),l===0)g=0,t=Sme("0",o+1);else{var q=vme(l);g=Tme(q);var L=0,V=z3(10,g-o);L=Eme(l/V),2*l>=(2*L+1)*V&&(L+=1),L>=z3(10,o+1)&&(L/=10,g+=1),t=k3(L)}return o!==0&&(t=B3(t,0,1)+"."+B3(t,1)),g===0?(I="+",P="0"):(I=g>0?"+":"-",P=k3(wme(g))),t+="e"+I+P,c+t}})});var W3=M(()=>{"use strict";var Cme=we(),Pw=_t(),Pme=Ei(),Mme=Dd(),qme=Ad(),U3=ft(),Rme=RangeError,G3=String,$3=Math.floor,Cw=Pw(qme),j3=Pw("".slice),Bd=Pw(1 .toFixed),Eh=function(s,n,l){return n===0?l:n%2===1?Eh(s,n-1,l*s):Eh(s*s,n/2,l)},Dme=function(s){for(var n=0,l=s;l>=4096;)n+=12,l/=4096;for(;l>=2;)n+=1,l/=2;return n},Th=function(s,n,l){for(var o=-1,c=l;++o<6;)c+=n*s[o],s[o]=c%1e7,c=$3(c/1e7)},Ow=function(s,n){for(var l=6,o=0;--l>=0;)o+=s[l],s[l]=$3(o/n),o=o%n*1e7},V3=function(s){for(var n=6,l="";--n>=0;)if(l!==""||n===0||s[n]!==0){var o=G3(s[n]);l=l===""?o:l+Cw("0",7-o.length)+o}return l},Lme=U3(function(){return Bd(8e-5,3)!=="0.000"||Bd(.9,0)!=="1"||Bd(1.255,2)!=="1.25"||Bd(0xde0b6b3a7640080,0)!=="1000000000000000128"})||!U3(function(){Bd({})});Cme({target:"Number",proto:!0,forced:Lme},{toFixed:function(n){var l=Mme(this),o=Pme(n),c=[0,0,0,0,0,0],t="",g="0",I,P,q,L;if(o<0||o>20)throw Rme("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return G3(l);if(l<0&&(t="-",l=-l),l>1e-21)if(I=Dme(l*Eh(2,69,1))-69,P=I<0?l*Eh(2,-I,1):l/Eh(2,I,1),P*=4503599627370496,I=52-I,I>0){for(Th(c,0,P),q=o;q>=7;)Th(c,1e7,0),q-=7;for(Th(c,Eh(10,q,1),0),q=I-1;q>=23;)Ow(c,1<<23),q-=23;Ow(c,1<<q),Th(c,1,1),Ow(c,2),g=V3(c)}else Th(c,0,P),Th(c,1<<-I,0),g=V3(c)+Cw("0",o);return o>0?(L=g.length,g=t+(L<=o?"0."+Cw("0",o-L)+g:j3(g,0,L-o)+"."+j3(g,L-o))):g=t+g,g}})});var X3=M(()=>{"use strict";var kme=we(),zme=_t(),Z3=ft(),H3=Dd(),Vg=zme(1 .toPrecision),Bme=Z3(function(){return Vg(1,void 0)!=="1"})||!Z3(function(){Vg({})});kme({target:"Number",proto:!0,forced:Bme},{toPrecision:function(n){return n===void 0?Vg(H3(this)):Vg(H3(this),n)}})});var qw=M((U6e,J3)=>{"use strict";var Y3=$t(),Fme=_t(),Nme=ar(),Ume=ft(),Mw=ah(),jme=nd(),Vme=Qf(),Gme=Mr(),$me=_u(),Sh=Object.assign,K3=Object.defineProperty,Wme=Fme([].concat);J3.exports=!Sh||Ume(function(){if(Y3&&Sh({b:1},Sh(K3({},"a",{enumerable:!0,get:function(){K3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var s={},n={},l=Symbol(),o="abcdefghijklmnopqrst";return s[l]=7,o.split("").forEach(function(c){n[c]=c}),Sh({},s)[l]!=7||Mw(Sh({},n)).join("")!=o})?function(n,l){for(var o=Gme(n),c=arguments.length,t=1,g=jme.f,I=Vme.f;c>t;)for(var P=$me(arguments[t++]),q=g?Wme(Mw(P),g(P)):Mw(P),L=q.length,V=0,oe;L>V;)oe=q[V++],(!Y3||Nme(I,P,oe))&&(o[oe]=P[oe]);return o}:Sh});var eB=M(()=>{var Zme=we(),Q3=qw();Zme({target:"Object",stat:!0,arity:2,forced:Object.assign!==Q3},{assign:Q3})});var tB=M(()=>{var Hme=we(),Xme=$t(),Yme=Tn();Hme({target:"Object",stat:!0,sham:!Xme},{create:Yme})});var Fd=M((W6e,iB)=>{"use strict";var Kme=li(),Jme=Ct(),Qme=ft(),rB=_g();iB.exports=Kme||!Qme(function(){if(!(rB&&rB<535)){var s=Math.random();__defineSetter__.call(null,s,function(){}),delete Jme[s]}})});var nB=M(()=>{"use strict";var e_e=we(),t_e=$t(),r_e=Fd(),i_e=Ti(),n_e=Mr(),o_e=qr();t_e&&e_e({target:"Object",proto:!0,forced:r_e},{__defineGetter__:function(n,l){o_e.f(n_e(this),n,{get:i_e(l),enumerable:!0,configurable:!0})}})});var aB=M(()=>{var a_e=we(),s_e=$t(),oB=jy().f;a_e({target:"Object",stat:!0,forced:Object.defineProperties!==oB,sham:!s_e},{defineProperties:oB})});var lB=M(()=>{var l_e=we(),u_e=$t(),sB=qr().f;l_e({target:"Object",stat:!0,forced:Object.defineProperty!==sB,sham:!u_e},{defineProperty:sB})});var uB=M(()=>{"use strict";var c_e=we(),h_e=$t(),p_e=Fd(),f_e=Ti(),d_e=Mr(),m_e=qr();h_e&&c_e({target:"Object",proto:!0,forced:p_e},{__defineSetter__:function(n,l){m_e.f(d_e(this),n,{set:f_e(l),enumerable:!0,configurable:!0})}})});var Rw=M((tje,pB)=>{var __e=$t(),hB=_t(),y_e=ah(),g_e=sn(),v_e=Qf().f,x_e=hB(v_e),b_e=hB([].push),cB=function(s){return function(n){for(var l=g_e(n),o=y_e(l),c=o.length,t=0,g=[],I;c>t;)I=o[t++],(!__e||x_e(l,I))&&b_e(g,s?[I,l[I]]:l[I]);return g}};pB.exports={entries:cB(!0),values:cB(!1)}});var fB=M(()=>{var w_e=we(),T_e=Rw().entries;w_e({target:"Object",stat:!0},{entries:function(n){return T_e(n)}})});var dB=M(()=>{var E_e=we(),S_e=wh(),I_e=ft(),A_e=sr(),O_e=rl().onFreeze,Dw=Object.freeze,C_e=I_e(function(){Dw(1)});E_e({target:"Object",stat:!0,forced:C_e,sham:!S_e},{freeze:function(n){return Dw&&A_e(n)?Dw(O_e(n)):n}})});var mB=M(()=>{var P_e=we(),M_e=qo(),q_e=ca();P_e({target:"Object",stat:!0},{fromEntries:function(n){var l={};return M_e(n,function(o,c){q_e(l,o,c)},{AS_ENTRIES:!0}),l}})});var gB=M(()=>{var R_e=we(),D_e=ft(),L_e=sn(),_B=Ui().f,yB=$t(),k_e=D_e(function(){_B(1)}),z_e=!yB||k_e;R_e({target:"Object",stat:!0,forced:z_e,sham:!yB},{getOwnPropertyDescriptor:function(n,l){return _B(L_e(n),l)}})});var vB=M(()=>{var B_e=we(),F_e=$t(),N_e=Fy(),U_e=sn(),j_e=Ui(),V_e=ca();B_e({target:"Object",stat:!0,sham:!F_e},{getOwnPropertyDescriptors:function(n){for(var l=U_e(n),o=j_e.f,c=N_e(l),t={},g=0,I,P;c.length>g;)P=o(l,I=c[g++]),P!==void 0&&V_e(t,I,P);return t}})});var xB=M(()=>{var G_e=we(),$_e=ft(),W_e=$y().f,Z_e=$_e(function(){return!Object.getOwnPropertyNames(1)});G_e({target:"Object",stat:!0,forced:Z_e},{getOwnPropertyNames:W_e})});var wB=M(()=>{var H_e=we(),X_e=ft(),Y_e=Mr(),bB=jn(),K_e=rg(),J_e=X_e(function(){bB(1)});H_e({target:"Object",stat:!0,forced:J_e,sham:!K_e},{getPrototypeOf:function(n){return bB(Y_e(n))}})});var TB=M(()=>{var Q_e=we(),eye=_r();Q_e({target:"Object",stat:!0},{hasOwn:eye})});var Lw=M((gje,EB)=>{EB.exports=Object.is||function(n,l){return n===l?n!==0||1/n===1/l:n!=n&&l!=l}});var SB=M(()=>{var tye=we(),rye=Lw();tye({target:"Object",stat:!0},{is:rye})});var AB=M(()=>{var iye=we(),IB=Cd();iye({target:"Object",stat:!0,forced:Object.isExtensible!==IB},{isExtensible:IB})});var CB=M(()=>{var nye=we(),oye=ft(),aye=sr(),sye=on(),OB=Mg(),kw=Object.isFrozen,lye=oye(function(){kw(1)});nye({target:"Object",stat:!0,forced:lye||OB},{isFrozen:function(n){return!aye(n)||OB&&sye(n)=="ArrayBuffer"?!0:kw?kw(n):!1}})});var MB=M(()=>{var uye=we(),cye=ft(),hye=sr(),pye=on(),PB=Mg(),zw=Object.isSealed,fye=cye(function(){zw(1)});uye({target:"Object",stat:!0,forced:fye||PB},{isSealed:function(n){return!hye(n)||PB&&pye(n)=="ArrayBuffer"?!0:zw?zw(n):!1}})});var RB=M(()=>{var dye=we(),mye=Mr(),qB=ah(),_ye=ft(),yye=_ye(function(){qB(1)});dye({target:"Object",stat:!0,forced:yye},{keys:function(n){return qB(mye(n))}})});var DB=M(()=>{"use strict";var gye=we(),vye=$t(),xye=Fd(),bye=Mr(),wye=Xa(),Tye=jn(),Eye=Ui().f;vye&&gye({target:"Object",proto:!0,forced:xye},{__lookupGetter__:function(n){var l=bye(this),o=wye(n),c;do if(c=Eye(l,o))return c.get;while(l=Tye(l))}})});var LB=M(()=>{"use strict";var Sye=we(),Iye=$t(),Aye=Fd(),Oye=Mr(),Cye=Xa(),Pye=jn(),Mye=Ui().f;Iye&&Sye({target:"Object",proto:!0,forced:Aye},{__lookupSetter__:function(n){var l=Oye(this),o=Cye(n),c;do if(c=Mye(l,o))return c.set;while(l=Pye(l))}})});var kB=M(()=>{var qye=we(),Rye=sr(),Dye=rl().onFreeze,Lye=wh(),kye=ft(),Bw=Object.preventExtensions,zye=kye(function(){Bw(1)});qye({target:"Object",stat:!0,forced:zye,sham:!Lye},{preventExtensions:function(n){return Bw&&Rye(n)?Bw(Dye(n)):n}})});var nl=M((Lje,BB)=>{var zB=zy(),Bye=qr();BB.exports=function(s,n,l){return l.get&&zB(l.get,n,{getter:!0}),l.set&&zB(l.set,n,{setter:!0}),Bye.f(s,n,l)}});var GB=M(()=>{"use strict";var Fye=$t(),Nye=nl(),FB=sr(),Uye=Mr(),jye=mi(),NB=Object.getPrototypeOf,UB=Object.setPrototypeOf,jB=Object.prototype,VB="__proto__";if(Fye&&NB&&UB&&!(VB in jB))try{Nye(jB,VB,{configurable:!0,get:function(){return NB(Uye(this))},set:function(n){var l=jye(this);!FB(n)&&n!==null||!FB(l)||UB(l,n)}})}catch{}});var $B=M(()=>{var Vye=we(),Gye=sr(),$ye=rl().onFreeze,Wye=wh(),Zye=ft(),Fw=Object.seal,Hye=Zye(function(){Fw(1)});Vye({target:"Object",stat:!0,forced:Hye,sham:!Wye},{seal:function(n){return Fw&&Gye(n)?Fw($ye(n)):n}})});var WB=M(()=>{var Xye=we(),Yye=Mo();Xye({target:"Object",stat:!0},{setPrototypeOf:Yye})});var HB=M((jje,ZB)=>{"use strict";var Kye=Ny(),Jye=Po();ZB.exports=Kye?{}.toString:function(){return"[object "+Jye(this)+"]"}});var XB=M(()=>{var Qye=Ny(),ege=Qr(),tge=HB();Qye||ege(Object.prototype,"toString",tge,{unsafe:!0})});var YB=M(()=>{var rge=we(),ige=Rw().values;rge({target:"Object",stat:!0},{values:function(n){return ige(n)}})});var JB=M(()=>{var nge=we(),KB=Sw();nge({global:!0,forced:parseFloat!=KB},{parseFloat:KB})});var eF=M(()=>{var oge=we(),QB=Iw();oge({global:!0,forced:parseInt!=QB},{parseInt:QB})});var as=M((Kje,tF)=>{var age=TypeError;tF.exports=function(s,n){if(s<n)throw age("Not enough arguments");return s}});var Nw=M((Jje,rF)=>{var sge=aa();rF.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(sge)});var jd=M((Qje,cF)=>{var Gn=Ct(),lge=Un(),uge=Qn(),iF=fr(),cge=_r(),hge=ft(),nF=A1(),pge=Hs(),oF=td(),fge=as(),dge=Nw(),mge=fa(),Ww=Gn.setImmediate,Zw=Gn.clearImmediate,_ge=Gn.process,Uw=Gn.Dispatch,yge=Gn.Function,aF=Gn.MessageChannel,gge=Gn.String,jw=0,Nd={},sF="onreadystatechange",Ud,Du,Vw,Gw;try{Ud=Gn.location}catch{}var Hw=function(s){if(cge(Nd,s)){var n=Nd[s];delete Nd[s],n()}},$w=function(s){return function(){Hw(s)}},lF=function(s){Hw(s.data)},uF=function(s){Gn.postMessage(gge(s),Ud.protocol+"//"+Ud.host)};(!Ww||!Zw)&&(Ww=function(n){fge(arguments.length,1);var l=iF(n)?n:yge(n),o=pge(arguments,1);return Nd[++jw]=function(){lge(l,void 0,o)},Du(jw),jw},Zw=function(n){delete Nd[n]},mge?Du=function(s){_ge.nextTick($w(s))}:Uw&&Uw.now?Du=function(s){Uw.now($w(s))}:aF&&!dge?(Vw=new aF,Gw=Vw.port2,Vw.port1.onmessage=lF,Du=uge(Gw.postMessage,Gw)):Gn.addEventListener&&iF(Gn.postMessage)&&!Gn.importScripts&&Ud&&Ud.protocol!=="file:"&&!hge(uF)?(Du=uF,Gn.addEventListener("message",lF,!1)):sF in oF("script")?Du=function(s){nF.appendChild(oF("script"))[sF]=function(){nF.removeChild(this),Hw(s)}}:Du=function(s){setTimeout($w(s),0)});cF.exports={set:Ww,clear:Zw}});var pF=M((eVe,hF)=>{var vge=aa(),xge=Ct();hF.exports=/ipad|iphone|ipod/i.test(vge)&&xge.Pebble!==void 0});var dF=M((tVe,fF)=>{var bge=aa();fF.exports=/web0s(?!.*chrome)/i.test(bge)});var Qw=M((rVe,wF)=>{var ku=Ct(),mF=Qn(),wge=Ui().f,Xw=jd().set,Tge=Nw(),Ege=pF(),Sge=dF(),Yw=fa(),_F=ku.MutationObserver||ku.WebKitMutationObserver,yF=ku.document,gF=ku.process,Gg=ku.Promise,vF=wge(ku,"queueMicrotask"),bF=vF&&vF.value,Vd,Lu,Gd,Ih,Kw,Jw,$g,xF;bF||(Vd=function(){var s,n;for(Yw&&(s=gF.domain)&&s.exit();Lu;){n=Lu.fn,Lu=Lu.next;try{n()}catch(l){throw Lu?Ih():Gd=void 0,l}}Gd=void 0,s&&s.enter()},!Tge&&!Yw&&!Sge&&_F&&yF?(Kw=!0,Jw=yF.createTextNode(""),new _F(Vd).observe(Jw,{characterData:!0}),Ih=function(){Jw.data=Kw=!Kw}):!Ege&&Gg&&Gg.resolve?($g=Gg.resolve(void 0),$g.constructor=Gg,xF=mF($g.then,$g),Ih=function(){xF(Vd)}):Yw?Ih=function(){gF.nextTick(Vd)}:(Xw=mF(Xw,ku),Ih=function(){Xw(Vd)}));wF.exports=bF||function(s){var n={fn:s,next:void 0};Gd&&(Gd.next=n),Lu||(Lu=n,Ih()),Gd=n}});var EF=M((iVe,TF)=>{var Ige=Ct();TF.exports=function(s,n){var l=Ige.console;l&&l.error&&(arguments.length==1?l.error(s):l.error(s,n))}});var Ah=M((nVe,SF)=>{SF.exports=function(s){try{return{error:!1,value:s()}}catch(n){return{error:!0,value:n}}}});var OF=M((oVe,AF)=>{var IF=function(){this.head=null,this.tail=null};IF.prototype={add:function(s){var n={item:s,next:null};this.head?this.tail.next=n:this.head=n,this.tail=n},get:function(){var s=this.head;if(s)return this.head=s.next,this.tail===s&&(this.tail=null),s.item}};AF.exports=IF});var zu=M((aVe,CF)=>{var Age=Ct();CF.exports=Age.Promise});var Wg=M((sVe,PF)=>{PF.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"});var eT=M((lVe,MF)=>{var Oge=Wg(),Cge=fa();MF.exports=!Oge&&!Cge&&typeof window=="object"&&typeof document=="object"});var Oh=M((uVe,DF)=>{var Pge=Ct(),$d=zu(),Mge=fr(),qge=oh(),Rge=qy(),Dge=cr(),Lge=eT(),kge=Wg(),zge=li(),tT=sa(),qF=$d&&$d.prototype,Bge=Dge("species"),rT=!1,RF=Mge(Pge.PromiseRejectionEvent),Fge=qge("Promise",function(){var s=Rge($d),n=s!==String($d);if(!n&&tT===66||zge&&!(qF.catch&&qF.finally))return!0;if(!tT||tT<51||!/native code/.test(s)){var l=new $d(function(t){t(1)}),o=function(t){t(function(){},function(){})},c=l.constructor={};if(c[Bge]=o,rT=l.then(function(){})instanceof o,!rT)return!0}return!n&&(Lge||kge)&&!RF});DF.exports={CONSTRUCTOR:Fge,REJECTION_EVENT:RF,SUBCLASSING:rT}});var ol=M((cVe,kF)=>{"use strict";var LF=Ti(),Nge=TypeError,Uge=function(s){var n,l;this.promise=new s(function(o,c){if(n!==void 0||l!==void 0)throw Nge("Bad Promise constructor");n=o,l=c}),this.resolve=LF(n),this.reject=LF(l)};kF.exports.f=function(s){return new Uge(s)}});var tN=M(()=>{"use strict";var jge=we(),Vge=li(),Yg=fa(),al=Ct(),qh=ar(),zF=Qr(),BF=Mo(),Gge=En(),$ge=Ou(),Wge=Ti(),Xg=fr(),Zge=sr(),Hge=Ro(),Xge=Pu(),VF=jd().set,sT=Qw(),Yge=EF(),Kge=Ah(),Jge=OF(),GF=_i(),Kg=zu(),lT=Oh(),$F=ol(),Jg="Promise",WF=lT.CONSTRUCTOR,Qge=lT.REJECTION_EVENT,eve=lT.SUBCLASSING,iT=GF.getterFor(Jg),tve=GF.set,Ch=Kg&&Kg.prototype,Bu=Kg,Zg=Ch,ZF=al.TypeError,nT=al.document,uT=al.process,oT=$F.f,rve=oT,ive=!!(nT&&nT.createEvent&&al.dispatchEvent),HF="unhandledrejection",nve="rejectionhandled",FF=0,XF=1,ove=2,cT=1,YF=2,Hg,NF,ave,UF,KF=function(s){var n;return Zge(s)&&Xg(n=s.then)?n:!1},JF=function(s,n){var l=n.value,o=n.state==XF,c=o?s.ok:s.fail,t=s.resolve,g=s.reject,I=s.domain,P,q,L;try{c?(o||(n.rejection===YF&&lve(n),n.rejection=cT),c===!0?P=l:(I&&I.enter(),P=c(l),I&&(I.exit(),L=!0)),P===s.promise?g(ZF("Promise-chain cycle")):(q=KF(P))?qh(q,P,t,g):t(P)):g(l)}catch(V){I&&!L&&I.exit(),g(V)}},QF=function(s,n){s.notified||(s.notified=!0,sT(function(){for(var l=s.reactions,o;o=l.get();)JF(o,s);s.notified=!1,n&&!s.rejection&&sve(s)}))},eN=function(s,n,l){var o,c;ive?(o=nT.createEvent("Event"),o.promise=n,o.reason=l,o.initEvent(s,!1,!0),al.dispatchEvent(o)):o={promise:n,reason:l},!Qge&&(c=al["on"+s])?c(o):s===HF&&Yge("Unhandled promise rejection",l)},sve=function(s){qh(VF,al,function(){var n=s.facade,l=s.value,o=jF(s),c;if(o&&(c=Kge(function(){Yg?uT.emit("unhandledRejection",l,n):eN(HF,n,l)}),s.rejection=Yg||jF(s)?YF:cT,c.error))throw c.value})},jF=function(s){return s.rejection!==cT&&!s.parent},lve=function(s){qh(VF,al,function(){var n=s.facade;Yg?uT.emit("rejectionHandled",n):eN(nve,n,s.value)})},Ph=function(s,n,l){return function(o){s(n,o,l)}},Mh=function(s,n,l){s.done||(s.done=!0,l&&(s=l),s.value=n,s.state=ove,QF(s,!0))},aT=function(s,n,l){if(!s.done){s.done=!0,l&&(s=l);try{if(s.facade===n)throw ZF("Promise can't be resolved itself");var o=KF(n);o?sT(function(){var c={done:!1};try{qh(o,n,Ph(aT,c,s),Ph(Mh,c,s))}catch(t){Mh(c,t,s)}}):(s.value=n,s.state=XF,QF(s,!1))}catch(c){Mh({done:!1},c,s)}}};if(WF&&(Bu=function(n){Hge(this,Zg),Wge(n),qh(Hg,this);var l=iT(this);try{n(Ph(aT,l),Ph(Mh,l))}catch(o){Mh(l,o)}},Zg=Bu.prototype,Hg=function(n){tve(this,{type:Jg,done:!1,notified:!1,parent:!1,reactions:new Jge,rejection:!1,state:FF,value:void 0})},Hg.prototype=zF(Zg,"then",function(n,l){var o=iT(this),c=oT(Xge(this,Bu));return o.parent=!0,c.ok=Xg(n)?n:!0,c.fail=Xg(l)&&l,c.domain=Yg?uT.domain:void 0,o.state==FF?o.reactions.add(c):sT(function(){JF(c,o)}),c.promise}),NF=function(){var s=new Hg,n=iT(s);this.promise=s,this.resolve=Ph(aT,n),this.reject=Ph(Mh,n)},$F.f=oT=function(s){return s===Bu||s===ave?new NF(s):rve(s)},!Vge&&Xg(Kg)&&Ch!==Object.prototype)){UF=Ch.then,eve||zF(Ch,"then",function(n,l){var o=this;return new Bu(function(c,t){qh(UF,o,c,t)}).then(n,l)},{unsafe:!0});try{delete Ch.constructor}catch{}BF&&BF(Ch,Zg)}jge({global:!0,constructor:!0,wrap:!0,forced:WF},{Promise:Bu});Gge(Bu,Jg,!1,!0);$ge(Jg)});var hT=M((fVe,rN)=>{var uve=zu(),cve=vd(),hve=Oh().CONSTRUCTOR;rN.exports=hve||!cve(function(s){uve.all(s).then(void 0,function(){})})});var iN=M(()=>{"use strict";var pve=we(),fve=ar(),dve=Ti(),mve=ol(),_ve=Ah(),yve=qo(),gve=hT();pve({target:"Promise",stat:!0,forced:gve},{all:function(n){var l=this,o=mve.f(l),c=o.resolve,t=o.reject,g=_ve(function(){var I=dve(l.resolve),P=[],q=0,L=1;yve(n,function(V){var oe=q++,ne=!1;L++,fve(I,l,V).then(function(Ie){ne||(ne=!0,P[oe]=Ie,--L||c(P))},t)}),--L||c(P)});return g.error&&t(g.value),o.promise}})});var oN=M(()=>{"use strict";var vve=we(),xve=li(),bve=Oh().CONSTRUCTOR,fT=zu(),wve=Hr(),Tve=fr(),Eve=Qr(),nN=fT&&fT.prototype;vve({target:"Promise",proto:!0,forced:bve,real:!0},{catch:function(s){return this.then(void 0,s)}});!xve&&Tve(fT)&&(pT=wve("Promise").prototype.catch,nN.catch!==pT&&Eve(nN,"catch",pT,{unsafe:!0}));var pT});var aN=M(()=>{"use strict";var Sve=we(),Ive=ar(),Ave=Ti(),Ove=ol(),Cve=Ah(),Pve=qo(),Mve=hT();Sve({target:"Promise",stat:!0,forced:Mve},{race:function(n){var l=this,o=Ove.f(l),c=o.reject,t=Cve(function(){var g=Ave(l.resolve);Pve(n,function(I){Ive(g,l,I).then(o.resolve,c)})});return t.error&&c(t.value),o.promise}})});var sN=M(()=>{"use strict";var qve=we(),Rve=ar(),Dve=ol(),Lve=Oh().CONSTRUCTOR;qve({target:"Promise",stat:!0,forced:Lve},{reject:function(n){var l=Dve.f(this);return Rve(l.reject,void 0,n),l.promise}})});var dT=M((wVe,lN)=>{var kve=Qt(),zve=sr(),Bve=ol();lN.exports=function(s,n){if(kve(s),zve(n)&&n.constructor===s)return n;var l=Bve.f(s),o=l.resolve;return o(n),l.promise}});var hN=M(()=>{"use strict";var Fve=we(),Nve=Hr(),uN=li(),Uve=zu(),cN=Oh().CONSTRUCTOR,jve=dT(),Vve=Nve("Promise"),Gve=uN&&!cN;Fve({target:"Promise",stat:!0,forced:uN||cN},{resolve:function(n){return jve(Gve&&this===Vve?Uve:this,n)}})});var pN=M(()=>{tN();iN();oN();aN();sN();hN()});var fN=M(()=>{"use strict";var $ve=we(),Wve=ar(),Zve=Ti(),Hve=ol(),Xve=Ah(),Yve=qo();$ve({target:"Promise",stat:!0},{allSettled:function(n){var l=this,o=Hve.f(l),c=o.resolve,t=o.reject,g=Xve(function(){var I=Zve(l.resolve),P=[],q=0,L=1;Yve(n,function(V){var oe=q++,ne=!1;L++,Wve(I,l,V).then(function(Ie){ne||(ne=!0,P[oe]={status:"fulfilled",value:Ie},--L||c(P))},function(Ie){ne||(ne=!0,P[oe]={status:"rejected",reason:Ie},--L||c(P))})}),--L||c(P)});return g.error&&t(g.value),o.promise}})});var mN=M(()=>{"use strict";var Kve=we(),Jve=ar(),Qve=Ti(),e0e=Hr(),t0e=ol(),r0e=Ah(),i0e=qo(),dN="No one promise resolved";Kve({target:"Promise",stat:!0},{any:function(n){var l=this,o=e0e("AggregateError"),c=t0e.f(l),t=c.resolve,g=c.reject,I=r0e(function(){var P=Qve(l.resolve),q=[],L=0,V=1,oe=!1;i0e(n,function(ne){var Ie=L++,Se=!1;V++,Jve(P,l,ne).then(function(Re){Se||oe||(oe=!0,t(Re))},function(Re){Se||oe||(Se=!0,q[Ie]=Re,--V||g(new o(q,dN)))})}),--V||g(new o(q,dN))});return I.error&&g(I.value),c.promise}})});var vN=M(()=>{"use strict";var n0e=we(),o0e=li(),Qg=zu(),a0e=ft(),yN=Hr(),gN=fr(),s0e=Pu(),_N=dT(),l0e=Qr(),_T=Qg&&Qg.prototype,u0e=!!Qg&&a0e(function(){_T.finally.call({then:function(){}},function(){})});n0e({target:"Promise",proto:!0,real:!0,forced:u0e},{finally:function(s){var n=s0e(this,yN("Promise")),l=gN(s);return this.then(l?function(o){return _N(n,s()).then(function(){return o})}:s,l?function(o){return _N(n,s()).then(function(){throw o})}:s)}});!o0e&&gN(Qg)&&(mT=yN("Promise").prototype.finally,_T.finally!==mT&&l0e(_T,"finally",mT,{unsafe:!0}));var mT});var xN=M(()=>{var c0e=we(),h0e=Un(),p0e=Ti(),f0e=Qt(),d0e=ft(),m0e=!d0e(function(){Reflect.apply(function(){})});c0e({target:"Reflect",stat:!0,forced:m0e},{apply:function(n,l,o){return h0e(p0e(n),l,f0e(o))}})});var AN=M(()=>{var _0e=we(),y0e=Hr(),yT=Un(),g0e=nw(),bN=Cg(),v0e=Qt(),wN=sr(),x0e=Tn(),EN=ft(),gT=y0e("Reflect","construct"),b0e=Object.prototype,w0e=[].push,SN=EN(function(){function s(){}return!(gT(function(){},[],s)instanceof s)}),IN=!EN(function(){gT(function(){})}),TN=SN||IN;_0e({target:"Reflect",stat:!0,forced:TN,sham:TN},{construct:function(n,l){bN(n),v0e(l);var o=arguments.length<3?n:bN(arguments[2]);if(IN&&!SN)return gT(n,l,o);if(n==o){switch(l.length){case 0:return new n;case 1:return new n(l[0]);case 2:return new n(l[0],l[1]);case 3:return new n(l[0],l[1],l[2]);case 4:return new n(l[0],l[1],l[2],l[3])}var c=[null];return yT(w0e,c,l),new(yT(g0e,n,c))}var t=o.prototype,g=x0e(wN(t)?t:b0e),I=yT(n,g,l);return wN(I)?I:g}})});var PN=M(()=>{var T0e=we(),E0e=$t(),ON=Qt(),S0e=Xa(),CN=qr(),I0e=ft(),A0e=I0e(function(){Reflect.defineProperty(CN.f({},1,{value:1}),1,{value:2})});T0e({target:"Reflect",stat:!0,forced:A0e,sham:!E0e},{defineProperty:function(n,l,o){ON(n);var c=S0e(l);ON(o);try{return CN.f(n,c,o),!0}catch{return!1}}})});var MN=M(()=>{var O0e=we(),C0e=Qt(),P0e=Ui().f;O0e({target:"Reflect",stat:!0},{deleteProperty:function(n,l){var o=P0e(C0e(n),l);return o&&!o.configurable?!1:delete n[l]}})});var vT=M((UVe,RN)=>{var qN=_r();RN.exports=function(s){return s!==void 0&&(qN(s,"value")||qN(s,"writable"))}});var LN=M(()=>{var M0e=we(),q0e=ar(),R0e=sr(),D0e=Qt(),L0e=vT(),k0e=Ui(),z0e=jn();function DN(s,n){var l=arguments.length<3?s:arguments[2],o,c;if(D0e(s)===l)return s[n];if(o=k0e.f(s,n),o)return L0e(o)?o.value:o.get===void 0?void 0:q0e(o.get,l);if(R0e(c=z0e(s)))return DN(c,n,l)}M0e({target:"Reflect",stat:!0},{get:DN})});var kN=M(()=>{var B0e=we(),F0e=$t(),N0e=Qt(),U0e=Ui();B0e({target:"Reflect",stat:!0,sham:!F0e},{getOwnPropertyDescriptor:function(n,l){return U0e.f(N0e(n),l)}})});var zN=M(()=>{var j0e=we(),V0e=Qt(),G0e=jn(),$0e=rg();j0e({target:"Reflect",stat:!0,sham:!$0e},{getPrototypeOf:function(n){return G0e(V0e(n))}})});var BN=M(()=>{var W0e=we();W0e({target:"Reflect",stat:!0},{has:function(n,l){return l in n}})});var FN=M(()=>{var Z0e=we(),H0e=Qt(),X0e=Cd();Z0e({target:"Reflect",stat:!0},{isExtensible:function(n){return H0e(n),X0e(n)}})});var NN=M(()=>{var Y0e=we(),K0e=Fy();Y0e({target:"Reflect",stat:!0},{ownKeys:K0e})});var UN=M(()=>{var J0e=we(),Q0e=Hr(),exe=Qt(),txe=wh();J0e({target:"Reflect",stat:!0,sham:!txe},{preventExtensions:function(n){exe(n);try{var l=Q0e("Object","preventExtensions");return l&&l(n),!0}catch{return!1}}})});var WN=M(()=>{var rxe=we(),ixe=ar(),nxe=Qt(),jN=sr(),oxe=vT(),axe=ft(),xT=qr(),VN=Ui(),sxe=jn(),GN=Fn();function $N(s,n,l){var o=arguments.length<4?s:arguments[3],c=VN.f(nxe(s),n),t,g,I;if(!c){if(jN(g=sxe(s)))return $N(g,n,l,o);c=GN(0)}if(oxe(c)){if(c.writable===!1||!jN(o))return!1;if(t=VN.f(o,n)){if(t.get||t.set||t.writable===!1)return!1;t.value=l,xT.f(o,n,t)}else xT.f(o,n,GN(0,l))}else{if(I=c.set,I===void 0)return!1;ixe(I,o,l)}return!0}var lxe=axe(function(){var s=function(){},n=xT.f(new s,"a",{configurable:!0});return Reflect.set(s.prototype,"a",1,n)!==!1});rxe({target:"Reflect",stat:!0,forced:lxe},{set:$N})});var HN=M(()=>{var uxe=we(),cxe=Qt(),hxe=J1(),ZN=Mo();ZN&&uxe({target:"Reflect",stat:!0},{setPrototypeOf:function(n,l){cxe(n),hxe(l);try{return ZN(n,l),!0}catch{return!1}}})});var XN=M(()=>{var pxe=we(),fxe=Ct(),dxe=En();pxe({global:!0},{Reflect:{}});dxe(fxe.Reflect,"Reflect",!0)});var Rh=M((l8e,YN)=>{var mxe=sr(),_xe=on(),yxe=cr(),gxe=yxe("match");YN.exports=function(s){var n;return mxe(s)&&((n=s[gxe])!==void 0?!!n:_xe(s)=="RegExp")}});var ev=M((u8e,KN)=>{"use strict";var vxe=Qt();KN.exports=function(){var s=vxe(this),n="";return s.hasIndices&&(n+="d"),s.global&&(n+="g"),s.ignoreCase&&(n+="i"),s.multiline&&(n+="m"),s.dotAll&&(n+="s"),s.unicode&&(n+="u"),s.unicodeSets&&(n+="v"),s.sticky&&(n+="y"),n}});var Dh=M((c8e,QN)=>{var xxe=ar(),bxe=_r(),wxe=Nn(),Txe=ev(),JN=RegExp.prototype;QN.exports=function(s){var n=s.flags;return n===void 0&&!("flags"in JN)&&!bxe(s,"flags")&&wxe(JN,s)?xxe(Txe,s):n}});var Wd=M((h8e,e4)=>{var bT=ft(),Exe=Ct(),wT=Exe.RegExp,TT=bT(function(){var s=wT("a","y");return s.lastIndex=2,s.exec("abcd")!=null}),Sxe=TT||bT(function(){return!wT("a","y").sticky}),Ixe=TT||bT(function(){var s=wT("^r","gy");return s.lastIndex=2,s.exec("str")!=null});e4.exports={BROKEN_CARET:Ixe,MISSED_STICKY:Sxe,UNSUPPORTED_Y:TT}});var tv=M((p8e,t4)=>{var Axe=ft(),Oxe=Ct(),Cxe=Oxe.RegExp;t4.exports=Axe(function(){var s=Cxe(".","s");return!(s.dotAll&&s.exec(`
`)&&s.flags==="s")})});var ET=M((f8e,r4)=>{var Pxe=ft(),Mxe=Ct(),qxe=Mxe.RegExp;r4.exports=Pxe(function(){var s=qxe("(?<a>b)","g");return s.exec("b").groups.a!=="b"||"b".replace(s,"$<a>c")!=="bc"})});var h4=M(()=>{var Rxe=$t(),OT=Ct(),Zd=_t(),Dxe=oh(),Lxe=Iu(),kxe=ln(),zxe=Ya().f,i4=Nn(),Bxe=Rh(),n4=hr(),Fxe=Dh(),s4=Wd(),Nxe=Q1(),Uxe=Qr(),jxe=ft(),Vxe=_r(),Gxe=_i().enforce,$xe=Ou(),Wxe=cr(),l4=tv(),u4=ET(),Zxe=Wxe("match"),ll=OT.RegExp,Lh=ll.prototype,Hxe=OT.SyntaxError,Xxe=Zd(Lh.exec),rv=Zd("".charAt),o4=Zd("".replace),a4=Zd("".indexOf),Yxe=Zd("".slice),Kxe=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Fu=/a/g,ST=/a/g,Jxe=new ll(Fu)!==Fu,c4=s4.MISSED_STICKY,Qxe=s4.UNSUPPORTED_Y,e1e=Rxe&&(!Jxe||c4||l4||u4||jxe(function(){return ST[Zxe]=!1,ll(Fu)!=Fu||ll(ST)==ST||ll(Fu,"i")!="/a/i"})),t1e=function(s){for(var n=s.length,l=0,o="",c=!1,t;l<=n;l++){if(t=rv(s,l),t==="\\"){o+=t+rv(s,++l);continue}!c&&t==="."?o+="[\\s\\S]":(t==="["?c=!0:t==="]"&&(c=!1),o+=t)}return o},r1e=function(s){for(var n=s.length,l=0,o="",c=[],t={},g=!1,I=!1,P=0,q="",L;l<=n;l++){if(L=rv(s,l),L==="\\")L=L+rv(s,++l);else if(L==="]")g=!1;else if(!g)switch(!0){case L==="[":g=!0;break;case L==="(":Xxe(Kxe,Yxe(s,l+1))&&(l+=2,I=!0),o+=L,P++;continue;case(L===">"&&I):if(q===""||Vxe(t,q))throw new Hxe("Invalid capture group name");t[q]=!0,c[c.length]=[q,P],I=!1,q="";continue}I?q+=L:o+=L}return[o,c]};if(Dxe("RegExp",e1e)){for(sl=function(n,l){var o=i4(Lh,this),c=Bxe(n),t=l===void 0,g=[],I=n,P,q,L,V,oe,ne;if(!o&&c&&t&&n.constructor===sl)return n;if((c||i4(Lh,n))&&(n=n.source,t&&(l=Fxe(I))),n=n===void 0?"":n4(n),l=l===void 0?"":n4(l),I=n,l4&&"dotAll"in Fu&&(q=!!l&&a4(l,"s")>-1,q&&(l=o4(l,/s/g,""))),P=l,c4&&"sticky"in Fu&&(L=!!l&&a4(l,"y")>-1,L&&Qxe&&(l=o4(l,/y/g,""))),u4&&(V=r1e(n),n=V[0],g=V[1]),oe=Lxe(ll(n,l),o?this:Lh,sl),(q||L||g.length)&&(ne=Gxe(oe),q&&(ne.dotAll=!0,ne.raw=sl(t1e(n),P)),L&&(ne.sticky=!0),g.length&&(ne.groups=g)),n!==I)try{kxe(oe,"source",I===""?"(?:)":I)}catch{}return oe},IT=zxe(ll),AT=0;IT.length>AT;)Nxe(sl,ll,IT[AT++]);Lh.constructor=sl,sl.prototype=Lh,Uxe(OT,"RegExp",sl,{constructor:!0})}var sl,IT,AT;$xe("RegExp")});var f4=M(()=>{var i1e=$t(),n1e=tv(),o1e=on(),a1e=nl(),s1e=_i().get,p4=RegExp.prototype,l1e=TypeError;i1e&&n1e&&a1e(p4,"dotAll",{configurable:!0,get:function(){if(this!==p4){if(o1e(this)==="RegExp")return!!s1e(this).dotAll;throw l1e("Incompatible receiver, RegExp required")}}})});var Hd=M((g8e,m4)=>{"use strict";var kh=ar(),nv=_t(),u1e=hr(),c1e=ev(),h1e=Wd(),p1e=gu(),f1e=Tn(),d1e=_i().get,m1e=tv(),_1e=ET(),y1e=p1e("native-string-replace",String.prototype.replace),iv=RegExp.prototype.exec,PT=iv,g1e=nv("".charAt),v1e=nv("".indexOf),x1e=nv("".replace),CT=nv("".slice),MT=function(){var s=/a/,n=/b*/g;return kh(iv,s,"a"),kh(iv,n,"a"),s.lastIndex!==0||n.lastIndex!==0}(),d4=h1e.BROKEN_CARET,qT=/()??/.exec("")[1]!==void 0,b1e=MT||qT||d4||m1e||_1e;b1e&&(PT=function(n){var l=this,o=d1e(l),c=u1e(n),t=o.raw,g,I,P,q,L,V,oe;if(t)return t.lastIndex=l.lastIndex,g=kh(PT,t,c),l.lastIndex=t.lastIndex,g;var ne=o.groups,Ie=d4&&l.sticky,Se=kh(c1e,l),Re=l.source,Ze=0,et=c;if(Ie&&(Se=x1e(Se,"y",""),v1e(Se,"g")===-1&&(Se+="g"),et=CT(c,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&g1e(c,l.lastIndex-1)!==`
`)&&(Re="(?: "+Re+")",et=" "+et,Ze++),I=new RegExp("^(?:"+Re+")",Se)),qT&&(I=new RegExp("^"+Re+"$(?!\\s)",Se)),MT&&(P=l.lastIndex),q=kh(iv,Ie?I:l,et),Ie?q?(q.input=CT(q.input,Ze),q[0]=CT(q[0],Ze),q.index=l.lastIndex,l.lastIndex+=q[0].length):l.lastIndex=0:MT&&q&&(l.lastIndex=l.global?q.index+q[0].length:P),qT&&q&&q.length>1&&kh(y1e,q[0],I,function(){for(L=1;L<arguments.length-2;L++)arguments[L]===void 0&&(q[L]=void 0)}),q&&ne)for(q.groups=V=f1e(null),L=0;L<ne.length;L++)oe=ne[L],V[oe[0]]=q[oe[1]];return q});m4.exports=PT});var ov=M(()=>{"use strict";var w1e=we(),_4=Hd();w1e({target:"RegExp",proto:!0,forced:/./.exec!==_4},{exec:_4})});var v4=M(()=>{var T1e=Ct(),E1e=$t(),S1e=nl(),I1e=ev(),A1e=ft(),y4=T1e.RegExp,g4=y4.prototype,O1e=E1e&&A1e(function(){var s=!0;try{y4(".","d")}catch{s=!1}var n={},l="",o=s?"dgimsy":"gimsy",c=function(P,q){Object.defineProperty(n,P,{get:function(){return l+=q,!0}})},t={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};s&&(t.hasIndices="d");for(var g in t)c(g,t[g]);var I=Object.getOwnPropertyDescriptor(g4,"flags").get.call(n);return I!==o||l!==o});O1e&&S1e(g4,"flags",{configurable:!0,get:I1e})});var b4=M(()=>{var C1e=$t(),P1e=Wd().MISSED_STICKY,M1e=on(),q1e=nl(),R1e=_i().get,x4=RegExp.prototype,D1e=TypeError;C1e&&P1e&&q1e(x4,"sticky",{configurable:!0,get:function(){if(this!==x4){if(M1e(this)==="RegExp")return!!R1e(this).sticky;throw D1e("Incompatible receiver, RegExp required")}}})});var E4=M(()=>{"use strict";ov();var L1e=we(),w4=ar(),k1e=fr(),T4=Qt(),z1e=hr(),B1e=function(){var s=!1,n=/[ac]/;return n.exec=function(){return s=!0,/./.exec.apply(this,arguments)},n.test("abc")===!0&&s}(),F1e=/./.test;L1e({target:"RegExp",proto:!0,forced:!B1e},{test:function(s){var n=T4(this),l=z1e(s),o=n.exec;if(!k1e(o))return w4(F1e,n,l);var c=w4(o,n,l);return c===null?!1:(T4(c),!0)}})});var A4=M(()=>{"use strict";var N1e=bu().PROPER,U1e=Qr(),j1e=Qt(),S4=hr(),V1e=ft(),G1e=Dh(),RT="toString",$1e=RegExp.prototype,I4=$1e[RT],W1e=V1e(function(){return I4.call({source:"a",flags:"b"})!="/a/b"}),Z1e=N1e&&I4.name!=RT;(W1e||Z1e)&&U1e(RegExp.prototype,RT,function(){var n=j1e(this),l=S4(n.source),o=S4(G1e(n));return"/"+l+"/"+o},{unsafe:!0})});var O4=M(()=>{"use strict";var H1e=Pd(),X1e=fw();H1e("Set",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},X1e)});var C4=M(()=>{O4()});var P4=M(()=>{"use strict";var Y1e=we(),K1e=_t(),J1e=mi(),Q1e=Ei(),ebe=hr(),tbe=ft(),rbe=K1e("".charAt),ibe=tbe(function(){return"\u{20BB7}".at(-2)!=="\uD842"});Y1e({target:"String",proto:!0,forced:ibe},{at:function(n){var l=ebe(J1e(this)),o=l.length,c=Q1e(n),t=c>=0?c:o+c;return t<0||t>=o?void 0:rbe(l,t)}})});var Xd=M((L8e,R4)=>{var DT=_t(),nbe=Ei(),obe=hr(),abe=mi(),sbe=DT("".charAt),M4=DT("".charCodeAt),lbe=DT("".slice),q4=function(s){return function(n,l){var o=obe(abe(n)),c=nbe(l),t=o.length,g,I;return c<0||c>=t?s?"":void 0:(g=M4(o,c),g<55296||g>56319||c+1===t||(I=M4(o,c+1))<56320||I>57343?s?sbe(o,c):g:s?lbe(o,c,c+2):(g-55296<<10)+(I-56320)+65536)}};R4.exports={codeAt:q4(!1),charAt:q4(!0)}});var D4=M(()=>{"use strict";var ube=we(),cbe=Xd().codeAt;ube({target:"String",proto:!0},{codePointAt:function(n){return cbe(this,n)}})});var av=M((B8e,L4)=>{var hbe=Rh(),pbe=TypeError;L4.exports=function(s){if(hbe(s))throw pbe("The method doesn't accept regular expressions");return s}});var sv=M((F8e,k4)=>{var fbe=cr(),dbe=fbe("match");k4.exports=function(s){var n=/./;try{"/./"[s](n)}catch{try{return n[dbe]=!1,"/./"[s](n)}catch{}}return!1}});var U4=M(()=>{"use strict";var mbe=we(),F4=_t(),_be=Ui().f,ybe=wn(),z4=hr(),gbe=av(),vbe=mi(),xbe=sv(),bbe=li(),B4=F4("".endsWith),wbe=F4("".slice),Tbe=Math.min,N4=xbe("endsWith"),Ebe=!bbe&&!N4&&!!function(){var s=_be(String.prototype,"endsWith");return s&&!s.writable}();mbe({target:"String",proto:!0,forced:!Ebe&&!N4},{endsWith:function(n){var l=z4(vbe(this));gbe(n);var o=arguments.length>1?arguments[1]:void 0,c=l.length,t=o===void 0?c:Tbe(ybe(o),c),g=z4(n);return B4?B4(l,g,t):wbe(l,t-g.length,t)===g}})});var G4=M(()=>{var Sbe=we(),Ibe=_t(),Abe=ua(),Obe=RangeError,j4=String.fromCharCode,V4=String.fromCodePoint,Cbe=Ibe([].join),Pbe=!!V4&&V4.length!=1;Sbe({target:"String",stat:!0,arity:1,forced:Pbe},{fromCodePoint:function(n){for(var l=[],o=arguments.length,c=0,t;o>c;){if(t=+arguments[c++],Abe(t,1114111)!==t)throw Obe(t+" is not a valid code point");l[c]=t<65536?j4(t):j4(((t-=65536)>>10)+55296,t%1024+56320)}return Cbe(l,"")}})});var W4=M(()=>{"use strict";var Mbe=we(),qbe=_t(),Rbe=av(),Dbe=mi(),$4=hr(),Lbe=sv(),kbe=qbe("".indexOf);Mbe({target:"String",proto:!0,forced:!Lbe("includes")},{includes:function(n){return!!~kbe($4(Dbe(this)),$4(Rbe(n)),arguments.length>1?arguments[1]:void 0)}})});var LT=M(()=>{"use strict";var zbe=Xd().charAt,Bbe=hr(),H4=_i(),Fbe=pg(),Z4=wd(),X4="String Iterator",Nbe=H4.set,Ube=H4.getterFor(X4);Fbe(String,"String",function(s){Nbe(this,{type:X4,string:Bbe(s),index:0})},function(){var n=Ube(this),l=n.string,o=n.index,c;return o>=l.length?Z4(void 0,!0):(c=zbe(l,o),n.index+=c.length,Z4(c,!1))})});var Yd=M((H8e,eU)=>{"use strict";ov();var Y4=_t(),K4=Qr(),jbe=Hd(),J4=ft(),Q4=cr(),Vbe=ln(),Gbe=Q4("species"),kT=RegExp.prototype;eU.exports=function(s,n,l,o){var c=Q4(s),t=!J4(function(){var q={};return q[c]=function(){return 7},""[s](q)!=7}),g=t&&!J4(function(){var q=!1,L=/a/;return s==="split"&&(L={},L.constructor={},L.constructor[Gbe]=function(){return L},L.flags="",L[c]=/./[c]),L.exec=function(){return q=!0,null},L[c](""),!q});if(!t||!g||l){var I=Y4(/./[c]),P=n(c,""[s],function(q,L,V,oe,ne){var Ie=Y4(q),Se=L.exec;return Se===jbe||Se===kT.exec?t&&!ne?{done:!0,value:I(L,V,oe)}:{done:!0,value:Ie(V,L,oe)}:{done:!1}});K4(String.prototype,s,P[0]),K4(kT,c,P[1])}o&&Vbe(kT[c],"sham",!0)}});var Kd=M((X8e,tU)=>{"use strict";var $be=Xd().charAt;tU.exports=function(s,n,l){return n+(l?$be(s,n).length:1)}});var zh=M((Y8e,iU)=>{var rU=ar(),Wbe=Qt(),Zbe=fr(),Hbe=on(),Xbe=Hd(),Ybe=TypeError;iU.exports=function(s,n){var l=s.exec;if(Zbe(l)){var o=rU(l,s,n);return o!==null&&Wbe(o),o}if(Hbe(s)==="RegExp")return rU(Xbe,s,n);throw Ybe("RegExp#exec called on incompatible receiver")}});var oU=M(()=>{"use strict";var Kbe=ar(),Jbe=Yd(),Qbe=Qt(),ewe=an(),twe=wn(),zT=hr(),rwe=mi(),iwe=la(),nwe=Kd(),nU=zh();Jbe("match",function(s,n,l){return[function(c){var t=rwe(this),g=ewe(c)?void 0:iwe(c,s);return g?Kbe(g,c,t):new RegExp(c)[s](zT(t))},function(o){var c=Qbe(this),t=zT(o),g=l(n,c,t);if(g.done)return g.value;if(!c.global)return nU(c,t);var I=c.unicode;c.lastIndex=0;for(var P=[],q=0,L;(L=nU(c,t))!==null;){var V=zT(L[0]);P[q]=V,V===""&&(c.lastIndex=nwe(t,twe(c.lastIndex),I)),q++}return q===0?null:P}]})});var mU=M(()=>{"use strict";var owe=we(),aU=ar(),uU=_t(),awe=ug(),lv=wd(),sU=mi(),cU=wn(),Jd=hr(),swe=Qt(),lwe=an(),uwe=on(),cwe=Rh(),hU=Dh(),hwe=la(),pwe=Qr(),fwe=ft(),dwe=cr(),mwe=Pu(),_we=Kd(),ywe=zh(),pU=_i(),FT=li(),uv=dwe("matchAll"),fU="RegExp String",dU=fU+" Iterator",gwe=pU.set,vwe=pU.getterFor(dU),lU=RegExp.prototype,xwe=TypeError,NT=uU("".indexOf),cv=uU("".matchAll),BT=!!cv&&!fwe(function(){cv("a",/./)}),bwe=awe(function(n,l,o,c){gwe(this,{type:dU,regexp:n,string:l,global:o,unicode:c,done:!1})},fU,function(){var n=vwe(this);if(n.done)return lv(void 0,!0);var l=n.regexp,o=n.string,c=ywe(l,o);return c===null?(n.done=!0,lv(void 0,!0)):n.global?(Jd(c[0])===""&&(l.lastIndex=_we(o,cU(l.lastIndex),n.unicode)),lv(c,!1)):(n.done=!0,lv(c,!1))}),UT=function(s){var n=swe(this),l=Jd(s),o=mwe(n,RegExp),c=Jd(hU(n)),t,g,I;return t=new o(o===RegExp?n.source:n,c),g=!!~NT(c,"g"),I=!!~NT(c,"u"),t.lastIndex=cU(n.lastIndex),new bwe(t,l,g,I)};owe({target:"String",proto:!0,forced:BT},{matchAll:function(n){var l=sU(this),o,c,t,g;if(lwe(n)){if(BT)return cv(l,n)}else{if(cwe(n)&&(o=Jd(sU(hU(n))),!~NT(o,"g")))throw xwe("`.matchAll` does not allow non-global regexes");if(BT)return cv(l,n);if(t=hwe(n,uv),t===void 0&&FT&&uwe(n)=="RegExp"&&(t=UT),t)return aU(t,n,l)}return c=Jd(l),g=new RegExp(n,"g"),FT?aU(UT,g,c):g[uv](c)}});FT||uv in lU||pwe(lU,uv,UT)});var jT=M((tGe,_U)=>{var wwe=aa();_U.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(wwe)});var yU=M(()=>{"use strict";var Twe=we(),Ewe=Pg().end,Swe=jT();Twe({target:"String",proto:!0,forced:Swe},{padEnd:function(n){return Ewe(this,n,arguments.length>1?arguments[1]:void 0)}})});var gU=M(()=>{"use strict";var Iwe=we(),Awe=Pg().start,Owe=jT();Iwe({target:"String",proto:!0,forced:Owe},{padStart:function(n){return Awe(this,n,arguments.length>1?arguments[1]:void 0)}})});var wU=M(()=>{var Cwe=we(),bU=_t(),Pwe=sn(),Mwe=Mr(),vU=hr(),qwe=Vr(),xU=bU([].push),Rwe=bU([].join);Cwe({target:"String",stat:!0},{raw:function(n){for(var l=Pwe(Mwe(n).raw),o=qwe(l),c=arguments.length,t=[],g=0;o>g;){if(xU(t,vU(l[g++])),g===o)return Rwe(t,"");g<c&&xU(t,vU(arguments[g]))}}})});var TU=M(()=>{var Dwe=we(),Lwe=Ad();Dwe({target:"String",proto:!0},{repeat:Lwe})});var WT=M((cGe,EU)=>{var $T=_t(),kwe=Mr(),zwe=Math.floor,VT=$T("".charAt),Bwe=$T("".replace),GT=$T("".slice),Fwe=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Nwe=/\$([$&'`]|\d{1,2})/g;EU.exports=function(s,n,l,o,c,t){var g=l+s.length,I=o.length,P=Nwe;return c!==void 0&&(c=kwe(c),P=Fwe),Bwe(t,P,function(q,L){var V;switch(VT(L,0)){case"$":return"$";case"&":return s;case"`":return GT(n,0,l);case"'":return GT(n,g);case"<":V=c[GT(L,1,-1)];break;default:var oe=+L;if(oe===0)return q;if(oe>I){var ne=zwe(oe/10);return ne===0?q:ne<=I?o[ne-1]===void 0?VT(L,1):o[ne-1]+VT(L,1):q}V=o[oe-1]}return V===void 0?"":V})}});var CU=M(()=>{"use strict";var Uwe=Un(),SU=ar(),hv=_t(),jwe=Yd(),Vwe=ft(),Gwe=Qt(),$we=fr(),Wwe=an(),Zwe=Ei(),Hwe=wn(),Bh=hr(),Xwe=mi(),Ywe=Kd(),Kwe=la(),Jwe=WT(),Qwe=zh(),eTe=cr(),HT=eTe("replace"),tTe=Math.max,rTe=Math.min,iTe=hv([].concat),ZT=hv([].push),IU=hv("".indexOf),AU=hv("".slice),nTe=function(s){return s===void 0?s:String(s)},oTe=function(){return"a".replace(/./,"$0")==="$0"}(),OU=function(){return/./[HT]?/./[HT]("a","$0")==="":!1}(),aTe=!Vwe(function(){var s=/./;return s.exec=function(){var n=[];return n.groups={a:"7"},n},"".replace(s,"$<a>")!=="7"});jwe("replace",function(s,n,l){var o=OU?"$":"$0";return[function(t,g){var I=Xwe(this),P=Wwe(t)?void 0:Kwe(t,HT);return P?SU(P,t,I,g):SU(n,Bh(I),t,g)},function(c,t){var g=Gwe(this),I=Bh(c);if(typeof t=="string"&&IU(t,o)===-1&&IU(t,"$<")===-1){var P=l(n,g,I,t);if(P.done)return P.value}var q=$we(t);q||(t=Bh(t));var L=g.global;if(L){var V=g.unicode;g.lastIndex=0}for(var oe=[];;){var ne=Qwe(g,I);if(ne===null||(ZT(oe,ne),!L))break;var Ie=Bh(ne[0]);Ie===""&&(g.lastIndex=Ywe(I,Hwe(g.lastIndex),V))}for(var Se="",Re=0,Ze=0;Ze<oe.length;Ze++){ne=oe[Ze];for(var et=Bh(ne[0]),He=tTe(rTe(Zwe(ne.index),I.length),0),It=[],Yt=1;Yt<ne.length;Yt++)ZT(It,nTe(ne[Yt]));var At=ne.groups;if(q){var Nt=iTe([et],It,He,I);At!==void 0&&ZT(Nt,At);var wt=Bh(Uwe(t,void 0,Nt))}else wt=Jwe(et,I,He,It,At,t);He>=Re&&(Se+=AU(I,Re,He)+wt,Re=He+et.length)}return Se+AU(I,Re)}]},!aTe||!oTe||OU)});var DU=M(()=>{"use strict";var sTe=we(),lTe=ar(),XT=_t(),PU=mi(),uTe=fr(),cTe=an(),hTe=Rh(),Fh=hr(),pTe=la(),fTe=Dh(),dTe=WT(),mTe=cr(),_Te=li(),yTe=mTe("replace"),gTe=TypeError,RU=XT("".indexOf),vTe=XT("".replace),MU=XT("".slice),xTe=Math.max,qU=function(s,n,l){return l>s.length?-1:n===""?l:RU(s,n,l)};sTe({target:"String",proto:!0},{replaceAll:function(n,l){var o=PU(this),c,t,g,I,P,q,L,V,oe,ne=0,Ie=0,Se="";if(!cTe(n)){if(c=hTe(n),c&&(t=Fh(PU(fTe(n))),!~RU(t,"g")))throw gTe("`.replaceAll` does not allow non-global regexes");if(g=pTe(n,yTe),g)return lTe(g,n,o,l);if(_Te&&c)return vTe(Fh(o),n,l)}for(I=Fh(o),P=Fh(n),q=uTe(l),q||(l=Fh(l)),L=P.length,V=xTe(1,L),ne=qU(I,P,0);ne!==-1;)oe=q?Fh(l(P,ne,I)):dTe(P,I,ne,[],void 0,l),Se+=MU(I,Ie,ne)+oe,Ie=ne+L,ne=qU(I,P,ne+V);return Ie<I.length&&(Se+=MU(I,Ie)),Se}})});var zU=M(()=>{"use strict";var bTe=ar(),wTe=Yd(),TTe=Qt(),ETe=an(),STe=mi(),LU=Lw(),kU=hr(),ITe=la(),ATe=zh();wTe("search",function(s,n,l){return[function(c){var t=STe(this),g=ETe(c)?void 0:ITe(c,s);return g?bTe(g,c,t):new RegExp(c)[s](kU(t))},function(o){var c=TTe(this),t=kU(o),g=l(n,c,t);if(g.done)return g.value;var I=c.lastIndex;LU(I,0)||(c.lastIndex=0);var P=ATe(c,t);return LU(c.lastIndex,I)||(c.lastIndex=I),P===null?-1:P.index}]})});var VU=M(()=>{"use strict";var OTe=Un(),Qd=ar(),KT=_t(),CTe=Yd(),PTe=Qt(),MTe=an(),qTe=Rh(),BU=mi(),RTe=Pu(),DTe=Kd(),LTe=wn(),YT=hr(),kTe=la(),FU=sh(),NU=zh(),zTe=Hd(),BTe=Wd(),FTe=ft(),Nh=BTe.UNSUPPORTED_Y,UU=4294967295,NTe=Math.min,jU=[].push,UTe=KT(/./.exec),Uh=KT(jU),em=KT("".slice),jTe=!FTe(function(){var s=/(?:)/,n=s.exec;s.exec=function(){return n.apply(this,arguments)};var l="ab".split(s);return l.length!==2||l[0]!=="a"||l[1]!=="b"});CTe("split",function(s,n,l){var o;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?o=function(c,t){var g=YT(BU(this)),I=t===void 0?UU:t>>>0;if(I===0)return[];if(c===void 0)return[g];if(!qTe(c))return Qd(n,g,c,I);for(var P=[],q=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(c.sticky?"y":""),L=0,V=new RegExp(c.source,q+"g"),oe,ne,Ie;(oe=Qd(zTe,V,g))&&(ne=V.lastIndex,!(ne>L&&(Uh(P,em(g,L,oe.index)),oe.length>1&&oe.index<g.length&&OTe(jU,P,FU(oe,1)),Ie=oe[0].length,L=ne,P.length>=I)));)V.lastIndex===oe.index&&V.lastIndex++;return L===g.length?(Ie||!UTe(V,""))&&Uh(P,""):Uh(P,em(g,L)),P.length>I?FU(P,0,I):P}:"0".split(void 0,0).length?o=function(c,t){return c===void 0&&t===0?[]:Qd(n,this,c,t)}:o=n,[function(t,g){var I=BU(this),P=MTe(t)?void 0:kTe(t,s);return P?Qd(P,t,I,g):Qd(o,YT(I),t,g)},function(c,t){var g=PTe(this),I=YT(c),P=l(o,g,I,t,o!==n);if(P.done)return P.value;var q=RTe(g,RegExp),L=g.unicode,V=(g.ignoreCase?"i":"")+(g.multiline?"m":"")+(g.unicode?"u":"")+(Nh?"g":"y"),oe=new q(Nh?"^(?:"+g.source+")":g,V),ne=t===void 0?UU:t>>>0;if(ne===0)return[];if(I.length===0)return NU(oe,I)===null?[I]:[];for(var Ie=0,Se=0,Re=[];Se<I.length;){oe.lastIndex=Nh?0:Se;var Ze=NU(oe,Nh?em(I,Se):I),et;if(Ze===null||(et=NTe(LTe(oe.lastIndex+(Nh?Se:0)),I.length))===Ie)Se=DTe(I,Se,L);else{if(Uh(Re,em(I,Ie,Se)),Re.length===ne)return Re;for(var He=1;He<=Ze.length-1;He++)if(Uh(Re,Ze[He]),Re.length===ne)return Re;Se=Ie=et}}return Uh(Re,em(I,Ie)),Re}]},!jTe,Nh)});var HU=M(()=>{"use strict";var VTe=we(),WU=_t(),GTe=Ui().f,$Te=wn(),GU=hr(),WTe=av(),ZTe=mi(),HTe=sv(),XTe=li(),$U=WU("".startsWith),YTe=WU("".slice),KTe=Math.min,ZU=HTe("startsWith"),JTe=!XTe&&!ZU&&!!function(){var s=GTe(String.prototype,"startsWith");return s&&!s.writable}();VTe({target:"String",proto:!0,forced:!JTe&&!ZU},{startsWith:function(n){var l=GU(ZTe(this));WTe(n);var o=$Te(KTe(arguments.length>1?arguments[1]:void 0,l.length)),c=GU(n);return $U?$U(l,c,o):YTe(l,o,o+c.length)===c}})});var YU=M(()=>{"use strict";var QTe=we(),eEe=_t(),tEe=mi(),XU=Ei(),rEe=hr(),iEe=eEe("".slice),nEe=Math.max,oEe=Math.min,aEe=!"".substr||"ab".substr(-1)!=="b";QTe({target:"String",proto:!0,forced:aEe},{substr:function(n,l){var o=rEe(tEe(this)),c=o.length,t=XU(n),g,I;return t===1/0&&(t=0),t<0&&(t=nEe(c+t,0)),g=l===void 0?c:XU(l),g<=0||g===1/0?"":(I=oEe(t+g,c),t>=I?"":iEe(o,t,I))}})});var pv=M((TGe,QU)=>{var sEe=bu().PROPER,lEe=ft(),KU=Ld(),JU="\u200B\x85\u180E";QU.exports=function(s){return lEe(function(){return!!KU[s]()||JU[s]()!==JU||sEe&&KU[s].name!==s})}});var e5=M(()=>{"use strict";var uEe=we(),cEe=qu().trim,hEe=pv();uEe({target:"String",proto:!0,forced:hEe("trim")},{trim:function(){return cEe(this)}})});var JT=M((IGe,t5)=>{"use strict";var pEe=qu().end,fEe=pv();t5.exports=fEe("trimEnd")?function(){return pEe(this)}:"".trimEnd});var i5=M(()=>{var dEe=we(),r5=JT();dEe({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==r5},{trimRight:r5})});var o5=M(()=>{i5();var mEe=we(),n5=JT();mEe({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==n5},{trimEnd:n5})});var QT=M((MGe,a5)=>{"use strict";var _Ee=qu().start,yEe=pv();a5.exports=yEe("trimStart")?function(){return _Ee(this)}:"".trimStart});var l5=M(()=>{var gEe=we(),s5=QT();gEe({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==s5},{trimLeft:s5})});var c5=M(()=>{l5();var vEe=we(),u5=QT();vEe({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==u5},{trimStart:u5})});var An=M((kGe,p5)=>{var xEe=_t(),bEe=mi(),h5=hr(),wEe=/"/g,TEe=xEe("".replace);p5.exports=function(s,n,l,o){var c=h5(bEe(s)),t="<"+n;return l!==""&&(t+=" "+l+'="'+TEe(h5(o),wEe,"&quot;")+'"'),t+">"+c+"</"+n+">"}});var On=M((zGe,f5)=>{var EEe=ft();f5.exports=function(s){return EEe(function(){var n=""[s]('"');return n!==n.toLowerCase()||n.split('"').length>3})}});var d5=M(()=>{"use strict";var SEe=we(),IEe=An(),AEe=On();SEe({target:"String",proto:!0,forced:AEe("anchor")},{anchor:function(n){return IEe(this,"a","name",n)}})});var m5=M(()=>{"use strict";var OEe=we(),CEe=An(),PEe=On();OEe({target:"String",proto:!0,forced:PEe("big")},{big:function(){return CEe(this,"big","","")}})});var _5=M(()=>{"use strict";var MEe=we(),qEe=An(),REe=On();MEe({target:"String",proto:!0,forced:REe("blink")},{blink:function(){return qEe(this,"blink","","")}})});var y5=M(()=>{"use strict";var DEe=we(),LEe=An(),kEe=On();DEe({target:"String",proto:!0,forced:kEe("bold")},{bold:function(){return LEe(this,"b","","")}})});var g5=M(()=>{"use strict";var zEe=we(),BEe=An(),FEe=On();zEe({target:"String",proto:!0,forced:FEe("fixed")},{fixed:function(){return BEe(this,"tt","","")}})});var v5=M(()=>{"use strict";var NEe=we(),UEe=An(),jEe=On();NEe({target:"String",proto:!0,forced:jEe("fontcolor")},{fontcolor:function(n){return UEe(this,"font","color",n)}})});var x5=M(()=>{"use strict";var VEe=we(),GEe=An(),$Ee=On();VEe({target:"String",proto:!0,forced:$Ee("fontsize")},{fontsize:function(n){return GEe(this,"font","size",n)}})});var b5=M(()=>{"use strict";var WEe=we(),ZEe=An(),HEe=On();WEe({target:"String",proto:!0,forced:HEe("italics")},{italics:function(){return ZEe(this,"i","","")}})});var w5=M(()=>{"use strict";var XEe=we(),YEe=An(),KEe=On();XEe({target:"String",proto:!0,forced:KEe("link")},{link:function(n){return YEe(this,"a","href",n)}})});var T5=M(()=>{"use strict";var JEe=we(),QEe=An(),eSe=On();JEe({target:"String",proto:!0,forced:eSe("small")},{small:function(){return QEe(this,"small","","")}})});var E5=M(()=>{"use strict";var tSe=we(),rSe=An(),iSe=On();tSe({target:"String",proto:!0,forced:iSe("strike")},{strike:function(){return rSe(this,"strike","","")}})});var S5=M(()=>{"use strict";var nSe=we(),oSe=An(),aSe=On();nSe({target:"String",proto:!0,forced:aSe("sub")},{sub:function(){return oSe(this,"sub","","")}})});var I5=M(()=>{"use strict";var sSe=we(),lSe=An(),uSe=On();sSe({target:"String",proto:!0,forced:uSe("sup")},{sup:function(){return lSe(this,"sup","","")}})});var fv=M((c$e,O5)=>{var A5=Ct(),eE=ft(),cSe=vd(),hSe=yr().NATIVE_ARRAY_BUFFER_VIEWS,pSe=A5.ArrayBuffer,Nu=A5.Int8Array;O5.exports=!hSe||!eE(function(){Nu(1)})||!eE(function(){new Nu(-1)})||!cSe(function(s){new Nu,new Nu(null),new Nu(1.5),new Nu(s)},!0)||eE(function(){return new Nu(new pSe(2),1,void 0).length!==1})});var P5=M((h$e,C5)=>{var fSe=Ei(),dSe=RangeError;C5.exports=function(s){var n=fSe(s);if(n<0)throw dSe("The argument can't be less than 0");return n}});var tE=M((p$e,M5)=>{var mSe=P5(),_Se=RangeError;M5.exports=function(s,n){var l=mSe(s);if(l%n)throw _Se("Wrong offset");return l}});var R5=M((f$e,q5)=>{var ySe=Po(),gSe=_t(),vSe=gSe("".slice);q5.exports=function(s){return vSe(ySe(s),0,3)==="Big"}});var rE=M((d$e,D5)=>{var xSe=ed(),bSe=TypeError;D5.exports=function(s){var n=xSe(s,"number");if(typeof n=="number")throw bSe("Can't convert number to bigint");return BigInt(n)}});var iE=M((m$e,L5)=>{var wSe=Qn(),TSe=ar(),ESe=Cg(),SSe=Mr(),ISe=Vr(),ASe=md(),OSe=fh(),CSe=ig(),PSe=R5(),MSe=yr().aTypedArrayConstructor,qSe=rE();L5.exports=function(n){var l=ESe(this),o=SSe(n),c=arguments.length,t=c>1?arguments[1]:void 0,g=t!==void 0,I=OSe(o),P,q,L,V,oe,ne,Ie,Se;if(I&&!CSe(I))for(Ie=ASe(o,I),Se=Ie.next,o=[];!(ne=TSe(Se,Ie)).done;)o.push(ne.value);for(g&&c>2&&(t=wSe(t,arguments[2])),q=ISe(o),L=new(MSe(l))(q),V=PSe(L),P=0;q>P;P++)oe=g?t(o[P],P):o[P],L[P]=V?qSe(oe):+oe;return L}});var ya=M((_$e,cE)=>{"use strict";var k5=we(),Z5=Ct(),z5=ar(),RSe=$t(),DSe=fv(),jh=yr(),H5=Id(),B5=Ro(),LSe=Fn(),tm=ln(),kSe=Ng(),zSe=wn(),F5=kb(),nE=tE(),X5=Xa(),rm=_r(),BSe=Po(),sE=sr(),FSe=Gs(),NSe=Tn(),USe=Nn(),dv=Mo(),jSe=Ya().f,N5=iE(),VSe=Mi().forEach,GSe=Ou(),Y5=qr(),K5=Ui(),hE=_i(),$Se=Iu(),lE=hE.get,WSe=hE.set,ZSe=hE.enforce,pE=Y5.f,HSe=K5.f,XSe=Math.round,oE=Z5.RangeError,J5=H5.ArrayBuffer,YSe=J5.prototype,KSe=H5.DataView,mv=jh.NATIVE_ARRAY_BUFFER_VIEWS,U5=jh.TYPED_ARRAY_TAG,j5=jh.TypedArray,im=jh.TypedArrayPrototype,JSe=jh.aTypedArrayConstructor,uE=jh.isTypedArray,_v="BYTES_PER_ELEMENT",aE="Wrong length",V5=function(s,n){JSe(s);for(var l=0,o=n.length,c=new s(o);o>l;)c[l]=n[l++];return c},yv=function(s,n){pE(s,n,{get:function(){return lE(this)[n]}})},G5=function(s){var n;return USe(YSe,s)||(n=BSe(s))=="ArrayBuffer"||n=="SharedArrayBuffer"},Q5=function(s,n){return uE(s)&&!FSe(n)&&n in s&&kSe(+n)&&n>=0},$5=function(n,l){return l=X5(l),Q5(n,l)?LSe(2,n[l]):HSe(n,l)},W5=function(n,l,o){return l=X5(l),Q5(n,l)&&sE(o)&&rm(o,"value")&&!rm(o,"get")&&!rm(o,"set")&&!o.configurable&&(!rm(o,"writable")||o.writable)&&(!rm(o,"enumerable")||o.enumerable)?(n[l]=o.value,n):pE(n,l,o)};RSe?(mv||(K5.f=$5,Y5.f=W5,yv(im,"buffer"),yv(im,"byteOffset"),yv(im,"byteLength"),yv(im,"length")),k5({target:"Object",stat:!0,forced:!mv},{getOwnPropertyDescriptor:$5,defineProperty:W5}),cE.exports=function(s,n,l){var o=s.match(/\d+$/)[0]/8,c=s+(l?"Clamped":"")+"Array",t="get"+s,g="set"+s,I=Z5[c],P=I,q=P&&P.prototype,L={},V=function(Se,Re){var Ze=lE(Se);return Ze.view[t](Re*o+Ze.byteOffset,!0)},oe=function(Se,Re,Ze){var et=lE(Se);l&&(Ze=(Ze=XSe(Ze))<0?0:Ze>255?255:Ze&255),et.view[g](Re*o+et.byteOffset,Ze,!0)},ne=function(Se,Re){pE(Se,Re,{get:function(){return V(this,Re)},set:function(Ze){return oe(this,Re,Ze)},enumerable:!0})};mv?DSe&&(P=n(function(Se,Re,Ze,et){return B5(Se,q),$Se(function(){return sE(Re)?G5(Re)?et!==void 0?new I(Re,nE(Ze,o),et):Ze!==void 0?new I(Re,nE(Ze,o)):new I(Re):uE(Re)?V5(P,Re):z5(N5,P,Re):new I(F5(Re))}(),Se,P)}),dv&&dv(P,j5),VSe(jSe(I),function(Se){Se in P||tm(P,Se,I[Se])}),P.prototype=q):(P=n(function(Se,Re,Ze,et){B5(Se,q);var He=0,It=0,Yt,At,Nt;if(!sE(Re))Nt=F5(Re),At=Nt*o,Yt=new J5(At);else if(G5(Re)){Yt=Re,It=nE(Ze,o);var wt=Re.byteLength;if(et===void 0){if(wt%o||(At=wt-It,At<0))throw oE(aE)}else if(At=zSe(et)*o,At+It>wt)throw oE(aE);Nt=At/o}else return uE(Re)?V5(P,Re):z5(N5,P,Re);for(WSe(Se,{buffer:Yt,byteOffset:It,byteLength:At,length:Nt,view:new KSe(Yt)});He<Nt;)ne(Se,He++)}),dv&&dv(P,j5),q=P.prototype=NSe(im)),q.constructor!==P&&tm(q,"constructor",P),ZSe(q).TypedArrayConstructor=P,U5&&tm(q,U5,c);var Ie=P!=I;L[c]=P,k5({global:!0,constructor:!0,forced:Ie,sham:!mv},L),_v in P||tm(P,_v,o),_v in q||tm(q,_v,o),GSe(c)}):cE.exports=function(){}});var e6=M(()=>{var QSe=ya();QSe("Float32",function(s){return function(l,o,c){return s(this,l,o,c)}})});var t6=M(()=>{var e2e=ya();e2e("Float64",function(s){return function(l,o,c){return s(this,l,o,c)}})});var r6=M(()=>{var t2e=ya();t2e("Int8",function(s){return function(l,o,c){return s(this,l,o,c)}})});var i6=M(()=>{var r2e=ya();r2e("Int16",function(s){return function(l,o,c){return s(this,l,o,c)}})});var n6=M(()=>{var i2e=ya();i2e("Int32",function(s){return function(l,o,c){return s(this,l,o,c)}})});var o6=M(()=>{var n2e=ya();n2e("Uint8",function(s){return function(l,o,c){return s(this,l,o,c)}})});var a6=M(()=>{var o2e=ya();o2e("Uint8",function(s){return function(l,o,c){return s(this,l,o,c)}},!0)});var s6=M(()=>{var a2e=ya();a2e("Uint16",function(s){return function(l,o,c){return s(this,l,o,c)}})});var l6=M(()=>{var s2e=ya();s2e("Uint32",function(s){return function(l,o,c){return s(this,l,o,c)}})});var c6=M(()=>{"use strict";var u6=yr(),l2e=Vr(),u2e=Ei(),c2e=u6.aTypedArray,h2e=u6.exportTypedArrayMethod;h2e("at",function(n){var l=c2e(this),o=l2e(l),c=u2e(n),t=c>=0?c:o+c;return t<0||t>=o?void 0:l[t]})});var p6=M(()=>{"use strict";var p2e=_t(),h6=yr(),f2e=db(),d2e=p2e(f2e),m2e=h6.aTypedArray,_2e=h6.exportTypedArrayMethod;_2e("copyWithin",function(n,l){return d2e(m2e(this),n,l,arguments.length>2?arguments[2]:void 0)})});var d6=M(()=>{"use strict";var f6=yr(),y2e=Mi().every,g2e=f6.aTypedArray,v2e=f6.exportTypedArrayMethod;v2e("every",function(n){return y2e(g2e(this),n,arguments.length>1?arguments[1]:void 0)})});var _6=M(()=>{"use strict";var m6=yr(),x2e=lg(),b2e=rE(),w2e=Po(),T2e=ar(),E2e=_t(),S2e=ft(),I2e=m6.aTypedArray,A2e=m6.exportTypedArrayMethod,O2e=E2e("".slice),C2e=S2e(function(){var s=0;return new Int8Array(2).fill({valueOf:function(){return s++}}),s!==1});A2e("fill",function(n){var l=arguments.length;I2e(this);var o=O2e(w2e(this),0,3)==="Big"?b2e(n):+n;return T2e(x2e,this,o,l>1?arguments[1]:void 0,l>2?arguments[2]:void 0)},C2e)});var g6=M((V$e,y6)=>{var P2e=Vr();y6.exports=function(s,n){for(var l=0,o=P2e(n),c=new s(o);o>l;)c[l]=n[l++];return c}});var nm=M((G$e,x6)=>{var v6=yr(),M2e=Pu(),q2e=v6.aTypedArrayConstructor,R2e=v6.getTypedArrayConstructor;x6.exports=function(s){return q2e(M2e(s,R2e(s)))}});var w6=M(($$e,b6)=>{var D2e=g6(),L2e=nm();b6.exports=function(s,n){return D2e(L2e(s),n)}});var E6=M(()=>{"use strict";var T6=yr(),k2e=Mi().filter,z2e=w6(),B2e=T6.aTypedArray,F2e=T6.exportTypedArrayMethod;F2e("filter",function(n){var l=k2e(B2e(this),n,arguments.length>1?arguments[1]:void 0);return z2e(this,l)})});var I6=M(()=>{"use strict";var S6=yr(),N2e=Mi().find,U2e=S6.aTypedArray,j2e=S6.exportTypedArrayMethod;j2e("find",function(n){return N2e(U2e(this),n,arguments.length>1?arguments[1]:void 0)})});var O6=M(()=>{"use strict";var A6=yr(),V2e=Mi().findIndex,G2e=A6.aTypedArray,$2e=A6.exportTypedArrayMethod;$2e("findIndex",function(n){return V2e(G2e(this),n,arguments.length>1?arguments[1]:void 0)})});var P6=M(()=>{"use strict";var C6=yr(),W2e=gd().findLast,Z2e=C6.aTypedArray,H2e=C6.exportTypedArrayMethod;H2e("findLast",function(n){return W2e(Z2e(this),n,arguments.length>1?arguments[1]:void 0)})});var q6=M(()=>{"use strict";var M6=yr(),X2e=gd().findLastIndex,Y2e=M6.aTypedArray,K2e=M6.exportTypedArrayMethod;K2e("findLastIndex",function(n){return X2e(Y2e(this),n,arguments.length>1?arguments[1]:void 0)})});var D6=M(()=>{"use strict";var R6=yr(),J2e=Mi().forEach,Q2e=R6.aTypedArray,eIe=R6.exportTypedArrayMethod;eIe("forEach",function(n){J2e(Q2e(this),n,arguments.length>1?arguments[1]:void 0)})});var L6=M(()=>{"use strict";var tIe=fv(),rIe=yr().exportTypedArrayStaticMethod,iIe=iE();rIe("from",iIe,tIe)});var z6=M(()=>{"use strict";var k6=yr(),nIe=nh().includes,oIe=k6.aTypedArray,aIe=k6.exportTypedArrayMethod;aIe("includes",function(n){return nIe(oIe(this),n,arguments.length>1?arguments[1]:void 0)})});var F6=M(()=>{"use strict";var B6=yr(),sIe=nh().indexOf,lIe=B6.aTypedArray,uIe=B6.exportTypedArrayMethod;uIe("indexOf",function(n){return sIe(lIe(this),n,arguments.length>1?arguments[1]:void 0)})});var G6=M(()=>{"use strict";var cIe=Ct(),hIe=ft(),fE=_t(),U6=yr(),dE=Td(),pIe=cr(),mE=pIe("iterator"),N6=cIe.Uint8Array,fIe=fE(dE.values),dIe=fE(dE.keys),mIe=fE(dE.entries),_E=U6.aTypedArray,gv=U6.exportTypedArrayMethod,Vh=N6&&N6.prototype,vv=!hIe(function(){Vh[mE].call([1])}),j6=!!Vh&&Vh.values&&Vh[mE]===Vh.values&&Vh.values.name==="values",V6=function(){return fIe(_E(this))};gv("entries",function(){return mIe(_E(this))},vv);gv("keys",function(){return dIe(_E(this))},vv);gv("values",V6,vv||!j6,{name:"values"});gv(mE,V6,vv||!j6,{name:"values"})});var W6=M(()=>{"use strict";var $6=yr(),_Ie=_t(),yIe=$6.aTypedArray,gIe=$6.exportTypedArrayMethod,vIe=_Ie([].join);gIe("join",function(n){return vIe(yIe(this),n)})});var H6=M(()=>{"use strict";var Z6=yr(),xIe=Un(),bIe=Cb(),wIe=Z6.aTypedArray,TIe=Z6.exportTypedArrayMethod;TIe("lastIndexOf",function(n){var l=arguments.length;return xIe(bIe,wIe(this),l>1?[n,arguments[1]]:[n])})});var Y6=M(()=>{"use strict";var X6=yr(),EIe=Mi().map,SIe=nm(),IIe=X6.aTypedArray,AIe=X6.exportTypedArrayMethod;AIe("map",function(n){return EIe(IIe(this),n,arguments.length>1?arguments[1]:void 0,function(l,o){return new(SIe(l))(o)})})});var J6=M(()=>{"use strict";var K6=yr(),OIe=fv(),CIe=K6.aTypedArrayConstructor,PIe=K6.exportTypedArrayStaticMethod;PIe("of",function(){for(var n=0,l=arguments.length,o=new(CIe(this))(l);l>n;)o[n]=arguments[n++];return o},OIe)});var ej=M(()=>{"use strict";var Q6=yr(),MIe=Ed().left,qIe=Q6.aTypedArray,RIe=Q6.exportTypedArrayMethod;RIe("reduce",function(n){var l=arguments.length;return MIe(qIe(this),n,l,l>1?arguments[1]:void 0)})});var rj=M(()=>{"use strict";var tj=yr(),DIe=Ed().right,LIe=tj.aTypedArray,kIe=tj.exportTypedArrayMethod;kIe("reduceRight",function(n){var l=arguments.length;return DIe(LIe(this),n,l,l>1?arguments[1]:void 0)})});var nj=M(()=>{"use strict";var ij=yr(),zIe=ij.aTypedArray,BIe=ij.exportTypedArrayMethod,FIe=Math.floor;BIe("reverse",function(){for(var n=this,l=zIe(n).length,o=FIe(l/2),c=0,t;c<o;)t=n[c],n[c++]=n[--l],n[l]=t;return n})});var cj=M(()=>{"use strict";var aj=Ct(),sj=ar(),vE=yr(),NIe=Vr(),UIe=tE(),jIe=Mr(),lj=ft(),VIe=aj.RangeError,yE=aj.Int8Array,oj=yE&&yE.prototype,uj=oj&&oj.set,GIe=vE.aTypedArray,$Ie=vE.exportTypedArrayMethod,gE=!lj(function(){var s=new Uint8ClampedArray(2);return sj(uj,s,{length:1,0:3},1),s[1]!==3}),WIe=gE&&vE.NATIVE_ARRAY_BUFFER_VIEWS&&lj(function(){var s=new yE(2);return s.set(1),s.set("2",1),s[0]!==0||s[1]!==2});$Ie("set",function(n){GIe(this);var l=UIe(arguments.length>1?arguments[1]:void 0,1),o=jIe(n);if(gE)return sj(uj,this,o,l);var c=this.length,t=NIe(o),g=0;if(t+l>c)throw VIe("Wrong length");for(;g<t;)this[l+g]=o[g++]},!gE||WIe)});var pj=M(()=>{"use strict";var hj=yr(),ZIe=nm(),HIe=ft(),XIe=Hs(),YIe=hj.aTypedArray,KIe=hj.exportTypedArrayMethod,JIe=HIe(function(){new Int8Array(1).slice()});KIe("slice",function(n,l){for(var o=XIe(YIe(this),n,l),c=ZIe(this),t=0,g=o.length,I=new c(g);g>t;)I[t]=o[t++];return I},JIe)});var dj=M(()=>{"use strict";var fj=yr(),QIe=Mi().some,eAe=fj.aTypedArray,tAe=fj.exportTypedArrayMethod;tAe("some",function(n){return QIe(eAe(this),n,arguments.length>1?arguments[1]:void 0)})});var xj=M(()=>{"use strict";var rAe=Ct(),iAe=_t(),xE=ft(),nAe=Ti(),oAe=mg(),vj=yr(),mj=qb(),aAe=Rb(),_j=sa(),yj=_g(),sAe=vj.aTypedArray,lAe=vj.exportTypedArrayMethod,om=rAe.Uint16Array,Gh=om&&iAe(om.prototype.sort),uAe=!!Gh&&!(xE(function(){Gh(new om(2),null)})&&xE(function(){Gh(new om(2),{})})),gj=!!Gh&&!xE(function(){if(_j)return _j<74;if(mj)return mj<67;if(aAe)return!0;if(yj)return yj<602;var s=new om(516),n=Array(516),l,o;for(l=0;l<516;l++)o=l%4,s[l]=515-l,n[l]=l-2*o+3;for(Gh(s,function(c,t){return(c/4|0)-(t/4|0)}),l=0;l<516;l++)if(s[l]!==n[l])return!0}),cAe=function(s){return function(n,l){return s!==void 0?+s(n,l)||0:l!==l?-1:n!==n?1:n===0&&l===0?1/n>0&&1/l<0?1:-1:n>l}};lAe("sort",function(n){return n!==void 0&&nAe(n),gj?Gh(this,n):oAe(sAe(this),cAe(n))},!gj||uAe)});var Tj=M(()=>{"use strict";var wj=yr(),hAe=wn(),bj=ua(),pAe=nm(),fAe=wj.aTypedArray,dAe=wj.exportTypedArrayMethod;dAe("subarray",function(n,l){var o=fAe(this),c=o.length,t=bj(n,c),g=pAe(o);return new g(o.buffer,o.byteOffset+t*o.BYTES_PER_ELEMENT,hAe((l===void 0?c:bj(l,c))-t))})});var Oj=M(()=>{"use strict";var mAe=Ct(),_Ae=Un(),Ij=yr(),bE=ft(),Ej=Hs(),xv=mAe.Int8Array,Sj=Ij.aTypedArray,yAe=Ij.exportTypedArrayMethod,Aj=[].toLocaleString,gAe=!!xv&&bE(function(){Aj.call(new xv(1))}),vAe=bE(function(){return[1,2].toLocaleString()!=new xv([1,2]).toLocaleString()})||!bE(function(){xv.prototype.toLocaleString.call([1,2])});yAe("toLocaleString",function(){return _Ae(Aj,gAe?Ej(Sj(this)):Sj(this),Ej(arguments))},vAe)});var Pj=M(()=>{"use strict";var xAe=yr().exportTypedArrayMethod,bAe=ft(),wAe=Ct(),TAe=_t(),Cj=wAe.Uint8Array,EAe=Cj&&Cj.prototype||{},bv=[].toString,SAe=TAe([].join);bAe(function(){bv.call({})})&&(bv=function(){return SAe(this)});var IAe=EAe.toString!=bv;xAe("toString",bv,IAe)});var Lj=M(()=>{"use strict";var AAe=we(),wE=_t(),OAe=hr(),Mj=String.fromCharCode,qj=wE("".charAt),Rj=wE(/./.exec),Dj=wE("".slice),CAe=/^[\da-f]{2}$/i,PAe=/^[\da-f]{4}$/i;AAe({global:!0},{unescape:function(n){for(var l=OAe(n),o="",c=l.length,t=0,g,I;t<c;){if(g=qj(l,t++),g==="%"){if(qj(l,t)==="u"){if(I=Dj(l,t+1,t+5),Rj(PAe,I)){o+=Mj(parseInt(I,16)),t+=5;continue}}else if(I=Dj(l,t,t+2),Rj(CAe,I)){o+=Mj(parseInt(I,16)),t+=2;continue}}o+=g}return o}})});var SE=M((j7e,Uj)=>{"use strict";var MAe=_t(),kj=_h(),wv=rl().getWeakData,qAe=Ro(),RAe=Qt(),DAe=an(),TE=sr(),LAe=qo(),Bj=Mi(),zj=_r(),Fj=_i(),kAe=Fj.set,zAe=Fj.getterFor,BAe=Bj.find,FAe=Bj.findIndex,NAe=MAe([].splice),UAe=0,Tv=function(s){return s.frozen||(s.frozen=new Nj)},Nj=function(){this.entries=[]},EE=function(s,n){return BAe(s.entries,function(l){return l[0]===n})};Nj.prototype={get:function(s){var n=EE(this,s);if(n)return n[1]},has:function(s){return!!EE(this,s)},set:function(s,n){var l=EE(this,s);l?l[1]=n:this.entries.push([s,n])},delete:function(s){var n=FAe(this.entries,function(l){return l[0]===s});return~n&&NAe(this.entries,n,1),!!~n}};Uj.exports={getConstructor:function(s,n,l,o){var c=s(function(P,q){qAe(P,t),kAe(P,{type:n,id:UAe++,frozen:void 0}),DAe(q)||LAe(q,P[o],{that:P,AS_ENTRIES:l})}),t=c.prototype,g=zAe(n),I=function(P,q,L){var V=g(P),oe=wv(RAe(q),!0);return oe===!0?Tv(V).set(q,L):oe[V.id]=L,P};return kj(t,{delete:function(P){var q=g(this);if(!TE(P))return!1;var L=wv(P);return L===!0?Tv(q).delete(P):L&&zj(L,q.id)&&delete L[q.id]},has:function(q){var L=g(this);if(!TE(q))return!1;var V=wv(q);return V===!0?Tv(L).has(q):V&&zj(V,L.id)}}),kj(t,l?{get:function(q){var L=g(this);if(TE(q)){var V=wv(q);return V===!0?Tv(L).get(q):V?V[L.id]:void 0}},set:function(q,L){return I(this,q,L)}}:{add:function(q){return I(this,q,!0)}}),c}}});var $j=M(()=>{"use strict";var jj=Ct(),Ev=_t(),jAe=_h(),VAe=rl(),GAe=Pd(),Vj=SE(),Sv=sr(),Iv=Cd(),Av=_i().enforce,$Ae=g1(),WAe=!jj.ActiveXObject&&"ActiveXObject"in jj,am,Gj=function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},ZAe=GAe("WeakMap",Gj,Vj);$Ae&&WAe&&(am=Vj.getConstructor(Gj,"WeakMap",!0),VAe.enable(),$h=ZAe.prototype,IE=Ev($h.delete),sm=Ev($h.has),AE=Ev($h.get),OE=Ev($h.set),jAe($h,{delete:function(s){if(Sv(s)&&!Iv(s)){var n=Av(this);return n.frozen||(n.frozen=new am),IE(this,s)||n.frozen.delete(s)}return IE(this,s)},has:function(n){if(Sv(n)&&!Iv(n)){var l=Av(this);return l.frozen||(l.frozen=new am),sm(this,n)||l.frozen.has(n)}return sm(this,n)},get:function(n){if(Sv(n)&&!Iv(n)){var l=Av(this);return l.frozen||(l.frozen=new am),sm(this,n)?AE(this,n):l.frozen.get(n)}return AE(this,n)},set:function(n,l){if(Sv(n)&&!Iv(n)){var o=Av(this);o.frozen||(o.frozen=new am),sm(this,n)?OE(this,n,l):o.frozen.set(n,l)}else OE(this,n,l);return this}}));var $h,IE,sm,AE,OE});var Wj=M(()=>{$j()});var Zj=M(()=>{"use strict";var HAe=Pd(),XAe=SE();HAe("WeakSet",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},XAe)});var Hj=M(()=>{Zj()});var CE=M((K7e,Kj)=>{var Xj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Yj={};for(lm=0;lm<66;lm++)Yj[Xj.charAt(lm)]=lm;var lm;Kj.exports={itoc:Xj,ctoi:Yj}});var iV=M(()=>{var YAe=we(),tV=Hr(),ME=_t(),qE=ft(),KAe=hr(),JAe=_r(),QAe=as(),PE=CE().ctoi,rV=/[^\d+/a-z]/i,eOe=/[\t\n\f\r ]+/g,tOe=/[=]+$/,um=tV("atob"),rOe=String.fromCharCode,iOe=ME("".charAt),Jj=ME("".replace),nOe=ME(rV.exec),RE=qE(function(){return um(" ")!==""}),DE=!qE(function(){um("a")}),Qj=!RE&&!DE&&!qE(function(){um()}),eV=!RE&&!DE&&um.length!==1;YAe({global:!0,enumerable:!0,forced:RE||DE||Qj||eV},{atob:function(n){if(QAe(arguments.length,1),Qj||eV)return um(n);var l=Jj(KAe(n),eOe,""),o="",c=0,t=0,g,I;if(l.length%4==0&&(l=Jj(l,tOe,"")),l.length%4==1||nOe(rV,l))throw new(tV("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;g=iOe(l,c++);)JAe(PE,g)&&(I=t%4?I*64+PE[g]:PE[g],t++%4&&(o+=rOe(255&I>>(-2*t&6))));return o}})});var pV=M(()=>{var oOe=we(),uV=Hr(),cV=_t(),hV=ft(),nV=hr(),aOe=as(),sOe=CE().itoc,Uu=uV("btoa"),oV=cV("".charAt),lOe=cV("".charCodeAt),aV=!!Uu&&!hV(function(){Uu()}),sV=!!Uu&&hV(function(){return Uu(null)!=="bnVsbA=="}),lV=!!Uu&&Uu.length!==1;oOe({global:!0,enumerable:!0,forced:aV||sV||lV},{btoa:function(n){if(aOe(arguments.length,1),aV||sV||lV)return Uu(nV(n));for(var l=nV(n),o="",c=0,t=sOe,g,I;oV(l,c)||(t="=",c%1);){if(I=lOe(l,c+=3/4),I>255)throw new(uV("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");g=g<<8|I,o+=oV(t,63&g>>8-c%1*8)}return o}})});var LE=M((rWe,fV)=>{fV.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}});var zE=M((iWe,mV)=>{var uOe=td(),kE=uOe("span").classList,dV=kE&&kE.constructor&&kE.constructor.prototype;mV.exports=dV===Object.prototype?void 0:dV});var vV=M(()=>{var _V=Ct(),yV=LE(),cOe=zE(),BE=gb(),hOe=ln(),gV=function(s){if(s&&s.forEach!==BE)try{hOe(s,"forEach",BE)}catch{s.forEach=BE}};for(Ov in yV)yV[Ov]&&gV(_V[Ov]&&_V[Ov].prototype);var Ov;gV(cOe)});var SV=M(()=>{var xV=Ct(),wV=LE(),pOe=zE(),cm=Td(),FE=ln(),TV=cr(),NE=TV("iterator"),bV=TV("toStringTag"),UE=cm.values,EV=function(s,n){if(s){if(s[NE]!==UE)try{FE(s,NE,UE)}catch{s[NE]=UE}if(s[bV]||FE(s,bV,n),wV[n]){for(var l in cm)if(s[l]!==cm[l])try{FE(s,l,cm[l])}catch{s[l]=cm[l]}}}};for(Cv in wV)EV(xV[Cv]&&xV[Cv].prototype,Cv);var Cv;EV(pOe,"DOMTokenList")});var AV=M((lWe,IV)=>{var fOe=fa();IV.exports=function(s){try{if(fOe)return Function('return require("'+s+'")')()}catch{}}});var jE=M((uWe,OV)=>{OV.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}});var FV=M(()=>{"use strict";var dOe=we(),mOe=AV(),qv=Hr(),HE=ft(),_Oe=Tn(),XE=Fn(),Rv=qr().f,yOe=Qr(),Pv=nl(),Mv=_r(),gOe=Ro(),vOe=Qt(),MV=ob(),CV=hh(),Wh=jE(),xOe=dd(),qV=_i(),YE=$t(),RV=li(),Zh="DOMException",ZE="DATA_CLONE_ERR",Lv=qv("Error"),ss=qv(Zh)||function(){try{var s=qv("MessageChannel")||mOe("worker_threads").MessageChannel;new s().port1.postMessage(new WeakMap)}catch(n){if(n.name==ZE&&n.code==25)return n.constructor}}(),bOe=ss&&ss.prototype,DV=Lv.prototype,wOe=qV.set,TOe=qV.getterFor(Zh),EOe="stack"in Lv(Zh),LV=function(s){return Mv(Wh,s)&&Wh[s].m?Wh[s].c:0},KE=function(){gOe(this,pm);var n=arguments.length,l=CV(n<1?void 0:arguments[0]),o=CV(n<2?void 0:arguments[1],"Error"),c=LV(o);if(wOe(this,{type:Zh,name:o,message:l,code:c}),YE||(this.name=o,this.message=l,this.code=c),EOe){var t=Lv(l);t.name=Zh,Rv(this,"stack",XE(1,xOe(t.stack,1)))}},pm=KE.prototype=_Oe(DV),kV=function(s){return{enumerable:!0,configurable:!0,get:s}},VE=function(s){return kV(function(){return TOe(this)[s]})};YE&&(Pv(pm,"code",VE("code")),Pv(pm,"message",VE("message")),Pv(pm,"name",VE("name")));Rv(pm,"constructor",XE(1,KE));var kv=HE(function(){return!(new ss instanceof Lv)}),zV=kv||HE(function(){return DV.toString!==MV||String(new ss(1,2))!=="2: 1"}),BV=kv||HE(function(){return new ss(1,"DataCloneError").code!==25}),SOe=kv||ss[ZE]!==25||bOe[ZE]!==25,PV=RV?zV||BV||SOe:kv;dOe({global:!0,constructor:!0,forced:PV},{DOMException:PV?KE:ss});var fm=qv(Zh),Dv=fm.prototype;zV&&(RV||ss===fm)&&yOe(Dv,"toString",MV);BV&&YE&&ss===fm&&Pv(Dv,"code",kV(function(){return LV(vOe(this).name)}));for(GE in Wh)Mv(Wh,GE)&&($E=Wh[GE],hm=$E.s,WE=XE(6,$E.c),Mv(fm,hm)||Rv(fm,hm,WE),Mv(Dv,hm)||Rv(Dv,hm,WE));var $E,hm,WE,GE});var WV=M(()=>{"use strict";var IOe=we(),AOe=Ct(),oS=Hr(),iS=Fn(),nS=qr().f,NV=_r(),OOe=Ro(),COe=Iu(),UV=hh(),JE=jE(),POe=dd(),MOe=$t(),GV=li(),mm="DOMException",$V=oS("Error"),_m=oS(mm),aS=function(){OOe(this,qOe);var n=arguments.length,l=UV(n<1?void 0:arguments[0]),o=UV(n<2?void 0:arguments[1],"Error"),c=new _m(l,o),t=$V(l);return t.name=mm,nS(c,"stack",iS(1,POe(t.stack,1))),COe(c,this,aS),c},qOe=aS.prototype=_m.prototype,ROe="stack"in $V(mm),DOe="stack"in new _m(1,2),QE=_m&&MOe&&Object.getOwnPropertyDescriptor(AOe,mm),LOe=!!QE&&!(QE.writable&&QE.configurable),jV=ROe&&!LOe&&!DOe;IOe({global:!0,constructor:!0,forced:GV||jV},{DOMException:jV?aS:_m});var dm=oS(mm),VV=dm.prototype;if(VV.constructor!==dm){GV||nS(VV,"constructor",iS(1,dm));for(eS in JE)NV(JE,eS)&&(tS=JE[eS],rS=tS.s,NV(dm,rS)||nS(dm,rS,iS(6,tS.c)))}var tS,rS,eS});var HV=M(()=>{var kOe=Hr(),zOe=En(),ZV="DOMException";zOe(kOe(ZV),ZV)});var YV=M(()=>{var BOe=we(),FOe=Ct(),XV=jd().clear;BOe({global:!0,bind:!0,enumerable:!0,forced:FOe.clearImmediate!==XV},{clearImmediate:XV})});var JV=M(()=>{var NOe=we(),UOe=Ct(),KV=jd().set;NOe({global:!0,bind:!0,enumerable:!0,forced:UOe.setImmediate!==KV},{setImmediate:KV})});var QV=M(()=>{YV();JV()});var e8=M(()=>{var jOe=we(),VOe=Ct(),GOe=Qw(),$Oe=Ti(),WOe=as(),ZOe=fa(),HOe=VOe.process;jOe({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(n){WOe(arguments.length,1),$Oe(n);var l=ZOe&&HOe.domain;GOe(l?l.bind(n):n)}})});var r8=M(()=>{"use strict";var XOe=we(),ul=Ct(),YOe=nl(),KOe=$t(),JOe=TypeError,QOe=Object.defineProperty,t8=ul.self!==ul;try{KOe?(zv=Object.getOwnPropertyDescriptor(ul,"self"),(t8||!zv||!zv.get||!zv.enumerable)&&YOe(ul,"self",{get:function(){return ul},set:function(n){if(this!==ul)throw JOe("Illegal invocation");QOe(ul,"self",{value:n,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})):XOe({global:!0,simple:!0,forced:t8},{self:ul})}catch{}var zv});var p8=M(()=>{var eCe=li(),tCe=we(),ai=Ct(),vm=Hr(),ls=_t(),Nv=ft(),rCe=vu(),hS=fr(),iCe=Tu(),nCe=an(),pS=sr(),oCe=Gs(),aCe=qo(),n8=Qt(),o8=Po(),sCe=_r(),lCe=ca(),sS=ln(),fS=Vr(),uCe=as(),cCe=Dh(),hCe=Qy(),lS=sa(),pCe=eT(),fCe=Wg(),dCe=fa(),ym=ai.Object,a8=ai.Date,xm=ai.Error,mCe=ai.EvalError,_Ce=ai.RangeError,yCe=ai.ReferenceError,gCe=ai.SyntaxError,s8=ai.TypeError,vCe=ai.URIError,xCe=ai.PerformanceMark,Hh=ai.WebAssembly,bCe=Hh&&Hh.CompileError||xm,wCe=Hh&&Hh.LinkError||xm,TCe=Hh&&Hh.RuntimeError||xm,ju=vm("DOMException"),l8=vm("Set"),Bv=vm("Map"),mS=Bv.prototype,u8=ls(mS.has),ECe=ls(mS.get),Fv=ls(mS.set),SCe=ls(l8.prototype.add),ICe=vm("Object","keys"),ACe=ls([].push),OCe=ls((!0).valueOf),CCe=ls(1 .valueOf),PCe=ls("".valueOf),MCe=ls(a8.prototype.getTime),dS=rCe("structuredClone"),gm="DataCloneError",uS="Transferring",c8=function(s){return!Nv(function(){var n=new ai.Set([7]),l=s(n),o=s(ym(7));return l==n||!l.has(7)||typeof o!="object"||o!=7})&&s},i8=function(s,n){return!Nv(function(){var l=new n,o=s({a:l,b:l});return!(o&&o.a===o.b&&o.a instanceof n&&o.a.stack===l.stack)})},qCe=function(s){return!Nv(function(){var n=s(new ai.AggregateError([1],dS,{cause:3}));return n.name!="AggregateError"||n.errors[0]!=1||n.message!=dS||n.cause!=3})},hl=ai.structuredClone,RCe=eCe||!i8(hl,xm)||!i8(hl,ju)||!qCe(hl),DCe=!hl&&c8(function(s){return new xCe(dS,{detail:s}).detail}),cl=c8(hl)||DCe,cS=function(s){throw new ju("Uncloneable type: "+s,gm)},hn=function(s,n){throw new ju((n||"Cloning")+" of "+s+" cannot be properly polyfilled in this engine",gm)},LCe=function(){var s;try{s=new ai.DataTransfer}catch{try{s=new ai.ClipboardEvent("").clipboardData}catch{}}return s&&s.items&&s.files?s:null},Xi=function(s,n){if(oCe(s)&&cS("Symbol"),!pS(s))return s;if(n){if(u8(n,s))return ECe(n,s)}else n=new Bv;var l=o8(s),o=!1,c,t,g,I,P,q,L,V,oe,ne;switch(l){case"Array":g=[],o=!0;break;case"Object":g={},o=!0;break;case"Map":g=new Bv,o=!0;break;case"Set":g=new l8,o=!0;break;case"RegExp":g=new RegExp(s.source,cCe(s));break;case"Error":switch(t=s.name,t){case"AggregateError":g=vm("AggregateError")([]);break;case"EvalError":g=mCe();break;case"RangeError":g=_Ce();break;case"ReferenceError":g=yCe();break;case"SyntaxError":g=gCe();break;case"TypeError":g=s8();break;case"URIError":g=vCe();break;case"CompileError":g=bCe();break;case"LinkError":g=wCe();break;case"RuntimeError":g=TCe();break;default:g=xm()}o=!0;break;case"DOMException":g=new ju(s.message,s.name),o=!0;break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":c=ai[l],pS(c)||hn(l),g=new c(Xi(s.buffer,n),s.byteOffset,l==="DataView"?s.byteLength:s.length);break;case"DOMQuad":try{g=new DOMQuad(Xi(s.p1,n),Xi(s.p2,n),Xi(s.p3,n),Xi(s.p4,n))}catch{cl?g=cl(s):hn(l)}break;case"FileList":if(I=LCe(),I){for(P=0,q=fS(s);P<q;P++)I.items.add(Xi(s[P],n));g=I.files}else cl?g=cl(s):hn(l);break;case"ImageData":try{g=new ImageData(Xi(s.data,n),s.width,s.height,{colorSpace:s.colorSpace})}catch{cl?g=cl(s):hn(l)}break;default:if(cl)g=cl(s);else switch(l){case"BigInt":g=ym(s.valueOf());break;case"Boolean":g=ym(OCe(s));break;case"Number":g=ym(CCe(s));break;case"String":g=ym(PCe(s));break;case"Date":g=new a8(MCe(s));break;case"ArrayBuffer":c=ai.DataView,!c&&typeof s.slice!="function"&&hn(l);try{if(typeof s.slice=="function")g=s.slice(0);else for(q=s.byteLength,g=new ArrayBuffer(q),oe=new c(s),ne=new c(g),P=0;P<q;P++)ne.setUint8(P,oe.getUint8(P))}catch{throw new ju("ArrayBuffer is detached",gm)}break;case"SharedArrayBuffer":g=s;break;case"Blob":try{g=s.slice(0,s.size,s.type)}catch{hn(l)}break;case"DOMPoint":case"DOMPointReadOnly":c=ai[l];try{g=c.fromPoint?c.fromPoint(s):new c(s.x,s.y,s.z,s.w)}catch{hn(l)}break;case"DOMRect":case"DOMRectReadOnly":c=ai[l];try{g=c.fromRect?c.fromRect(s):new c(s.x,s.y,s.width,s.height)}catch{hn(l)}break;case"DOMMatrix":case"DOMMatrixReadOnly":c=ai[l];try{g=c.fromMatrix?c.fromMatrix(s):new c(s)}catch{hn(l)}break;case"AudioData":case"VideoFrame":hS(s.clone)||hn(l);try{g=s.clone()}catch{cS(l)}break;case"File":try{g=new File([s],s.name,s)}catch{hn(l)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":hn(l);default:cS(l)}}if(Fv(n,s,g),o)switch(l){case"Array":case"Object":for(L=ICe(s),P=0,q=fS(L);P<q;P++)V=L[P],lCe(g,V,Xi(s[V],n));break;case"Map":s.forEach(function(Ie,Se){Fv(g,Xi(Se,n),Xi(Ie,n))});break;case"Set":s.forEach(function(Ie){SCe(g,Xi(Ie,n))});break;case"Error":sS(g,"message",Xi(s.message,n)),sCe(s,"cause")&&sS(g,"cause",Xi(s.cause,n)),t=="AggregateError"&&(g.errors=Xi(s.errors,n));case"DOMException":hCe&&sS(g,"stack",Xi(s.stack,n))}return g},h8=hl&&!Nv(function(){if(fCe&&lS>92||dCe&&lS>94||pCe&&lS>97)return!1;var s=new ArrayBuffer(8),n=hl(s,{transfer:[s]});return s.byteLength!=0||n.byteLength!=8}),kCe=function(s,n){if(!pS(s))throw s8("Transfer option cannot be converted to a sequence");var l=[];aCe(s,function(oe){ACe(l,n8(oe))});var o=0,c=fS(l),t,g,I,P,q,L,V;if(h8)for(P=hl(l,{transfer:l});o<c;)Fv(n,l[o],P[o++]);else for(;o<c;){if(t=l[o++],u8(n,t))throw new ju("Duplicate transferable",gm);switch(g=o8(t),g){case"ImageBitmap":I=ai.OffscreenCanvas,iCe(I)||hn(g,uS);try{L=new I(t.width,t.height),V=L.getContext("bitmaprenderer"),V.transferFromImageBitmap(t),q=L.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!hS(t.clone)||!hS(t.close))&&hn(g,uS);try{q=t.clone(),t.close()}catch{}break;case"ArrayBuffer":case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":hn(g,uS)}if(q===void 0)throw new ju("This object cannot be transferred: "+g,gm);Fv(n,t,q)}};tCe({global:!0,enumerable:!0,sham:!h8,forced:RCe},{structuredClone:function(n){var l=uCe(arguments.length,1)>1&&!nCe(arguments[1])?n8(arguments[1]):void 0,o=l?l.transfer:void 0,c;return o!==void 0&&(c=new Bv,kCe(o,c)),Xi(n,c)}})});var yS=M((OWe,d8)=>{var _S=Ct(),zCe=Un(),BCe=fr(),FCe=aa(),NCe=Hs(),UCe=as(),jCe=/MSIE .\./.test(FCe),VCe=_S.Function,f8=function(s){return jCe?function(n,l){var o=UCe(arguments.length,1)>2,c=BCe(n)?n:VCe(n),t=o?NCe(arguments,2):void 0;return s(o?function(){zCe(c,this,t)}:c,l)}:s};d8.exports={setTimeout:f8(_S.setTimeout),setInterval:f8(_S.setInterval)}});var _8=M(()=>{var GCe=we(),$Ce=Ct(),m8=yS().setInterval;GCe({global:!0,bind:!0,forced:$Ce.setInterval!==m8},{setInterval:m8})});var g8=M(()=>{var WCe=we(),ZCe=Ct(),y8=yS().setTimeout;WCe({global:!0,bind:!0,forced:ZCe.setTimeout!==y8},{setTimeout:y8})});var v8=M(()=>{_8();g8()});var gS=M((LWe,x8)=>{var HCe=ft(),XCe=cr(),YCe=li(),KCe=XCe("iterator");x8.exports=!HCe(function(){var s=new URL("b?a=1&b=2&c=3","http://a"),n=s.searchParams,l="";return s.pathname="c%20d",n.forEach(function(o,c){n.delete("b"),l+=c+o}),YCe&&!s.toJSON||!n.sort||s.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[KCe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||l!=="a1c3"||new URL("http://x",void 0).host!=="x"})});var C8=M((kWe,O8)=>{"use strict";var Vu=_t(),vS=2147483647,bm=36,S8=1,wS=26,JCe=38,QCe=700,ePe=72,tPe=128,rPe="-",iPe=/[^\0-\u007E]/,I8=/[.\u3002\uFF0E\uFF61]/g,b8="Overflow: input needs wider integers to process",xS=bm-S8,w8=RangeError,nPe=Vu(I8.exec),Xh=Math.floor,bS=String.fromCharCode,T8=Vu("".charCodeAt),A8=Vu([].join),pl=Vu([].push),oPe=Vu("".replace),aPe=Vu("".split),sPe=Vu("".toLowerCase),lPe=function(s){for(var n=[],l=0,o=s.length;l<o;){var c=T8(s,l++);if(c>=55296&&c<=56319&&l<o){var t=T8(s,l++);(t&64512)==56320?pl(n,((c&1023)<<10)+(t&1023)+65536):(pl(n,c),l--)}else pl(n,c)}return n},E8=function(s){return s+22+75*(s<26)},uPe=function(s,n,l){var o=0;for(s=l?Xh(s/QCe):s>>1,s+=Xh(s/n);s>xS*wS>>1;)s=Xh(s/xS),o+=bm;return Xh(o+(xS+1)*s/(s+JCe))},cPe=function(s){var n=[];s=lPe(s);var l=s.length,o=tPe,c=0,t=ePe,g,I;for(g=0;g<s.length;g++)I=s[g],I<128&&pl(n,bS(I));var P=n.length,q=P;for(P&&pl(n,rPe);q<l;){var L=vS;for(g=0;g<s.length;g++)I=s[g],I>=o&&I<L&&(L=I);var V=q+1;if(L-o>Xh((vS-c)/V))throw w8(b8);for(c+=(L-o)*V,o=L,g=0;g<s.length;g++){if(I=s[g],I<o&&++c>vS)throw w8(b8);if(I==o){for(var oe=c,ne=bm;;){var Ie=ne<=t?S8:ne>=t+wS?wS:ne-t;if(oe<Ie)break;var Se=oe-Ie,Re=bm-Ie;pl(n,bS(E8(Ie+Se%Re))),oe=Xh(Se/Re),ne+=bm}pl(n,bS(E8(oe))),t=uPe(c,V,q==P),c=0,q++}}c++,o++}return A8(n,"")};O8.exports=function(s){var n=[],l=aPe(oPe(sPe(s),I8,"."),"."),o,c;for(o=0;o<l.length;o++)c=l[o],pl(n,nPe(iPe,c)?"xn--"+cPe(c):c);return A8(n,".")}});var qS=M((zWe,X8)=>{"use strict";Td();var AS=we(),Kh=Ct(),Uv=ar(),ga=_t(),hPe=$t(),U8=gS(),j8=Qr(),pPe=_h(),fPe=En(),dPe=ug(),PS=_i(),V8=Ro(),TS=fr(),mPe=_r(),_Pe=Qn(),yPe=Po(),gPe=Qt(),G8=sr(),$n=hr(),vPe=Tn(),P8=Fn(),OS=md(),xPe=fh(),Yh=as(),bPe=cr(),wPe=mg(),TPe=bPe("iterator"),Em="URLSearchParams",$8=Em+"Iterator",W8=PS.set,Lo=PS.getterFor(Em),EPe=PS.getterFor($8),SPe=Object.getOwnPropertyDescriptor,MS=function(s){if(!hPe)return Kh[s];var n=SPe(Kh,s);return n&&n.value},M8=MS("fetch"),Vv=MS("Request"),wm=MS("Headers"),ES=Vv&&Vv.prototype,q8=wm&&wm.prototype,IPe=Kh.RegExp,APe=Kh.TypeError,Z8=Kh.decodeURIComponent,OPe=Kh.encodeURIComponent,CPe=ga("".charAt),R8=ga([].join),Gu=ga([].push),CS=ga("".replace),PPe=ga([].shift),D8=ga([].splice),L8=ga("".split),MPe=ga("".slice),qPe=/\+/g,k8=Array(4),RPe=function(s){return k8[s-1]||(k8[s-1]=IPe("((?:%[\\da-f]{2}){"+s+"})","gi"))},DPe=function(s){try{return Z8(s)}catch{return s}},z8=function(s){var n=CS(s,qPe," "),l=4;try{return Z8(n)}catch{for(;l;)n=CS(n,RPe(l--),DPe);return n}},LPe=/[!'()~]|%20/g,kPe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zPe=function(s){return kPe[s]},B8=function(s){return CS(OPe(s),LPe,zPe)},SS=dPe(function(n,l){W8(this,{type:$8,iterator:OS(Lo(n).entries),kind:l})},"Iterator",function(){var n=EPe(this),l=n.kind,o=n.iterator.next(),c=o.value;return o.done||(o.value=l==="keys"?c.key:l==="values"?c.value:[c.key,c.value]),o},!0),H8=function(s){this.entries=[],this.url=null,s!==void 0&&(G8(s)?this.parseObject(s):this.parseQuery(typeof s=="string"?CPe(s,0)==="?"?MPe(s,1):s:$n(s)))};H8.prototype={type:Em,bindURL:function(s){this.url=s,this.update()},parseObject:function(s){var n=xPe(s),l,o,c,t,g,I,P;if(n)for(l=OS(s,n),o=l.next;!(c=Uv(o,l)).done;){if(t=OS(gPe(c.value)),g=t.next,(I=Uv(g,t)).done||(P=Uv(g,t)).done||!Uv(g,t).done)throw APe("Expected sequence with length 2");Gu(this.entries,{key:$n(I.value),value:$n(P.value)})}else for(var q in s)mPe(s,q)&&Gu(this.entries,{key:q,value:$n(s[q])})},parseQuery:function(s){if(s)for(var n=L8(s,"&"),l=0,o,c;l<n.length;)o=n[l++],o.length&&(c=L8(o,"="),Gu(this.entries,{key:z8(PPe(c)),value:z8(R8(c,"="))}))},serialize:function(){for(var s=this.entries,n=[],l=0,o;l<s.length;)o=s[l++],Gu(n,B8(o.key)+"="+B8(o.value));return R8(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Gv=function(){V8(this,Tm);var n=arguments.length>0?arguments[0]:void 0;W8(this,new H8(n))},Tm=Gv.prototype;pPe(Tm,{append:function(n,l){Yh(arguments.length,2);var o=Lo(this);Gu(o.entries,{key:$n(n),value:$n(l)}),o.updateURL()},delete:function(s){Yh(arguments.length,1);for(var n=Lo(this),l=n.entries,o=$n(s),c=0;c<l.length;)l[c].key===o?D8(l,c,1):c++;n.updateURL()},get:function(n){Yh(arguments.length,1);for(var l=Lo(this).entries,o=$n(n),c=0;c<l.length;c++)if(l[c].key===o)return l[c].value;return null},getAll:function(n){Yh(arguments.length,1);for(var l=Lo(this).entries,o=$n(n),c=[],t=0;t<l.length;t++)l[t].key===o&&Gu(c,l[t].value);return c},has:function(n){Yh(arguments.length,1);for(var l=Lo(this).entries,o=$n(n),c=0;c<l.length;)if(l[c++].key===o)return!0;return!1},set:function(n,l){Yh(arguments.length,1);for(var o=Lo(this),c=o.entries,t=!1,g=$n(n),I=$n(l),P=0,q;P<c.length;P++)q=c[P],q.key===g&&(t?D8(c,P--,1):(t=!0,q.value=I));t||Gu(c,{key:g,value:I}),o.updateURL()},sort:function(){var n=Lo(this);wPe(n.entries,function(l,o){return l.key>o.key?1:-1}),n.updateURL()},forEach:function(n){for(var l=Lo(this).entries,o=_Pe(n,arguments.length>1?arguments[1]:void 0),c=0,t;c<l.length;)t=l[c++],o(t.value,t.key,this)},keys:function(){return new SS(this,"keys")},values:function(){return new SS(this,"values")},entries:function(){return new SS(this,"entries")}},{enumerable:!0});j8(Tm,TPe,Tm.entries,{name:"entries"});j8(Tm,"toString",function(){return Lo(this).serialize()},{enumerable:!0});fPe(Gv,Em);AS({global:!0,constructor:!0,forced:!U8},{URLSearchParams:Gv});!U8&&TS(wm)&&(F8=ga(q8.has),N8=ga(q8.set),IS=function(s){if(G8(s)){var n=s.body,l;if(yPe(n)===Em)return l=s.headers?new wm(s.headers):new wm,F8(l,"content-type")||N8(l,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vPe(s,{body:P8(0,$n(n)),headers:P8(0,l)})}return s},TS(M8)&&AS({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return M8(n,arguments.length>1?IS(arguments[1]):{})}}),TS(Vv)&&(jv=function(n){return V8(this,ES),new Vv(n,arguments.length>1?IS(arguments[1]):{})},ES.constructor=jv,jv.prototype=ES,AS({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:jv})));var F8,N8,IS,jv;X8.exports={URLSearchParams:Gv,getState:Lo}});var dG=M(()=>{"use strict";LT();var BPe=we(),HS=$t(),FPe=gS(),XS=Ct(),Y8=Qn(),so=_t(),Xv=Qr(),io=nl(),NPe=Ro(),$S=_r(),YS=qw(),Jh=vb(),ko=sh(),UPe=Xd().codeAt,jPe=C8(),cs=hr(),VPe=En(),GPe=as(),lG=qS(),uG=_i(),$Pe=uG.set,Yv=uG.getterFor("URL"),WPe=lG.URLSearchParams,ZPe=lG.getState,Sm=XS.URL,WS=XS.TypeError,Kv=XS.parseInt,HPe=Math.floor,K8=Math.pow,ao=so("".charAt),zo=so(/./.exec),Am=so([].join),XPe=so(1 .toString),YPe=so([].pop),ep=so([].push),J8=so("".replace),KPe=so([].shift),JPe=so("".split),Cm=so("".slice),Jv=so("".toLowerCase),QPe=so([].unshift),eMe="Invalid authority",RS="Invalid scheme",$u="Invalid host",Q8="Invalid port",cG=/[a-z]/i,tMe=/[\d+-.a-z]/i,ZS=/\d/,rMe=/^0x/i,iMe=/^[0-7]+$/,nMe=/^\d+$/,hG=/^[\da-f]+$/i,oMe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,aMe=/[\0\t\n\r #/:<>?@[\\\]^|]/,sMe=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,lMe=/[\t\n\r]/g,no,uMe=function(s){var n=JPe(s,"."),l,o,c,t,g,I,P;if(n.length&&n[n.length-1]==""&&n.length--,l=n.length,l>4)return s;for(o=[],c=0;c<l;c++){if(t=n[c],t=="")return s;if(g=10,t.length>1&&ao(t,0)=="0"&&(g=zo(rMe,t)?16:8,t=Cm(t,g==8?1:2)),t==="")I=0;else{if(!zo(g==10?nMe:g==8?iMe:hG,t))return s;I=Kv(t,g)}ep(o,I)}for(c=0;c<l;c++)if(I=o[c],c==l-1){if(I>=K8(256,5-l))return null}else if(I>255)return null;for(P=YPe(o),c=0;c<o.length;c++)P+=o[c]*K8(256,3-c);return P},cMe=function(s){var n=[0,0,0,0,0,0,0,0],l=0,o=null,c=0,t,g,I,P,q,L,V,oe=function(){return ao(s,c)};if(oe()==":"){if(ao(s,1)!=":")return;c+=2,l++,o=l}for(;oe();){if(l==8)return;if(oe()==":"){if(o!==null)return;c++,l++,o=l;continue}for(t=g=0;g<4&&zo(hG,oe());)t=t*16+Kv(oe(),16),c++,g++;if(oe()=="."){if(g==0||(c-=g,l>6))return;for(I=0;oe();){if(P=null,I>0)if(oe()=="."&&I<4)c++;else return;if(!zo(ZS,oe()))return;for(;zo(ZS,oe());){if(q=Kv(oe(),10),P===null)P=q;else{if(P==0)return;P=P*10+q}if(P>255)return;c++}n[l]=n[l]*256+P,I++,(I==2||I==4)&&l++}if(I!=4)return;break}else if(oe()==":"){if(c++,!oe())return}else if(oe())return;n[l++]=t}if(o!==null)for(L=l-o,l=7;l!=0&&L>0;)V=n[l],n[l--]=n[o+L-1],n[o+--L]=V;else if(l!=8)return;return n},hMe=function(s){for(var n=null,l=1,o=null,c=0,t=0;t<8;t++)s[t]!==0?(c>l&&(n=o,l=c),o=null,c=0):(o===null&&(o=t),++c);return c>l&&(n=o,l=c),n},Im=function(s){var n,l,o,c;if(typeof s=="number"){for(n=[],l=0;l<4;l++)QPe(n,s%256),s=HPe(s/256);return Am(n,".")}else if(typeof s=="object"){for(n="",o=hMe(s),l=0;l<8;l++)c&&s[l]===0||(c&&(c=!1),o===l?(n+=l?":":"::",c=!0):(n+=XPe(s[l],16),l<7&&(n+=":")));return"["+n+"]"}return s},Hv={},pG=YS({},Hv,{" ":1,'"':1,"<":1,">":1,"`":1}),fG=YS({},pG,{"#":1,"?":1,"{":1,"}":1}),DS=YS({},fG,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),fl=function(s,n){var l=UPe(s,0);return l>32&&l<127&&!$S(n,s)?s:encodeURIComponent(s)},$v={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Om=function(s,n){var l;return s.length==2&&zo(cG,ao(s,0))&&((l=ao(s,1))==":"||!n&&l=="|")},eG=function(s){var n;return s.length>1&&Om(Cm(s,0,2))&&(s.length==2||(n=ao(s,2))==="/"||n==="\\"||n==="?"||n==="#")},pMe=function(s){return s==="."||Jv(s)==="%2e"},fMe=function(s){return s=Jv(s),s===".."||s==="%2e."||s===".%2e"||s==="%2e%2e"},LS={},tG={},kS={},rG={},iG={},zS={},nG={},oG={},Wv={},Zv={},BS={},FS={},NS={},US={},aG={},jS={},Qh={},va={},sG={},Wu={},us={},KS=function(s,n,l){var o=cs(s),c,t,g;if(n){if(t=this.parse(o),t)throw WS(t);this.searchParams=null}else{if(l!==void 0&&(c=new KS(l,!0)),t=this.parse(o,null,c),t)throw WS(t);g=ZPe(new WPe),g.bindURL(this),this.searchParams=g}};KS.prototype={type:"URL",parse:function(s,n,l){var o=this,c=n||LS,t=0,g="",I=!1,P=!1,q=!1,L,V,oe,ne;for(s=cs(s),n||(o.scheme="",o.username="",o.password="",o.host=null,o.port=null,o.path=[],o.query=null,o.fragment=null,o.cannotBeABaseURL=!1,s=J8(s,sMe,"")),s=J8(s,lMe,""),L=Jh(s);t<=L.length;){switch(V=L[t],c){case LS:if(V&&zo(cG,V))g+=Jv(V),c=tG;else{if(n)return RS;c=kS;continue}break;case tG:if(V&&(zo(tMe,V)||V=="+"||V=="-"||V=="."))g+=Jv(V);else if(V==":"){if(n&&(o.isSpecial()!=$S($v,g)||g=="file"&&(o.includesCredentials()||o.port!==null)||o.scheme=="file"&&!o.host))return;if(o.scheme=g,n){o.isSpecial()&&$v[o.scheme]==o.port&&(o.port=null);return}g="",o.scheme=="file"?c=US:o.isSpecial()&&l&&l.scheme==o.scheme?c=rG:o.isSpecial()?c=oG:L[t+1]=="/"?(c=iG,t++):(o.cannotBeABaseURL=!0,ep(o.path,""),c=sG)}else{if(n)return RS;g="",c=kS,t=0;continue}break;case kS:if(!l||l.cannotBeABaseURL&&V!="#")return RS;if(l.cannotBeABaseURL&&V=="#"){o.scheme=l.scheme,o.path=ko(l.path),o.query=l.query,o.fragment="",o.cannotBeABaseURL=!0,c=us;break}c=l.scheme=="file"?US:zS;continue;case rG:if(V=="/"&&L[t+1]=="/")c=Wv,t++;else{c=zS;continue}break;case iG:if(V=="/"){c=Zv;break}else{c=va;continue}case zS:if(o.scheme=l.scheme,V==no)o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=ko(l.path),o.query=l.query;else if(V=="/"||V=="\\"&&o.isSpecial())c=nG;else if(V=="?")o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=ko(l.path),o.query="",c=Wu;else if(V=="#")o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=ko(l.path),o.query=l.query,o.fragment="",c=us;else{o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,o.path=ko(l.path),o.path.length--,c=va;continue}break;case nG:if(o.isSpecial()&&(V=="/"||V=="\\"))c=Wv;else if(V=="/")c=Zv;else{o.username=l.username,o.password=l.password,o.host=l.host,o.port=l.port,c=va;continue}break;case oG:if(c=Wv,V!="/"||ao(g,t+1)!="/")continue;t++;break;case Wv:if(V!="/"&&V!="\\"){c=Zv;continue}break;case Zv:if(V=="@"){I&&(g="%40"+g),I=!0,oe=Jh(g);for(var Ie=0;Ie<oe.length;Ie++){var Se=oe[Ie];if(Se==":"&&!q){q=!0;continue}var Re=fl(Se,DS);q?o.password+=Re:o.username+=Re}g=""}else if(V==no||V=="/"||V=="?"||V=="#"||V=="\\"&&o.isSpecial()){if(I&&g=="")return eMe;t-=Jh(g).length+1,g="",c=BS}else g+=V;break;case BS:case FS:if(n&&o.scheme=="file"){c=jS;continue}else if(V==":"&&!P){if(g=="")return $u;if(ne=o.parseHost(g),ne)return ne;if(g="",c=NS,n==FS)return}else if(V==no||V=="/"||V=="?"||V=="#"||V=="\\"&&o.isSpecial()){if(o.isSpecial()&&g=="")return $u;if(n&&g==""&&(o.includesCredentials()||o.port!==null))return;if(ne=o.parseHost(g),ne)return ne;if(g="",c=Qh,n)return;continue}else V=="["?P=!0:V=="]"&&(P=!1),g+=V;break;case NS:if(zo(ZS,V))g+=V;else if(V==no||V=="/"||V=="?"||V=="#"||V=="\\"&&o.isSpecial()||n){if(g!=""){var Ze=Kv(g,10);if(Ze>65535)return Q8;o.port=o.isSpecial()&&Ze===$v[o.scheme]?null:Ze,g=""}if(n)return;c=Qh;continue}else return Q8;break;case US:if(o.scheme="file",V=="/"||V=="\\")c=aG;else if(l&&l.scheme=="file")if(V==no)o.host=l.host,o.path=ko(l.path),o.query=l.query;else if(V=="?")o.host=l.host,o.path=ko(l.path),o.query="",c=Wu;else if(V=="#")o.host=l.host,o.path=ko(l.path),o.query=l.query,o.fragment="",c=us;else{eG(Am(ko(L,t),""))||(o.host=l.host,o.path=ko(l.path),o.shortenPath()),c=va;continue}else{c=va;continue}break;case aG:if(V=="/"||V=="\\"){c=jS;break}l&&l.scheme=="file"&&!eG(Am(ko(L,t),""))&&(Om(l.path[0],!0)?ep(o.path,l.path[0]):o.host=l.host),c=va;continue;case jS:if(V==no||V=="/"||V=="\\"||V=="?"||V=="#"){if(!n&&Om(g))c=va;else if(g==""){if(o.host="",n)return;c=Qh}else{if(ne=o.parseHost(g),ne)return ne;if(o.host=="localhost"&&(o.host=""),n)return;g="",c=Qh}continue}else g+=V;break;case Qh:if(o.isSpecial()){if(c=va,V!="/"&&V!="\\")continue}else if(!n&&V=="?")o.query="",c=Wu;else if(!n&&V=="#")o.fragment="",c=us;else if(V!=no&&(c=va,V!="/"))continue;break;case va:if(V==no||V=="/"||V=="\\"&&o.isSpecial()||!n&&(V=="?"||V=="#")){if(fMe(g)?(o.shortenPath(),V!="/"&&!(V=="\\"&&o.isSpecial())&&ep(o.path,"")):pMe(g)?V!="/"&&!(V=="\\"&&o.isSpecial())&&ep(o.path,""):(o.scheme=="file"&&!o.path.length&&Om(g)&&(o.host&&(o.host=""),g=ao(g,0)+":"),ep(o.path,g)),g="",o.scheme=="file"&&(V==no||V=="?"||V=="#"))for(;o.path.length>1&&o.path[0]==="";)KPe(o.path);V=="?"?(o.query="",c=Wu):V=="#"&&(o.fragment="",c=us)}else g+=fl(V,fG);break;case sG:V=="?"?(o.query="",c=Wu):V=="#"?(o.fragment="",c=us):V!=no&&(o.path[0]+=fl(V,Hv));break;case Wu:!n&&V=="#"?(o.fragment="",c=us):V!=no&&(V=="'"&&o.isSpecial()?o.query+="%27":V=="#"?o.query+="%23":o.query+=fl(V,Hv));break;case us:V!=no&&(o.fragment+=fl(V,pG));break}t++}},parseHost:function(s){var n,l,o;if(ao(s,0)=="["){if(ao(s,s.length-1)!="]"||(n=cMe(Cm(s,1,-1)),!n))return $u;this.host=n}else if(this.isSpecial()){if(s=jPe(s),zo(oMe,s)||(n=uMe(s),n===null))return $u;this.host=n}else{if(zo(aMe,s))return $u;for(n="",l=Jh(s),o=0;o<l.length;o++)n+=fl(l[o],Hv);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return $S($v,this.scheme)},shortenPath:function(){var s=this.path,n=s.length;n&&(this.scheme!="file"||n!=1||!Om(s[0],!0))&&s.length--},serialize:function(){var s=this,n=s.scheme,l=s.username,o=s.password,c=s.host,t=s.port,g=s.path,I=s.query,P=s.fragment,q=n+":";return c!==null?(q+="//",s.includesCredentials()&&(q+=l+(o?":"+o:"")+"@"),q+=Im(c),t!==null&&(q+=":"+t)):n=="file"&&(q+="//"),q+=s.cannotBeABaseURL?g[0]:g.length?"/"+Am(g,"/"):"",I!==null&&(q+="?"+I),P!==null&&(q+="#"+P),q},setHref:function(s){var n=this.parse(s);if(n)throw WS(n);this.searchParams.update()},getOrigin:function(){var s=this.scheme,n=this.port;if(s=="blob")try{return new tp(s.path[0]).origin}catch{return"null"}return s=="file"||!this.isSpecial()?"null":s+"://"+Im(this.host)+(n!==null?":"+n:"")},getProtocol:function(){return this.scheme+":"},setProtocol:function(s){this.parse(cs(s)+":",LS)},getUsername:function(){return this.username},setUsername:function(s){var n=Jh(cs(s));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var l=0;l<n.length;l++)this.username+=fl(n[l],DS)}},getPassword:function(){return this.password},setPassword:function(s){var n=Jh(cs(s));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var l=0;l<n.length;l++)this.password+=fl(n[l],DS)}},getHost:function(){var s=this.host,n=this.port;return s===null?"":n===null?Im(s):Im(s)+":"+n},setHost:function(s){this.cannotBeABaseURL||this.parse(s,BS)},getHostname:function(){var s=this.host;return s===null?"":Im(s)},setHostname:function(s){this.cannotBeABaseURL||this.parse(s,FS)},getPort:function(){var s=this.port;return s===null?"":cs(s)},setPort:function(s){this.cannotHaveUsernamePasswordPort()||(s=cs(s),s==""?this.port=null:this.parse(s,NS))},getPathname:function(){var s=this.path;return this.cannotBeABaseURL?s[0]:s.length?"/"+Am(s,"/"):""},setPathname:function(s){this.cannotBeABaseURL||(this.path=[],this.parse(s,Qh))},getSearch:function(){var s=this.query;return s?"?"+s:""},setSearch:function(s){s=cs(s),s==""?this.query=null:(ao(s,0)=="?"&&(s=Cm(s,1)),this.query="",this.parse(s,Wu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var s=this.fragment;return s?"#"+s:""},setHash:function(s){if(s=cs(s),s==""){this.fragment=null;return}ao(s,0)=="#"&&(s=Cm(s,1)),this.fragment="",this.parse(s,us)},update:function(){this.query=this.searchParams.serialize()||null}};var tp=function(n){var l=NPe(this,pn),o=GPe(arguments.length,1)>1?arguments[1]:void 0,c=$Pe(l,new KS(n,!1,o));HS||(l.href=c.serialize(),l.origin=c.getOrigin(),l.protocol=c.getProtocol(),l.username=c.getUsername(),l.password=c.getPassword(),l.host=c.getHost(),l.hostname=c.getHostname(),l.port=c.getPort(),l.pathname=c.getPathname(),l.search=c.getSearch(),l.searchParams=c.getSearchParams(),l.hash=c.getHash())},pn=tp.prototype,oo=function(s,n){return{get:function(){return Yv(this)[s]()},set:n&&function(l){return Yv(this)[n](l)},configurable:!0,enumerable:!0}};HS&&(io(pn,"href",oo("serialize","setHref")),io(pn,"origin",oo("getOrigin")),io(pn,"protocol",oo("getProtocol","setProtocol")),io(pn,"username",oo("getUsername","setUsername")),io(pn,"password",oo("getPassword","setPassword")),io(pn,"host",oo("getHost","setHost")),io(pn,"hostname",oo("getHostname","setHostname")),io(pn,"port",oo("getPort","setPort")),io(pn,"pathname",oo("getPathname","setPathname")),io(pn,"search",oo("getSearch","setSearch")),io(pn,"searchParams",oo("getSearchParams")),io(pn,"hash",oo("getHash","setHash")));Xv(pn,"toJSON",function(){return Yv(this).serialize()},{enumerable:!0});Xv(pn,"toString",function(){return Yv(this).serialize()},{enumerable:!0});Sm&&(VS=Sm.createObjectURL,GS=Sm.revokeObjectURL,VS&&Xv(tp,"createObjectURL",Y8(VS,Sm)),GS&&Xv(tp,"revokeObjectURL",Y8(GS,Sm)));var VS,GS;VPe(tp,"URL");BPe({global:!0,constructor:!0,forced:!FPe,sham:!HS},{URL:tp})});var mG=M(()=>{dG()});var _G=M(()=>{"use strict";var dMe=we(),mMe=ar();dMe({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return mMe(URL.prototype.toString,this)}})});var yG=M(()=>{qS()});var vG=M((WWe,gG)=>{tq();lq();uq();cq();hq();pq();fq();dq();mq();_q();yq();gq();vq();xq();bq();jq();Zq();cR();dR();_R();wR();IR();OR();MR();qR();DR();kR();FR();NR();VR();GR();ZR();iD();nD();aD();sD();Td();OD();qD();RD();LD();zD();jD();GD();WD();XD();YD();pL();mL();_L();yL();gL();vL();WL();nk();fk();mk();_k();gk();bk();wk();qk();Rk();Bk();jk();Gk();Yk();Qk();iz();nz();Y1();oz();bz();Ez();Az();Cz();Mz();qz();Lz();zz();Nz();jz();Gz();Wz();Zz();Hz();Xz();Jz();t3();r3();i3();h3();p3();m3();y3();g3();v3();x3();b3();A3();L3();N3();W3();X3();eB();tB();nB();aB();lB();uB();fB();dB();mB();gB();vB();xB();wB();TB();SB();AB();CB();MB();RB();DB();LB();kB();GB();$B();WB();XB();YB();JB();eF();pN();fN();mN();vN();xN();AN();PN();MN();LN();kN();zN();BN();FN();NN();UN();WN();HN();XN();h4();f4();ov();v4();b4();E4();A4();C4();P4();D4();U4();G4();W4();LT();oU();mU();yU();gU();wU();TU();CU();DU();zU();VU();HU();YU();e5();o5();c5();d5();m5();_5();y5();g5();v5();x5();b5();w5();T5();E5();S5();I5();e6();t6();r6();i6();n6();o6();a6();s6();l6();c6();p6();d6();_6();E6();I6();O6();P6();q6();D6();L6();z6();F6();G6();W6();H6();Y6();J6();ej();rj();nj();cj();pj();dj();xj();Tj();Oj();Pj();Lj();Wj();Hj();iV();pV();vV();SV();FV();WV();HV();QV();e8();r8();p8();v8();mG();_G();yG();gG.exports=q1()});var xG=M((ZWe,QS)=>{var JS=function(s){"use strict";var n=Object.prototype,l=n.hasOwnProperty,o=Object.defineProperty||function(ke,Le,rt){ke[Le]=rt.value},c,t=typeof Symbol=="function"?Symbol:{},g=t.iterator||"@@iterator",I=t.asyncIterator||"@@asyncIterator",P=t.toStringTag||"@@toStringTag";function q(ke,Le,rt){return Object.defineProperty(ke,Le,{value:rt,enumerable:!0,configurable:!0,writable:!0}),ke[Le]}try{q({},"")}catch{q=function(Le,rt,ot){return Le[rt]=ot}}function L(ke,Le,rt,ot){var vt=Le&&Le.prototype instanceof Ze?Le:Ze,nr=Object.create(vt.prototype),Xt=new ei(ot||[]);return o(nr,"_invoke",{value:pi(ke,rt,Xt)}),nr}s.wrap=L;function V(ke,Le,rt){try{return{type:"normal",arg:ke.call(Le,rt)}}catch(ot){return{type:"throw",arg:ot}}}var oe="suspendedStart",ne="suspendedYield",Ie="executing",Se="completed",Re={};function Ze(){}function et(){}function He(){}var It={};q(It,g,function(){return this});var Yt=Object.getPrototypeOf,At=Yt&&Yt(Yt(Me([])));At&&At!==n&&l.call(At,g)&&(It=At);var Nt=He.prototype=Ze.prototype=Object.create(It);et.prototype=He,o(Nt,"constructor",{value:He,configurable:!0}),o(He,"constructor",{value:et,configurable:!0}),et.displayName=q(He,P,"GeneratorFunction");function wt(ke){["next","throw","return"].forEach(function(Le){q(ke,Le,function(rt){return this._invoke(Le,rt)})})}s.isGeneratorFunction=function(ke){var Le=typeof ke=="function"&&ke.constructor;return Le?Le===et||(Le.displayName||Le.name)==="GeneratorFunction":!1},s.mark=function(ke){return Object.setPrototypeOf?Object.setPrototypeOf(ke,He):(ke.__proto__=He,q(ke,P,"GeneratorFunction")),ke.prototype=Object.create(Nt),ke},s.awrap=function(ke){return{__await:ke}};function Ht(ke,Le){function rt(nr,Xt,Ir,Yr){var ti=V(ke[nr],ke,Xt);if(ti.type==="throw")Yr(ti.arg);else{var co=ti.arg,Li=co.value;return Li&&typeof Li=="object"&&l.call(Li,"__await")?Le.resolve(Li.__await).then(function(fn){rt("next",fn,Ir,Yr)},function(fn){rt("throw",fn,Ir,Yr)}):Le.resolve(Li).then(function(fn){co.value=fn,Ir(co)},function(fn){return rt("throw",fn,Ir,Yr)})}}var ot;function vt(nr,Xt){function Ir(){return new Le(function(Yr,ti){rt(nr,Xt,Yr,ti)})}return ot=ot?ot.then(Ir,Ir):Ir()}o(this,"_invoke",{value:vt})}wt(Ht.prototype),q(Ht.prototype,I,function(){return this}),s.AsyncIterator=Ht,s.async=function(ke,Le,rt,ot,vt){vt===void 0&&(vt=Promise);var nr=new Ht(L(ke,Le,rt,ot),vt);return s.isGeneratorFunction(Le)?nr:nr.next().then(function(Xt){return Xt.done?Xt.value:nr.next()})};function pi(ke,Le,rt){var ot=oe;return function(nr,Xt){if(ot===Ie)throw new Error("Generator is already running");if(ot===Se){if(nr==="throw")throw Xt;return tt()}for(rt.method=nr,rt.arg=Xt;;){var Ir=rt.delegate;if(Ir){var Yr=yi(Ir,rt);if(Yr){if(Yr===Re)continue;return Yr}}if(rt.method==="next")rt.sent=rt._sent=rt.arg;else if(rt.method==="throw"){if(ot===oe)throw ot=Se,rt.arg;rt.dispatchException(rt.arg)}else rt.method==="return"&&rt.abrupt("return",rt.arg);ot=Ie;var ti=V(ke,Le,rt);if(ti.type==="normal"){if(ot=rt.done?Se:ne,ti.arg===Re)continue;return{value:ti.arg,done:rt.done}}else ti.type==="throw"&&(ot=Se,rt.method="throw",rt.arg=ti.arg)}}}function yi(ke,Le){var rt=ke.iterator[Le.method];if(rt===c){if(Le.delegate=null,Le.method==="throw"){if(ke.iterator.return&&(Le.method="return",Le.arg=c,yi(ke,Le),Le.method==="throw"))return Re;Le.method="throw",Le.arg=new TypeError("The iterator does not provide a 'throw' method")}return Re}var ot=V(rt,ke.iterator,Le.arg);if(ot.type==="throw")return Le.method="throw",Le.arg=ot.arg,Le.delegate=null,Re;var vt=ot.arg;if(!vt)return Le.method="throw",Le.arg=new TypeError("iterator result is not an object"),Le.delegate=null,Re;if(vt.done)Le[ke.resultName]=vt.value,Le.next=ke.nextLoc,Le.method!=="return"&&(Le.method="next",Le.arg=c);else return vt;return Le.delegate=null,Re}wt(Nt),q(Nt,P,"Generator"),q(Nt,g,function(){return this}),q(Nt,"toString",function(){return"[object Generator]"});function gr(ke){var Le={tryLoc:ke[0]};1 in ke&&(Le.catchLoc=ke[1]),2 in ke&&(Le.finallyLoc=ke[2],Le.afterLoc=ke[3]),this.tryEntries.push(Le)}function ni(ke){var Le=ke.completion||{};Le.type="normal",delete Le.arg,ke.completion=Le}function ei(ke){this.tryEntries=[{tryLoc:"root"}],ke.forEach(gr,this),this.reset(!0)}s.keys=function(ke){var Le=Object(ke),rt=[];for(var ot in Le)rt.push(ot);return rt.reverse(),function vt(){for(;rt.length;){var nr=rt.pop();if(nr in Le)return vt.value=nr,vt.done=!1,vt}return vt.done=!0,vt}};function Me(ke){if(ke){var Le=ke[g];if(Le)return Le.call(ke);if(typeof ke.next=="function")return ke;if(!isNaN(ke.length)){var rt=-1,ot=function vt(){for(;++rt<ke.length;)if(l.call(ke,rt))return vt.value=ke[rt],vt.done=!1,vt;return vt.value=c,vt.done=!0,vt};return ot.next=ot}}return{next:tt}}s.values=Me;function tt(){return{value:c,done:!0}}return ei.prototype={constructor:ei,reset:function(ke){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(ni),!ke)for(var Le in this)Le.charAt(0)==="t"&&l.call(this,Le)&&!isNaN(+Le.slice(1))&&(this[Le]=c)},stop:function(){this.done=!0;var ke=this.tryEntries[0],Le=ke.completion;if(Le.type==="throw")throw Le.arg;return this.rval},dispatchException:function(ke){if(this.done)throw ke;var Le=this;function rt(Yr,ti){return nr.type="throw",nr.arg=ke,Le.next=Yr,ti&&(Le.method="next",Le.arg=c),!!ti}for(var ot=this.tryEntries.length-1;ot>=0;--ot){var vt=this.tryEntries[ot],nr=vt.completion;if(vt.tryLoc==="root")return rt("end");if(vt.tryLoc<=this.prev){var Xt=l.call(vt,"catchLoc"),Ir=l.call(vt,"finallyLoc");if(Xt&&Ir){if(this.prev<vt.catchLoc)return rt(vt.catchLoc,!0);if(this.prev<vt.finallyLoc)return rt(vt.finallyLoc)}else if(Xt){if(this.prev<vt.catchLoc)return rt(vt.catchLoc,!0)}else if(Ir){if(this.prev<vt.finallyLoc)return rt(vt.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(ke,Le){for(var rt=this.tryEntries.length-1;rt>=0;--rt){var ot=this.tryEntries[rt];if(ot.tryLoc<=this.prev&&l.call(ot,"finallyLoc")&&this.prev<ot.finallyLoc){var vt=ot;break}}vt&&(ke==="break"||ke==="continue")&&vt.tryLoc<=Le&&Le<=vt.finallyLoc&&(vt=null);var nr=vt?vt.completion:{};return nr.type=ke,nr.arg=Le,vt?(this.method="next",this.next=vt.finallyLoc,Re):this.complete(nr)},complete:function(ke,Le){if(ke.type==="throw")throw ke.arg;return ke.type==="break"||ke.type==="continue"?this.next=ke.arg:ke.type==="return"?(this.rval=this.arg=ke.arg,this.method="return",this.next="end"):ke.type==="normal"&&Le&&(this.next=Le),Re},finish:function(ke){for(var Le=this.tryEntries.length-1;Le>=0;--Le){var rt=this.tryEntries[Le];if(rt.finallyLoc===ke)return this.complete(rt.completion,rt.afterLoc),ni(rt),Re}},catch:function(ke){for(var Le=this.tryEntries.length-1;Le>=0;--Le){var rt=this.tryEntries[Le];if(rt.tryLoc===ke){var ot=rt.completion;if(ot.type==="throw"){var vt=ot.arg;ni(rt)}return vt}}throw new Error("illegal catch attempt")},delegateYield:function(ke,Le,rt){return this.delegate={iterator:Me(ke),resultName:Le,nextLoc:rt},this.method==="next"&&(this.arg=c),Re}},s}(typeof QS=="object"?QS.exports:{});try{regeneratorRuntime=JS}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=JS:Function("r","regeneratorRuntime = r")(JS)}});var t2=M((HWe,e2)=>{"use strict";var rp=typeof Reflect=="object"?Reflect:null,bG=rp&&typeof rp.apply=="function"?rp.apply:function(n,l,o){return Function.prototype.apply.call(n,l,o)},Qv;rp&&typeof rp.ownKeys=="function"?Qv=rp.ownKeys:Object.getOwnPropertySymbols?Qv=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Qv=function(n){return Object.getOwnPropertyNames(n)};function _Me(s){console&&console.warn&&console.warn(s)}var TG=Number.isNaN||function(n){return n!==n};function Fr(){Fr.init.call(this)}e2.exports=Fr;e2.exports.once=xMe;Fr.EventEmitter=Fr;Fr.prototype._events=void 0;Fr.prototype._eventsCount=0;Fr.prototype._maxListeners=void 0;var wG=10;function e0(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(Fr,"defaultMaxListeners",{enumerable:!0,get:function(){return wG},set:function(s){if(typeof s!="number"||s<0||TG(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");wG=s}});Fr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Fr.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||TG(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function EG(s){return s._maxListeners===void 0?Fr.defaultMaxListeners:s._maxListeners}Fr.prototype.getMaxListeners=function(){return EG(this)};Fr.prototype.emit=function(n){for(var l=[],o=1;o<arguments.length;o++)l.push(arguments[o]);var c=n==="error",t=this._events;if(t!==void 0)c=c&&t.error===void 0;else if(!c)return!1;if(c){var g;if(l.length>0&&(g=l[0]),g instanceof Error)throw g;var I=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw I.context=g,I}var P=t[n];if(P===void 0)return!1;if(typeof P=="function")bG(P,this,l);else for(var q=P.length,L=CG(P,q),o=0;o<q;++o)bG(L[o],this,l);return!0};function SG(s,n,l,o){var c,t,g;if(e0(l),t=s._events,t===void 0?(t=s._events=Object.create(null),s._eventsCount=0):(t.newListener!==void 0&&(s.emit("newListener",n,l.listener?l.listener:l),t=s._events),g=t[n]),g===void 0)g=t[n]=l,++s._eventsCount;else if(typeof g=="function"?g=t[n]=o?[l,g]:[g,l]:o?g.unshift(l):g.push(l),c=EG(s),c>0&&g.length>c&&!g.warned){g.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=s,I.type=n,I.count=g.length,_Me(I)}return s}Fr.prototype.addListener=function(n,l){return SG(this,n,l,!1)};Fr.prototype.on=Fr.prototype.addListener;Fr.prototype.prependListener=function(n,l){return SG(this,n,l,!0)};function yMe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function IG(s,n,l){var o={fired:!1,wrapFn:void 0,target:s,type:n,listener:l},c=yMe.bind(o);return c.listener=l,o.wrapFn=c,c}Fr.prototype.once=function(n,l){return e0(l),this.on(n,IG(this,n,l)),this};Fr.prototype.prependOnceListener=function(n,l){return e0(l),this.prependListener(n,IG(this,n,l)),this};Fr.prototype.removeListener=function(n,l){var o,c,t,g,I;if(e0(l),c=this._events,c===void 0)return this;if(o=c[n],o===void 0)return this;if(o===l||o.listener===l)--this._eventsCount===0?this._events=Object.create(null):(delete c[n],c.removeListener&&this.emit("removeListener",n,o.listener||l));else if(typeof o!="function"){for(t=-1,g=o.length-1;g>=0;g--)if(o[g]===l||o[g].listener===l){I=o[g].listener,t=g;break}if(t<0)return this;t===0?o.shift():gMe(o,t),o.length===1&&(c[n]=o[0]),c.removeListener!==void 0&&this.emit("removeListener",n,I||l)}return this};Fr.prototype.off=Fr.prototype.removeListener;Fr.prototype.removeAllListeners=function(n){var l,o,c;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[n]),this;if(arguments.length===0){var t=Object.keys(o),g;for(c=0;c<t.length;++c)g=t[c],g!=="removeListener"&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(l=o[n],typeof l=="function")this.removeListener(n,l);else if(l!==void 0)for(c=l.length-1;c>=0;c--)this.removeListener(n,l[c]);return this};function AG(s,n,l){var o=s._events;if(o===void 0)return[];var c=o[n];return c===void 0?[]:typeof c=="function"?l?[c.listener||c]:[c]:l?vMe(c):CG(c,c.length)}Fr.prototype.listeners=function(n){return AG(this,n,!0)};Fr.prototype.rawListeners=function(n){return AG(this,n,!1)};Fr.listenerCount=function(s,n){return typeof s.listenerCount=="function"?s.listenerCount(n):OG.call(s,n)};Fr.prototype.listenerCount=OG;function OG(s){var n=this._events;if(n!==void 0){var l=n[s];if(typeof l=="function")return 1;if(l!==void 0)return l.length}return 0}Fr.prototype.eventNames=function(){return this._eventsCount>0?Qv(this._events):[]};function CG(s,n){for(var l=new Array(n),o=0;o<n;++o)l[o]=s[o];return l}function gMe(s,n){for(;n+1<s.length;n++)s[n]=s[n+1];s.pop()}function vMe(s){for(var n=new Array(s.length),l=0;l<n.length;++l)n[l]=s[l].listener||s[l];return n}function xMe(s,n){return new Promise(function(l,o){function c(g){s.removeListener(n,t),o(g)}function t(){typeof s.removeListener=="function"&&s.removeListener("error",c),l([].slice.call(arguments))}PG(s,n,t,{once:!0}),n!=="error"&&bMe(s,c,{once:!0})})}function bMe(s,n,l){typeof s.on=="function"&&PG(s,"error",n,l)}function PG(s,n,l,o){if(typeof s.on=="function")o.once?s.once(n,l):s.on(n,l);else if(typeof s.addEventListener=="function")s.addEventListener(n,function c(t){o.once&&s.removeEventListener(n,c),l(t)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}});var np=M((KWe,XG)=>{function PMe(s){var n=typeof s;return s!=null&&(n=="object"||n=="function")}XG.exports=PMe});var KG=M((JWe,YG)=>{var MMe=typeof global=="object"&&global&&global.Object===Object&&global;YG.exports=MMe});var Rm=M((QWe,JG)=>{var qMe=KG(),RMe=typeof self=="object"&&self&&self.Object===Object&&self,DMe=qMe||RMe||Function("return this")();JG.exports=DMe});var e$=M((eZe,QG)=>{var LMe=Rm(),kMe=function(){return LMe.Date.now()};QG.exports=kMe});var r$=M((tZe,t$)=>{var zMe=/\s/;function BMe(s){for(var n=s.length;n--&&zMe.test(s.charAt(n)););return n}t$.exports=BMe});var n$=M((rZe,i$)=>{var FMe=r$(),NMe=/^\s+/;function UMe(s){return s&&s.slice(0,FMe(s)+1).replace(NMe,"")}i$.exports=UMe});var Dm=M((iZe,o$)=>{var jMe=Rm(),VMe=jMe.Symbol;o$.exports=VMe});var u$=M((nZe,l$)=>{var a$=Dm(),s$=Object.prototype,GMe=s$.hasOwnProperty,$Me=s$.toString,Lm=a$?a$.toStringTag:void 0;function WMe(s){var n=GMe.call(s,Lm),l=s[Lm];try{s[Lm]=void 0;var o=!0}catch{}var c=$Me.call(s);return o&&(n?s[Lm]=l:delete s[Lm]),c}l$.exports=WMe});var h$=M((oZe,c$)=>{var ZMe=Object.prototype,HMe=ZMe.toString;function XMe(s){return HMe.call(s)}c$.exports=XMe});var a0=M((aZe,d$)=>{var p$=Dm(),YMe=u$(),KMe=h$(),JMe="[object Null]",QMe="[object Undefined]",f$=p$?p$.toStringTag:void 0;function eqe(s){return s==null?s===void 0?QMe:JMe:f$&&f$ in Object(s)?YMe(s):KMe(s)}d$.exports=eqe});var s0=M((sZe,m$)=>{function tqe(s){return s!=null&&typeof s=="object"}m$.exports=tqe});var km=M((lZe,_$)=>{var rqe=a0(),iqe=s0(),nqe="[object Symbol]";function oqe(s){return typeof s=="symbol"||iqe(s)&&rqe(s)==nqe}_$.exports=oqe});var x$=M((uZe,v$)=>{var aqe=n$(),y$=np(),sqe=km(),g$=0/0,lqe=/^[-+]0x[0-9a-f]+$/i,uqe=/^0b[01]+$/i,cqe=/^0o[0-7]+$/i,hqe=parseInt;function pqe(s){if(typeof s=="number")return s;if(sqe(s))return g$;if(y$(s)){var n=typeof s.valueOf=="function"?s.valueOf():s;s=y$(n)?n+"":n}if(typeof s!="string")return s===0?s:+s;s=aqe(s);var l=uqe.test(s);return l||cqe.test(s)?hqe(s.slice(2),l?2:8):lqe.test(s)?g$:+s}v$.exports=pqe});var n2=M((cZe,w$)=>{var fqe=np(),i2=e$(),b$=x$(),dqe="Expected a function",mqe=Math.max,_qe=Math.min;function yqe(s,n,l){var o,c,t,g,I,P,q=0,L=!1,V=!1,oe=!0;if(typeof s!="function")throw new TypeError(dqe);n=b$(n)||0,fqe(l)&&(L=!!l.leading,V="maxWait"in l,t=V?mqe(b$(l.maxWait)||0,n):t,oe="trailing"in l?!!l.trailing:oe);function ne(At){var Nt=o,wt=c;return o=c=void 0,q=At,g=s.apply(wt,Nt),g}function Ie(At){return q=At,I=setTimeout(Ze,n),L?ne(At):g}function Se(At){var Nt=At-P,wt=At-q,Ht=n-Nt;return V?_qe(Ht,t-wt):Ht}function Re(At){var Nt=At-P,wt=At-q;return P===void 0||Nt>=n||Nt<0||V&&wt>=t}function Ze(){var At=i2();if(Re(At))return et(At);I=setTimeout(Ze,Se(At))}function et(At){return I=void 0,oe&&o?ne(At):(o=c=void 0,g)}function He(){I!==void 0&&clearTimeout(I),q=0,o=P=c=I=void 0}function It(){return I===void 0?g:et(i2())}function Yt(){var At=i2(),Nt=Re(At);if(o=arguments,c=this,P=At,Nt){if(I===void 0)return Ie(P);if(V)return clearTimeout(I),I=setTimeout(Ze,n),ne(P)}return I===void 0&&(I=setTimeout(Ze,n)),g}return Yt.cancel=He,Yt.flush=It,Yt}w$.exports=yqe});var I$=M(o2=>{"use strict";var T$=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,gqe=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,E$=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,vqe=/\\([\u000b\u0020-\u00ff])/g,xqe=/([\\"])/g,S$=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;o2.format=bqe;o2.parse=wqe;function bqe(s){if(!s||typeof s!="object")throw new TypeError("argument obj is required");var n=s.parameters,l=s.type;if(!l||!S$.test(l))throw new TypeError("invalid type");var o=l;if(n&&typeof n=="object")for(var c,t=Object.keys(n).sort(),g=0;g<t.length;g++){if(c=t[g],!E$.test(c))throw new TypeError("invalid parameter name");o+="; "+c+"="+Eqe(n[c])}return o}function wqe(s){if(!s)throw new TypeError("argument string is required");var n=typeof s=="object"?Tqe(s):s;if(typeof n!="string")throw new TypeError("argument string is required to be a string");var l=n.indexOf(";"),o=l!==-1?n.substr(0,l).trim():n.trim();if(!S$.test(o))throw new TypeError("invalid media type");var c=new Sqe(o.toLowerCase());if(l!==-1){var t,g,I;for(T$.lastIndex=l;g=T$.exec(n);){if(g.index!==l)throw new TypeError("invalid parameter format");l+=g[0].length,t=g[1].toLowerCase(),I=g[2],I[0]==='"'&&(I=I.substr(1,I.length-2).replace(vqe,"$1")),c.parameters[t]=I}if(l!==n.length)throw new TypeError("invalid parameter format")}return c}function Tqe(s){var n;if(typeof s.getHeader=="function"?n=s.getHeader("content-type"):typeof s.headers=="object"&&(n=s.headers&&s.headers["content-type"]),typeof n!="string")throw new TypeError("content-type header is missing from object");return n}function Eqe(s){var n=String(s);if(E$.test(n))return n;if(n.length>0&&!gqe.test(n))throw new TypeError("invalid parameter value");return'"'+n.replace(xqe,"\\$1")+'"'}function Sqe(s){this.parameters=Object.create(null),this.type=s}});var s2=M((zm,a2)=>{(function(s){"use strict";function n(l){var o=l&&l.Promise||s.Promise,c=l&&l.XMLHttpRequest||s.XMLHttpRequest;return function(){var t=Object.create(s,{fetch:{value:void 0,writable:!0}});return function(g,I){typeof zm=="object"&&typeof a2<"u"?I(zm):typeof define=="function"&&define.amd?define(["exports"],I):I(g.WHATWGFetch={})}(this,function(g){"use strict";var I=typeof t<"u"&&t||typeof self<"u"&&self||typeof I<"u"&&I,P={searchParams:"URLSearchParams"in I,iterable:"Symbol"in I&&"iterator"in Symbol,blob:"FileReader"in I&&"Blob"in I&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in I,arrayBuffer:"ArrayBuffer"in I};function q(Me){return Me&&DataView.prototype.isPrototypeOf(Me)}if(P.arrayBuffer)var L=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],V=ArrayBuffer.isView||function(Me){return Me&&L.indexOf(Object.prototype.toString.call(Me))>-1};function oe(Me){if(typeof Me!="string"&&(Me=String(Me)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(Me)||Me==="")throw new TypeError("Invalid character in header field name");return Me.toLowerCase()}function ne(Me){return typeof Me!="string"&&(Me=String(Me)),Me}function Ie(Me){var tt={next:function(){var ke=Me.shift();return{done:ke===void 0,value:ke}}};return P.iterable&&(tt[Symbol.iterator]=function(){return tt}),tt}function Se(Me){this.map={},Me instanceof Se?Me.forEach(function(tt,ke){this.append(ke,tt)},this):Array.isArray(Me)?Me.forEach(function(tt){this.append(tt[0],tt[1])},this):Me&&Object.getOwnPropertyNames(Me).forEach(function(tt){this.append(tt,Me[tt])},this)}Se.prototype.append=function(Me,tt){Me=oe(Me),tt=ne(tt);var ke=this.map[Me];this.map[Me]=ke?ke+", "+tt:tt},Se.prototype.delete=function(Me){delete this.map[oe(Me)]},Se.prototype.get=function(Me){return Me=oe(Me),this.has(Me)?this.map[Me]:null},Se.prototype.has=function(Me){return this.map.hasOwnProperty(oe(Me))},Se.prototype.set=function(Me,tt){this.map[oe(Me)]=ne(tt)},Se.prototype.forEach=function(Me,tt){for(var ke in this.map)this.map.hasOwnProperty(ke)&&Me.call(tt,this.map[ke],ke,this)},Se.prototype.keys=function(){var Me=[];return this.forEach(function(tt,ke){Me.push(ke)}),Ie(Me)},Se.prototype.values=function(){var Me=[];return this.forEach(function(tt){Me.push(tt)}),Ie(Me)},Se.prototype.entries=function(){var Me=[];return this.forEach(function(tt,ke){Me.push([ke,tt])}),Ie(Me)},P.iterable&&(Se.prototype[Symbol.iterator]=Se.prototype.entries);function Re(Me){if(Me.bodyUsed)return o.reject(new TypeError("Already read"));Me.bodyUsed=!0}function Ze(Me){return new o(function(tt,ke){Me.onload=function(){tt(Me.result)},Me.onerror=function(){ke(Me.error)}})}function et(Me){var tt=new FileReader,ke=Ze(tt);return tt.readAsArrayBuffer(Me),ke}function He(Me){var tt=new FileReader,ke=Ze(tt);return tt.readAsText(Me),ke}function It(Me){for(var tt=new Uint8Array(Me),ke=new Array(tt.length),Le=0;Le<tt.length;Le++)ke[Le]=String.fromCharCode(tt[Le]);return ke.join("")}function Yt(Me){if(Me.slice)return Me.slice(0);var tt=new Uint8Array(Me.byteLength);return tt.set(new Uint8Array(Me)),tt.buffer}function At(){return this.bodyUsed=!1,this._initBody=function(Me){this.bodyUsed=this.bodyUsed,this._bodyInit=Me,Me?typeof Me=="string"?this._bodyText=Me:P.blob&&Blob.prototype.isPrototypeOf(Me)?this._bodyBlob=Me:P.formData&&FormData.prototype.isPrototypeOf(Me)?this._bodyFormData=Me:P.searchParams&&URLSearchParams.prototype.isPrototypeOf(Me)?this._bodyText=Me.toString():P.arrayBuffer&&P.blob&&q(Me)?(this._bodyArrayBuffer=Yt(Me.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):P.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(Me)||V(Me))?this._bodyArrayBuffer=Yt(Me):this._bodyText=Me=Object.prototype.toString.call(Me):this._bodyText="",this.headers.get("content-type")||(typeof Me=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):P.searchParams&&URLSearchParams.prototype.isPrototypeOf(Me)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},P.blob&&(this.blob=function(){var Me=Re(this);if(Me)return Me;if(this._bodyBlob)return o.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return o.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return o.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var Me=Re(this);return Me||(ArrayBuffer.isView(this._bodyArrayBuffer)?o.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):o.resolve(this._bodyArrayBuffer))}else return this.blob().then(et)}),this.text=function(){var Me=Re(this);if(Me)return Me;if(this._bodyBlob)return He(this._bodyBlob);if(this._bodyArrayBuffer)return o.resolve(It(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return o.resolve(this._bodyText)},P.formData&&(this.formData=function(){return this.text().then(pi)}),this.json=function(){return this.text().then(JSON.parse)},this}var Nt=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function wt(Me){var tt=Me.toUpperCase();return Nt.indexOf(tt)>-1?tt:Me}function Ht(Me,tt){if(!(this instanceof Ht))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');tt=tt||{};var ke=tt.body;if(Me instanceof Ht){if(Me.bodyUsed)throw new TypeError("Already read");this.url=Me.url,this.credentials=Me.credentials,tt.headers||(this.headers=new Se(Me.headers)),this.method=Me.method,this.mode=Me.mode,this.signal=Me.signal,!ke&&Me._bodyInit!=null&&(ke=Me._bodyInit,Me.bodyUsed=!0)}else this.url=String(Me);if(this.credentials=tt.credentials||this.credentials||"same-origin",(tt.headers||!this.headers)&&(this.headers=new Se(tt.headers)),this.method=wt(tt.method||this.method||"GET"),this.mode=tt.mode||this.mode||null,this.signal=tt.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&ke)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(ke),(this.method==="GET"||this.method==="HEAD")&&(tt.cache==="no-store"||tt.cache==="no-cache")){var Le=/([?&])_=[^&]*/;if(Le.test(this.url))this.url=this.url.replace(Le,"$1_="+new Date().getTime());else{var rt=/\?/;this.url+=(rt.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Ht.prototype.clone=function(){return new Ht(this,{body:this._bodyInit})};function pi(Me){var tt=new FormData;return Me.trim().split("&").forEach(function(ke){if(ke){var Le=ke.split("="),rt=Le.shift().replace(/\+/g," "),ot=Le.join("=").replace(/\+/g," ");tt.append(decodeURIComponent(rt),decodeURIComponent(ot))}}),tt}function yi(Me){var tt=new Se,ke=Me.replace(/\r?\n[\t ]+/g," ");return ke.split("\r").map(function(Le){return Le.indexOf(`
`)===0?Le.substr(1,Le.length):Le}).forEach(function(Le){var rt=Le.split(":"),ot=rt.shift().trim();if(ot){var vt=rt.join(":").trim();tt.append(ot,vt)}}),tt}At.call(Ht.prototype);function gr(Me,tt){if(!(this instanceof gr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');tt||(tt={}),this.type="default",this.status=tt.status===void 0?200:tt.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in tt?tt.statusText:"",this.headers=new Se(tt.headers),this.url=tt.url||"",this._initBody(Me)}At.call(gr.prototype),gr.prototype.clone=function(){return new gr(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Se(this.headers),url:this.url})},gr.error=function(){var Me=new gr(null,{status:0,statusText:""});return Me.type="error",Me};var ni=[301,302,303,307,308];gr.redirect=function(Me,tt){if(ni.indexOf(tt)===-1)throw new RangeError("Invalid status code");return new gr(null,{status:tt,headers:{location:Me}})},g.DOMException=I.DOMException;try{new g.DOMException}catch{g.DOMException=function(tt,ke){this.message=tt,this.name=ke;var Le=Error(tt);this.stack=Le.stack},g.DOMException.prototype=Object.create(Error.prototype),g.DOMException.prototype.constructor=g.DOMException}function ei(Me,tt){return new o(function(ke,Le){var rt=new Ht(Me,tt);if(rt.signal&&rt.signal.aborted)return Le(new g.DOMException("Aborted","AbortError"));var ot=new c;function vt(){ot.abort()}ot.onload=function(){var Xt={status:ot.status,statusText:ot.statusText,headers:yi(ot.getAllResponseHeaders()||"")};Xt.url="responseURL"in ot?ot.responseURL:Xt.headers.get("X-Request-URL");var Ir="response"in ot?ot.response:ot.responseText;setTimeout(function(){ke(new gr(Ir,Xt))},0)},ot.onerror=function(){setTimeout(function(){Le(new TypeError("Network request failed"))},0)},ot.ontimeout=function(){setTimeout(function(){Le(new TypeError("Network request failed"))},0)},ot.onabort=function(){setTimeout(function(){Le(new g.DOMException("Aborted","AbortError"))},0)};function nr(Xt){try{return Xt===""&&I.location.href?I.location.href:Xt}catch{return Xt}}ot.open(rt.method,nr(rt.url),!0),rt.credentials==="include"?ot.withCredentials=!0:rt.credentials==="omit"&&(ot.withCredentials=!1),"responseType"in ot&&(P.blob?ot.responseType="blob":P.arrayBuffer&&rt.headers.get("Content-Type")&&rt.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(ot.responseType="arraybuffer")),tt&&typeof tt.headers=="object"&&!(tt.headers instanceof Se)?Object.getOwnPropertyNames(tt.headers).forEach(function(Xt){ot.setRequestHeader(Xt,ne(tt.headers[Xt]))}):rt.headers.forEach(function(Xt,Ir){ot.setRequestHeader(Ir,Xt)}),rt.signal&&(rt.signal.addEventListener("abort",vt),ot.onreadystatechange=function(){ot.readyState===4&&rt.signal.removeEventListener("abort",vt)}),ot.send(typeof rt._bodyInit>"u"?null:rt._bodyInit)})}ei.polyfill=!0,I.fetch||(I.fetch=ei,I.Headers=Se,I.Request=Ht,I.Response=gr),g.Headers=Se,g.Request=Ht,g.Response=gr,g.fetch=ei,Object.defineProperty(g,"__esModule",{value:!0})}),{fetch:t.fetch,Headers:t.Headers,Request:t.Request,Response:t.Response,DOMException:t.DOMException}}()}typeof define=="function"&&define.amd?define(function(){return n}):typeof zm=="object"?a2.exports=n:s.fetchPonyfill=n})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:zm)});var O$=M((pZe,A$)=>{"use strict";var{EventEmitter:Iqe}=t2(),{fetch:Aqe}=s2()(),Oqe=(s,n={})=>{let{interval:l,respectDataSaving:o,respectPageVisibility:c,fetchOpts:t,setTimer:g,clearTimer:I}={interval:3e4,respectDataSaving:!0,respectPageVisibility:!0,fetchOpts:{},setTimer:setTimeout,clearTimer:clearTimeout,...n},P="minInterval"in n?n.minInterval:l*3,q=new Iqe,L=null,V=null,oe=async()=>{let wt={};L!==null?wt["if-none-match"]=L:V!==null&&(wt["if-modified-since"]=V);let Ht=await Aqe(s,{...t,headers:{...t.headers,...wt}});if(!Ht.ok&&Ht.status!==304){let ni=new Error(Ht.statusText);throw ni.response=Ht,ni}let pi=!0;Ht.status===304&&(pi=!1);let yi=Ht.headers.get("etag");yi&&(yi===L&&(pi=!1),L=yi);let gr=Ht.headers.get("last-modified")||null;return gr=gr&&+new Date(gr),Number.isInteger(gr)||(gr=null),gr!==null&&V!==null&&(gr<=V&&(pi=!1),V=gr),{changed:pi,response:Ht}},ne=null,Ie=()=>(ne!==null||(q.emit("fetch"),ne=oe().then(({changed:wt,response:Ht})=>(ne=null,q.emit("fetch-done"),wt&&q.emit("change",Ht),Ht),wt=>{throw ne=null,q.emit("fetch-done"),q.emit("error",wt),wt})),ne),Se=globalThis.document,Re=()=>!c||!Se?!1:typeof Se.hidden=="boolean"?Se.hidden:!1,Ze=globalThis.navigator&&globalThis.navigator.connection,et=()=>o&&Ze?Ze.saveData:!1,He=!1,It=null,Yt=()=>{Ie().catch(()=>{}).then(()=>{if(!He)return;let wt=Re()||et()?P:l;It=g(Yt,wt)})},At=()=>{He||(He=!0,Yt(),q.emit("start"))},Nt=()=>{!He||(It===null&&(I(It),It=null),He=!1,q.emit("stop"))};return At(),q.url=()=>s,q.start=At,q.stop=Nt,q.isActive=()=>!!He,q.refetch=Ie,q.isFetching=()=>!!ne,q};A$.exports=Oqe});var M$=M(l0=>{"use strict";l0.byteLength=Pqe;l0.toByteArray=qqe;l0.fromByteArray=Lqe;var xa=[],lo=[],Cqe=typeof Uint8Array<"u"?Uint8Array:Array,l2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Zu=0,C$=l2.length;Zu<C$;++Zu)xa[Zu]=l2[Zu],lo[l2.charCodeAt(Zu)]=Zu;var Zu,C$;lo["-".charCodeAt(0)]=62;lo["_".charCodeAt(0)]=63;function P$(s){var n=s.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=s.indexOf("=");l===-1&&(l=n);var o=l===n?0:4-l%4;return[l,o]}function Pqe(s){var n=P$(s),l=n[0],o=n[1];return(l+o)*3/4-o}function Mqe(s,n,l){return(n+l)*3/4-l}function qqe(s){var n,l=P$(s),o=l[0],c=l[1],t=new Cqe(Mqe(s,o,c)),g=0,I=c>0?o-4:o,P;for(P=0;P<I;P+=4)n=lo[s.charCodeAt(P)]<<18|lo[s.charCodeAt(P+1)]<<12|lo[s.charCodeAt(P+2)]<<6|lo[s.charCodeAt(P+3)],t[g++]=n>>16&255,t[g++]=n>>8&255,t[g++]=n&255;return c===2&&(n=lo[s.charCodeAt(P)]<<2|lo[s.charCodeAt(P+1)]>>4,t[g++]=n&255),c===1&&(n=lo[s.charCodeAt(P)]<<10|lo[s.charCodeAt(P+1)]<<4|lo[s.charCodeAt(P+2)]>>2,t[g++]=n>>8&255,t[g++]=n&255),t}function Rqe(s){return xa[s>>18&63]+xa[s>>12&63]+xa[s>>6&63]+xa[s&63]}function Dqe(s,n,l){for(var o,c=[],t=n;t<l;t+=3)o=(s[t]<<16&16711680)+(s[t+1]<<8&65280)+(s[t+2]&255),c.push(Rqe(o));return c.join("")}function Lqe(s){for(var n,l=s.length,o=l%3,c=[],t=16383,g=0,I=l-o;g<I;g+=t)c.push(Dqe(s,g,g+t>I?I:g+t));return o===1?(n=s[l-1],c.push(xa[n>>2]+xa[n<<4&63]+"==")):o===2&&(n=(s[l-2]<<8)+s[l-1],c.push(xa[n>>10]+xa[n>>4&63]+xa[n<<2&63]+"=")),c.join("")}});var q$=M(u2=>{u2.read=function(s,n,l,o,c){var t,g,I=c*8-o-1,P=(1<<I)-1,q=P>>1,L=-7,V=l?c-1:0,oe=l?-1:1,ne=s[n+V];for(V+=oe,t=ne&(1<<-L)-1,ne>>=-L,L+=I;L>0;t=t*256+s[n+V],V+=oe,L-=8);for(g=t&(1<<-L)-1,t>>=-L,L+=o;L>0;g=g*256+s[n+V],V+=oe,L-=8);if(t===0)t=1-q;else{if(t===P)return g?NaN:(ne?-1:1)*(1/0);g=g+Math.pow(2,o),t=t-q}return(ne?-1:1)*g*Math.pow(2,t-o)};u2.write=function(s,n,l,o,c,t){var g,I,P,q=t*8-c-1,L=(1<<q)-1,V=L>>1,oe=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=o?0:t-1,Ie=o?1:-1,Se=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(I=isNaN(n)?1:0,g=L):(g=Math.floor(Math.log(n)/Math.LN2),n*(P=Math.pow(2,-g))<1&&(g--,P*=2),g+V>=1?n+=oe/P:n+=oe*Math.pow(2,1-V),n*P>=2&&(g++,P/=2),g+V>=L?(I=0,g=L):g+V>=1?(I=(n*P-1)*Math.pow(2,c),g=g+V):(I=n*Math.pow(2,V-1)*Math.pow(2,c),g=0));c>=8;s[l+ne]=I&255,ne+=Ie,I/=256,c-=8);for(g=g<<c|I,q+=c;q>0;s[l+ne]=g&255,ne+=Ie,g/=256,q-=8);s[l+ne-Ie]|=Se*128}});var X$=M(lp=>{"use strict";var c2=M$(),ap=q$(),R$=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;lp.Buffer=je;lp.SlowBuffer=Uqe;lp.INSPECT_MAX_BYTES=50;var u0=2147483647;lp.kMaxLength=u0;je.TYPED_ARRAY_SUPPORT=kqe();!je.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function kqe(){try{let s=new Uint8Array(1),n={foo:function(){return 42}};return Object.setPrototypeOf(n,Uint8Array.prototype),Object.setPrototypeOf(s,n),s.foo()===42}catch{return!1}}Object.defineProperty(je.prototype,"parent",{enumerable:!0,get:function(){if(!!je.isBuffer(this))return this.buffer}});Object.defineProperty(je.prototype,"offset",{enumerable:!0,get:function(){if(!!je.isBuffer(this))return this.byteOffset}});function hs(s){if(s>u0)throw new RangeError('The value "'+s+'" is invalid for option "size"');let n=new Uint8Array(s);return Object.setPrototypeOf(n,je.prototype),n}function je(s,n,l){if(typeof s=="number"){if(typeof n=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d2(s)}return z$(s,n,l)}je.poolSize=8192;function z$(s,n,l){if(typeof s=="string")return Bqe(s,n);if(ArrayBuffer.isView(s))return Fqe(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(ba(s,ArrayBuffer)||s&&ba(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ba(s,SharedArrayBuffer)||s&&ba(s.buffer,SharedArrayBuffer)))return p2(s,n,l);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let o=s.valueOf&&s.valueOf();if(o!=null&&o!==s)return je.from(o,n,l);let c=Nqe(s);if(c)return c;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return je.from(s[Symbol.toPrimitive]("string"),n,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}je.from=function(s,n,l){return z$(s,n,l)};Object.setPrototypeOf(je.prototype,Uint8Array.prototype);Object.setPrototypeOf(je,Uint8Array);function B$(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function zqe(s,n,l){return B$(s),s<=0?hs(s):n!==void 0?typeof l=="string"?hs(s).fill(n,l):hs(s).fill(n):hs(s)}je.alloc=function(s,n,l){return zqe(s,n,l)};function d2(s){return B$(s),hs(s<0?0:m2(s)|0)}je.allocUnsafe=function(s){return d2(s)};je.allocUnsafeSlow=function(s){return d2(s)};function Bqe(s,n){if((typeof n!="string"||n==="")&&(n="utf8"),!je.isEncoding(n))throw new TypeError("Unknown encoding: "+n);let l=F$(s,n)|0,o=hs(l),c=o.write(s,n);return c!==l&&(o=o.slice(0,c)),o}function h2(s){let n=s.length<0?0:m2(s.length)|0,l=hs(n);for(let o=0;o<n;o+=1)l[o]=s[o]&255;return l}function Fqe(s){if(ba(s,Uint8Array)){let n=new Uint8Array(s);return p2(n.buffer,n.byteOffset,n.byteLength)}return h2(s)}function p2(s,n,l){if(n<0||s.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<n+(l||0))throw new RangeError('"length" is outside of buffer bounds');let o;return n===void 0&&l===void 0?o=new Uint8Array(s):l===void 0?o=new Uint8Array(s,n):o=new Uint8Array(s,n,l),Object.setPrototypeOf(o,je.prototype),o}function Nqe(s){if(je.isBuffer(s)){let n=m2(s.length)|0,l=hs(n);return l.length===0||s.copy(l,0,0,n),l}if(s.length!==void 0)return typeof s.length!="number"||y2(s.length)?hs(0):h2(s);if(s.type==="Buffer"&&Array.isArray(s.data))return h2(s.data)}function m2(s){if(s>=u0)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+u0.toString(16)+" bytes");return s|0}function Uqe(s){return+s!=s&&(s=0),je.alloc(+s)}je.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==je.prototype};je.compare=function(n,l){if(ba(n,Uint8Array)&&(n=je.from(n,n.offset,n.byteLength)),ba(l,Uint8Array)&&(l=je.from(l,l.offset,l.byteLength)),!je.isBuffer(n)||!je.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===l)return 0;let o=n.length,c=l.length;for(let t=0,g=Math.min(o,c);t<g;++t)if(n[t]!==l[t]){o=n[t],c=l[t];break}return o<c?-1:c<o?1:0};je.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};je.concat=function(n,l){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return je.alloc(0);let o;if(l===void 0)for(l=0,o=0;o<n.length;++o)l+=n[o].length;let c=je.allocUnsafe(l),t=0;for(o=0;o<n.length;++o){let g=n[o];if(ba(g,Uint8Array))t+g.length>c.length?(je.isBuffer(g)||(g=je.from(g)),g.copy(c,t)):Uint8Array.prototype.set.call(c,g,t);else if(je.isBuffer(g))g.copy(c,t);else throw new TypeError('"list" argument must be an Array of Buffers');t+=g.length}return c};function F$(s,n){if(je.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||ba(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);let l=s.length,o=arguments.length>2&&arguments[2]===!0;if(!o&&l===0)return 0;let c=!1;for(;;)switch(n){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return f2(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return H$(s).length;default:if(c)return o?-1:f2(s).length;n=(""+n).toLowerCase(),c=!0}}je.byteLength=F$;function jqe(s,n,l){let o=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((l===void 0||l>this.length)&&(l=this.length),l<=0)||(l>>>=0,n>>>=0,l<=n))return"";for(s||(s="utf8");;)switch(s){case"hex":return Jqe(this,n,l);case"utf8":case"utf-8":return U$(this,n,l);case"ascii":return Yqe(this,n,l);case"latin1":case"binary":return Kqe(this,n,l);case"base64":return Hqe(this,n,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qqe(this,n,l);default:if(o)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),o=!0}}je.prototype._isBuffer=!0;function Hu(s,n,l){let o=s[n];s[n]=s[l],s[l]=o}je.prototype.swap16=function(){let n=this.length;if(n%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let l=0;l<n;l+=2)Hu(this,l,l+1);return this};je.prototype.swap32=function(){let n=this.length;if(n%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let l=0;l<n;l+=4)Hu(this,l,l+3),Hu(this,l+1,l+2);return this};je.prototype.swap64=function(){let n=this.length;if(n%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let l=0;l<n;l+=8)Hu(this,l,l+7),Hu(this,l+1,l+6),Hu(this,l+2,l+5),Hu(this,l+3,l+4);return this};je.prototype.toString=function(){let n=this.length;return n===0?"":arguments.length===0?U$(this,0,n):jqe.apply(this,arguments)};je.prototype.toLocaleString=je.prototype.toString;je.prototype.equals=function(n){if(!je.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n?!0:je.compare(this,n)===0};je.prototype.inspect=function(){let n="",l=lp.INSPECT_MAX_BYTES;return n=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(n+=" ... "),"<Buffer "+n+">"};R$&&(je.prototype[R$]=je.prototype.inspect);je.prototype.compare=function(n,l,o,c,t){if(ba(n,Uint8Array)&&(n=je.from(n,n.offset,n.byteLength)),!je.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(l===void 0&&(l=0),o===void 0&&(o=n?n.length:0),c===void 0&&(c=0),t===void 0&&(t=this.length),l<0||o>n.length||c<0||t>this.length)throw new RangeError("out of range index");if(c>=t&&l>=o)return 0;if(c>=t)return-1;if(l>=o)return 1;if(l>>>=0,o>>>=0,c>>>=0,t>>>=0,this===n)return 0;let g=t-c,I=o-l,P=Math.min(g,I),q=this.slice(c,t),L=n.slice(l,o);for(let V=0;V<P;++V)if(q[V]!==L[V]){g=q[V],I=L[V];break}return g<I?-1:I<g?1:0};function N$(s,n,l,o,c){if(s.length===0)return-1;if(typeof l=="string"?(o=l,l=0):l>2147483647?l=2147483647:l<-2147483648&&(l=-2147483648),l=+l,y2(l)&&(l=c?0:s.length-1),l<0&&(l=s.length+l),l>=s.length){if(c)return-1;l=s.length-1}else if(l<0)if(c)l=0;else return-1;if(typeof n=="string"&&(n=je.from(n,o)),je.isBuffer(n))return n.length===0?-1:D$(s,n,l,o,c);if(typeof n=="number")return n=n&255,typeof Uint8Array.prototype.indexOf=="function"?c?Uint8Array.prototype.indexOf.call(s,n,l):Uint8Array.prototype.lastIndexOf.call(s,n,l):D$(s,[n],l,o,c);throw new TypeError("val must be string, number or Buffer")}function D$(s,n,l,o,c){let t=1,g=s.length,I=n.length;if(o!==void 0&&(o=String(o).toLowerCase(),o==="ucs2"||o==="ucs-2"||o==="utf16le"||o==="utf-16le")){if(s.length<2||n.length<2)return-1;t=2,g/=2,I/=2,l/=2}function P(L,V){return t===1?L[V]:L.readUInt16BE(V*t)}let q;if(c){let L=-1;for(q=l;q<g;q++)if(P(s,q)===P(n,L===-1?0:q-L)){if(L===-1&&(L=q),q-L+1===I)return L*t}else L!==-1&&(q-=q-L),L=-1}else for(l+I>g&&(l=g-I),q=l;q>=0;q--){let L=!0;for(let V=0;V<I;V++)if(P(s,q+V)!==P(n,V)){L=!1;break}if(L)return q}return-1}je.prototype.includes=function(n,l,o){return this.indexOf(n,l,o)!==-1};je.prototype.indexOf=function(n,l,o){return N$(this,n,l,o,!0)};je.prototype.lastIndexOf=function(n,l,o){return N$(this,n,l,o,!1)};function Vqe(s,n,l,o){l=Number(l)||0;let c=s.length-l;o?(o=Number(o),o>c&&(o=c)):o=c;let t=n.length;o>t/2&&(o=t/2);let g;for(g=0;g<o;++g){let I=parseInt(n.substr(g*2,2),16);if(y2(I))return g;s[l+g]=I}return g}function Gqe(s,n,l,o){return c0(f2(n,s.length-l),s,l,o)}function $qe(s,n,l,o){return c0(iRe(n),s,l,o)}function Wqe(s,n,l,o){return c0(H$(n),s,l,o)}function Zqe(s,n,l,o){return c0(nRe(n,s.length-l),s,l,o)}je.prototype.write=function(n,l,o,c){if(l===void 0)c="utf8",o=this.length,l=0;else if(o===void 0&&typeof l=="string")c=l,o=this.length,l=0;else if(isFinite(l))l=l>>>0,isFinite(o)?(o=o>>>0,c===void 0&&(c="utf8")):(c=o,o=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let t=this.length-l;if((o===void 0||o>t)&&(o=t),n.length>0&&(o<0||l<0)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");c||(c="utf8");let g=!1;for(;;)switch(c){case"hex":return Vqe(this,n,l,o);case"utf8":case"utf-8":return Gqe(this,n,l,o);case"ascii":case"latin1":case"binary":return $qe(this,n,l,o);case"base64":return Wqe(this,n,l,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Zqe(this,n,l,o);default:if(g)throw new TypeError("Unknown encoding: "+c);c=(""+c).toLowerCase(),g=!0}};je.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Hqe(s,n,l){return n===0&&l===s.length?c2.fromByteArray(s):c2.fromByteArray(s.slice(n,l))}function U$(s,n,l){l=Math.min(s.length,l);let o=[],c=n;for(;c<l;){let t=s[c],g=null,I=t>239?4:t>223?3:t>191?2:1;if(c+I<=l){let P,q,L,V;switch(I){case 1:t<128&&(g=t);break;case 2:P=s[c+1],(P&192)===128&&(V=(t&31)<<6|P&63,V>127&&(g=V));break;case 3:P=s[c+1],q=s[c+2],(P&192)===128&&(q&192)===128&&(V=(t&15)<<12|(P&63)<<6|q&63,V>2047&&(V<55296||V>57343)&&(g=V));break;case 4:P=s[c+1],q=s[c+2],L=s[c+3],(P&192)===128&&(q&192)===128&&(L&192)===128&&(V=(t&15)<<18|(P&63)<<12|(q&63)<<6|L&63,V>65535&&V<1114112&&(g=V))}}g===null?(g=65533,I=1):g>65535&&(g-=65536,o.push(g>>>10&1023|55296),g=56320|g&1023),o.push(g),c+=I}return Xqe(o)}var L$=4096;function Xqe(s){let n=s.length;if(n<=L$)return String.fromCharCode.apply(String,s);let l="",o=0;for(;o<n;)l+=String.fromCharCode.apply(String,s.slice(o,o+=L$));return l}function Yqe(s,n,l){let o="";l=Math.min(s.length,l);for(let c=n;c<l;++c)o+=String.fromCharCode(s[c]&127);return o}function Kqe(s,n,l){let o="";l=Math.min(s.length,l);for(let c=n;c<l;++c)o+=String.fromCharCode(s[c]);return o}function Jqe(s,n,l){let o=s.length;(!n||n<0)&&(n=0),(!l||l<0||l>o)&&(l=o);let c="";for(let t=n;t<l;++t)c+=oRe[s[t]];return c}function Qqe(s,n,l){let o=s.slice(n,l),c="";for(let t=0;t<o.length-1;t+=2)c+=String.fromCharCode(o[t]+o[t+1]*256);return c}je.prototype.slice=function(n,l){let o=this.length;n=~~n,l=l===void 0?o:~~l,n<0?(n+=o,n<0&&(n=0)):n>o&&(n=o),l<0?(l+=o,l<0&&(l=0)):l>o&&(l=o),l<n&&(l=n);let c=this.subarray(n,l);return Object.setPrototypeOf(c,je.prototype),c};function Ri(s,n,l){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+n>l)throw new RangeError("Trying to access beyond buffer length")}je.prototype.readUintLE=je.prototype.readUIntLE=function(n,l,o){n=n>>>0,l=l>>>0,o||Ri(n,l,this.length);let c=this[n],t=1,g=0;for(;++g<l&&(t*=256);)c+=this[n+g]*t;return c};je.prototype.readUintBE=je.prototype.readUIntBE=function(n,l,o){n=n>>>0,l=l>>>0,o||Ri(n,l,this.length);let c=this[n+--l],t=1;for(;l>0&&(t*=256);)c+=this[n+--l]*t;return c};je.prototype.readUint8=je.prototype.readUInt8=function(n,l){return n=n>>>0,l||Ri(n,1,this.length),this[n]};je.prototype.readUint16LE=je.prototype.readUInt16LE=function(n,l){return n=n>>>0,l||Ri(n,2,this.length),this[n]|this[n+1]<<8};je.prototype.readUint16BE=je.prototype.readUInt16BE=function(n,l){return n=n>>>0,l||Ri(n,2,this.length),this[n]<<8|this[n+1]};je.prototype.readUint32LE=je.prototype.readUInt32LE=function(n,l){return n=n>>>0,l||Ri(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+this[n+3]*16777216};je.prototype.readUint32BE=je.prototype.readUInt32BE=function(n,l){return n=n>>>0,l||Ri(n,4,this.length),this[n]*16777216+(this[n+1]<<16|this[n+2]<<8|this[n+3])};je.prototype.readBigUInt64LE=ml(function(n){n=n>>>0,sp(n,"offset");let l=this[n],o=this[n+7];(l===void 0||o===void 0)&&Bm(n,this.length-8);let c=l+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24,t=this[++n]+this[++n]*2**8+this[++n]*2**16+o*2**24;return BigInt(c)+(BigInt(t)<<BigInt(32))});je.prototype.readBigUInt64BE=ml(function(n){n=n>>>0,sp(n,"offset");let l=this[n],o=this[n+7];(l===void 0||o===void 0)&&Bm(n,this.length-8);let c=l*2**24+this[++n]*2**16+this[++n]*2**8+this[++n],t=this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+o;return(BigInt(c)<<BigInt(32))+BigInt(t)});je.prototype.readIntLE=function(n,l,o){n=n>>>0,l=l>>>0,o||Ri(n,l,this.length);let c=this[n],t=1,g=0;for(;++g<l&&(t*=256);)c+=this[n+g]*t;return t*=128,c>=t&&(c-=Math.pow(2,8*l)),c};je.prototype.readIntBE=function(n,l,o){n=n>>>0,l=l>>>0,o||Ri(n,l,this.length);let c=l,t=1,g=this[n+--c];for(;c>0&&(t*=256);)g+=this[n+--c]*t;return t*=128,g>=t&&(g-=Math.pow(2,8*l)),g};je.prototype.readInt8=function(n,l){return n=n>>>0,l||Ri(n,1,this.length),this[n]&128?(255-this[n]+1)*-1:this[n]};je.prototype.readInt16LE=function(n,l){n=n>>>0,l||Ri(n,2,this.length);let o=this[n]|this[n+1]<<8;return o&32768?o|4294901760:o};je.prototype.readInt16BE=function(n,l){n=n>>>0,l||Ri(n,2,this.length);let o=this[n+1]|this[n]<<8;return o&32768?o|4294901760:o};je.prototype.readInt32LE=function(n,l){return n=n>>>0,l||Ri(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24};je.prototype.readInt32BE=function(n,l){return n=n>>>0,l||Ri(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]};je.prototype.readBigInt64LE=ml(function(n){n=n>>>0,sp(n,"offset");let l=this[n],o=this[n+7];(l===void 0||o===void 0)&&Bm(n,this.length-8);let c=this[n+4]+this[n+5]*2**8+this[n+6]*2**16+(o<<24);return(BigInt(c)<<BigInt(32))+BigInt(l+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24)});je.prototype.readBigInt64BE=ml(function(n){n=n>>>0,sp(n,"offset");let l=this[n],o=this[n+7];(l===void 0||o===void 0)&&Bm(n,this.length-8);let c=(l<<24)+this[++n]*2**16+this[++n]*2**8+this[++n];return(BigInt(c)<<BigInt(32))+BigInt(this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+o)});je.prototype.readFloatLE=function(n,l){return n=n>>>0,l||Ri(n,4,this.length),ap.read(this,n,!0,23,4)};je.prototype.readFloatBE=function(n,l){return n=n>>>0,l||Ri(n,4,this.length),ap.read(this,n,!1,23,4)};je.prototype.readDoubleLE=function(n,l){return n=n>>>0,l||Ri(n,8,this.length),ap.read(this,n,!0,52,8)};je.prototype.readDoubleBE=function(n,l){return n=n>>>0,l||Ri(n,8,this.length),ap.read(this,n,!1,52,8)};function Cn(s,n,l,o,c,t){if(!je.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>c||n<t)throw new RangeError('"value" argument is out of bounds');if(l+o>s.length)throw new RangeError("Index out of range")}je.prototype.writeUintLE=je.prototype.writeUIntLE=function(n,l,o,c){if(n=+n,l=l>>>0,o=o>>>0,!c){let I=Math.pow(2,8*o)-1;Cn(this,n,l,o,I,0)}let t=1,g=0;for(this[l]=n&255;++g<o&&(t*=256);)this[l+g]=n/t&255;return l+o};je.prototype.writeUintBE=je.prototype.writeUIntBE=function(n,l,o,c){if(n=+n,l=l>>>0,o=o>>>0,!c){let I=Math.pow(2,8*o)-1;Cn(this,n,l,o,I,0)}let t=o-1,g=1;for(this[l+t]=n&255;--t>=0&&(g*=256);)this[l+t]=n/g&255;return l+o};je.prototype.writeUint8=je.prototype.writeUInt8=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,1,255,0),this[l]=n&255,l+1};je.prototype.writeUint16LE=je.prototype.writeUInt16LE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,2,65535,0),this[l]=n&255,this[l+1]=n>>>8,l+2};je.prototype.writeUint16BE=je.prototype.writeUInt16BE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,2,65535,0),this[l]=n>>>8,this[l+1]=n&255,l+2};je.prototype.writeUint32LE=je.prototype.writeUInt32LE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,4,4294967295,0),this[l+3]=n>>>24,this[l+2]=n>>>16,this[l+1]=n>>>8,this[l]=n&255,l+4};je.prototype.writeUint32BE=je.prototype.writeUInt32BE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,4,4294967295,0),this[l]=n>>>24,this[l+1]=n>>>16,this[l+2]=n>>>8,this[l+3]=n&255,l+4};function j$(s,n,l,o,c){Z$(n,o,c,s,l,7);let t=Number(n&BigInt(4294967295));s[l++]=t,t=t>>8,s[l++]=t,t=t>>8,s[l++]=t,t=t>>8,s[l++]=t;let g=Number(n>>BigInt(32)&BigInt(4294967295));return s[l++]=g,g=g>>8,s[l++]=g,g=g>>8,s[l++]=g,g=g>>8,s[l++]=g,l}function V$(s,n,l,o,c){Z$(n,o,c,s,l,7);let t=Number(n&BigInt(4294967295));s[l+7]=t,t=t>>8,s[l+6]=t,t=t>>8,s[l+5]=t,t=t>>8,s[l+4]=t;let g=Number(n>>BigInt(32)&BigInt(4294967295));return s[l+3]=g,g=g>>8,s[l+2]=g,g=g>>8,s[l+1]=g,g=g>>8,s[l]=g,l+8}je.prototype.writeBigUInt64LE=ml(function(n,l=0){return j$(this,n,l,BigInt(0),BigInt("0xffffffffffffffff"))});je.prototype.writeBigUInt64BE=ml(function(n,l=0){return V$(this,n,l,BigInt(0),BigInt("0xffffffffffffffff"))});je.prototype.writeIntLE=function(n,l,o,c){if(n=+n,l=l>>>0,!c){let P=Math.pow(2,8*o-1);Cn(this,n,l,o,P-1,-P)}let t=0,g=1,I=0;for(this[l]=n&255;++t<o&&(g*=256);)n<0&&I===0&&this[l+t-1]!==0&&(I=1),this[l+t]=(n/g>>0)-I&255;return l+o};je.prototype.writeIntBE=function(n,l,o,c){if(n=+n,l=l>>>0,!c){let P=Math.pow(2,8*o-1);Cn(this,n,l,o,P-1,-P)}let t=o-1,g=1,I=0;for(this[l+t]=n&255;--t>=0&&(g*=256);)n<0&&I===0&&this[l+t+1]!==0&&(I=1),this[l+t]=(n/g>>0)-I&255;return l+o};je.prototype.writeInt8=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,1,127,-128),n<0&&(n=255+n+1),this[l]=n&255,l+1};je.prototype.writeInt16LE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,2,32767,-32768),this[l]=n&255,this[l+1]=n>>>8,l+2};je.prototype.writeInt16BE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,2,32767,-32768),this[l]=n>>>8,this[l+1]=n&255,l+2};je.prototype.writeInt32LE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,4,2147483647,-2147483648),this[l]=n&255,this[l+1]=n>>>8,this[l+2]=n>>>16,this[l+3]=n>>>24,l+4};je.prototype.writeInt32BE=function(n,l,o){return n=+n,l=l>>>0,o||Cn(this,n,l,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[l]=n>>>24,this[l+1]=n>>>16,this[l+2]=n>>>8,this[l+3]=n&255,l+4};je.prototype.writeBigInt64LE=ml(function(n,l=0){return j$(this,n,l,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});je.prototype.writeBigInt64BE=ml(function(n,l=0){return V$(this,n,l,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function G$(s,n,l,o,c,t){if(l+o>s.length)throw new RangeError("Index out of range");if(l<0)throw new RangeError("Index out of range")}function $$(s,n,l,o,c){return n=+n,l=l>>>0,c||G$(s,n,l,4,34028234663852886e22,-34028234663852886e22),ap.write(s,n,l,o,23,4),l+4}je.prototype.writeFloatLE=function(n,l,o){return $$(this,n,l,!0,o)};je.prototype.writeFloatBE=function(n,l,o){return $$(this,n,l,!1,o)};function W$(s,n,l,o,c){return n=+n,l=l>>>0,c||G$(s,n,l,8,17976931348623157e292,-17976931348623157e292),ap.write(s,n,l,o,52,8),l+8}je.prototype.writeDoubleLE=function(n,l,o){return W$(this,n,l,!0,o)};je.prototype.writeDoubleBE=function(n,l,o){return W$(this,n,l,!1,o)};je.prototype.copy=function(n,l,o,c){if(!je.isBuffer(n))throw new TypeError("argument should be a Buffer");if(o||(o=0),!c&&c!==0&&(c=this.length),l>=n.length&&(l=n.length),l||(l=0),c>0&&c<o&&(c=o),c===o||n.length===0||this.length===0)return 0;if(l<0)throw new RangeError("targetStart out of bounds");if(o<0||o>=this.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("sourceEnd out of bounds");c>this.length&&(c=this.length),n.length-l<c-o&&(c=n.length-l+o);let t=c-o;return this===n&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(l,o,c):Uint8Array.prototype.set.call(n,this.subarray(o,c),l),t};je.prototype.fill=function(n,l,o,c){if(typeof n=="string"){if(typeof l=="string"?(c=l,l=0,o=this.length):typeof o=="string"&&(c=o,o=this.length),c!==void 0&&typeof c!="string")throw new TypeError("encoding must be a string");if(typeof c=="string"&&!je.isEncoding(c))throw new TypeError("Unknown encoding: "+c);if(n.length===1){let g=n.charCodeAt(0);(c==="utf8"&&g<128||c==="latin1")&&(n=g)}}else typeof n=="number"?n=n&255:typeof n=="boolean"&&(n=Number(n));if(l<0||this.length<l||this.length<o)throw new RangeError("Out of range index");if(o<=l)return this;l=l>>>0,o=o===void 0?this.length:o>>>0,n||(n=0);let t;if(typeof n=="number")for(t=l;t<o;++t)this[t]=n;else{let g=je.isBuffer(n)?n:je.from(n,c),I=g.length;if(I===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(t=0;t<o-l;++t)this[t+l]=g[t%I]}return this};var op={};function _2(s,n,l){op[s]=class extends l{constructor(){super(),Object.defineProperty(this,"message",{value:n.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${s}]`,this.stack,delete this.name}get code(){return s}set code(c){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:c,writable:!0})}toString(){return`${this.name} [${s}]: ${this.message}`}}}_2("ERR_BUFFER_OUT_OF_BOUNDS",function(s){return s?`${s} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);_2("ERR_INVALID_ARG_TYPE",function(s,n){return`The "${s}" argument must be of type number. Received type ${typeof n}`},TypeError);_2("ERR_OUT_OF_RANGE",function(s,n,l){let o=`The value of "${s}" is out of range.`,c=l;return Number.isInteger(l)&&Math.abs(l)>2**32?c=k$(String(l)):typeof l=="bigint"&&(c=String(l),(l>BigInt(2)**BigInt(32)||l<-(BigInt(2)**BigInt(32)))&&(c=k$(c)),c+="n"),o+=` It must be ${n}. Received ${c}`,o},RangeError);function k$(s){let n="",l=s.length,o=s[0]==="-"?1:0;for(;l>=o+4;l-=3)n=`_${s.slice(l-3,l)}${n}`;return`${s.slice(0,l)}${n}`}function eRe(s,n,l){sp(n,"offset"),(s[n]===void 0||s[n+l]===void 0)&&Bm(n,s.length-(l+1))}function Z$(s,n,l,o,c,t){if(s>l||s<n){let g=typeof n=="bigint"?"n":"",I;throw t>3?n===0||n===BigInt(0)?I=`>= 0${g} and < 2${g} ** ${(t+1)*8}${g}`:I=`>= -(2${g} ** ${(t+1)*8-1}${g}) and < 2 ** ${(t+1)*8-1}${g}`:I=`>= ${n}${g} and <= ${l}${g}`,new op.ERR_OUT_OF_RANGE("value",I,s)}eRe(o,c,t)}function sp(s,n){if(typeof s!="number")throw new op.ERR_INVALID_ARG_TYPE(n,"number",s)}function Bm(s,n,l){throw Math.floor(s)!==s?(sp(s,l),new op.ERR_OUT_OF_RANGE(l||"offset","an integer",s)):n<0?new op.ERR_BUFFER_OUT_OF_BOUNDS:new op.ERR_OUT_OF_RANGE(l||"offset",`>= ${l?1:0} and <= ${n}`,s)}var tRe=/[^+/0-9A-Za-z-_]/g;function rRe(s){if(s=s.split("=")[0],s=s.trim().replace(tRe,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function f2(s,n){n=n||1/0;let l,o=s.length,c=null,t=[];for(let g=0;g<o;++g){if(l=s.charCodeAt(g),l>55295&&l<57344){if(!c){if(l>56319){(n-=3)>-1&&t.push(239,191,189);continue}else if(g+1===o){(n-=3)>-1&&t.push(239,191,189);continue}c=l;continue}if(l<56320){(n-=3)>-1&&t.push(239,191,189),c=l;continue}l=(c-55296<<10|l-56320)+65536}else c&&(n-=3)>-1&&t.push(239,191,189);if(c=null,l<128){if((n-=1)<0)break;t.push(l)}else if(l<2048){if((n-=2)<0)break;t.push(l>>6|192,l&63|128)}else if(l<65536){if((n-=3)<0)break;t.push(l>>12|224,l>>6&63|128,l&63|128)}else if(l<1114112){if((n-=4)<0)break;t.push(l>>18|240,l>>12&63|128,l>>6&63|128,l&63|128)}else throw new Error("Invalid code point")}return t}function iRe(s){let n=[];for(let l=0;l<s.length;++l)n.push(s.charCodeAt(l)&255);return n}function nRe(s,n){let l,o,c,t=[];for(let g=0;g<s.length&&!((n-=2)<0);++g)l=s.charCodeAt(g),o=l>>8,c=l%256,t.push(c),t.push(o);return t}function H$(s){return c2.toByteArray(rRe(s))}function c0(s,n,l,o){let c;for(c=0;c<o&&!(c+l>=n.length||c>=s.length);++c)n[c+l]=s[c];return c}function ba(s,n){return s instanceof n||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===n.name}function y2(s){return s!==s}var oRe=function(){let s="0123456789abcdef",n=new Array(256);for(let l=0;l<16;++l){let o=l*16;for(let c=0;c<16;++c)n[o+c]=s[l]+s[c]}return n}();function ml(s){return typeof BigInt>"u"?aRe:s}function aRe(){throw new Error("BigInt not supported")}});var K$=M((yZe,Y$)=>{"use strict";Y$.exports=sRe;function sRe(s,n){for(var l=new Array(arguments.length-1),o=0,c=2,t=!0;c<arguments.length;)l[o++]=arguments[c++];return new Promise(function(I,P){l[o]=function(L){if(t)if(t=!1,L)P(L);else{for(var V=new Array(arguments.length-1),oe=0;oe<V.length;)V[oe++]=arguments[oe];I.apply(null,V)}};try{s.apply(n||null,l)}catch(q){t&&(t=!1,P(q))}})}});var t7=M(e7=>{"use strict";var h0=e7;h0.length=function(n){var l=n.length;if(!l)return 0;for(var o=0;--l%4>1&&n.charAt(l)==="=";)++o;return Math.ceil(n.length*3)/4-o};var up=new Array(64),Q$=new Array(123);for(Bo=0;Bo<64;)Q$[up[Bo]=Bo<26?Bo+65:Bo<52?Bo+71:Bo<62?Bo-4:Bo-59|43]=Bo++;var Bo;h0.encode=function(n,l,o){for(var c=null,t=[],g=0,I=0,P;l<o;){var q=n[l++];switch(I){case 0:t[g++]=up[q>>2],P=(q&3)<<4,I=1;break;case 1:t[g++]=up[P|q>>4],P=(q&15)<<2,I=2;break;case 2:t[g++]=up[P|q>>6],t[g++]=up[q&63],I=0;break}g>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,t)),g=0)}return I&&(t[g++]=up[P],t[g++]=61,I===1&&(t[g++]=61)),c?(g&&c.push(String.fromCharCode.apply(String,t.slice(0,g))),c.join("")):String.fromCharCode.apply(String,t.slice(0,g))};var J$="invalid encoding";h0.decode=function(n,l,o){for(var c=o,t=0,g,I=0;I<n.length;){var P=n.charCodeAt(I++);if(P===61&&t>1)break;if((P=Q$[P])===void 0)throw Error(J$);switch(t){case 0:g=P,t=1;break;case 1:l[o++]=g<<2|(P&48)>>4,g=P,t=2;break;case 2:l[o++]=(g&15)<<4|(P&60)>>2,g=P,t=3;break;case 3:l[o++]=(g&3)<<6|P,t=0;break}}if(t===1)throw Error(J$);return o-c};h0.test=function(n){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(n)}});var i7=M((vZe,r7)=>{"use strict";r7.exports=p0;function p0(){this._listeners={}}p0.prototype.on=function(n,l,o){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:l,ctx:o||this}),this};p0.prototype.off=function(n,l){if(n===void 0)this._listeners={};else if(l===void 0)this._listeners[n]=[];else for(var o=this._listeners[n],c=0;c<o.length;)o[c].fn===l?o.splice(c,1):++c;return this};p0.prototype.emit=function(n){var l=this._listeners[n];if(l){for(var o=[],c=1;c<arguments.length;)o.push(arguments[c++]);for(c=0;c<l.length;)l[c].fn.apply(l[c++].ctx,o)}return this}});var c7=M((xZe,u7)=>{"use strict";u7.exports=n7(n7);function n7(s){return typeof Float32Array<"u"?function(){var n=new Float32Array([-0]),l=new Uint8Array(n.buffer),o=l[3]===128;function c(P,q,L){n[0]=P,q[L]=l[0],q[L+1]=l[1],q[L+2]=l[2],q[L+3]=l[3]}function t(P,q,L){n[0]=P,q[L]=l[3],q[L+1]=l[2],q[L+2]=l[1],q[L+3]=l[0]}s.writeFloatLE=o?c:t,s.writeFloatBE=o?t:c;function g(P,q){return l[0]=P[q],l[1]=P[q+1],l[2]=P[q+2],l[3]=P[q+3],n[0]}function I(P,q){return l[3]=P[q],l[2]=P[q+1],l[1]=P[q+2],l[0]=P[q+3],n[0]}s.readFloatLE=o?g:I,s.readFloatBE=o?I:g}():function(){function n(o,c,t,g){var I=c<0?1:0;if(I&&(c=-c),c===0)o(1/c>0?0:2147483648,t,g);else if(isNaN(c))o(2143289344,t,g);else if(c>34028234663852886e22)o((I<<31|2139095040)>>>0,t,g);else if(c<11754943508222875e-54)o((I<<31|Math.round(c/1401298464324817e-60))>>>0,t,g);else{var P=Math.floor(Math.log(c)/Math.LN2),q=Math.round(c*Math.pow(2,-P)*8388608)&8388607;o((I<<31|P+127<<23|q)>>>0,t,g)}}s.writeFloatLE=n.bind(null,o7),s.writeFloatBE=n.bind(null,a7);function l(o,c,t){var g=o(c,t),I=(g>>31)*2+1,P=g>>>23&255,q=g&8388607;return P===255?q?NaN:I*(1/0):P===0?I*1401298464324817e-60*q:I*Math.pow(2,P-150)*(q+8388608)}s.readFloatLE=l.bind(null,s7),s.readFloatBE=l.bind(null,l7)}(),typeof Float64Array<"u"?function(){var n=new Float64Array([-0]),l=new Uint8Array(n.buffer),o=l[7]===128;function c(P,q,L){n[0]=P,q[L]=l[0],q[L+1]=l[1],q[L+2]=l[2],q[L+3]=l[3],q[L+4]=l[4],q[L+5]=l[5],q[L+6]=l[6],q[L+7]=l[7]}function t(P,q,L){n[0]=P,q[L]=l[7],q[L+1]=l[6],q[L+2]=l[5],q[L+3]=l[4],q[L+4]=l[3],q[L+5]=l[2],q[L+6]=l[1],q[L+7]=l[0]}s.writeDoubleLE=o?c:t,s.writeDoubleBE=o?t:c;function g(P,q){return l[0]=P[q],l[1]=P[q+1],l[2]=P[q+2],l[3]=P[q+3],l[4]=P[q+4],l[5]=P[q+5],l[6]=P[q+6],l[7]=P[q+7],n[0]}function I(P,q){return l[7]=P[q],l[6]=P[q+1],l[5]=P[q+2],l[4]=P[q+3],l[3]=P[q+4],l[2]=P[q+5],l[1]=P[q+6],l[0]=P[q+7],n[0]}s.readDoubleLE=o?g:I,s.readDoubleBE=o?I:g}():function(){function n(o,c,t,g,I,P){var q=g<0?1:0;if(q&&(g=-g),g===0)o(0,I,P+c),o(1/g>0?0:2147483648,I,P+t);else if(isNaN(g))o(0,I,P+c),o(2146959360,I,P+t);else if(g>17976931348623157e292)o(0,I,P+c),o((q<<31|2146435072)>>>0,I,P+t);else{var L;if(g<22250738585072014e-324)L=g/5e-324,o(L>>>0,I,P+c),o((q<<31|L/4294967296)>>>0,I,P+t);else{var V=Math.floor(Math.log(g)/Math.LN2);V===1024&&(V=1023),L=g*Math.pow(2,-V),o(L*4503599627370496>>>0,I,P+c),o((q<<31|V+1023<<20|L*1048576&1048575)>>>0,I,P+t)}}}s.writeDoubleLE=n.bind(null,o7,0,4),s.writeDoubleBE=n.bind(null,a7,4,0);function l(o,c,t,g,I){var P=o(g,I+c),q=o(g,I+t),L=(q>>31)*2+1,V=q>>>20&2047,oe=4294967296*(q&1048575)+P;return V===2047?oe?NaN:L*(1/0):V===0?L*5e-324*oe:L*Math.pow(2,V-1075)*(oe+4503599627370496)}s.readDoubleLE=l.bind(null,s7,0,4),s.readDoubleBE=l.bind(null,l7,4,0)}(),s}function o7(s,n,l){n[l]=s&255,n[l+1]=s>>>8&255,n[l+2]=s>>>16&255,n[l+3]=s>>>24}function a7(s,n,l){n[l]=s>>>24,n[l+1]=s>>>16&255,n[l+2]=s>>>8&255,n[l+3]=s&255}function s7(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16|s[n+3]<<24)>>>0}function l7(s,n){return(s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3])>>>0}});var h7=M((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(s){}return null}});var f7=M(p7=>{"use strict";var g2=p7;g2.length=function(n){for(var l=0,o=0,c=0;c<n.length;++c)o=n.charCodeAt(c),o<128?l+=1:o<2048?l+=2:(o&64512)===55296&&(n.charCodeAt(c+1)&64512)===56320?(++c,l+=4):l+=3;return l};g2.read=function(n,l,o){var c=o-l;if(c<1)return"";for(var t=null,g=[],I=0,P;l<o;)P=n[l++],P<128?g[I++]=P:P>191&&P<224?g[I++]=(P&31)<<6|n[l++]&63:P>239&&P<365?(P=((P&7)<<18|(n[l++]&63)<<12|(n[l++]&63)<<6|n[l++]&63)-65536,g[I++]=55296+(P>>10),g[I++]=56320+(P&1023)):g[I++]=(P&15)<<12|(n[l++]&63)<<6|n[l++]&63,I>8191&&((t||(t=[])).push(String.fromCharCode.apply(String,g)),I=0);return t?(I&&t.push(String.fromCharCode.apply(String,g.slice(0,I))),t.join("")):String.fromCharCode.apply(String,g.slice(0,I))};g2.write=function(n,l,o){for(var c=o,t,g,I=0;I<n.length;++I)t=n.charCodeAt(I),t<128?l[o++]=t:t<2048?(l[o++]=t>>6|192,l[o++]=t&63|128):(t&64512)===55296&&((g=n.charCodeAt(I+1))&64512)===56320?(t=65536+((t&1023)<<10)+(g&1023),++I,l[o++]=t>>18|240,l[o++]=t>>12&63|128,l[o++]=t>>6&63|128,l[o++]=t&63|128):(l[o++]=t>>12|224,l[o++]=t>>6&63|128,l[o++]=t&63|128);return o-c}});var m7=M((wZe,d7)=>{"use strict";d7.exports=lRe;function lRe(s,n,l){var o=l||8192,c=o>>>1,t=null,g=o;return function(P){if(P<1||P>c)return s(P);g+P>o&&(t=s(o),g=0);var q=n.call(t,g,g+=P);return g&7&&(g=(g|7)+1),q}}});var y7=M((TZe,_7)=>{"use strict";_7.exports=Di;var Fm=yl();function Di(s,n){this.lo=s>>>0,this.hi=n>>>0}var Xu=Di.zero=new Di(0,0);Xu.toNumber=function(){return 0};Xu.zzEncode=Xu.zzDecode=function(){return this};Xu.length=function(){return 1};var uRe=Di.zeroHash="\0\0\0\0\0\0\0\0";Di.fromNumber=function(n){if(n===0)return Xu;var l=n<0;l&&(n=-n);var o=n>>>0,c=(n-o)/4294967296>>>0;return l&&(c=~c>>>0,o=~o>>>0,++o>4294967295&&(o=0,++c>4294967295&&(c=0))),new Di(o,c)};Di.from=function(n){if(typeof n=="number")return Di.fromNumber(n);if(Fm.isString(n))if(Fm.Long)n=Fm.Long.fromString(n);else return Di.fromNumber(parseInt(n,10));return n.low||n.high?new Di(n.low>>>0,n.high>>>0):Xu};Di.prototype.toNumber=function(n){if(!n&&this.hi>>>31){var l=~this.lo+1>>>0,o=~this.hi>>>0;return l||(o=o+1>>>0),-(l+o*4294967296)}return this.lo+this.hi*4294967296};Di.prototype.toLong=function(n){return Fm.Long?new Fm.Long(this.lo|0,this.hi|0,Boolean(n)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(n)}};var _l=String.prototype.charCodeAt;Di.fromHash=function(n){return n===uRe?Xu:new Di((_l.call(n,0)|_l.call(n,1)<<8|_l.call(n,2)<<16|_l.call(n,3)<<24)>>>0,(_l.call(n,4)|_l.call(n,5)<<8|_l.call(n,6)<<16|_l.call(n,7)<<24)>>>0)};Di.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Di.prototype.zzEncode=function(){var n=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^n)>>>0,this.lo=(this.lo<<1^n)>>>0,this};Di.prototype.zzDecode=function(){var n=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^n)>>>0,this.hi=(this.hi>>>1^n)>>>0,this};Di.prototype.length=function(){var n=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,o=this.hi>>>24;return o===0?l===0?n<16384?n<128?1:2:n<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:o<128?9:10}});var yl=M(v2=>{"use strict";var Rt=v2;Rt.asPromise=K$();Rt.base64=t7();Rt.EventEmitter=i7();Rt.float=c7();Rt.inquire=h7();Rt.utf8=f7();Rt.pool=m7();Rt.LongBits=y7();Rt.isNode=Boolean(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Rt.global=Rt.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||v2;Rt.emptyArray=Object.freeze?Object.freeze([]):[];Rt.emptyObject=Object.freeze?Object.freeze({}):{};Rt.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};Rt.isString=function(n){return typeof n=="string"||n instanceof String};Rt.isObject=function(n){return n&&typeof n=="object"};Rt.isset=Rt.isSet=function(n,l){var o=n[l];return o!=null&&n.hasOwnProperty(l)?typeof o!="object"||(Array.isArray(o)?o.length:Object.keys(o).length)>0:!1};Rt.Buffer=function(){try{var s=Rt.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch{return null}}();Rt._Buffer_from=null;Rt._Buffer_allocUnsafe=null;Rt.newBuffer=function(n){return typeof n=="number"?Rt.Buffer?Rt._Buffer_allocUnsafe(n):new Rt.Array(n):Rt.Buffer?Rt._Buffer_from(n):typeof Uint8Array>"u"?n:new Uint8Array(n)};Rt.Array=typeof Uint8Array<"u"?Uint8Array:Array;Rt.Long=Rt.global.dcodeIO&&Rt.global.dcodeIO.Long||Rt.global.Long||Rt.inquire("long");Rt.key2Re=/^true|false|0|1$/;Rt.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Rt.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Rt.longToHash=function(n){return n?Rt.LongBits.from(n).toHash():Rt.LongBits.zeroHash};Rt.longFromHash=function(n,l){var o=Rt.LongBits.fromHash(n);return Rt.Long?Rt.Long.fromBits(o.lo,o.hi,l):o.toNumber(Boolean(l))};function g7(s,n,l){for(var o=Object.keys(n),c=0;c<o.length;++c)(s[o[c]]===void 0||!l)&&(s[o[c]]=n[o[c]]);return s}Rt.merge=g7;Rt.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};function v7(s){function n(l,o){if(!(this instanceof n))return new n(l,o);Object.defineProperty(this,"message",{get:function(){return l}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:new Error().stack||""}),o&&g7(this,o)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get(){return s},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}Rt.newError=v7;Rt.ProtocolError=v7("ProtocolError");Rt.oneOfGetter=function(n){for(var l={},o=0;o<n.length;++o)l[n[o]]=1;return function(){for(var c=Object.keys(this),t=c.length-1;t>-1;--t)if(l[c[t]]===1&&this[c[t]]!==void 0&&this[c[t]]!==null)return c[t]}};Rt.oneOfSetter=function(n){return function(l){for(var o=0;o<n.length;++o)n[o]!==l&&delete this[n[o]]}};Rt.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Rt._configure=function(){var s=Rt.Buffer;if(!s){Rt._Buffer_from=Rt._Buffer_allocUnsafe=null;return}Rt._Buffer_from=s.from!==Uint8Array.from&&s.from||function(l,o){return new s(l,o)},Rt._Buffer_allocUnsafe=s.allocUnsafe||function(l){return new s(l)}}});var I2=M((SZe,T7)=>{"use strict";T7.exports=wr;var uo=yl(),x2,f0=uo.LongBits,x7=uo.base64,b7=uo.utf8;function Nm(s,n,l){this.fn=s,this.len=n,this.next=void 0,this.val=l}function w2(){}function cRe(s){this.head=s.head,this.tail=s.tail,this.len=s.len,this.next=s.states}function wr(){this.len=0,this.head=new Nm(w2,0,0),this.tail=this.head,this.states=null}var w7=function(){return uo.Buffer?function(){return(wr.create=function(){return new x2})()}:function(){return new wr}};wr.create=w7();wr.alloc=function(n){return new uo.Array(n)};uo.Array!==Array&&(wr.alloc=uo.pool(wr.alloc,uo.Array.prototype.subarray));wr.prototype._push=function(n,l,o){return this.tail=this.tail.next=new Nm(n,l,o),this.len+=l,this};function T2(s,n,l){n[l]=s&255}function hRe(s,n,l){for(;s>127;)n[l++]=s&127|128,s>>>=7;n[l]=s}function E2(s,n){this.len=s,this.next=void 0,this.val=n}E2.prototype=Object.create(Nm.prototype);E2.prototype.fn=hRe;wr.prototype.uint32=function(n){return this.len+=(this.tail=this.tail.next=new E2((n=n>>>0)<128?1:n<16384?2:n<2097152?3:n<268435456?4:5,n)).len,this};wr.prototype.int32=function(n){return n<0?this._push(S2,10,f0.fromNumber(n)):this.uint32(n)};wr.prototype.sint32=function(n){return this.uint32((n<<1^n>>31)>>>0)};function S2(s,n,l){for(;s.hi;)n[l++]=s.lo&127|128,s.lo=(s.lo>>>7|s.hi<<25)>>>0,s.hi>>>=7;for(;s.lo>127;)n[l++]=s.lo&127|128,s.lo=s.lo>>>7;n[l++]=s.lo}wr.prototype.uint64=function(n){var l=f0.from(n);return this._push(S2,l.length(),l)};wr.prototype.int64=wr.prototype.uint64;wr.prototype.sint64=function(n){var l=f0.from(n).zzEncode();return this._push(S2,l.length(),l)};wr.prototype.bool=function(n){return this._push(T2,1,n?1:0)};function b2(s,n,l){n[l]=s&255,n[l+1]=s>>>8&255,n[l+2]=s>>>16&255,n[l+3]=s>>>24}wr.prototype.fixed32=function(n){return this._push(b2,4,n>>>0)};wr.prototype.sfixed32=wr.prototype.fixed32;wr.prototype.fixed64=function(n){var l=f0.from(n);return this._push(b2,4,l.lo)._push(b2,4,l.hi)};wr.prototype.sfixed64=wr.prototype.fixed64;wr.prototype.float=function(n){return this._push(uo.float.writeFloatLE,4,n)};wr.prototype.double=function(n){return this._push(uo.float.writeDoubleLE,8,n)};var pRe=uo.Array.prototype.set?function(n,l,o){l.set(n,o)}:function(n,l,o){for(var c=0;c<n.length;++c)l[o+c]=n[c]};wr.prototype.bytes=function(n){var l=n.length>>>0;if(!l)return this._push(T2,1,0);if(uo.isString(n)){var o=wr.alloc(l=x7.length(n));x7.decode(n,o,0),n=o}return this.uint32(l)._push(pRe,l,n)};wr.prototype.string=function(n){var l=b7.length(n);return l?this.uint32(l)._push(b7.write,l,n):this._push(T2,1,0)};wr.prototype.fork=function(){return this.states=new cRe(this),this.head=this.tail=new Nm(w2,0,0),this.len=0,this};wr.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Nm(w2,0,0),this.len=0),this};wr.prototype.ldelim=function(){var n=this.head,l=this.tail,o=this.len;return this.reset().uint32(o),o&&(this.tail.next=n.next,this.tail=l,this.len+=o),this};wr.prototype.finish=function(){for(var n=this.head.next,l=this.constructor.alloc(this.len),o=0;n;)n.fn(n.val,l,o),o+=n.len,n=n.next;return l};wr._configure=function(s){x2=s,wr.create=w7(),x2._configure()}});var I7=M((IZe,S7)=>{"use strict";S7.exports=wa;var E7=I2();(wa.prototype=Object.create(E7.prototype)).constructor=wa;var gl=yl();function wa(){E7.call(this)}wa._configure=function(){wa.alloc=gl._Buffer_allocUnsafe,wa.writeBytesBuffer=gl.Buffer&&gl.Buffer.prototype instanceof Uint8Array&&gl.Buffer.prototype.set.name==="set"?function(n,l,o){l.set(n,o)}:function(n,l,o){if(n.copy)n.copy(l,o,0,n.length);else for(var c=0;c<n.length;)l[o++]=n[c++]}};wa.prototype.bytes=function(n){gl.isString(n)&&(n=gl._Buffer_from(n,"base64"));var l=n.length>>>0;return this.uint32(l),l&&this._push(wa.writeBytesBuffer,l,n),this};function fRe(s,n,l){s.length<40?gl.utf8.write(s,n,l):n.utf8Write?n.utf8Write(s,l):n.write(s,l)}wa.prototype.string=function(n){var l=gl.Buffer.byteLength(n);return this.uint32(l),l&&this._push(fRe,l,n),this};wa._configure()});var C2=M((AZe,M7)=>{"use strict";M7.exports=ui;var Ta=yl(),O2,C7=Ta.LongBits,dRe=Ta.utf8;function Fo(s,n){return RangeError("index out of range: "+s.pos+" + "+(n||1)+" > "+s.len)}function ui(s){this.buf=s,this.pos=0,this.len=s.length}var A7=typeof Uint8Array<"u"?function(n){if(n instanceof Uint8Array||Array.isArray(n))return new ui(n);throw Error("illegal buffer")}:function(n){if(Array.isArray(n))return new ui(n);throw Error("illegal buffer")},P7=function(){return Ta.Buffer?function(l){return(ui.create=function(c){return Ta.Buffer.isBuffer(c)?new O2(c):A7(c)})(l)}:A7};ui.create=P7();ui.prototype._slice=Ta.Array.prototype.subarray||Ta.Array.prototype.slice;ui.prototype.uint32=function(){var n=4294967295;return function(){if(n=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(n=(n|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return n;if((this.pos+=5)>this.len)throw this.pos=this.len,Fo(this,10);return n}}();ui.prototype.int32=function(){return this.uint32()|0};ui.prototype.sint32=function(){var n=this.uint32();return n>>>1^-(n&1)|0};function A2(){var s=new C7(0,0),n=0;if(this.len-this.pos>4){for(;n<4;++n)if(s.lo=(s.lo|(this.buf[this.pos]&127)<<n*7)>>>0,this.buf[this.pos++]<128)return s;if(s.lo=(s.lo|(this.buf[this.pos]&127)<<28)>>>0,s.hi=(s.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return s;n=0}else{for(;n<3;++n){if(this.pos>=this.len)throw Fo(this);if(s.lo=(s.lo|(this.buf[this.pos]&127)<<n*7)>>>0,this.buf[this.pos++]<128)return s}return s.lo=(s.lo|(this.buf[this.pos++]&127)<<n*7)>>>0,s}if(this.len-this.pos>4){for(;n<5;++n)if(s.hi=(s.hi|(this.buf[this.pos]&127)<<n*7+3)>>>0,this.buf[this.pos++]<128)return s}else for(;n<5;++n){if(this.pos>=this.len)throw Fo(this);if(s.hi=(s.hi|(this.buf[this.pos]&127)<<n*7+3)>>>0,this.buf[this.pos++]<128)return s}throw Error("invalid varint encoding")}ui.prototype.bool=function(){return this.uint32()!==0};function d0(s,n){return(s[n-4]|s[n-3]<<8|s[n-2]<<16|s[n-1]<<24)>>>0}ui.prototype.fixed32=function(){if(this.pos+4>this.len)throw Fo(this,4);return d0(this.buf,this.pos+=4)};ui.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Fo(this,4);return d0(this.buf,this.pos+=4)|0};function O7(){if(this.pos+8>this.len)throw Fo(this,8);return new C7(d0(this.buf,this.pos+=4),d0(this.buf,this.pos+=4))}ui.prototype.float=function(){if(this.pos+4>this.len)throw Fo(this,4);var n=Ta.float.readFloatLE(this.buf,this.pos);return this.pos+=4,n};ui.prototype.double=function(){if(this.pos+8>this.len)throw Fo(this,4);var n=Ta.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,n};ui.prototype.bytes=function(){var n=this.uint32(),l=this.pos,o=this.pos+n;if(o>this.len)throw Fo(this,n);return this.pos+=n,Array.isArray(this.buf)?this.buf.slice(l,o):l===o?new this.buf.constructor(0):this._slice.call(this.buf,l,o)};ui.prototype.string=function(){var n=this.bytes();return dRe.read(n,0,n.length)};ui.prototype.skip=function(n){if(typeof n=="number"){if(this.pos+n>this.len)throw Fo(this,n);this.pos+=n}else do if(this.pos>=this.len)throw Fo(this);while(this.buf[this.pos++]&128);return this};ui.prototype.skipType=function(s){switch(s){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(s=this.uint32()&7)!==4;)this.skipType(s);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+s+" at offset "+this.pos)}return this};ui._configure=function(s){O2=s,ui.create=P7(),O2._configure();var n=Ta.Long?"toLong":"toNumber";Ta.merge(ui.prototype,{int64:function(){return A2.call(this)[n](!1)},uint64:function(){return A2.call(this)[n](!0)},sint64:function(){return A2.call(this).zzDecode()[n](!1)},fixed64:function(){return O7.call(this)[n](!0)},sfixed64:function(){return O7.call(this)[n](!1)}})}});var L7=M((OZe,D7)=>{"use strict";D7.exports=Yu;var R7=C2();(Yu.prototype=Object.create(R7.prototype)).constructor=Yu;var q7=yl();function Yu(s){R7.call(this,s)}Yu._configure=function(){q7.Buffer&&(Yu.prototype._slice=q7.Buffer.prototype.slice)};Yu.prototype.string=function(){var n=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+n,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+n,this.len))};Yu._configure()});var z7=M((CZe,k7)=>{"use strict";k7.exports=Um;var P2=yl();(Um.prototype=Object.create(P2.EventEmitter.prototype)).constructor=Um;function Um(s,n,l){if(typeof s!="function")throw TypeError("rpcImpl must be a function");P2.EventEmitter.call(this),this.rpcImpl=s,this.requestDelimited=Boolean(n),this.responseDelimited=Boolean(l)}Um.prototype.rpcCall=function s(n,l,o,c,t){if(!c)throw TypeError("request must be specified");var g=this;if(!t)return P2.asPromise(s,g,n,l,o,c);if(!g.rpcImpl){setTimeout(function(){t(Error("already ended"))},0);return}try{return g.rpcImpl(n,l[g.requestDelimited?"encodeDelimited":"encode"](c).finish(),function(P,q){if(P)return g.emit("error",P,n),t(P);if(q===null){g.end(!0);return}if(!(q instanceof o))try{q=o[g.responseDelimited?"decodeDelimited":"decode"](q)}catch(L){return g.emit("error",L,n),t(L)}return g.emit("data",q,n),t(null,q)})}catch(I){g.emit("error",I,n),setTimeout(function(){t(I)},0);return}};Um.prototype.end=function(n){return this.rpcImpl&&(n||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var F7=M(B7=>{"use strict";var mRe=B7;mRe.Service=z7()});var U7=M((MZe,N7)=>{"use strict";N7.exports={}});var G7=M(V7=>{"use strict";var Pn=V7;Pn.build="minimal";Pn.Writer=I2();Pn.BufferWriter=I7();Pn.Reader=C2();Pn.BufferReader=L7();Pn.util=yl();Pn.rpc=F7();Pn.roots=U7();Pn.configure=j7;function j7(){Pn.util._configure(),Pn.Writer._configure(Pn.BufferWriter),Pn.Reader._configure(Pn.BufferReader)}j7()});var W7=M((RZe,$7)=>{"use strict";$7.exports=G7()});var H7=M((DZe,Z7)=>{"use strict";var Wr=W7(),mt=Wr.Reader,ci=Wr.Writer,Ve=Wr.util,ue=Wr.roots.default||(Wr.roots.default={});ue.transit_realtime=function(){var s={};return s.FeedMessage=function(){function n(l){if(this.entity=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.header=null,n.prototype.entity=Ve.emptyArray,n.create=function(o){return new n(o)},n.encode=function(o,c){if(c||(c=ci.create()),ue.transit_realtime.FeedHeader.encode(o.header,c.uint32(10).fork()).ldelim(),o.entity!=null&&o.entity.length)for(var t=0;t<o.entity.length;++t)ue.transit_realtime.FeedEntity.encode(o.entity[t],c.uint32(18).fork()).ldelim();return c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.FeedMessage;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.header=ue.transit_realtime.FeedHeader.decode(o,o.uint32());break}case 2:{g.entity&&g.entity.length||(g.entity=[]),g.entity.push(ue.transit_realtime.FeedEntity.decode(o,o.uint32()));break}default:o.skipType(I&7);break}}if(!g.hasOwnProperty("header"))throw Ve.ProtocolError("missing required 'header'",{instance:g});return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";{var c=ue.transit_realtime.FeedHeader.verify(o.header);if(c)return"header."+c}if(o.entity!=null&&o.hasOwnProperty("entity")){if(!Array.isArray(o.entity))return"entity: array expected";for(var t=0;t<o.entity.length;++t){var c=ue.transit_realtime.FeedEntity.verify(o.entity[t]);if(c)return"entity."+c}}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.FeedMessage)return o;var c=new ue.transit_realtime.FeedMessage;if(o.header!=null){if(typeof o.header!="object")throw TypeError(".transit_realtime.FeedMessage.header: object expected");c.header=ue.transit_realtime.FeedHeader.fromObject(o.header)}if(o.entity){if(!Array.isArray(o.entity))throw TypeError(".transit_realtime.FeedMessage.entity: array expected");c.entity=[];for(var t=0;t<o.entity.length;++t){if(typeof o.entity[t]!="object")throw TypeError(".transit_realtime.FeedMessage.entity: object expected");c.entity[t]=ue.transit_realtime.FeedEntity.fromObject(o.entity[t])}}return c},n.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.entity=[]),c.defaults&&(t.header=null),o.header!=null&&o.hasOwnProperty("header")&&(t.header=ue.transit_realtime.FeedHeader.toObject(o.header,c)),o.entity&&o.entity.length){t.entity=[];for(var g=0;g<o.entity.length;++g)t.entity[g]=ue.transit_realtime.FeedEntity.toObject(o.entity[g],c)}return t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.FeedMessage"},n}(),s.FeedHeader=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.gtfs_realtime_version="",n.prototype.incrementality=0,n.prototype.timestamp=Ve.Long?Ve.Long.fromBits(0,0,!0):0,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),c.uint32(10).string(o.gtfs_realtime_version),o.incrementality!=null&&Object.hasOwnProperty.call(o,"incrementality")&&c.uint32(16).int32(o.incrementality),o.timestamp!=null&&Object.hasOwnProperty.call(o,"timestamp")&&c.uint32(24).uint64(o.timestamp),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.FeedHeader;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.gtfs_realtime_version=o.string();break}case 2:{g.incrementality=o.int32();break}case 3:{g.timestamp=o.uint64();break}default:o.skipType(I&7);break}}if(!g.hasOwnProperty("gtfs_realtime_version"))throw Ve.ProtocolError("missing required 'gtfs_realtime_version'",{instance:g});return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(!Ve.isString(o.gtfs_realtime_version))return"gtfs_realtime_version: string expected";if(o.incrementality!=null&&o.hasOwnProperty("incrementality"))switch(o.incrementality){default:return"incrementality: enum value expected";case 0:case 1:break}return o.timestamp!=null&&o.hasOwnProperty("timestamp")&&!Ve.isInteger(o.timestamp)&&!(o.timestamp&&Ve.isInteger(o.timestamp.low)&&Ve.isInteger(o.timestamp.high))?"timestamp: integer|Long expected":null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.FeedHeader)return o;var c=new ue.transit_realtime.FeedHeader;switch(o.gtfs_realtime_version!=null&&(c.gtfs_realtime_version=String(o.gtfs_realtime_version)),o.incrementality){default:if(typeof o.incrementality=="number"){c.incrementality=o.incrementality;break}break;case"FULL_DATASET":case 0:c.incrementality=0;break;case"DIFFERENTIAL":case 1:c.incrementality=1;break}return o.timestamp!=null&&(Ve.Long?(c.timestamp=Ve.Long.fromValue(o.timestamp)).unsigned=!0:typeof o.timestamp=="string"?c.timestamp=parseInt(o.timestamp,10):typeof o.timestamp=="number"?c.timestamp=o.timestamp:typeof o.timestamp=="object"&&(c.timestamp=new Ve.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0))),c},n.toObject=function(o,c){c||(c={});var t={};if(c.defaults)if(t.gtfs_realtime_version="",t.incrementality=c.enums===String?"FULL_DATASET":0,Ve.Long){var g=new Ve.Long(0,0,!0);t.timestamp=c.longs===String?g.toString():c.longs===Number?g.toNumber():g}else t.timestamp=c.longs===String?"0":0;return o.gtfs_realtime_version!=null&&o.hasOwnProperty("gtfs_realtime_version")&&(t.gtfs_realtime_version=o.gtfs_realtime_version),o.incrementality!=null&&o.hasOwnProperty("incrementality")&&(t.incrementality=c.enums===String?ue.transit_realtime.FeedHeader.Incrementality[o.incrementality]===void 0?o.incrementality:ue.transit_realtime.FeedHeader.Incrementality[o.incrementality]:o.incrementality),o.timestamp!=null&&o.hasOwnProperty("timestamp")&&(typeof o.timestamp=="number"?t.timestamp=c.longs===String?String(o.timestamp):o.timestamp:t.timestamp=c.longs===String?Ve.Long.prototype.toString.call(o.timestamp):c.longs===Number?new Ve.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0):o.timestamp),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.FeedHeader"},n.Incrementality=function(){var l={},o=Object.create(l);return o[l[0]="FULL_DATASET"]=0,o[l[1]="DIFFERENTIAL"]=1,o}(),n}(),s.FeedEntity=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.id="",n.prototype.is_deleted=!1,n.prototype.trip_update=null,n.prototype.vehicle=null,n.prototype.alert=null,n.prototype.shape=null,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),c.uint32(10).string(o.id),o.is_deleted!=null&&Object.hasOwnProperty.call(o,"is_deleted")&&c.uint32(16).bool(o.is_deleted),o.trip_update!=null&&Object.hasOwnProperty.call(o,"trip_update")&&ue.transit_realtime.TripUpdate.encode(o.trip_update,c.uint32(26).fork()).ldelim(),o.vehicle!=null&&Object.hasOwnProperty.call(o,"vehicle")&&ue.transit_realtime.VehiclePosition.encode(o.vehicle,c.uint32(34).fork()).ldelim(),o.alert!=null&&Object.hasOwnProperty.call(o,"alert")&&ue.transit_realtime.Alert.encode(o.alert,c.uint32(42).fork()).ldelim(),o.shape!=null&&Object.hasOwnProperty.call(o,"shape")&&ue.transit_realtime.Shape.encode(o.shape,c.uint32(50).fork()).ldelim(),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.FeedEntity;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.id=o.string();break}case 2:{g.is_deleted=o.bool();break}case 3:{g.trip_update=ue.transit_realtime.TripUpdate.decode(o,o.uint32());break}case 4:{g.vehicle=ue.transit_realtime.VehiclePosition.decode(o,o.uint32());break}case 5:{g.alert=ue.transit_realtime.Alert.decode(o,o.uint32());break}case 6:{g.shape=ue.transit_realtime.Shape.decode(o,o.uint32());break}default:o.skipType(I&7);break}}if(!g.hasOwnProperty("id"))throw Ve.ProtocolError("missing required 'id'",{instance:g});return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(!Ve.isString(o.id))return"id: string expected";if(o.is_deleted!=null&&o.hasOwnProperty("is_deleted")&&typeof o.is_deleted!="boolean")return"is_deleted: boolean expected";if(o.trip_update!=null&&o.hasOwnProperty("trip_update")){var c=ue.transit_realtime.TripUpdate.verify(o.trip_update);if(c)return"trip_update."+c}if(o.vehicle!=null&&o.hasOwnProperty("vehicle")){var c=ue.transit_realtime.VehiclePosition.verify(o.vehicle);if(c)return"vehicle."+c}if(o.alert!=null&&o.hasOwnProperty("alert")){var c=ue.transit_realtime.Alert.verify(o.alert);if(c)return"alert."+c}if(o.shape!=null&&o.hasOwnProperty("shape")){var c=ue.transit_realtime.Shape.verify(o.shape);if(c)return"shape."+c}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.FeedEntity)return o;var c=new ue.transit_realtime.FeedEntity;if(o.id!=null&&(c.id=String(o.id)),o.is_deleted!=null&&(c.is_deleted=Boolean(o.is_deleted)),o.trip_update!=null){if(typeof o.trip_update!="object")throw TypeError(".transit_realtime.FeedEntity.trip_update: object expected");c.trip_update=ue.transit_realtime.TripUpdate.fromObject(o.trip_update)}if(o.vehicle!=null){if(typeof o.vehicle!="object")throw TypeError(".transit_realtime.FeedEntity.vehicle: object expected");c.vehicle=ue.transit_realtime.VehiclePosition.fromObject(o.vehicle)}if(o.alert!=null){if(typeof o.alert!="object")throw TypeError(".transit_realtime.FeedEntity.alert: object expected");c.alert=ue.transit_realtime.Alert.fromObject(o.alert)}if(o.shape!=null){if(typeof o.shape!="object")throw TypeError(".transit_realtime.FeedEntity.shape: object expected");c.shape=ue.transit_realtime.Shape.fromObject(o.shape)}return c},n.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.id="",t.is_deleted=!1,t.trip_update=null,t.vehicle=null,t.alert=null,t.shape=null),o.id!=null&&o.hasOwnProperty("id")&&(t.id=o.id),o.is_deleted!=null&&o.hasOwnProperty("is_deleted")&&(t.is_deleted=o.is_deleted),o.trip_update!=null&&o.hasOwnProperty("trip_update")&&(t.trip_update=ue.transit_realtime.TripUpdate.toObject(o.trip_update,c)),o.vehicle!=null&&o.hasOwnProperty("vehicle")&&(t.vehicle=ue.transit_realtime.VehiclePosition.toObject(o.vehicle,c)),o.alert!=null&&o.hasOwnProperty("alert")&&(t.alert=ue.transit_realtime.Alert.toObject(o.alert,c)),o.shape!=null&&o.hasOwnProperty("shape")&&(t.shape=ue.transit_realtime.Shape.toObject(o.shape,c)),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.FeedEntity"},n}(),s.TripUpdate=function(){function n(l){if(this.stop_time_update=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.trip=null,n.prototype.vehicle=null,n.prototype.stop_time_update=Ve.emptyArray,n.prototype.timestamp=Ve.Long?Ve.Long.fromBits(0,0,!0):0,n.prototype.delay=0,n.prototype.trip_properties=null,n.create=function(o){return new n(o)},n.encode=function(o,c){if(c||(c=ci.create()),ue.transit_realtime.TripDescriptor.encode(o.trip,c.uint32(10).fork()).ldelim(),o.stop_time_update!=null&&o.stop_time_update.length)for(var t=0;t<o.stop_time_update.length;++t)ue.transit_realtime.TripUpdate.StopTimeUpdate.encode(o.stop_time_update[t],c.uint32(18).fork()).ldelim();return o.vehicle!=null&&Object.hasOwnProperty.call(o,"vehicle")&&ue.transit_realtime.VehicleDescriptor.encode(o.vehicle,c.uint32(26).fork()).ldelim(),o.timestamp!=null&&Object.hasOwnProperty.call(o,"timestamp")&&c.uint32(32).uint64(o.timestamp),o.delay!=null&&Object.hasOwnProperty.call(o,"delay")&&c.uint32(40).int32(o.delay),o.trip_properties!=null&&Object.hasOwnProperty.call(o,"trip_properties")&&ue.transit_realtime.TripUpdate.TripProperties.encode(o.trip_properties,c.uint32(50).fork()).ldelim(),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.TripUpdate;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.trip=ue.transit_realtime.TripDescriptor.decode(o,o.uint32());break}case 3:{g.vehicle=ue.transit_realtime.VehicleDescriptor.decode(o,o.uint32());break}case 2:{g.stop_time_update&&g.stop_time_update.length||(g.stop_time_update=[]),g.stop_time_update.push(ue.transit_realtime.TripUpdate.StopTimeUpdate.decode(o,o.uint32()));break}case 4:{g.timestamp=o.uint64();break}case 5:{g.delay=o.int32();break}case 6:{g.trip_properties=ue.transit_realtime.TripUpdate.TripProperties.decode(o,o.uint32());break}default:o.skipType(I&7);break}}if(!g.hasOwnProperty("trip"))throw Ve.ProtocolError("missing required 'trip'",{instance:g});return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";{var c=ue.transit_realtime.TripDescriptor.verify(o.trip);if(c)return"trip."+c}if(o.vehicle!=null&&o.hasOwnProperty("vehicle")){var c=ue.transit_realtime.VehicleDescriptor.verify(o.vehicle);if(c)return"vehicle."+c}if(o.stop_time_update!=null&&o.hasOwnProperty("stop_time_update")){if(!Array.isArray(o.stop_time_update))return"stop_time_update: array expected";for(var t=0;t<o.stop_time_update.length;++t){var c=ue.transit_realtime.TripUpdate.StopTimeUpdate.verify(o.stop_time_update[t]);if(c)return"stop_time_update."+c}}if(o.timestamp!=null&&o.hasOwnProperty("timestamp")&&!Ve.isInteger(o.timestamp)&&!(o.timestamp&&Ve.isInteger(o.timestamp.low)&&Ve.isInteger(o.timestamp.high)))return"timestamp: integer|Long expected";if(o.delay!=null&&o.hasOwnProperty("delay")&&!Ve.isInteger(o.delay))return"delay: integer expected";if(o.trip_properties!=null&&o.hasOwnProperty("trip_properties")){var c=ue.transit_realtime.TripUpdate.TripProperties.verify(o.trip_properties);if(c)return"trip_properties."+c}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.TripUpdate)return o;var c=new ue.transit_realtime.TripUpdate;if(o.trip!=null){if(typeof o.trip!="object")throw TypeError(".transit_realtime.TripUpdate.trip: object expected");c.trip=ue.transit_realtime.TripDescriptor.fromObject(o.trip)}if(o.vehicle!=null){if(typeof o.vehicle!="object")throw TypeError(".transit_realtime.TripUpdate.vehicle: object expected");c.vehicle=ue.transit_realtime.VehicleDescriptor.fromObject(o.vehicle)}if(o.stop_time_update){if(!Array.isArray(o.stop_time_update))throw TypeError(".transit_realtime.TripUpdate.stop_time_update: array expected");c.stop_time_update=[];for(var t=0;t<o.stop_time_update.length;++t){if(typeof o.stop_time_update[t]!="object")throw TypeError(".transit_realtime.TripUpdate.stop_time_update: object expected");c.stop_time_update[t]=ue.transit_realtime.TripUpdate.StopTimeUpdate.fromObject(o.stop_time_update[t])}}if(o.timestamp!=null&&(Ve.Long?(c.timestamp=Ve.Long.fromValue(o.timestamp)).unsigned=!0:typeof o.timestamp=="string"?c.timestamp=parseInt(o.timestamp,10):typeof o.timestamp=="number"?c.timestamp=o.timestamp:typeof o.timestamp=="object"&&(c.timestamp=new Ve.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0))),o.delay!=null&&(c.delay=o.delay|0),o.trip_properties!=null){if(typeof o.trip_properties!="object")throw TypeError(".transit_realtime.TripUpdate.trip_properties: object expected");c.trip_properties=ue.transit_realtime.TripUpdate.TripProperties.fromObject(o.trip_properties)}return c},n.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.stop_time_update=[]),c.defaults){if(t.trip=null,t.vehicle=null,Ve.Long){var g=new Ve.Long(0,0,!0);t.timestamp=c.longs===String?g.toString():c.longs===Number?g.toNumber():g}else t.timestamp=c.longs===String?"0":0;t.delay=0,t.trip_properties=null}if(o.trip!=null&&o.hasOwnProperty("trip")&&(t.trip=ue.transit_realtime.TripDescriptor.toObject(o.trip,c)),o.stop_time_update&&o.stop_time_update.length){t.stop_time_update=[];for(var I=0;I<o.stop_time_update.length;++I)t.stop_time_update[I]=ue.transit_realtime.TripUpdate.StopTimeUpdate.toObject(o.stop_time_update[I],c)}return o.vehicle!=null&&o.hasOwnProperty("vehicle")&&(t.vehicle=ue.transit_realtime.VehicleDescriptor.toObject(o.vehicle,c)),o.timestamp!=null&&o.hasOwnProperty("timestamp")&&(typeof o.timestamp=="number"?t.timestamp=c.longs===String?String(o.timestamp):o.timestamp:t.timestamp=c.longs===String?Ve.Long.prototype.toString.call(o.timestamp):c.longs===Number?new Ve.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0):o.timestamp),o.delay!=null&&o.hasOwnProperty("delay")&&(t.delay=o.delay),o.trip_properties!=null&&o.hasOwnProperty("trip_properties")&&(t.trip_properties=ue.transit_realtime.TripUpdate.TripProperties.toObject(o.trip_properties,c)),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TripUpdate"},n.StopTimeEvent=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.delay=0,l.prototype.time=Ve.Long?Ve.Long.fromBits(0,0,!1):0,l.prototype.uncertainty=0,l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=ci.create()),c.delay!=null&&Object.hasOwnProperty.call(c,"delay")&&t.uint32(8).int32(c.delay),c.time!=null&&Object.hasOwnProperty.call(c,"time")&&t.uint32(16).int64(c.time),c.uncertainty!=null&&Object.hasOwnProperty.call(c,"uncertainty")&&t.uint32(24).int32(c.uncertainty),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof mt||(c=mt.create(c));for(var g=t===void 0?c.len:c.pos+t,I=new ue.transit_realtime.TripUpdate.StopTimeEvent;c.pos<g;){var P=c.uint32();switch(P>>>3){case 1:{I.delay=c.int32();break}case 2:{I.time=c.int64();break}case 3:{I.uncertainty=c.int32();break}default:c.skipType(P&7);break}}return I},l.decodeDelimited=function(c){return c instanceof mt||(c=new mt(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":c.delay!=null&&c.hasOwnProperty("delay")&&!Ve.isInteger(c.delay)?"delay: integer expected":c.time!=null&&c.hasOwnProperty("time")&&!Ve.isInteger(c.time)&&!(c.time&&Ve.isInteger(c.time.low)&&Ve.isInteger(c.time.high))?"time: integer|Long expected":c.uncertainty!=null&&c.hasOwnProperty("uncertainty")&&!Ve.isInteger(c.uncertainty)?"uncertainty: integer expected":null},l.fromObject=function(c){if(c instanceof ue.transit_realtime.TripUpdate.StopTimeEvent)return c;var t=new ue.transit_realtime.TripUpdate.StopTimeEvent;return c.delay!=null&&(t.delay=c.delay|0),c.time!=null&&(Ve.Long?(t.time=Ve.Long.fromValue(c.time)).unsigned=!1:typeof c.time=="string"?t.time=parseInt(c.time,10):typeof c.time=="number"?t.time=c.time:typeof c.time=="object"&&(t.time=new Ve.LongBits(c.time.low>>>0,c.time.high>>>0).toNumber())),c.uncertainty!=null&&(t.uncertainty=c.uncertainty|0),t},l.toObject=function(c,t){t||(t={});var g={};if(t.defaults){if(g.delay=0,Ve.Long){var I=new Ve.Long(0,0,!1);g.time=t.longs===String?I.toString():t.longs===Number?I.toNumber():I}else g.time=t.longs===String?"0":0;g.uncertainty=0}return c.delay!=null&&c.hasOwnProperty("delay")&&(g.delay=c.delay),c.time!=null&&c.hasOwnProperty("time")&&(typeof c.time=="number"?g.time=t.longs===String?String(c.time):c.time:g.time=t.longs===String?Ve.Long.prototype.toString.call(c.time):t.longs===Number?new Ve.LongBits(c.time.low>>>0,c.time.high>>>0).toNumber():c.time),c.uncertainty!=null&&c.hasOwnProperty("uncertainty")&&(g.uncertainty=c.uncertainty),g},l.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TripUpdate.StopTimeEvent"},l}(),n.StopTimeUpdate=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.stop_sequence=0,l.prototype.stop_id="",l.prototype.arrival=null,l.prototype.departure=null,l.prototype.departure_occupancy_status=0,l.prototype.schedule_relationship=0,l.prototype.stop_time_properties=null,l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=ci.create()),c.stop_sequence!=null&&Object.hasOwnProperty.call(c,"stop_sequence")&&t.uint32(8).uint32(c.stop_sequence),c.arrival!=null&&Object.hasOwnProperty.call(c,"arrival")&&ue.transit_realtime.TripUpdate.StopTimeEvent.encode(c.arrival,t.uint32(18).fork()).ldelim(),c.departure!=null&&Object.hasOwnProperty.call(c,"departure")&&ue.transit_realtime.TripUpdate.StopTimeEvent.encode(c.departure,t.uint32(26).fork()).ldelim(),c.stop_id!=null&&Object.hasOwnProperty.call(c,"stop_id")&&t.uint32(34).string(c.stop_id),c.schedule_relationship!=null&&Object.hasOwnProperty.call(c,"schedule_relationship")&&t.uint32(40).int32(c.schedule_relationship),c.stop_time_properties!=null&&Object.hasOwnProperty.call(c,"stop_time_properties")&&ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.encode(c.stop_time_properties,t.uint32(50).fork()).ldelim(),c.departure_occupancy_status!=null&&Object.hasOwnProperty.call(c,"departure_occupancy_status")&&t.uint32(56).int32(c.departure_occupancy_status),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof mt||(c=mt.create(c));for(var g=t===void 0?c.len:c.pos+t,I=new ue.transit_realtime.TripUpdate.StopTimeUpdate;c.pos<g;){var P=c.uint32();switch(P>>>3){case 1:{I.stop_sequence=c.uint32();break}case 4:{I.stop_id=c.string();break}case 2:{I.arrival=ue.transit_realtime.TripUpdate.StopTimeEvent.decode(c,c.uint32());break}case 3:{I.departure=ue.transit_realtime.TripUpdate.StopTimeEvent.decode(c,c.uint32());break}case 7:{I.departure_occupancy_status=c.int32();break}case 5:{I.schedule_relationship=c.int32();break}case 6:{I.stop_time_properties=ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.decode(c,c.uint32());break}default:c.skipType(P&7);break}}return I},l.decodeDelimited=function(c){return c instanceof mt||(c=new mt(c)),this.decode(c,c.uint32())},l.verify=function(c){if(typeof c!="object"||c===null)return"object expected";if(c.stop_sequence!=null&&c.hasOwnProperty("stop_sequence")&&!Ve.isInteger(c.stop_sequence))return"stop_sequence: integer expected";if(c.stop_id!=null&&c.hasOwnProperty("stop_id")&&!Ve.isString(c.stop_id))return"stop_id: string expected";if(c.arrival!=null&&c.hasOwnProperty("arrival")){var t=ue.transit_realtime.TripUpdate.StopTimeEvent.verify(c.arrival);if(t)return"arrival."+t}if(c.departure!=null&&c.hasOwnProperty("departure")){var t=ue.transit_realtime.TripUpdate.StopTimeEvent.verify(c.departure);if(t)return"departure."+t}if(c.departure_occupancy_status!=null&&c.hasOwnProperty("departure_occupancy_status"))switch(c.departure_occupancy_status){default:return"departure_occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}if(c.schedule_relationship!=null&&c.hasOwnProperty("schedule_relationship"))switch(c.schedule_relationship){default:return"schedule_relationship: enum value expected";case 0:case 1:case 2:case 3:break}if(c.stop_time_properties!=null&&c.hasOwnProperty("stop_time_properties")){var t=ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.verify(c.stop_time_properties);if(t)return"stop_time_properties."+t}return null},l.fromObject=function(c){if(c instanceof ue.transit_realtime.TripUpdate.StopTimeUpdate)return c;var t=new ue.transit_realtime.TripUpdate.StopTimeUpdate;if(c.stop_sequence!=null&&(t.stop_sequence=c.stop_sequence>>>0),c.stop_id!=null&&(t.stop_id=String(c.stop_id)),c.arrival!=null){if(typeof c.arrival!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.arrival: object expected");t.arrival=ue.transit_realtime.TripUpdate.StopTimeEvent.fromObject(c.arrival)}if(c.departure!=null){if(typeof c.departure!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.departure: object expected");t.departure=ue.transit_realtime.TripUpdate.StopTimeEvent.fromObject(c.departure)}switch(c.departure_occupancy_status){default:if(typeof c.departure_occupancy_status=="number"){t.departure_occupancy_status=c.departure_occupancy_status;break}break;case"EMPTY":case 0:t.departure_occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:t.departure_occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:t.departure_occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:t.departure_occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:t.departure_occupancy_status=4;break;case"FULL":case 5:t.departure_occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:t.departure_occupancy_status=6;break;case"NO_DATA_AVAILABLE":case 7:t.departure_occupancy_status=7;break;case"NOT_BOARDABLE":case 8:t.departure_occupancy_status=8;break}switch(c.schedule_relationship){default:if(typeof c.schedule_relationship=="number"){t.schedule_relationship=c.schedule_relationship;break}break;case"SCHEDULED":case 0:t.schedule_relationship=0;break;case"SKIPPED":case 1:t.schedule_relationship=1;break;case"NO_DATA":case 2:t.schedule_relationship=2;break;case"UNSCHEDULED":case 3:t.schedule_relationship=3;break}if(c.stop_time_properties!=null){if(typeof c.stop_time_properties!="object")throw TypeError(".transit_realtime.TripUpdate.StopTimeUpdate.stop_time_properties: object expected");t.stop_time_properties=ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.fromObject(c.stop_time_properties)}return t},l.toObject=function(c,t){t||(t={});var g={};return t.defaults&&(g.stop_sequence=0,g.arrival=null,g.departure=null,g.stop_id="",g.schedule_relationship=t.enums===String?"SCHEDULED":0,g.stop_time_properties=null,g.departure_occupancy_status=t.enums===String?"EMPTY":0),c.stop_sequence!=null&&c.hasOwnProperty("stop_sequence")&&(g.stop_sequence=c.stop_sequence),c.arrival!=null&&c.hasOwnProperty("arrival")&&(g.arrival=ue.transit_realtime.TripUpdate.StopTimeEvent.toObject(c.arrival,t)),c.departure!=null&&c.hasOwnProperty("departure")&&(g.departure=ue.transit_realtime.TripUpdate.StopTimeEvent.toObject(c.departure,t)),c.stop_id!=null&&c.hasOwnProperty("stop_id")&&(g.stop_id=c.stop_id),c.schedule_relationship!=null&&c.hasOwnProperty("schedule_relationship")&&(g.schedule_relationship=t.enums===String?ue.transit_realtime.TripUpdate.StopTimeUpdate.ScheduleRelationship[c.schedule_relationship]===void 0?c.schedule_relationship:ue.transit_realtime.TripUpdate.StopTimeUpdate.ScheduleRelationship[c.schedule_relationship]:c.schedule_relationship),c.stop_time_properties!=null&&c.hasOwnProperty("stop_time_properties")&&(g.stop_time_properties=ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties.toObject(c.stop_time_properties,t)),c.departure_occupancy_status!=null&&c.hasOwnProperty("departure_occupancy_status")&&(g.departure_occupancy_status=t.enums===String?ue.transit_realtime.VehiclePosition.OccupancyStatus[c.departure_occupancy_status]===void 0?c.departure_occupancy_status:ue.transit_realtime.VehiclePosition.OccupancyStatus[c.departure_occupancy_status]:c.departure_occupancy_status),g},l.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TripUpdate.StopTimeUpdate"},l.ScheduleRelationship=function(){var o={},c=Object.create(o);return c[o[0]="SCHEDULED"]=0,c[o[1]="SKIPPED"]=1,c[o[2]="NO_DATA"]=2,c[o[3]="UNSCHEDULED"]=3,c}(),l.StopTimeProperties=function(){function o(c){if(c)for(var t=Object.keys(c),g=0;g<t.length;++g)c[t[g]]!=null&&(this[t[g]]=c[t[g]])}return o.prototype.assigned_stop_id="",o.create=function(t){return new o(t)},o.encode=function(t,g){return g||(g=ci.create()),t.assigned_stop_id!=null&&Object.hasOwnProperty.call(t,"assigned_stop_id")&&g.uint32(10).string(t.assigned_stop_id),g},o.encodeDelimited=function(t,g){return this.encode(t,g).ldelim()},o.decode=function(t,g){t instanceof mt||(t=mt.create(t));for(var I=g===void 0?t.len:t.pos+g,P=new ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties;t.pos<I;){var q=t.uint32();switch(q>>>3){case 1:{P.assigned_stop_id=t.string();break}default:t.skipType(q&7);break}}return P},o.decodeDelimited=function(t){return t instanceof mt||(t=new mt(t)),this.decode(t,t.uint32())},o.verify=function(t){return typeof t!="object"||t===null?"object expected":t.assigned_stop_id!=null&&t.hasOwnProperty("assigned_stop_id")&&!Ve.isString(t.assigned_stop_id)?"assigned_stop_id: string expected":null},o.fromObject=function(t){if(t instanceof ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties)return t;var g=new ue.transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties;return t.assigned_stop_id!=null&&(g.assigned_stop_id=String(t.assigned_stop_id)),g},o.toObject=function(t,g){g||(g={});var I={};return g.defaults&&(I.assigned_stop_id=""),t.assigned_stop_id!=null&&t.hasOwnProperty("assigned_stop_id")&&(I.assigned_stop_id=t.assigned_stop_id),I},o.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},o.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/transit_realtime.TripUpdate.StopTimeUpdate.StopTimeProperties"},o}(),l}(),n.TripProperties=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.trip_id="",l.prototype.start_date="",l.prototype.start_time="",l.prototype.shape_id="",l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=ci.create()),c.trip_id!=null&&Object.hasOwnProperty.call(c,"trip_id")&&t.uint32(10).string(c.trip_id),c.start_date!=null&&Object.hasOwnProperty.call(c,"start_date")&&t.uint32(18).string(c.start_date),c.start_time!=null&&Object.hasOwnProperty.call(c,"start_time")&&t.uint32(26).string(c.start_time),c.shape_id!=null&&Object.hasOwnProperty.call(c,"shape_id")&&t.uint32(34).string(c.shape_id),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof mt||(c=mt.create(c));for(var g=t===void 0?c.len:c.pos+t,I=new ue.transit_realtime.TripUpdate.TripProperties;c.pos<g;){var P=c.uint32();switch(P>>>3){case 1:{I.trip_id=c.string();break}case 2:{I.start_date=c.string();break}case 3:{I.start_time=c.string();break}case 4:{I.shape_id=c.string();break}default:c.skipType(P&7);break}}return I},l.decodeDelimited=function(c){return c instanceof mt||(c=new mt(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":c.trip_id!=null&&c.hasOwnProperty("trip_id")&&!Ve.isString(c.trip_id)?"trip_id: string expected":c.start_date!=null&&c.hasOwnProperty("start_date")&&!Ve.isString(c.start_date)?"start_date: string expected":c.start_time!=null&&c.hasOwnProperty("start_time")&&!Ve.isString(c.start_time)?"start_time: string expected":c.shape_id!=null&&c.hasOwnProperty("shape_id")&&!Ve.isString(c.shape_id)?"shape_id: string expected":null},l.fromObject=function(c){if(c instanceof ue.transit_realtime.TripUpdate.TripProperties)return c;var t=new ue.transit_realtime.TripUpdate.TripProperties;return c.trip_id!=null&&(t.trip_id=String(c.trip_id)),c.start_date!=null&&(t.start_date=String(c.start_date)),c.start_time!=null&&(t.start_time=String(c.start_time)),c.shape_id!=null&&(t.shape_id=String(c.shape_id)),t},l.toObject=function(c,t){t||(t={});var g={};return t.defaults&&(g.trip_id="",g.start_date="",g.start_time="",g.shape_id=""),c.trip_id!=null&&c.hasOwnProperty("trip_id")&&(g.trip_id=c.trip_id),c.start_date!=null&&c.hasOwnProperty("start_date")&&(g.start_date=c.start_date),c.start_time!=null&&c.hasOwnProperty("start_time")&&(g.start_time=c.start_time),c.shape_id!=null&&c.hasOwnProperty("shape_id")&&(g.shape_id=c.shape_id),g},l.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TripUpdate.TripProperties"},l}(),n}(),s.VehiclePosition=function(){function n(l){if(this.multi_carriage_details=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.trip=null,n.prototype.vehicle=null,n.prototype.position=null,n.prototype.current_stop_sequence=0,n.prototype.stop_id="",n.prototype.current_status=2,n.prototype.timestamp=Ve.Long?Ve.Long.fromBits(0,0,!0):0,n.prototype.congestion_level=0,n.prototype.occupancy_status=0,n.prototype.occupancy_percentage=0,n.prototype.multi_carriage_details=Ve.emptyArray,n.create=function(o){return new n(o)},n.encode=function(o,c){if(c||(c=ci.create()),o.trip!=null&&Object.hasOwnProperty.call(o,"trip")&&ue.transit_realtime.TripDescriptor.encode(o.trip,c.uint32(10).fork()).ldelim(),o.position!=null&&Object.hasOwnProperty.call(o,"position")&&ue.transit_realtime.Position.encode(o.position,c.uint32(18).fork()).ldelim(),o.current_stop_sequence!=null&&Object.hasOwnProperty.call(o,"current_stop_sequence")&&c.uint32(24).uint32(o.current_stop_sequence),o.current_status!=null&&Object.hasOwnProperty.call(o,"current_status")&&c.uint32(32).int32(o.current_status),o.timestamp!=null&&Object.hasOwnProperty.call(o,"timestamp")&&c.uint32(40).uint64(o.timestamp),o.congestion_level!=null&&Object.hasOwnProperty.call(o,"congestion_level")&&c.uint32(48).int32(o.congestion_level),o.stop_id!=null&&Object.hasOwnProperty.call(o,"stop_id")&&c.uint32(58).string(o.stop_id),o.vehicle!=null&&Object.hasOwnProperty.call(o,"vehicle")&&ue.transit_realtime.VehicleDescriptor.encode(o.vehicle,c.uint32(66).fork()).ldelim(),o.occupancy_status!=null&&Object.hasOwnProperty.call(o,"occupancy_status")&&c.uint32(72).int32(o.occupancy_status),o.occupancy_percentage!=null&&Object.hasOwnProperty.call(o,"occupancy_percentage")&&c.uint32(80).uint32(o.occupancy_percentage),o.multi_carriage_details!=null&&o.multi_carriage_details.length)for(var t=0;t<o.multi_carriage_details.length;++t)ue.transit_realtime.VehiclePosition.CarriageDetails.encode(o.multi_carriage_details[t],c.uint32(90).fork()).ldelim();return c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.VehiclePosition;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.trip=ue.transit_realtime.TripDescriptor.decode(o,o.uint32());break}case 8:{g.vehicle=ue.transit_realtime.VehicleDescriptor.decode(o,o.uint32());break}case 2:{g.position=ue.transit_realtime.Position.decode(o,o.uint32());break}case 3:{g.current_stop_sequence=o.uint32();break}case 7:{g.stop_id=o.string();break}case 4:{g.current_status=o.int32();break}case 5:{g.timestamp=o.uint64();break}case 6:{g.congestion_level=o.int32();break}case 9:{g.occupancy_status=o.int32();break}case 10:{g.occupancy_percentage=o.uint32();break}case 11:{g.multi_carriage_details&&g.multi_carriage_details.length||(g.multi_carriage_details=[]),g.multi_carriage_details.push(ue.transit_realtime.VehiclePosition.CarriageDetails.decode(o,o.uint32()));break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.trip!=null&&o.hasOwnProperty("trip")){var c=ue.transit_realtime.TripDescriptor.verify(o.trip);if(c)return"trip."+c}if(o.vehicle!=null&&o.hasOwnProperty("vehicle")){var c=ue.transit_realtime.VehicleDescriptor.verify(o.vehicle);if(c)return"vehicle."+c}if(o.position!=null&&o.hasOwnProperty("position")){var c=ue.transit_realtime.Position.verify(o.position);if(c)return"position."+c}if(o.current_stop_sequence!=null&&o.hasOwnProperty("current_stop_sequence")&&!Ve.isInteger(o.current_stop_sequence))return"current_stop_sequence: integer expected";if(o.stop_id!=null&&o.hasOwnProperty("stop_id")&&!Ve.isString(o.stop_id))return"stop_id: string expected";if(o.current_status!=null&&o.hasOwnProperty("current_status"))switch(o.current_status){default:return"current_status: enum value expected";case 0:case 1:case 2:break}if(o.timestamp!=null&&o.hasOwnProperty("timestamp")&&!Ve.isInteger(o.timestamp)&&!(o.timestamp&&Ve.isInteger(o.timestamp.low)&&Ve.isInteger(o.timestamp.high)))return"timestamp: integer|Long expected";if(o.congestion_level!=null&&o.hasOwnProperty("congestion_level"))switch(o.congestion_level){default:return"congestion_level: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(o.occupancy_status!=null&&o.hasOwnProperty("occupancy_status"))switch(o.occupancy_status){default:return"occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}if(o.occupancy_percentage!=null&&o.hasOwnProperty("occupancy_percentage")&&!Ve.isInteger(o.occupancy_percentage))return"occupancy_percentage: integer expected";if(o.multi_carriage_details!=null&&o.hasOwnProperty("multi_carriage_details")){if(!Array.isArray(o.multi_carriage_details))return"multi_carriage_details: array expected";for(var t=0;t<o.multi_carriage_details.length;++t){var c=ue.transit_realtime.VehiclePosition.CarriageDetails.verify(o.multi_carriage_details[t]);if(c)return"multi_carriage_details."+c}}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.VehiclePosition)return o;var c=new ue.transit_realtime.VehiclePosition;if(o.trip!=null){if(typeof o.trip!="object")throw TypeError(".transit_realtime.VehiclePosition.trip: object expected");c.trip=ue.transit_realtime.TripDescriptor.fromObject(o.trip)}if(o.vehicle!=null){if(typeof o.vehicle!="object")throw TypeError(".transit_realtime.VehiclePosition.vehicle: object expected");c.vehicle=ue.transit_realtime.VehicleDescriptor.fromObject(o.vehicle)}if(o.position!=null){if(typeof o.position!="object")throw TypeError(".transit_realtime.VehiclePosition.position: object expected");c.position=ue.transit_realtime.Position.fromObject(o.position)}switch(o.current_stop_sequence!=null&&(c.current_stop_sequence=o.current_stop_sequence>>>0),o.stop_id!=null&&(c.stop_id=String(o.stop_id)),o.current_status){case"INCOMING_AT":case 0:c.current_status=0;break;case"STOPPED_AT":case 1:c.current_status=1;break;default:if(typeof o.current_status=="number"){c.current_status=o.current_status;break}break;case"IN_TRANSIT_TO":case 2:c.current_status=2;break}switch(o.timestamp!=null&&(Ve.Long?(c.timestamp=Ve.Long.fromValue(o.timestamp)).unsigned=!0:typeof o.timestamp=="string"?c.timestamp=parseInt(o.timestamp,10):typeof o.timestamp=="number"?c.timestamp=o.timestamp:typeof o.timestamp=="object"&&(c.timestamp=new Ve.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0))),o.congestion_level){default:if(typeof o.congestion_level=="number"){c.congestion_level=o.congestion_level;break}break;case"UNKNOWN_CONGESTION_LEVEL":case 0:c.congestion_level=0;break;case"RUNNING_SMOOTHLY":case 1:c.congestion_level=1;break;case"STOP_AND_GO":case 2:c.congestion_level=2;break;case"CONGESTION":case 3:c.congestion_level=3;break;case"SEVERE_CONGESTION":case 4:c.congestion_level=4;break}switch(o.occupancy_status){default:if(typeof o.occupancy_status=="number"){c.occupancy_status=o.occupancy_status;break}break;case"EMPTY":case 0:c.occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:c.occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:c.occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:c.occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:c.occupancy_status=4;break;case"FULL":case 5:c.occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:c.occupancy_status=6;break;case"NO_DATA_AVAILABLE":case 7:c.occupancy_status=7;break;case"NOT_BOARDABLE":case 8:c.occupancy_status=8;break}if(o.occupancy_percentage!=null&&(c.occupancy_percentage=o.occupancy_percentage>>>0),o.multi_carriage_details){if(!Array.isArray(o.multi_carriage_details))throw TypeError(".transit_realtime.VehiclePosition.multi_carriage_details: array expected");c.multi_carriage_details=[];for(var t=0;t<o.multi_carriage_details.length;++t){if(typeof o.multi_carriage_details[t]!="object")throw TypeError(".transit_realtime.VehiclePosition.multi_carriage_details: object expected");c.multi_carriage_details[t]=ue.transit_realtime.VehiclePosition.CarriageDetails.fromObject(o.multi_carriage_details[t])}}return c},n.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.multi_carriage_details=[]),c.defaults){if(t.trip=null,t.position=null,t.current_stop_sequence=0,t.current_status=c.enums===String?"IN_TRANSIT_TO":2,Ve.Long){var g=new Ve.Long(0,0,!0);t.timestamp=c.longs===String?g.toString():c.longs===Number?g.toNumber():g}else t.timestamp=c.longs===String?"0":0;t.congestion_level=c.enums===String?"UNKNOWN_CONGESTION_LEVEL":0,t.stop_id="",t.vehicle=null,t.occupancy_status=c.enums===String?"EMPTY":0,t.occupancy_percentage=0}if(o.trip!=null&&o.hasOwnProperty("trip")&&(t.trip=ue.transit_realtime.TripDescriptor.toObject(o.trip,c)),o.position!=null&&o.hasOwnProperty("position")&&(t.position=ue.transit_realtime.Position.toObject(o.position,c)),o.current_stop_sequence!=null&&o.hasOwnProperty("current_stop_sequence")&&(t.current_stop_sequence=o.current_stop_sequence),o.current_status!=null&&o.hasOwnProperty("current_status")&&(t.current_status=c.enums===String?ue.transit_realtime.VehiclePosition.VehicleStopStatus[o.current_status]===void 0?o.current_status:ue.transit_realtime.VehiclePosition.VehicleStopStatus[o.current_status]:o.current_status),o.timestamp!=null&&o.hasOwnProperty("timestamp")&&(typeof o.timestamp=="number"?t.timestamp=c.longs===String?String(o.timestamp):o.timestamp:t.timestamp=c.longs===String?Ve.Long.prototype.toString.call(o.timestamp):c.longs===Number?new Ve.LongBits(o.timestamp.low>>>0,o.timestamp.high>>>0).toNumber(!0):o.timestamp),o.congestion_level!=null&&o.hasOwnProperty("congestion_level")&&(t.congestion_level=c.enums===String?ue.transit_realtime.VehiclePosition.CongestionLevel[o.congestion_level]===void 0?o.congestion_level:ue.transit_realtime.VehiclePosition.CongestionLevel[o.congestion_level]:o.congestion_level),o.stop_id!=null&&o.hasOwnProperty("stop_id")&&(t.stop_id=o.stop_id),o.vehicle!=null&&o.hasOwnProperty("vehicle")&&(t.vehicle=ue.transit_realtime.VehicleDescriptor.toObject(o.vehicle,c)),o.occupancy_status!=null&&o.hasOwnProperty("occupancy_status")&&(t.occupancy_status=c.enums===String?ue.transit_realtime.VehiclePosition.OccupancyStatus[o.occupancy_status]===void 0?o.occupancy_status:ue.transit_realtime.VehiclePosition.OccupancyStatus[o.occupancy_status]:o.occupancy_status),o.occupancy_percentage!=null&&o.hasOwnProperty("occupancy_percentage")&&(t.occupancy_percentage=o.occupancy_percentage),o.multi_carriage_details&&o.multi_carriage_details.length){t.multi_carriage_details=[];for(var I=0;I<o.multi_carriage_details.length;++I)t.multi_carriage_details[I]=ue.transit_realtime.VehiclePosition.CarriageDetails.toObject(o.multi_carriage_details[I],c)}return t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.VehiclePosition"},n.VehicleStopStatus=function(){var l={},o=Object.create(l);return o[l[0]="INCOMING_AT"]=0,o[l[1]="STOPPED_AT"]=1,o[l[2]="IN_TRANSIT_TO"]=2,o}(),n.CongestionLevel=function(){var l={},o=Object.create(l);return o[l[0]="UNKNOWN_CONGESTION_LEVEL"]=0,o[l[1]="RUNNING_SMOOTHLY"]=1,o[l[2]="STOP_AND_GO"]=2,o[l[3]="CONGESTION"]=3,o[l[4]="SEVERE_CONGESTION"]=4,o}(),n.OccupancyStatus=function(){var l={},o=Object.create(l);return o[l[0]="EMPTY"]=0,o[l[1]="MANY_SEATS_AVAILABLE"]=1,o[l[2]="FEW_SEATS_AVAILABLE"]=2,o[l[3]="STANDING_ROOM_ONLY"]=3,o[l[4]="CRUSHED_STANDING_ROOM_ONLY"]=4,o[l[5]="FULL"]=5,o[l[6]="NOT_ACCEPTING_PASSENGERS"]=6,o[l[7]="NO_DATA_AVAILABLE"]=7,o[l[8]="NOT_BOARDABLE"]=8,o}(),n.CarriageDetails=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.id="",l.prototype.label="",l.prototype.occupancy_status=7,l.prototype.occupancy_percentage=-1,l.prototype.carriage_sequence=0,l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=ci.create()),c.id!=null&&Object.hasOwnProperty.call(c,"id")&&t.uint32(10).string(c.id),c.label!=null&&Object.hasOwnProperty.call(c,"label")&&t.uint32(18).string(c.label),c.occupancy_status!=null&&Object.hasOwnProperty.call(c,"occupancy_status")&&t.uint32(24).int32(c.occupancy_status),c.occupancy_percentage!=null&&Object.hasOwnProperty.call(c,"occupancy_percentage")&&t.uint32(32).int32(c.occupancy_percentage),c.carriage_sequence!=null&&Object.hasOwnProperty.call(c,"carriage_sequence")&&t.uint32(40).uint32(c.carriage_sequence),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof mt||(c=mt.create(c));for(var g=t===void 0?c.len:c.pos+t,I=new ue.transit_realtime.VehiclePosition.CarriageDetails;c.pos<g;){var P=c.uint32();switch(P>>>3){case 1:{I.id=c.string();break}case 2:{I.label=c.string();break}case 3:{I.occupancy_status=c.int32();break}case 4:{I.occupancy_percentage=c.int32();break}case 5:{I.carriage_sequence=c.uint32();break}default:c.skipType(P&7);break}}return I},l.decodeDelimited=function(c){return c instanceof mt||(c=new mt(c)),this.decode(c,c.uint32())},l.verify=function(c){if(typeof c!="object"||c===null)return"object expected";if(c.id!=null&&c.hasOwnProperty("id")&&!Ve.isString(c.id))return"id: string expected";if(c.label!=null&&c.hasOwnProperty("label")&&!Ve.isString(c.label))return"label: string expected";if(c.occupancy_status!=null&&c.hasOwnProperty("occupancy_status"))switch(c.occupancy_status){default:return"occupancy_status: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:break}return c.occupancy_percentage!=null&&c.hasOwnProperty("occupancy_percentage")&&!Ve.isInteger(c.occupancy_percentage)?"occupancy_percentage: integer expected":c.carriage_sequence!=null&&c.hasOwnProperty("carriage_sequence")&&!Ve.isInteger(c.carriage_sequence)?"carriage_sequence: integer expected":null},l.fromObject=function(c){if(c instanceof ue.transit_realtime.VehiclePosition.CarriageDetails)return c;var t=new ue.transit_realtime.VehiclePosition.CarriageDetails;switch(c.id!=null&&(t.id=String(c.id)),c.label!=null&&(t.label=String(c.label)),c.occupancy_status){case"EMPTY":case 0:t.occupancy_status=0;break;case"MANY_SEATS_AVAILABLE":case 1:t.occupancy_status=1;break;case"FEW_SEATS_AVAILABLE":case 2:t.occupancy_status=2;break;case"STANDING_ROOM_ONLY":case 3:t.occupancy_status=3;break;case"CRUSHED_STANDING_ROOM_ONLY":case 4:t.occupancy_status=4;break;case"FULL":case 5:t.occupancy_status=5;break;case"NOT_ACCEPTING_PASSENGERS":case 6:t.occupancy_status=6;break;default:if(typeof c.occupancy_status=="number"){t.occupancy_status=c.occupancy_status;break}break;case"NO_DATA_AVAILABLE":case 7:t.occupancy_status=7;break;case"NOT_BOARDABLE":case 8:t.occupancy_status=8;break}return c.occupancy_percentage!=null&&(t.occupancy_percentage=c.occupancy_percentage|0),c.carriage_sequence!=null&&(t.carriage_sequence=c.carriage_sequence>>>0),t},l.toObject=function(c,t){t||(t={});var g={};return t.defaults&&(g.id="",g.label="",g.occupancy_status=t.enums===String?"NO_DATA_AVAILABLE":7,g.occupancy_percentage=-1,g.carriage_sequence=0),c.id!=null&&c.hasOwnProperty("id")&&(g.id=c.id),c.label!=null&&c.hasOwnProperty("label")&&(g.label=c.label),c.occupancy_status!=null&&c.hasOwnProperty("occupancy_status")&&(g.occupancy_status=t.enums===String?ue.transit_realtime.VehiclePosition.OccupancyStatus[c.occupancy_status]===void 0?c.occupancy_status:ue.transit_realtime.VehiclePosition.OccupancyStatus[c.occupancy_status]:c.occupancy_status),c.occupancy_percentage!=null&&c.hasOwnProperty("occupancy_percentage")&&(g.occupancy_percentage=c.occupancy_percentage),c.carriage_sequence!=null&&c.hasOwnProperty("carriage_sequence")&&(g.carriage_sequence=c.carriage_sequence),g},l.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.VehiclePosition.CarriageDetails"},l}(),n}(),s.Alert=function(){function n(l){if(this.active_period=[],this.informed_entity=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.active_period=Ve.emptyArray,n.prototype.informed_entity=Ve.emptyArray,n.prototype.cause=1,n.prototype.effect=8,n.prototype.url=null,n.prototype.header_text=null,n.prototype.description_text=null,n.prototype.tts_header_text=null,n.prototype.tts_description_text=null,n.prototype.severity_level=1,n.prototype.image=null,n.prototype.image_alternative_text=null,n.prototype.cause_detail=null,n.prototype.effect_detail=null,n.create=function(o){return new n(o)},n.encode=function(o,c){if(c||(c=ci.create()),o.active_period!=null&&o.active_period.length)for(var t=0;t<o.active_period.length;++t)ue.transit_realtime.TimeRange.encode(o.active_period[t],c.uint32(10).fork()).ldelim();if(o.informed_entity!=null&&o.informed_entity.length)for(var t=0;t<o.informed_entity.length;++t)ue.transit_realtime.EntitySelector.encode(o.informed_entity[t],c.uint32(42).fork()).ldelim();return o.cause!=null&&Object.hasOwnProperty.call(o,"cause")&&c.uint32(48).int32(o.cause),o.effect!=null&&Object.hasOwnProperty.call(o,"effect")&&c.uint32(56).int32(o.effect),o.url!=null&&Object.hasOwnProperty.call(o,"url")&&ue.transit_realtime.TranslatedString.encode(o.url,c.uint32(66).fork()).ldelim(),o.header_text!=null&&Object.hasOwnProperty.call(o,"header_text")&&ue.transit_realtime.TranslatedString.encode(o.header_text,c.uint32(82).fork()).ldelim(),o.description_text!=null&&Object.hasOwnProperty.call(o,"description_text")&&ue.transit_realtime.TranslatedString.encode(o.description_text,c.uint32(90).fork()).ldelim(),o.tts_header_text!=null&&Object.hasOwnProperty.call(o,"tts_header_text")&&ue.transit_realtime.TranslatedString.encode(o.tts_header_text,c.uint32(98).fork()).ldelim(),o.tts_description_text!=null&&Object.hasOwnProperty.call(o,"tts_description_text")&&ue.transit_realtime.TranslatedString.encode(o.tts_description_text,c.uint32(106).fork()).ldelim(),o.severity_level!=null&&Object.hasOwnProperty.call(o,"severity_level")&&c.uint32(112).int32(o.severity_level),o.image!=null&&Object.hasOwnProperty.call(o,"image")&&ue.transit_realtime.TranslatedImage.encode(o.image,c.uint32(122).fork()).ldelim(),o.image_alternative_text!=null&&Object.hasOwnProperty.call(o,"image_alternative_text")&&ue.transit_realtime.TranslatedString.encode(o.image_alternative_text,c.uint32(130).fork()).ldelim(),o.cause_detail!=null&&Object.hasOwnProperty.call(o,"cause_detail")&&ue.transit_realtime.TranslatedString.encode(o.cause_detail,c.uint32(138).fork()).ldelim(),o.effect_detail!=null&&Object.hasOwnProperty.call(o,"effect_detail")&&ue.transit_realtime.TranslatedString.encode(o.effect_detail,c.uint32(146).fork()).ldelim(),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.Alert;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.active_period&&g.active_period.length||(g.active_period=[]),g.active_period.push(ue.transit_realtime.TimeRange.decode(o,o.uint32()));break}case 5:{g.informed_entity&&g.informed_entity.length||(g.informed_entity=[]),g.informed_entity.push(ue.transit_realtime.EntitySelector.decode(o,o.uint32()));break}case 6:{g.cause=o.int32();break}case 7:{g.effect=o.int32();break}case 8:{g.url=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 10:{g.header_text=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 11:{g.description_text=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 12:{g.tts_header_text=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 13:{g.tts_description_text=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 14:{g.severity_level=o.int32();break}case 15:{g.image=ue.transit_realtime.TranslatedImage.decode(o,o.uint32());break}case 16:{g.image_alternative_text=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 17:{g.cause_detail=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}case 18:{g.effect_detail=ue.transit_realtime.TranslatedString.decode(o,o.uint32());break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.active_period!=null&&o.hasOwnProperty("active_period")){if(!Array.isArray(o.active_period))return"active_period: array expected";for(var c=0;c<o.active_period.length;++c){var t=ue.transit_realtime.TimeRange.verify(o.active_period[c]);if(t)return"active_period."+t}}if(o.informed_entity!=null&&o.hasOwnProperty("informed_entity")){if(!Array.isArray(o.informed_entity))return"informed_entity: array expected";for(var c=0;c<o.informed_entity.length;++c){var t=ue.transit_realtime.EntitySelector.verify(o.informed_entity[c]);if(t)return"informed_entity."+t}}if(o.cause!=null&&o.hasOwnProperty("cause"))switch(o.cause){default:return"cause: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:break}if(o.effect!=null&&o.hasOwnProperty("effect"))switch(o.effect){default:return"effect: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:break}if(o.url!=null&&o.hasOwnProperty("url")){var t=ue.transit_realtime.TranslatedString.verify(o.url);if(t)return"url."+t}if(o.header_text!=null&&o.hasOwnProperty("header_text")){var t=ue.transit_realtime.TranslatedString.verify(o.header_text);if(t)return"header_text."+t}if(o.description_text!=null&&o.hasOwnProperty("description_text")){var t=ue.transit_realtime.TranslatedString.verify(o.description_text);if(t)return"description_text."+t}if(o.tts_header_text!=null&&o.hasOwnProperty("tts_header_text")){var t=ue.transit_realtime.TranslatedString.verify(o.tts_header_text);if(t)return"tts_header_text."+t}if(o.tts_description_text!=null&&o.hasOwnProperty("tts_description_text")){var t=ue.transit_realtime.TranslatedString.verify(o.tts_description_text);if(t)return"tts_description_text."+t}if(o.severity_level!=null&&o.hasOwnProperty("severity_level"))switch(o.severity_level){default:return"severity_level: enum value expected";case 1:case 2:case 3:case 4:break}if(o.image!=null&&o.hasOwnProperty("image")){var t=ue.transit_realtime.TranslatedImage.verify(o.image);if(t)return"image."+t}if(o.image_alternative_text!=null&&o.hasOwnProperty("image_alternative_text")){var t=ue.transit_realtime.TranslatedString.verify(o.image_alternative_text);if(t)return"image_alternative_text."+t}if(o.cause_detail!=null&&o.hasOwnProperty("cause_detail")){var t=ue.transit_realtime.TranslatedString.verify(o.cause_detail);if(t)return"cause_detail."+t}if(o.effect_detail!=null&&o.hasOwnProperty("effect_detail")){var t=ue.transit_realtime.TranslatedString.verify(o.effect_detail);if(t)return"effect_detail."+t}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.Alert)return o;var c=new ue.transit_realtime.Alert;if(o.active_period){if(!Array.isArray(o.active_period))throw TypeError(".transit_realtime.Alert.active_period: array expected");c.active_period=[];for(var t=0;t<o.active_period.length;++t){if(typeof o.active_period[t]!="object")throw TypeError(".transit_realtime.Alert.active_period: object expected");c.active_period[t]=ue.transit_realtime.TimeRange.fromObject(o.active_period[t])}}if(o.informed_entity){if(!Array.isArray(o.informed_entity))throw TypeError(".transit_realtime.Alert.informed_entity: array expected");c.informed_entity=[];for(var t=0;t<o.informed_entity.length;++t){if(typeof o.informed_entity[t]!="object")throw TypeError(".transit_realtime.Alert.informed_entity: object expected");c.informed_entity[t]=ue.transit_realtime.EntitySelector.fromObject(o.informed_entity[t])}}switch(o.cause){default:if(typeof o.cause=="number"){c.cause=o.cause;break}break;case"UNKNOWN_CAUSE":case 1:c.cause=1;break;case"OTHER_CAUSE":case 2:c.cause=2;break;case"TECHNICAL_PROBLEM":case 3:c.cause=3;break;case"STRIKE":case 4:c.cause=4;break;case"DEMONSTRATION":case 5:c.cause=5;break;case"ACCIDENT":case 6:c.cause=6;break;case"HOLIDAY":case 7:c.cause=7;break;case"WEATHER":case 8:c.cause=8;break;case"MAINTENANCE":case 9:c.cause=9;break;case"CONSTRUCTION":case 10:c.cause=10;break;case"POLICE_ACTIVITY":case 11:c.cause=11;break;case"MEDICAL_EMERGENCY":case 12:c.cause=12;break}switch(o.effect){case"NO_SERVICE":case 1:c.effect=1;break;case"REDUCED_SERVICE":case 2:c.effect=2;break;case"SIGNIFICANT_DELAYS":case 3:c.effect=3;break;case"DETOUR":case 4:c.effect=4;break;case"ADDITIONAL_SERVICE":case 5:c.effect=5;break;case"MODIFIED_SERVICE":case 6:c.effect=6;break;case"OTHER_EFFECT":case 7:c.effect=7;break;default:if(typeof o.effect=="number"){c.effect=o.effect;break}break;case"UNKNOWN_EFFECT":case 8:c.effect=8;break;case"STOP_MOVED":case 9:c.effect=9;break;case"NO_EFFECT":case 10:c.effect=10;break;case"ACCESSIBILITY_ISSUE":case 11:c.effect=11;break}if(o.url!=null){if(typeof o.url!="object")throw TypeError(".transit_realtime.Alert.url: object expected");c.url=ue.transit_realtime.TranslatedString.fromObject(o.url)}if(o.header_text!=null){if(typeof o.header_text!="object")throw TypeError(".transit_realtime.Alert.header_text: object expected");c.header_text=ue.transit_realtime.TranslatedString.fromObject(o.header_text)}if(o.description_text!=null){if(typeof o.description_text!="object")throw TypeError(".transit_realtime.Alert.description_text: object expected");c.description_text=ue.transit_realtime.TranslatedString.fromObject(o.description_text)}if(o.tts_header_text!=null){if(typeof o.tts_header_text!="object")throw TypeError(".transit_realtime.Alert.tts_header_text: object expected");c.tts_header_text=ue.transit_realtime.TranslatedString.fromObject(o.tts_header_text)}if(o.tts_description_text!=null){if(typeof o.tts_description_text!="object")throw TypeError(".transit_realtime.Alert.tts_description_text: object expected");c.tts_description_text=ue.transit_realtime.TranslatedString.fromObject(o.tts_description_text)}switch(o.severity_level){default:if(typeof o.severity_level=="number"){c.severity_level=o.severity_level;break}break;case"UNKNOWN_SEVERITY":case 1:c.severity_level=1;break;case"INFO":case 2:c.severity_level=2;break;case"WARNING":case 3:c.severity_level=3;break;case"SEVERE":case 4:c.severity_level=4;break}if(o.image!=null){if(typeof o.image!="object")throw TypeError(".transit_realtime.Alert.image: object expected");c.image=ue.transit_realtime.TranslatedImage.fromObject(o.image)}if(o.image_alternative_text!=null){if(typeof o.image_alternative_text!="object")throw TypeError(".transit_realtime.Alert.image_alternative_text: object expected");c.image_alternative_text=ue.transit_realtime.TranslatedString.fromObject(o.image_alternative_text)}if(o.cause_detail!=null){if(typeof o.cause_detail!="object")throw TypeError(".transit_realtime.Alert.cause_detail: object expected");c.cause_detail=ue.transit_realtime.TranslatedString.fromObject(o.cause_detail)}if(o.effect_detail!=null){if(typeof o.effect_detail!="object")throw TypeError(".transit_realtime.Alert.effect_detail: object expected");c.effect_detail=ue.transit_realtime.TranslatedString.fromObject(o.effect_detail)}return c},n.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.active_period=[],t.informed_entity=[]),c.defaults&&(t.cause=c.enums===String?"UNKNOWN_CAUSE":1,t.effect=c.enums===String?"UNKNOWN_EFFECT":8,t.url=null,t.header_text=null,t.description_text=null,t.tts_header_text=null,t.tts_description_text=null,t.severity_level=c.enums===String?"UNKNOWN_SEVERITY":1,t.image=null,t.image_alternative_text=null,t.cause_detail=null,t.effect_detail=null),o.active_period&&o.active_period.length){t.active_period=[];for(var g=0;g<o.active_period.length;++g)t.active_period[g]=ue.transit_realtime.TimeRange.toObject(o.active_period[g],c)}if(o.informed_entity&&o.informed_entity.length){t.informed_entity=[];for(var g=0;g<o.informed_entity.length;++g)t.informed_entity[g]=ue.transit_realtime.EntitySelector.toObject(o.informed_entity[g],c)}return o.cause!=null&&o.hasOwnProperty("cause")&&(t.cause=c.enums===String?ue.transit_realtime.Alert.Cause[o.cause]===void 0?o.cause:ue.transit_realtime.Alert.Cause[o.cause]:o.cause),o.effect!=null&&o.hasOwnProperty("effect")&&(t.effect=c.enums===String?ue.transit_realtime.Alert.Effect[o.effect]===void 0?o.effect:ue.transit_realtime.Alert.Effect[o.effect]:o.effect),o.url!=null&&o.hasOwnProperty("url")&&(t.url=ue.transit_realtime.TranslatedString.toObject(o.url,c)),o.header_text!=null&&o.hasOwnProperty("header_text")&&(t.header_text=ue.transit_realtime.TranslatedString.toObject(o.header_text,c)),o.description_text!=null&&o.hasOwnProperty("description_text")&&(t.description_text=ue.transit_realtime.TranslatedString.toObject(o.description_text,c)),o.tts_header_text!=null&&o.hasOwnProperty("tts_header_text")&&(t.tts_header_text=ue.transit_realtime.TranslatedString.toObject(o.tts_header_text,c)),o.tts_description_text!=null&&o.hasOwnProperty("tts_description_text")&&(t.tts_description_text=ue.transit_realtime.TranslatedString.toObject(o.tts_description_text,c)),o.severity_level!=null&&o.hasOwnProperty("severity_level")&&(t.severity_level=c.enums===String?ue.transit_realtime.Alert.SeverityLevel[o.severity_level]===void 0?o.severity_level:ue.transit_realtime.Alert.SeverityLevel[o.severity_level]:o.severity_level),o.image!=null&&o.hasOwnProperty("image")&&(t.image=ue.transit_realtime.TranslatedImage.toObject(o.image,c)),o.image_alternative_text!=null&&o.hasOwnProperty("image_alternative_text")&&(t.image_alternative_text=ue.transit_realtime.TranslatedString.toObject(o.image_alternative_text,c)),o.cause_detail!=null&&o.hasOwnProperty("cause_detail")&&(t.cause_detail=ue.transit_realtime.TranslatedString.toObject(o.cause_detail,c)),o.effect_detail!=null&&o.hasOwnProperty("effect_detail")&&(t.effect_detail=ue.transit_realtime.TranslatedString.toObject(o.effect_detail,c)),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.Alert"},n.Cause=function(){var l={},o=Object.create(l);return o[l[1]="UNKNOWN_CAUSE"]=1,o[l[2]="OTHER_CAUSE"]=2,o[l[3]="TECHNICAL_PROBLEM"]=3,o[l[4]="STRIKE"]=4,o[l[5]="DEMONSTRATION"]=5,o[l[6]="ACCIDENT"]=6,o[l[7]="HOLIDAY"]=7,o[l[8]="WEATHER"]=8,o[l[9]="MAINTENANCE"]=9,o[l[10]="CONSTRUCTION"]=10,o[l[11]="POLICE_ACTIVITY"]=11,o[l[12]="MEDICAL_EMERGENCY"]=12,o}(),n.Effect=function(){var l={},o=Object.create(l);return o[l[1]="NO_SERVICE"]=1,o[l[2]="REDUCED_SERVICE"]=2,o[l[3]="SIGNIFICANT_DELAYS"]=3,o[l[4]="DETOUR"]=4,o[l[5]="ADDITIONAL_SERVICE"]=5,o[l[6]="MODIFIED_SERVICE"]=6,o[l[7]="OTHER_EFFECT"]=7,o[l[8]="UNKNOWN_EFFECT"]=8,o[l[9]="STOP_MOVED"]=9,o[l[10]="NO_EFFECT"]=10,o[l[11]="ACCESSIBILITY_ISSUE"]=11,o}(),n.SeverityLevel=function(){var l={},o=Object.create(l);return o[l[1]="UNKNOWN_SEVERITY"]=1,o[l[2]="INFO"]=2,o[l[3]="WARNING"]=3,o[l[4]="SEVERE"]=4,o}(),n}(),s.TimeRange=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.start=Ve.Long?Ve.Long.fromBits(0,0,!0):0,n.prototype.end=Ve.Long?Ve.Long.fromBits(0,0,!0):0,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),o.start!=null&&Object.hasOwnProperty.call(o,"start")&&c.uint32(8).uint64(o.start),o.end!=null&&Object.hasOwnProperty.call(o,"end")&&c.uint32(16).uint64(o.end),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.TimeRange;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.start=o.uint64();break}case 2:{g.end=o.uint64();break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){return typeof o!="object"||o===null?"object expected":o.start!=null&&o.hasOwnProperty("start")&&!Ve.isInteger(o.start)&&!(o.start&&Ve.isInteger(o.start.low)&&Ve.isInteger(o.start.high))?"start: integer|Long expected":o.end!=null&&o.hasOwnProperty("end")&&!Ve.isInteger(o.end)&&!(o.end&&Ve.isInteger(o.end.low)&&Ve.isInteger(o.end.high))?"end: integer|Long expected":null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.TimeRange)return o;var c=new ue.transit_realtime.TimeRange;return o.start!=null&&(Ve.Long?(c.start=Ve.Long.fromValue(o.start)).unsigned=!0:typeof o.start=="string"?c.start=parseInt(o.start,10):typeof o.start=="number"?c.start=o.start:typeof o.start=="object"&&(c.start=new Ve.LongBits(o.start.low>>>0,o.start.high>>>0).toNumber(!0))),o.end!=null&&(Ve.Long?(c.end=Ve.Long.fromValue(o.end)).unsigned=!0:typeof o.end=="string"?c.end=parseInt(o.end,10):typeof o.end=="number"?c.end=o.end:typeof o.end=="object"&&(c.end=new Ve.LongBits(o.end.low>>>0,o.end.high>>>0).toNumber(!0))),c},n.toObject=function(o,c){c||(c={});var t={};if(c.defaults){if(Ve.Long){var g=new Ve.Long(0,0,!0);t.start=c.longs===String?g.toString():c.longs===Number?g.toNumber():g}else t.start=c.longs===String?"0":0;if(Ve.Long){var g=new Ve.Long(0,0,!0);t.end=c.longs===String?g.toString():c.longs===Number?g.toNumber():g}else t.end=c.longs===String?"0":0}return o.start!=null&&o.hasOwnProperty("start")&&(typeof o.start=="number"?t.start=c.longs===String?String(o.start):o.start:t.start=c.longs===String?Ve.Long.prototype.toString.call(o.start):c.longs===Number?new Ve.LongBits(o.start.low>>>0,o.start.high>>>0).toNumber(!0):o.start),o.end!=null&&o.hasOwnProperty("end")&&(typeof o.end=="number"?t.end=c.longs===String?String(o.end):o.end:t.end=c.longs===String?Ve.Long.prototype.toString.call(o.end):c.longs===Number?new Ve.LongBits(o.end.low>>>0,o.end.high>>>0).toNumber(!0):o.end),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TimeRange"},n}(),s.Position=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.latitude=0,n.prototype.longitude=0,n.prototype.bearing=0,n.prototype.odometer=0,n.prototype.speed=0,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),c.uint32(13).float(o.latitude),c.uint32(21).float(o.longitude),o.bearing!=null&&Object.hasOwnProperty.call(o,"bearing")&&c.uint32(29).float(o.bearing),o.odometer!=null&&Object.hasOwnProperty.call(o,"odometer")&&c.uint32(33).double(o.odometer),o.speed!=null&&Object.hasOwnProperty.call(o,"speed")&&c.uint32(45).float(o.speed),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.Position;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.latitude=o.float();break}case 2:{g.longitude=o.float();break}case 3:{g.bearing=o.float();break}case 4:{g.odometer=o.double();break}case 5:{g.speed=o.float();break}default:o.skipType(I&7);break}}if(!g.hasOwnProperty("latitude"))throw Ve.ProtocolError("missing required 'latitude'",{instance:g});if(!g.hasOwnProperty("longitude"))throw Ve.ProtocolError("missing required 'longitude'",{instance:g});return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){return typeof o!="object"||o===null?"object expected":typeof o.latitude!="number"?"latitude: number expected":typeof o.longitude!="number"?"longitude: number expected":o.bearing!=null&&o.hasOwnProperty("bearing")&&typeof o.bearing!="number"?"bearing: number expected":o.odometer!=null&&o.hasOwnProperty("odometer")&&typeof o.odometer!="number"?"odometer: number expected":o.speed!=null&&o.hasOwnProperty("speed")&&typeof o.speed!="number"?"speed: number expected":null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.Position)return o;var c=new ue.transit_realtime.Position;return o.latitude!=null&&(c.latitude=Number(o.latitude)),o.longitude!=null&&(c.longitude=Number(o.longitude)),o.bearing!=null&&(c.bearing=Number(o.bearing)),o.odometer!=null&&(c.odometer=Number(o.odometer)),o.speed!=null&&(c.speed=Number(o.speed)),c},n.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.latitude=0,t.longitude=0,t.bearing=0,t.odometer=0,t.speed=0),o.latitude!=null&&o.hasOwnProperty("latitude")&&(t.latitude=c.json&&!isFinite(o.latitude)?String(o.latitude):o.latitude),o.longitude!=null&&o.hasOwnProperty("longitude")&&(t.longitude=c.json&&!isFinite(o.longitude)?String(o.longitude):o.longitude),o.bearing!=null&&o.hasOwnProperty("bearing")&&(t.bearing=c.json&&!isFinite(o.bearing)?String(o.bearing):o.bearing),o.odometer!=null&&o.hasOwnProperty("odometer")&&(t.odometer=c.json&&!isFinite(o.odometer)?String(o.odometer):o.odometer),o.speed!=null&&o.hasOwnProperty("speed")&&(t.speed=c.json&&!isFinite(o.speed)?String(o.speed):o.speed),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.Position"},n}(),s.TripDescriptor=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.trip_id="",n.prototype.route_id="",n.prototype.direction_id=0,n.prototype.start_time="",n.prototype.start_date="",n.prototype.schedule_relationship=0,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),o.trip_id!=null&&Object.hasOwnProperty.call(o,"trip_id")&&c.uint32(10).string(o.trip_id),o.start_time!=null&&Object.hasOwnProperty.call(o,"start_time")&&c.uint32(18).string(o.start_time),o.start_date!=null&&Object.hasOwnProperty.call(o,"start_date")&&c.uint32(26).string(o.start_date),o.schedule_relationship!=null&&Object.hasOwnProperty.call(o,"schedule_relationship")&&c.uint32(32).int32(o.schedule_relationship),o.route_id!=null&&Object.hasOwnProperty.call(o,"route_id")&&c.uint32(42).string(o.route_id),o.direction_id!=null&&Object.hasOwnProperty.call(o,"direction_id")&&c.uint32(48).uint32(o.direction_id),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.TripDescriptor;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.trip_id=o.string();break}case 5:{g.route_id=o.string();break}case 6:{g.direction_id=o.uint32();break}case 2:{g.start_time=o.string();break}case 3:{g.start_date=o.string();break}case 4:{g.schedule_relationship=o.int32();break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.trip_id!=null&&o.hasOwnProperty("trip_id")&&!Ve.isString(o.trip_id))return"trip_id: string expected";if(o.route_id!=null&&o.hasOwnProperty("route_id")&&!Ve.isString(o.route_id))return"route_id: string expected";if(o.direction_id!=null&&o.hasOwnProperty("direction_id")&&!Ve.isInteger(o.direction_id))return"direction_id: integer expected";if(o.start_time!=null&&o.hasOwnProperty("start_time")&&!Ve.isString(o.start_time))return"start_time: string expected";if(o.start_date!=null&&o.hasOwnProperty("start_date")&&!Ve.isString(o.start_date))return"start_date: string expected";if(o.schedule_relationship!=null&&o.hasOwnProperty("schedule_relationship"))switch(o.schedule_relationship){default:return"schedule_relationship: enum value expected";case 0:case 1:case 2:case 3:case 5:case 6:break}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.TripDescriptor)return o;var c=new ue.transit_realtime.TripDescriptor;switch(o.trip_id!=null&&(c.trip_id=String(o.trip_id)),o.route_id!=null&&(c.route_id=String(o.route_id)),o.direction_id!=null&&(c.direction_id=o.direction_id>>>0),o.start_time!=null&&(c.start_time=String(o.start_time)),o.start_date!=null&&(c.start_date=String(o.start_date)),o.schedule_relationship){default:if(typeof o.schedule_relationship=="number"){c.schedule_relationship=o.schedule_relationship;break}break;case"SCHEDULED":case 0:c.schedule_relationship=0;break;case"ADDED":case 1:c.schedule_relationship=1;break;case"UNSCHEDULED":case 2:c.schedule_relationship=2;break;case"CANCELED":case 3:c.schedule_relationship=3;break;case"REPLACEMENT":case 5:c.schedule_relationship=5;break;case"DUPLICATED":case 6:c.schedule_relationship=6;break}return c},n.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.trip_id="",t.start_time="",t.start_date="",t.schedule_relationship=c.enums===String?"SCHEDULED":0,t.route_id="",t.direction_id=0),o.trip_id!=null&&o.hasOwnProperty("trip_id")&&(t.trip_id=o.trip_id),o.start_time!=null&&o.hasOwnProperty("start_time")&&(t.start_time=o.start_time),o.start_date!=null&&o.hasOwnProperty("start_date")&&(t.start_date=o.start_date),o.schedule_relationship!=null&&o.hasOwnProperty("schedule_relationship")&&(t.schedule_relationship=c.enums===String?ue.transit_realtime.TripDescriptor.ScheduleRelationship[o.schedule_relationship]===void 0?o.schedule_relationship:ue.transit_realtime.TripDescriptor.ScheduleRelationship[o.schedule_relationship]:o.schedule_relationship),o.route_id!=null&&o.hasOwnProperty("route_id")&&(t.route_id=o.route_id),o.direction_id!=null&&o.hasOwnProperty("direction_id")&&(t.direction_id=o.direction_id),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TripDescriptor"},n.ScheduleRelationship=function(){var l={},o=Object.create(l);return o[l[0]="SCHEDULED"]=0,o[l[1]="ADDED"]=1,o[l[2]="UNSCHEDULED"]=2,o[l[3]="CANCELED"]=3,o[l[5]="REPLACEMENT"]=5,o[l[6]="DUPLICATED"]=6,o}(),n}(),s.VehicleDescriptor=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.id="",n.prototype.label="",n.prototype.license_plate="",n.prototype.wheelchair_accessible=0,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),o.id!=null&&Object.hasOwnProperty.call(o,"id")&&c.uint32(10).string(o.id),o.label!=null&&Object.hasOwnProperty.call(o,"label")&&c.uint32(18).string(o.label),o.license_plate!=null&&Object.hasOwnProperty.call(o,"license_plate")&&c.uint32(26).string(o.license_plate),o.wheelchair_accessible!=null&&Object.hasOwnProperty.call(o,"wheelchair_accessible")&&c.uint32(32).int32(o.wheelchair_accessible),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.VehicleDescriptor;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.id=o.string();break}case 2:{g.label=o.string();break}case 3:{g.license_plate=o.string();break}case 4:{g.wheelchair_accessible=o.int32();break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.id!=null&&o.hasOwnProperty("id")&&!Ve.isString(o.id))return"id: string expected";if(o.label!=null&&o.hasOwnProperty("label")&&!Ve.isString(o.label))return"label: string expected";if(o.license_plate!=null&&o.hasOwnProperty("license_plate")&&!Ve.isString(o.license_plate))return"license_plate: string expected";if(o.wheelchair_accessible!=null&&o.hasOwnProperty("wheelchair_accessible"))switch(o.wheelchair_accessible){default:return"wheelchair_accessible: enum value expected";case 0:case 1:case 2:case 3:break}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.VehicleDescriptor)return o;var c=new ue.transit_realtime.VehicleDescriptor;switch(o.id!=null&&(c.id=String(o.id)),o.label!=null&&(c.label=String(o.label)),o.license_plate!=null&&(c.license_plate=String(o.license_plate)),o.wheelchair_accessible){default:if(typeof o.wheelchair_accessible=="number"){c.wheelchair_accessible=o.wheelchair_accessible;break}break;case"NO_VALUE":case 0:c.wheelchair_accessible=0;break;case"UNKNOWN":case 1:c.wheelchair_accessible=1;break;case"WHEELCHAIR_ACCESSIBLE":case 2:c.wheelchair_accessible=2;break;case"WHEELCHAIR_INACCESSIBLE":case 3:c.wheelchair_accessible=3;break}return c},n.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.id="",t.label="",t.license_plate="",t.wheelchair_accessible=c.enums===String?"NO_VALUE":0),o.id!=null&&o.hasOwnProperty("id")&&(t.id=o.id),o.label!=null&&o.hasOwnProperty("label")&&(t.label=o.label),o.license_plate!=null&&o.hasOwnProperty("license_plate")&&(t.license_plate=o.license_plate),o.wheelchair_accessible!=null&&o.hasOwnProperty("wheelchair_accessible")&&(t.wheelchair_accessible=c.enums===String?ue.transit_realtime.VehicleDescriptor.WheelchairAccessible[o.wheelchair_accessible]===void 0?o.wheelchair_accessible:ue.transit_realtime.VehicleDescriptor.WheelchairAccessible[o.wheelchair_accessible]:o.wheelchair_accessible),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.VehicleDescriptor"},n.WheelchairAccessible=function(){var l={},o=Object.create(l);return o[l[0]="NO_VALUE"]=0,o[l[1]="UNKNOWN"]=1,o[l[2]="WHEELCHAIR_ACCESSIBLE"]=2,o[l[3]="WHEELCHAIR_INACCESSIBLE"]=3,o}(),n}(),s.EntitySelector=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.agency_id="",n.prototype.route_id="",n.prototype.route_type=0,n.prototype.trip=null,n.prototype.stop_id="",n.prototype.direction_id=0,n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),o.agency_id!=null&&Object.hasOwnProperty.call(o,"agency_id")&&c.uint32(10).string(o.agency_id),o.route_id!=null&&Object.hasOwnProperty.call(o,"route_id")&&c.uint32(18).string(o.route_id),o.route_type!=null&&Object.hasOwnProperty.call(o,"route_type")&&c.uint32(24).int32(o.route_type),o.trip!=null&&Object.hasOwnProperty.call(o,"trip")&&ue.transit_realtime.TripDescriptor.encode(o.trip,c.uint32(34).fork()).ldelim(),o.stop_id!=null&&Object.hasOwnProperty.call(o,"stop_id")&&c.uint32(42).string(o.stop_id),o.direction_id!=null&&Object.hasOwnProperty.call(o,"direction_id")&&c.uint32(48).uint32(o.direction_id),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.EntitySelector;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.agency_id=o.string();break}case 2:{g.route_id=o.string();break}case 3:{g.route_type=o.int32();break}case 4:{g.trip=ue.transit_realtime.TripDescriptor.decode(o,o.uint32());break}case 5:{g.stop_id=o.string();break}case 6:{g.direction_id=o.uint32();break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.agency_id!=null&&o.hasOwnProperty("agency_id")&&!Ve.isString(o.agency_id))return"agency_id: string expected";if(o.route_id!=null&&o.hasOwnProperty("route_id")&&!Ve.isString(o.route_id))return"route_id: string expected";if(o.route_type!=null&&o.hasOwnProperty("route_type")&&!Ve.isInteger(o.route_type))return"route_type: integer expected";if(o.trip!=null&&o.hasOwnProperty("trip")){var c=ue.transit_realtime.TripDescriptor.verify(o.trip);if(c)return"trip."+c}return o.stop_id!=null&&o.hasOwnProperty("stop_id")&&!Ve.isString(o.stop_id)?"stop_id: string expected":o.direction_id!=null&&o.hasOwnProperty("direction_id")&&!Ve.isInteger(o.direction_id)?"direction_id: integer expected":null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.EntitySelector)return o;var c=new ue.transit_realtime.EntitySelector;if(o.agency_id!=null&&(c.agency_id=String(o.agency_id)),o.route_id!=null&&(c.route_id=String(o.route_id)),o.route_type!=null&&(c.route_type=o.route_type|0),o.trip!=null){if(typeof o.trip!="object")throw TypeError(".transit_realtime.EntitySelector.trip: object expected");c.trip=ue.transit_realtime.TripDescriptor.fromObject(o.trip)}return o.stop_id!=null&&(c.stop_id=String(o.stop_id)),o.direction_id!=null&&(c.direction_id=o.direction_id>>>0),c},n.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.agency_id="",t.route_id="",t.route_type=0,t.trip=null,t.stop_id="",t.direction_id=0),o.agency_id!=null&&o.hasOwnProperty("agency_id")&&(t.agency_id=o.agency_id),o.route_id!=null&&o.hasOwnProperty("route_id")&&(t.route_id=o.route_id),o.route_type!=null&&o.hasOwnProperty("route_type")&&(t.route_type=o.route_type),o.trip!=null&&o.hasOwnProperty("trip")&&(t.trip=ue.transit_realtime.TripDescriptor.toObject(o.trip,c)),o.stop_id!=null&&o.hasOwnProperty("stop_id")&&(t.stop_id=o.stop_id),o.direction_id!=null&&o.hasOwnProperty("direction_id")&&(t.direction_id=o.direction_id),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.EntitySelector"},n}(),s.TranslatedString=function(){function n(l){if(this.translation=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.translation=Ve.emptyArray,n.create=function(o){return new n(o)},n.encode=function(o,c){if(c||(c=ci.create()),o.translation!=null&&o.translation.length)for(var t=0;t<o.translation.length;++t)ue.transit_realtime.TranslatedString.Translation.encode(o.translation[t],c.uint32(10).fork()).ldelim();return c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.TranslatedString;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.translation&&g.translation.length||(g.translation=[]),g.translation.push(ue.transit_realtime.TranslatedString.Translation.decode(o,o.uint32()));break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.translation!=null&&o.hasOwnProperty("translation")){if(!Array.isArray(o.translation))return"translation: array expected";for(var c=0;c<o.translation.length;++c){var t=ue.transit_realtime.TranslatedString.Translation.verify(o.translation[c]);if(t)return"translation."+t}}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.TranslatedString)return o;var c=new ue.transit_realtime.TranslatedString;if(o.translation){if(!Array.isArray(o.translation))throw TypeError(".transit_realtime.TranslatedString.translation: array expected");c.translation=[];for(var t=0;t<o.translation.length;++t){if(typeof o.translation[t]!="object")throw TypeError(".transit_realtime.TranslatedString.translation: object expected");c.translation[t]=ue.transit_realtime.TranslatedString.Translation.fromObject(o.translation[t])}}return c},n.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.translation=[]),o.translation&&o.translation.length){t.translation=[];for(var g=0;g<o.translation.length;++g)t.translation[g]=ue.transit_realtime.TranslatedString.Translation.toObject(o.translation[g],c)}return t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TranslatedString"},n.Translation=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.text="",l.prototype.language="",l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=ci.create()),t.uint32(10).string(c.text),c.language!=null&&Object.hasOwnProperty.call(c,"language")&&t.uint32(18).string(c.language),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof mt||(c=mt.create(c));for(var g=t===void 0?c.len:c.pos+t,I=new ue.transit_realtime.TranslatedString.Translation;c.pos<g;){var P=c.uint32();switch(P>>>3){case 1:{I.text=c.string();break}case 2:{I.language=c.string();break}default:c.skipType(P&7);break}}if(!I.hasOwnProperty("text"))throw Ve.ProtocolError("missing required 'text'",{instance:I});return I},l.decodeDelimited=function(c){return c instanceof mt||(c=new mt(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":Ve.isString(c.text)?c.language!=null&&c.hasOwnProperty("language")&&!Ve.isString(c.language)?"language: string expected":null:"text: string expected"},l.fromObject=function(c){if(c instanceof ue.transit_realtime.TranslatedString.Translation)return c;var t=new ue.transit_realtime.TranslatedString.Translation;return c.text!=null&&(t.text=String(c.text)),c.language!=null&&(t.language=String(c.language)),t},l.toObject=function(c,t){t||(t={});var g={};return t.defaults&&(g.text="",g.language=""),c.text!=null&&c.hasOwnProperty("text")&&(g.text=c.text),c.language!=null&&c.hasOwnProperty("language")&&(g.language=c.language),g},l.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TranslatedString.Translation"},l}(),n}(),s.TranslatedImage=function(){function n(l){if(this.localized_image=[],l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.localized_image=Ve.emptyArray,n.create=function(o){return new n(o)},n.encode=function(o,c){if(c||(c=ci.create()),o.localized_image!=null&&o.localized_image.length)for(var t=0;t<o.localized_image.length;++t)ue.transit_realtime.TranslatedImage.LocalizedImage.encode(o.localized_image[t],c.uint32(10).fork()).ldelim();return c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.TranslatedImage;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.localized_image&&g.localized_image.length||(g.localized_image=[]),g.localized_image.push(ue.transit_realtime.TranslatedImage.LocalizedImage.decode(o,o.uint32()));break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){if(typeof o!="object"||o===null)return"object expected";if(o.localized_image!=null&&o.hasOwnProperty("localized_image")){if(!Array.isArray(o.localized_image))return"localized_image: array expected";for(var c=0;c<o.localized_image.length;++c){var t=ue.transit_realtime.TranslatedImage.LocalizedImage.verify(o.localized_image[c]);if(t)return"localized_image."+t}}return null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.TranslatedImage)return o;var c=new ue.transit_realtime.TranslatedImage;if(o.localized_image){if(!Array.isArray(o.localized_image))throw TypeError(".transit_realtime.TranslatedImage.localized_image: array expected");c.localized_image=[];for(var t=0;t<o.localized_image.length;++t){if(typeof o.localized_image[t]!="object")throw TypeError(".transit_realtime.TranslatedImage.localized_image: object expected");c.localized_image[t]=ue.transit_realtime.TranslatedImage.LocalizedImage.fromObject(o.localized_image[t])}}return c},n.toObject=function(o,c){c||(c={});var t={};if((c.arrays||c.defaults)&&(t.localized_image=[]),o.localized_image&&o.localized_image.length){t.localized_image=[];for(var g=0;g<o.localized_image.length;++g)t.localized_image[g]=ue.transit_realtime.TranslatedImage.LocalizedImage.toObject(o.localized_image[g],c)}return t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.TranslatedImage"},n.LocalizedImage=function(){function l(o){if(o)for(var c=Object.keys(o),t=0;t<c.length;++t)o[c[t]]!=null&&(this[c[t]]=o[c[t]])}return l.prototype.url="",l.prototype.media_type="",l.prototype.language="",l.create=function(c){return new l(c)},l.encode=function(c,t){return t||(t=ci.create()),t.uint32(10).string(c.url),t.uint32(18).string(c.media_type),c.language!=null&&Object.hasOwnProperty.call(c,"language")&&t.uint32(26).string(c.language),t},l.encodeDelimited=function(c,t){return this.encode(c,t).ldelim()},l.decode=function(c,t){c instanceof mt||(c=mt.create(c));for(var g=t===void 0?c.len:c.pos+t,I=new ue.transit_realtime.TranslatedImage.LocalizedImage;c.pos<g;){var P=c.uint32();switch(P>>>3){case 1:{I.url=c.string();break}case 2:{I.media_type=c.string();break}case 3:{I.language=c.string();break}default:c.skipType(P&7);break}}if(!I.hasOwnProperty("url"))throw Ve.ProtocolError("missing required 'url'",{instance:I});if(!I.hasOwnProperty("media_type"))throw Ve.ProtocolError("missing required 'media_type'",{instance:I});return I},l.decodeDelimited=function(c){return c instanceof mt||(c=new mt(c)),this.decode(c,c.uint32())},l.verify=function(c){return typeof c!="object"||c===null?"object expected":Ve.isString(c.url)?Ve.isString(c.media_type)?c.language!=null&&c.hasOwnProperty("language")&&!Ve.isString(c.language)?"language: string expected":null:"media_type: string expected":"url: string expected"},l.fromObject=function(c){if(c instanceof ue.transit_realtime.TranslatedImage.LocalizedImage)return c;var t=new ue.transit_realtime.TranslatedImage.LocalizedImage;return c.url!=null&&(t.url=String(c.url)),c.media_type!=null&&(t.media_type=String(c.media_type)),c.language!=null&&(t.language=String(c.language)),t},l.toObject=function(c,t){t||(t={});var g={};return t.defaults&&(g.url="",g.media_type="",g.language=""),c.url!=null&&c.hasOwnProperty("url")&&(g.url=c.url),c.media_type!=null&&c.hasOwnProperty("media_type")&&(g.media_type=c.media_type),c.language!=null&&c.hasOwnProperty("language")&&(g.language=c.language),g},l.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},l.getTypeUrl=function(c){return c===void 0&&(c="type.googleapis.com"),c+"/transit_realtime.TranslatedImage.LocalizedImage"},l}(),n}(),s.Shape=function(){function n(l){if(l)for(var o=Object.keys(l),c=0;c<o.length;++c)l[o[c]]!=null&&(this[o[c]]=l[o[c]])}return n.prototype.shape_id="",n.prototype.encoded_polyline="",n.create=function(o){return new n(o)},n.encode=function(o,c){return c||(c=ci.create()),o.shape_id!=null&&Object.hasOwnProperty.call(o,"shape_id")&&c.uint32(10).string(o.shape_id),o.encoded_polyline!=null&&Object.hasOwnProperty.call(o,"encoded_polyline")&&c.uint32(18).string(o.encoded_polyline),c},n.encodeDelimited=function(o,c){return this.encode(o,c).ldelim()},n.decode=function(o,c){o instanceof mt||(o=mt.create(o));for(var t=c===void 0?o.len:o.pos+c,g=new ue.transit_realtime.Shape;o.pos<t;){var I=o.uint32();switch(I>>>3){case 1:{g.shape_id=o.string();break}case 2:{g.encoded_polyline=o.string();break}default:o.skipType(I&7);break}}return g},n.decodeDelimited=function(o){return o instanceof mt||(o=new mt(o)),this.decode(o,o.uint32())},n.verify=function(o){return typeof o!="object"||o===null?"object expected":o.shape_id!=null&&o.hasOwnProperty("shape_id")&&!Ve.isString(o.shape_id)?"shape_id: string expected":o.encoded_polyline!=null&&o.hasOwnProperty("encoded_polyline")&&!Ve.isString(o.encoded_polyline)?"encoded_polyline: string expected":null},n.fromObject=function(o){if(o instanceof ue.transit_realtime.Shape)return o;var c=new ue.transit_realtime.Shape;return o.shape_id!=null&&(c.shape_id=String(o.shape_id)),o.encoded_polyline!=null&&(c.encoded_polyline=String(o.encoded_polyline)),c},n.toObject=function(o,c){c||(c={});var t={};return c.defaults&&(t.shape_id="",t.encoded_polyline=""),o.shape_id!=null&&o.hasOwnProperty("shape_id")&&(t.shape_id=o.shape_id),o.encoded_polyline!=null&&o.hasOwnProperty("encoded_polyline")&&(t.encoded_polyline=o.encoded_polyline),t},n.prototype.toJSON=function(){return this.constructor.toObject(this,Wr.util.toJSONOptions)},n.getTypeUrl=function(o){return o===void 0&&(o="type.googleapis.com"),o+"/transit_realtime.Shape"},n}(),s}();Z7.exports=ue});var M2=M((LZe,X7)=>{"use strict";var{transit_realtime:_Re}=H7();X7.exports=_Re});var iW=M((BZe,m0)=>{"use strict";var{AbortController:rW,AbortSignal:wRe}=typeof self<"u"?self:typeof window<"u"?window:void 0;m0.exports=rW;m0.exports.AbortSignal=wRe;m0.exports.default=rW});var lW=M((jZe,sW)=>{var PRe=a0(),MRe=np(),qRe="[object AsyncFunction]",RRe="[object Function]",DRe="[object GeneratorFunction]",LRe="[object Proxy]";function kRe(s){if(!MRe(s))return!1;var n=PRe(s);return n==RRe||n==DRe||n==qRe||n==LRe}sW.exports=kRe});var cW=M((VZe,uW)=>{var zRe=Rm(),BRe=zRe["__core-js_shared__"];uW.exports=BRe});var fW=M((GZe,pW)=>{var D2=cW(),hW=function(){var s=/[^.]+$/.exec(D2&&D2.keys&&D2.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}();function FRe(s){return!!hW&&hW in s}pW.exports=FRe});var mW=M(($Ze,dW)=>{var NRe=Function.prototype,URe=NRe.toString;function jRe(s){if(s!=null){try{return URe.call(s)}catch{}try{return s+""}catch{}}return""}dW.exports=jRe});var yW=M((WZe,_W)=>{var VRe=lW(),GRe=fW(),$Re=np(),WRe=mW(),ZRe=/[\\^$.*+?()[\]{}|]/g,HRe=/^\[object .+?Constructor\]$/,XRe=Function.prototype,YRe=Object.prototype,KRe=XRe.toString,JRe=YRe.hasOwnProperty,QRe=RegExp("^"+KRe.call(JRe).replace(ZRe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function eDe(s){if(!$Re(s)||GRe(s))return!1;var n=VRe(s)?QRe:HRe;return n.test(WRe(s))}_W.exports=eDe});var vW=M((ZZe,gW)=>{function tDe(s,n){return s?.[n]}gW.exports=tDe});var _0=M((HZe,xW)=>{var rDe=yW(),iDe=vW();function nDe(s,n){var l=iDe(s,n);return rDe(l)?l:void 0}xW.exports=nDe});var Gm=M((XZe,bW)=>{var oDe=_0(),aDe=oDe(Object,"create");bW.exports=aDe});var EW=M((YZe,TW)=>{var wW=Gm();function sDe(){this.__data__=wW?wW(null):{},this.size=0}TW.exports=sDe});var IW=M((KZe,SW)=>{function lDe(s){var n=this.has(s)&&delete this.__data__[s];return this.size-=n?1:0,n}SW.exports=lDe});var OW=M((JZe,AW)=>{var uDe=Gm(),cDe="__lodash_hash_undefined__",hDe=Object.prototype,pDe=hDe.hasOwnProperty;function fDe(s){var n=this.__data__;if(uDe){var l=n[s];return l===cDe?void 0:l}return pDe.call(n,s)?n[s]:void 0}AW.exports=fDe});var PW=M((QZe,CW)=>{var dDe=Gm(),mDe=Object.prototype,_De=mDe.hasOwnProperty;function yDe(s){var n=this.__data__;return dDe?n[s]!==void 0:_De.call(n,s)}CW.exports=yDe});var qW=M((e9e,MW)=>{var gDe=Gm(),vDe="__lodash_hash_undefined__";function xDe(s,n){var l=this.__data__;return this.size+=this.has(s)?0:1,l[s]=gDe&&n===void 0?vDe:n,this}MW.exports=xDe});var DW=M((t9e,RW)=>{var bDe=EW(),wDe=IW(),TDe=OW(),EDe=PW(),SDe=qW();function pp(s){var n=-1,l=s==null?0:s.length;for(this.clear();++n<l;){var o=s[n];this.set(o[0],o[1])}}pp.prototype.clear=bDe;pp.prototype.delete=wDe;pp.prototype.get=TDe;pp.prototype.has=EDe;pp.prototype.set=SDe;RW.exports=pp});var kW=M((r9e,LW)=>{function IDe(){this.__data__=[],this.size=0}LW.exports=IDe});var L2=M((i9e,zW)=>{function ADe(s,n){return s===n||s!==s&&n!==n}zW.exports=ADe});var $m=M((n9e,BW)=>{var ODe=L2();function CDe(s,n){for(var l=s.length;l--;)if(ODe(s[l][0],n))return l;return-1}BW.exports=CDe});var NW=M((o9e,FW)=>{var PDe=$m(),MDe=Array.prototype,qDe=MDe.splice;function RDe(s){var n=this.__data__,l=PDe(n,s);if(l<0)return!1;var o=n.length-1;return l==o?n.pop():qDe.call(n,l,1),--this.size,!0}FW.exports=RDe});var jW=M((a9e,UW)=>{var DDe=$m();function LDe(s){var n=this.__data__,l=DDe(n,s);return l<0?void 0:n[l][1]}UW.exports=LDe});var GW=M((s9e,VW)=>{var kDe=$m();function zDe(s){return kDe(this.__data__,s)>-1}VW.exports=zDe});var WW=M((l9e,$W)=>{var BDe=$m();function FDe(s,n){var l=this.__data__,o=BDe(l,s);return o<0?(++this.size,l.push([s,n])):l[o][1]=n,this}$W.exports=FDe});var HW=M((u9e,ZW)=>{var NDe=kW(),UDe=NW(),jDe=jW(),VDe=GW(),GDe=WW();function fp(s){var n=-1,l=s==null?0:s.length;for(this.clear();++n<l;){var o=s[n];this.set(o[0],o[1])}}fp.prototype.clear=NDe;fp.prototype.delete=UDe;fp.prototype.get=jDe;fp.prototype.has=VDe;fp.prototype.set=GDe;ZW.exports=fp});var YW=M((c9e,XW)=>{var $De=_0(),WDe=Rm(),ZDe=$De(WDe,"Map");XW.exports=ZDe});var QW=M((h9e,JW)=>{var KW=DW(),HDe=HW(),XDe=YW();function YDe(){this.size=0,this.__data__={hash:new KW,map:new(XDe||HDe),string:new KW}}JW.exports=YDe});var tZ=M((p9e,eZ)=>{function KDe(s){var n=typeof s;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?s!=="__proto__":s===null}eZ.exports=KDe});var Wm=M((f9e,rZ)=>{var JDe=tZ();function QDe(s,n){var l=s.__data__;return JDe(n)?l[typeof n=="string"?"string":"hash"]:l.map}rZ.exports=QDe});var nZ=M((d9e,iZ)=>{var eLe=Wm();function tLe(s){var n=eLe(this,s).delete(s);return this.size-=n?1:0,n}iZ.exports=tLe});var aZ=M((m9e,oZ)=>{var rLe=Wm();function iLe(s){return rLe(this,s).get(s)}oZ.exports=iLe});var lZ=M((_9e,sZ)=>{var nLe=Wm();function oLe(s){return nLe(this,s).has(s)}sZ.exports=oLe});var cZ=M((y9e,uZ)=>{var aLe=Wm();function sLe(s,n){var l=aLe(this,s),o=l.size;return l.set(s,n),this.size+=l.size==o?0:1,this}uZ.exports=sLe});var pZ=M((g9e,hZ)=>{var lLe=QW(),uLe=nZ(),cLe=aZ(),hLe=lZ(),pLe=cZ();function dp(s){var n=-1,l=s==null?0:s.length;for(this.clear();++n<l;){var o=s[n];this.set(o[0],o[1])}}dp.prototype.clear=lLe;dp.prototype.delete=uLe;dp.prototype.get=cLe;dp.prototype.has=hLe;dp.prototype.set=pLe;hZ.exports=dp});var z2=M((v9e,dZ)=>{var fZ=pZ(),fLe="Expected a function";function k2(s,n){if(typeof s!="function"||n!=null&&typeof n!="function")throw new TypeError(fLe);var l=function(){var o=arguments,c=n?n.apply(this,o):o[0],t=l.cache;if(t.has(c))return t.get(c);var g=s.apply(this,o);return l.cache=t.set(c,g)||t,g};return l.cache=new(k2.Cache||fZ),l}k2.Cache=fZ;dZ.exports=k2});var mp=M((x9e,mZ)=>{var dLe=Array.isArray;mZ.exports=dLe});var yZ=M((b9e,_Z)=>{var mLe=mp(),_Le=km(),yLe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,gLe=/^\w*$/;function vLe(s,n){if(mLe(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||_Le(s)?!0:gLe.test(s)||!yLe.test(s)||n!=null&&s in Object(n)}_Z.exports=vLe});var vZ=M((w9e,gZ)=>{var xLe=z2(),bLe=500;function wLe(s){var n=xLe(s,function(o){return l.size===bLe&&l.clear(),o}),l=n.cache;return n}gZ.exports=wLe});var bZ=M((T9e,xZ)=>{var TLe=vZ(),ELe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,SLe=/\\(\\)?/g,ILe=TLe(function(s){var n=[];return s.charCodeAt(0)===46&&n.push(""),s.replace(ELe,function(l,o,c,t){n.push(c?t.replace(SLe,"$1"):o||l)}),n});xZ.exports=ILe});var TZ=M((E9e,wZ)=>{function ALe(s,n){for(var l=-1,o=s==null?0:s.length,c=Array(o);++l<o;)c[l]=n(s[l],l,s);return c}wZ.exports=ALe});var CZ=M((S9e,OZ)=>{var EZ=Dm(),OLe=TZ(),CLe=mp(),PLe=km(),MLe=1/0,SZ=EZ?EZ.prototype:void 0,IZ=SZ?SZ.toString:void 0;function AZ(s){if(typeof s=="string")return s;if(CLe(s))return OLe(s,AZ)+"";if(PLe(s))return IZ?IZ.call(s):"";var n=s+"";return n=="0"&&1/s==-MLe?"-0":n}OZ.exports=AZ});var MZ=M((I9e,PZ)=>{var qLe=CZ();function RLe(s){return s==null?"":qLe(s)}PZ.exports=RLe});var Zm=M((A9e,qZ)=>{var DLe=mp(),LLe=yZ(),kLe=bZ(),zLe=MZ();function BLe(s,n){return DLe(s)?s:LLe(s,n)?[s]:kLe(zLe(s))}qZ.exports=BLe});var y0=M((O9e,RZ)=>{var FLe=km(),NLe=1/0;function ULe(s){if(typeof s=="string"||FLe(s))return s;var n=s+"";return n=="0"&&1/s==-NLe?"-0":n}RZ.exports=ULe});var LZ=M((C9e,DZ)=>{var jLe=Zm(),VLe=y0();function GLe(s,n){n=jLe(n,s);for(var l=0,o=n.length;s!=null&&l<o;)s=s[VLe(n[l++])];return l&&l==o?s:void 0}DZ.exports=GLe});var B2=M((P9e,kZ)=>{var $Le=_0(),WLe=function(){try{var s=$Le(Object,"defineProperty");return s({},"",{}),s}catch{}}();kZ.exports=WLe});var FZ=M((M9e,BZ)=>{var zZ=B2();function ZLe(s,n,l){n=="__proto__"&&zZ?zZ(s,n,{configurable:!0,enumerable:!0,value:l,writable:!0}):s[n]=l}BZ.exports=ZLe});var UZ=M((q9e,NZ)=>{var HLe=FZ(),XLe=L2(),YLe=Object.prototype,KLe=YLe.hasOwnProperty;function JLe(s,n,l){var o=s[n];(!(KLe.call(s,n)&&XLe(o,l))||l===void 0&&!(n in s))&&HLe(s,n,l)}NZ.exports=JLe});var F2=M((R9e,jZ)=>{var QLe=9007199254740991,eke=/^(?:0|[1-9]\d*)$/;function tke(s,n){var l=typeof s;return n=n??QLe,!!n&&(l=="number"||l!="symbol"&&eke.test(s))&&s>-1&&s%1==0&&s<n}jZ.exports=tke});var $Z=M((D9e,GZ)=>{var rke=UZ(),ike=Zm(),nke=F2(),VZ=np(),oke=y0();function ake(s,n,l,o){if(!VZ(s))return s;n=ike(n,s);for(var c=-1,t=n.length,g=t-1,I=s;I!=null&&++c<t;){var P=oke(n[c]),q=l;if(P==="__proto__"||P==="constructor"||P==="prototype")return s;if(c!=g){var L=I[P];q=o?o(L,P,I):void 0,q===void 0&&(q=VZ(L)?L:nke(n[c+1])?[]:{})}rke(I,P,q),I=I[P]}return s}GZ.exports=ake});var ZZ=M((L9e,WZ)=>{var ske=LZ(),lke=$Z(),uke=Zm();function cke(s,n,l){for(var o=-1,c=n.length,t={};++o<c;){var g=n[o],I=ske(s,g);l(I,g)&&lke(t,uke(g,s),I)}return t}WZ.exports=cke});var XZ=M((k9e,HZ)=>{function hke(s,n){return s!=null&&n in Object(s)}HZ.exports=hke});var KZ=M((z9e,YZ)=>{var pke=a0(),fke=s0(),dke="[object Arguments]";function mke(s){return fke(s)&&pke(s)==dke}YZ.exports=mke});var N2=M((B9e,e9)=>{var JZ=KZ(),_ke=s0(),QZ=Object.prototype,yke=QZ.hasOwnProperty,gke=QZ.propertyIsEnumerable,vke=JZ(function(){return arguments}())?JZ:function(s){return _ke(s)&&yke.call(s,"callee")&&!gke.call(s,"callee")};e9.exports=vke});var r9=M((F9e,t9)=>{var xke=9007199254740991;function bke(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=xke}t9.exports=bke});var n9=M((N9e,i9)=>{var wke=Zm(),Tke=N2(),Eke=mp(),Ske=F2(),Ike=r9(),Ake=y0();function Oke(s,n,l){n=wke(n,s);for(var o=-1,c=n.length,t=!1;++o<c;){var g=Ake(n[o]);if(!(t=s!=null&&l(s,g)))break;s=s[g]}return t||++o!=c?t:(c=s==null?0:s.length,!!c&&Ike(c)&&Ske(g,c)&&(Eke(s)||Tke(s)))}i9.exports=Oke});var a9=M((U9e,o9)=>{var Cke=XZ(),Pke=n9();function Mke(s,n){return s!=null&&Pke(s,n,Cke)}o9.exports=Mke});var l9=M((j9e,s9)=>{var qke=ZZ(),Rke=a9();function Dke(s,n){return qke(s,n,function(l,o){return Rke(s,o)})}s9.exports=Dke});var c9=M((V9e,u9)=>{function Lke(s,n){for(var l=-1,o=n.length,c=s.length;++l<o;)s[c+l]=n[l];return s}u9.exports=Lke});var d9=M((G9e,f9)=>{var h9=Dm(),kke=N2(),zke=mp(),p9=h9?h9.isConcatSpreadable:void 0;function Bke(s){return zke(s)||kke(s)||!!(p9&&s&&s[p9])}f9.exports=Bke});var y9=M(($9e,_9)=>{var Fke=c9(),Nke=d9();function m9(s,n,l,o,c){var t=-1,g=s.length;for(l||(l=Nke),c||(c=[]);++t<g;){var I=s[t];n>0&&l(I)?n>1?m9(I,n-1,l,o,c):Fke(c,I):o||(c[c.length]=I)}return c}_9.exports=m9});var v9=M((W9e,g9)=>{var Uke=y9();function jke(s){var n=s==null?0:s.length;return n?Uke(s,1):[]}g9.exports=jke});var b9=M((Z9e,x9)=>{function Vke(s,n,l){switch(l.length){case 0:return s.call(n);case 1:return s.call(n,l[0]);case 2:return s.call(n,l[0],l[1]);case 3:return s.call(n,l[0],l[1],l[2])}return s.apply(n,l)}x9.exports=Vke});var E9=M((H9e,T9)=>{var Gke=b9(),w9=Math.max;function $ke(s,n,l){return n=w9(n===void 0?s.length-1:n,0),function(){for(var o=arguments,c=-1,t=w9(o.length-n,0),g=Array(t);++c<t;)g[c]=o[n+c];c=-1;for(var I=Array(n+1);++c<n;)I[c]=o[c];return I[n]=l(g),Gke(s,this,I)}}T9.exports=$ke});var I9=M((X9e,S9)=>{function Wke(s){return function(){return s}}S9.exports=Wke});var O9=M((Y9e,A9)=>{function Zke(s){return s}A9.exports=Zke});var M9=M((K9e,P9)=>{var Hke=I9(),C9=B2(),Xke=O9(),Yke=C9?function(s,n){return C9(s,"toString",{configurable:!0,enumerable:!1,value:Hke(n),writable:!0})}:Xke;P9.exports=Yke});var R9=M((J9e,q9)=>{var Kke=800,Jke=16,Qke=Date.now;function eze(s){var n=0,l=0;return function(){var o=Qke(),c=Jke-(o-l);if(l=o,c>0){if(++n>=Kke)return arguments[0]}else n=0;return s.apply(void 0,arguments)}}q9.exports=eze});var L9=M((Q9e,D9)=>{var tze=M9(),rze=R9(),ize=rze(tze);D9.exports=ize});var z9=M((eHe,k9)=>{var nze=v9(),oze=E9(),aze=L9();function sze(s){return aze(oze(s,void 0,nze),s+"")}k9.exports=sze});var F9=M((tHe,B9)=>{var lze=l9(),uze=z9(),cze=uze(function(s,n){return s==null?{}:lze(s,n)});B9.exports=cze});var U9=M((rHe,N9)=>{"use strict";N9.exports=s=>encodeURIComponent(s).replace(/[!'()*]/g,n=>`%${n.charCodeAt(0).toString(16).toUpperCase()}`)});var W9=M((iHe,$9)=>{"use strict";var G9="%[a-f0-9]{2}",j9=new RegExp(G9,"gi"),V9=new RegExp("("+G9+")+","gi");function U2(s,n){try{return decodeURIComponent(s.join(""))}catch{}if(s.length===1)return s;n=n||1;var l=s.slice(0,n),o=s.slice(n);return Array.prototype.concat.call([],U2(l),U2(o))}function hze(s){try{return decodeURIComponent(s)}catch{for(var n=s.match(j9),l=1;l<n.length;l++)s=U2(n,l).join(""),n=s.match(j9);return s}}function pze(s){for(var n={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},l=V9.exec(s);l;){try{n[l[0]]=decodeURIComponent(l[0])}catch{var o=hze(l[0]);o!==l[0]&&(n[l[0]]=o)}l=V9.exec(s)}n["%C2"]="\uFFFD";for(var c=Object.keys(n),t=0;t<c.length;t++){var g=c[t];s=s.replace(new RegExp(g,"g"),n[g])}return s}$9.exports=function(s){if(typeof s!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof s+"`");try{return s=s.replace(/\+/g," "),decodeURIComponent(s)}catch{return pze(s)}}});var H9=M((nHe,Z9)=>{"use strict";Z9.exports=(s,n)=>{if(!(typeof s=="string"&&typeof n=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(n==="")return[s];let l=s.indexOf(n);return l===-1?[s]:[s.slice(0,l),s.slice(l+n.length)]}});var Y9=M((oHe,X9)=>{"use strict";X9.exports=function(s,n){for(var l={},o=Object.keys(s),c=Array.isArray(n),t=0;t<o.length;t++){var g=o[t],I=s[g];(c?n.indexOf(g)!==-1:n(g,I,s))&&(l[g]=I)}return l}});var nH=M(Mn=>{"use strict";var fze=U9(),dze=W9(),J9=H9(),mze=Y9(),_ze=s=>s==null,j2=Symbol("encodeFragmentIdentifier");function yze(s){switch(s.arrayFormat){case"index":return n=>(l,o)=>{let c=l.length;return o===void 0||s.skipNull&&o===null||s.skipEmptyString&&o===""?l:o===null?[...l,[hi(n,s),"[",c,"]"].join("")]:[...l,[hi(n,s),"[",hi(c,s),"]=",hi(o,s)].join("")]};case"bracket":return n=>(l,o)=>o===void 0||s.skipNull&&o===null||s.skipEmptyString&&o===""?l:o===null?[...l,[hi(n,s),"[]"].join("")]:[...l,[hi(n,s),"[]=",hi(o,s)].join("")];case"colon-list-separator":return n=>(l,o)=>o===void 0||s.skipNull&&o===null||s.skipEmptyString&&o===""?l:o===null?[...l,[hi(n,s),":list="].join("")]:[...l,[hi(n,s),":list=",hi(o,s)].join("")];case"comma":case"separator":case"bracket-separator":{let n=s.arrayFormat==="bracket-separator"?"[]=":"=";return l=>(o,c)=>c===void 0||s.skipNull&&c===null||s.skipEmptyString&&c===""?o:(c=c===null?"":c,o.length===0?[[hi(l,s),n,hi(c,s)].join("")]:[[o,hi(c,s)].join(s.arrayFormatSeparator)])}default:return n=>(l,o)=>o===void 0||s.skipNull&&o===null||s.skipEmptyString&&o===""?l:o===null?[...l,hi(n,s)]:[...l,[hi(n,s),"=",hi(o,s)].join("")]}}function gze(s){let n;switch(s.arrayFormat){case"index":return(l,o,c)=>{if(n=/\[(\d*)\]$/.exec(l),l=l.replace(/\[\d*\]$/,""),!n){c[l]=o;return}c[l]===void 0&&(c[l]={}),c[l][n[1]]=o};case"bracket":return(l,o,c)=>{if(n=/(\[\])$/.exec(l),l=l.replace(/\[\]$/,""),!n){c[l]=o;return}if(c[l]===void 0){c[l]=[o];return}c[l]=[].concat(c[l],o)};case"colon-list-separator":return(l,o,c)=>{if(n=/(:list)$/.exec(l),l=l.replace(/:list$/,""),!n){c[l]=o;return}if(c[l]===void 0){c[l]=[o];return}c[l]=[].concat(c[l],o)};case"comma":case"separator":return(l,o,c)=>{let t=typeof o=="string"&&o.includes(s.arrayFormatSeparator),g=typeof o=="string"&&!t&&ps(o,s).includes(s.arrayFormatSeparator);o=g?ps(o,s):o;let I=t||g?o.split(s.arrayFormatSeparator).map(P=>ps(P,s)):o===null?o:ps(o,s);c[l]=I};case"bracket-separator":return(l,o,c)=>{let t=/(\[\])$/.test(l);if(l=l.replace(/\[\]$/,""),!t){c[l]=o&&ps(o,s);return}let g=o===null?[]:o.split(s.arrayFormatSeparator).map(I=>ps(I,s));if(c[l]===void 0){c[l]=g;return}c[l]=[].concat(c[l],g)};default:return(l,o,c)=>{if(c[l]===void 0){c[l]=o;return}c[l]=[].concat(c[l],o)}}}function Q9(s){if(typeof s!="string"||s.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function hi(s,n){return n.encode?n.strict?fze(s):encodeURIComponent(s):s}function ps(s,n){return n.decode?dze(s):s}function eH(s){return Array.isArray(s)?s.sort():typeof s=="object"?eH(Object.keys(s)).sort((n,l)=>Number(n)-Number(l)).map(n=>s[n]):s}function tH(s){let n=s.indexOf("#");return n!==-1&&(s=s.slice(0,n)),s}function vze(s){let n="",l=s.indexOf("#");return l!==-1&&(n=s.slice(l)),n}function rH(s){s=tH(s);let n=s.indexOf("?");return n===-1?"":s.slice(n+1)}function K9(s,n){return n.parseNumbers&&!Number.isNaN(Number(s))&&typeof s=="string"&&s.trim()!==""?s=Number(s):n.parseBooleans&&s!==null&&(s.toLowerCase()==="true"||s.toLowerCase()==="false")&&(s=s.toLowerCase()==="true"),s}function iH(s,n){n=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},n),Q9(n.arrayFormatSeparator);let l=gze(n),o=Object.create(null);if(typeof s!="string"||(s=s.trim().replace(/^[?#&]/,""),!s))return o;for(let c of s.split("&")){if(c==="")continue;let[t,g]=J9(n.decode?c.replace(/\+/g," "):c,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(n.arrayFormat)?g:ps(g,n),l(ps(t,n),g,o)}for(let c of Object.keys(o)){let t=o[c];if(typeof t=="object"&&t!==null)for(let g of Object.keys(t))t[g]=K9(t[g],n);else o[c]=K9(t,n)}return n.sort===!1?o:(n.sort===!0?Object.keys(o).sort():Object.keys(o).sort(n.sort)).reduce((c,t)=>{let g=o[t];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?c[t]=eH(g):c[t]=g,c},Object.create(null))}Mn.extract=rH;Mn.parse=iH;Mn.stringify=(s,n)=>{if(!s)return"";n=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},n),Q9(n.arrayFormatSeparator);let l=g=>n.skipNull&&_ze(s[g])||n.skipEmptyString&&s[g]==="",o=yze(n),c={};for(let g of Object.keys(s))l(g)||(c[g]=s[g]);let t=Object.keys(c);return n.sort!==!1&&t.sort(n.sort),t.map(g=>{let I=s[g];return I===void 0?"":I===null?hi(g,n):Array.isArray(I)?I.length===0&&n.arrayFormat==="bracket-separator"?hi(g,n)+"[]":I.reduce(o(g),[]).join("&"):hi(g,n)+"="+hi(I,n)}).filter(g=>g.length>0).join("&")};Mn.parseUrl=(s,n)=>{n=Object.assign({decode:!0},n);let[l,o]=J9(s,"#");return Object.assign({url:l.split("?")[0]||"",query:iH(rH(s),n)},n&&n.parseFragmentIdentifier&&o?{fragmentIdentifier:ps(o,n)}:{})};Mn.stringifyUrl=(s,n)=>{n=Object.assign({encode:!0,strict:!0,[j2]:!0},n);let l=tH(s.url).split("?")[0]||"",o=Mn.extract(s.url),c=Mn.parse(o,{sort:!1}),t=Object.assign(c,s.query),g=Mn.stringify(t,n);g&&(g=`?${g}`);let I=vze(s.url);return s.fragmentIdentifier&&(I=`#${n[j2]?hi(s.fragmentIdentifier,n):s.fragmentIdentifier}`),`${l}${g}${I}`};Mn.pick=(s,n,l)=>{l=Object.assign({parseFragmentIdentifier:!0,[j2]:!1},l);let{url:o,query:c,fragmentIdentifier:t}=Mn.parseUrl(s,l);return Mn.stringifyUrl({url:o,query:mze(c,n),fragmentIdentifier:t},l)};Mn.exclude=(s,n,l)=>{let o=Array.isArray(n)?c=>!n.includes(c):(c,t)=>!n(c,t);return Mn.pick(s,o,l)}});var G2=M((yHe,fH)=>{var yp=1e3,gp=yp*60,vp=gp*60,Ku=vp*24,Ize=Ku*7,Aze=Ku*365.25;fH.exports=function(s,n){n=n||{};var l=typeof s;if(l==="string"&&s.length>0)return Oze(s);if(l==="number"&&isFinite(s))return n.long?Pze(s):Cze(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function Oze(s){if(s=String(s),!(s.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!n){var l=parseFloat(n[1]),o=(n[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return l*Aze;case"weeks":case"week":case"w":return l*Ize;case"days":case"day":case"d":return l*Ku;case"hours":case"hour":case"hrs":case"hr":case"h":return l*vp;case"minutes":case"minute":case"mins":case"min":case"m":return l*gp;case"seconds":case"second":case"secs":case"sec":case"s":return l*yp;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function Cze(s){var n=Math.abs(s);return n>=Ku?Math.round(s/Ku)+"d":n>=vp?Math.round(s/vp)+"h":n>=gp?Math.round(s/gp)+"m":n>=yp?Math.round(s/yp)+"s":s+"ms"}function Pze(s){var n=Math.abs(s);return n>=Ku?v0(s,n,Ku,"day"):n>=vp?v0(s,n,vp,"hour"):n>=gp?v0(s,n,gp,"minute"):n>=yp?v0(s,n,yp,"second"):s+" ms"}function v0(s,n,l,o){var c=n>=l*1.5;return Math.round(s/l)+" "+o+(c?"s":"")}});var xH=M((W2,Z2)=>{(function(s,n){typeof W2=="object"&&typeof Z2<"u"?Z2.exports=n():typeof define=="function"&&define.amd?define(n):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=n())})(W2,function(){"use strict";var s,n,l;function o(t,g){if(!s)s=g;else if(!n)n=g;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",P={};s(P),l=g(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}o(["exports"],function(t){"use strict";var g=typeof self<"u"?self:{},I=P;function P(i,e,r,u){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=u,this.p2x=r,this.p2y=u}P.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},P.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},P.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},P.prototype.solveCurveX=function(i,e){var r,u,p,d,_;for(e===void 0&&(e=1e-6),p=i,_=0;_<8;_++){if(d=this.sampleCurveX(p)-i,Math.abs(d)<e)return p;var y=this.sampleCurveDerivativeX(p);if(Math.abs(y)<1e-6)break;p-=d/y}if((p=i)<(r=0))return r;if(p>(u=1))return u;for(;r<u;){if(d=this.sampleCurveX(p),Math.abs(d-i)<e)return p;i>d?r=p:u=p,p=.5*(u-r)+r}return p},P.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var q=L;function L(i,e){this.x=i,this.y=e}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),u=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=u,this},_rotateAround:function(i,e){var r=Math.cos(i),u=Math.sin(i),p=e.y+u*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-u*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(i){return i instanceof L?i:Array.isArray(i)?new L(i[0],i[1]):i};let V=Math.PI/180,oe=180/Math.PI;function ne(i){return i*V}function Ie(i){return i*oe}let Se=[[0,0],[1,0],[1,1],[0,1]];function Re(i){if(i<=0)return 0;if(i>=1)return 1;let e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function Ze(i,e,r,u){let p=new I(i,e,r,u);return function(d){return p.solve(d)}}let et=Ze(.25,.1,.25,1);function He(i,e,r){return Math.min(r,Math.max(e,i))}function It(i,e,r){return(r=He((r-i)/(e-i),0,1))*r*(3-2*r)}function Yt(i,e,r){let u=r-e,p=((i-e)%u+u)%u+e;return p===e?r:p}function At(i,e,r){if(!i.length)return r(null,[]);let u=i.length,p=new Array(i.length),d=null;i.forEach((_,y)=>{e(_,(b,w)=>{b&&(d=b),p[y]=w,--u==0&&r(d,p)})})}function Nt(i){let e=[];for(let r in i)e.push(i[r]);return e}function wt(i,...e){for(let r of e)for(let u in r)i[u]=r[u];return i}let Ht=1;function pi(){return Ht++}function yi(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function gr(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function ni(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function ei(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Me(i,e){return i.indexOf(e,i.length-e.length)!==-1}function tt(i,e,r){let u={};for(let p in i)u[p]=e.call(r||this,i[p],p,i);return u}function ke(i,e,r){let u={};for(let p in i)e.call(r||this,i[p],p,i)&&(u[p]=i[p]);return u}function Le(i){return Array.isArray(i)?i.map(Le):typeof i=="object"&&i?tt(i,Le):i}let rt={};function ot(i){rt[i]||(typeof console<"u"&&console.warn(i),rt[i]=!0)}function vt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function nr(i){let e=0;for(let r,u,p=0,d=i.length,_=d-1;p<d;_=p++)r=i[p],u=i[_],e+=(u.x-r.x)*(r.y+u.y);return e}function Xt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ir(i){let e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,u,p,d)=>{let _=p||d;return e[u]=!_||_.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Yr=null;function ti(i){if(Yr==null){let e=i.navigator?i.navigator.userAgent:null;Yr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yr}function co(i){try{let e=g[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Li(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}let fn=g.performance;function Ia(i){let e=i?i.url.toString():void 0;return fn.getEntriesByName(e)}var Aa="2.10.0";let er,ho,Oa,Wn,dn={now:()=>Oa!==void 0?Oa:g.performance.now(),setNow(i){Oa=i},restoreNow(){Oa=void 0},frame(i){let e=g.requestAnimationFrame(i);return{cancel:()=>g.cancelAnimationFrame(e)}},getImageData(i,e=0){let{width:r,height:u}=i;Wn||(Wn=g.document.createElement("canvas"));let p=Wn.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return(r>Wn.width||u>Wn.height)&&(Wn.width=r,Wn.height=u),p.clearRect(-e,-e,r+2*e,u+2*e),p.drawImage(i,0,0,r,u),p.getImageData(-e,-e,r+2*e,u+2*e)},resolveURL:i=>(er||(er=g.document.createElement("a")),er.href=i,er.href),get devicePixelRatio(){return g.devicePixelRatio},get prefersReducedMotion(){return!!g.matchMedia&&(ho==null&&(ho=g.matchMedia("(prefers-reduced-motion: reduce)")),ho.matches)}},fs,Jt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(fs==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{fs=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{fs=i}}return fs},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},No={supported:!1,testSupport:function(i){!Ca&&fo&&(ds?wl(i):po=i)}},po,fo,Ca=!1,ds=!1;function wl(i){let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,fo),i.isContextLost())return;No.supported=!0}catch{}i.deleteTexture(e),Ca=!0}g.document&&(fo=g.document.createElement("img"),fo.onload=function(){po&&wl(po),po=null,ds=!0},fo.onerror=function(){Ca=!0,po=null},fo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Tl="01",Ki="NO_ACCESS_TOKEN";function Zn(i){return i.indexOf("mapbox:")===0}function Pa(i){return Jt.API_URL_REGEX.test(i)}let Ju=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ji(i){let e=i.match(Ju);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function mo(i){let e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Qu(i){if(!i)return null;let e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(g.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class El{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let r=Qu(Jt.ACCESS_TOKEN),u="";return u=r&&r.u?g.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(p,d)=>String.fromCharCode(Number("0x"+d)))):Jt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){let e=co("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{let p=g.localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));let d=g.localStorage.getItem(u);d&&(this.anonId=d)}catch{ot("Unable to read from LocalStorage")}}saveEventData(){let e=co("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{g.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&g.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{ot("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,u,p){if(!Jt.EVENTS_URL)return;let d=Ji(Jt.EVENTS_URL);d.params.push(`access_token=${p||Jt.ACCESS_TOKEN||""}`);let _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Aa,skuId:Tl,userId:this.anonId},y=r?wt(_,r):_,b={url:mo(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=Ge(b,w=>{this.pendingRequest=null,u(w),this.saveEventData(),this.processRequests(p)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}let Sl=new class extends El{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Jt.EVENTS_URL&&Jt.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Zn(r)||Pa(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Qu(Jt.ACCESS_TOKEN),r=e?e.u:Jt.ACCESS_TOKEN,u=r!==this.eventData.tokenU;ni(this.anonId)||(this.anonId=yi(),u=!0);let p=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),_=new Date(p),y=(p-this.eventData.lastSuccess)/864e5;u=u||y>=1||y<-1||d.getDate()!==_.getDate()}else u=!0;u?this.postEvent(p,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)},i):this.processRequests()}},Il=Sl.postTurnstileEvent.bind(Sl),Al=new class extends El{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,u){this.skuToken=e,this.errorCb=u,Jt.EVENTS_URL&&(r||Jt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Ki)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ni(this.anonId)||(this.anonId=yi()),this.postEvent(r,{skuToken:this.skuToken},u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},i))}},ec=Al.postMapLoadEvent.bind(Al),tc=new class extends El{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,u){if(!Jt.API_URL||!Jt.SESSION_PATH)return;let p=Ji(Jt.API_URL+Jt.SESSION_PATH);p.params.push(`sku=${e||""}`),p.params.push(`access_token=${u||Jt.ACCESS_TOKEN||""}`);let d={url:mo(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ut(d,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,e,r,u){this.skuToken=e,this.errorCb=u,Jt.SESSION_PATH&&Jt.API_URL&&(r||Jt.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Ki)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},i)}},Tp=tc.getSessionAPI.bind(tc),Uo=new Set,_o,ms=500,rc=50,ji={};function Ol(i){let e=N(i),r,u;e&&e.forEach(d=>{let _=d.split("=");_[0]==="language"?r=_[1]:_[0]==="worldview"&&(u=_[1])});let p="mapbox-tiles";return r&&(p+=`-${r}`),u&&(p+=`-${u}`),p}function Q(){try{return g.caches}catch{}}function B(i){let e=Q();e&&!ji[i]&&(ji[i]=e.open(i))}function N(i){let e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function K(i){let e=i.indexOf("?");if(e<0)return i;let r=N(i).filter(u=>{let p=u.split("=");return p[0]==="language"||p[0]==="worldview"});return r.length?`${i.slice(0,e)}?${r.join("&")}`:i.slice(0,e)}let re=1/0,_e={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_e);class be extends Error{constructor(e,r,u){r===401&&Pa(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let ve=Xt()?()=>self.worker&&self.worker.referrer:()=>(g.location.protocol==="blob:"?g.parent:g).location.href,ye=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(ve())&&!/^\w+:/.test(r))){if(g.fetch&&g.Request&&g.AbortController&&g.Request.prototype.hasOwnProperty("signal"))return function(u,p){let d=new g.AbortController,_=new g.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ve(),signal:d.signal}),y=!1,b=!1,w=(S=_.url).indexOf("sku=")>0&&Pa(S);var S;u.type==="json"&&_.headers.set("Accept","application/json");let O=(k,z,U)=>{if(b)return;if(k&&k.message!=="SecurityError"&&ot(k),z&&U)return C(z);let G=Date.now();g.fetch(_).then(J=>{if(J.ok){let le=w?J.clone():null;return C(J,le,G)}return p(new be(J.statusText,J.status,u.url))}).catch(J=>{J.code!==20&&p(new Error(J.message))})},C=(k,z,U)=>{(u.type==="arrayBuffer"?k.arrayBuffer():u.type==="json"?k.json():k.text()).then(G=>{b||(z&&U&&function(J,le,te){let ae=Ol(J.url);if(B(ae),!ji[ae])return;let me={status:le.status,statusText:le.statusText,headers:new g.Headers};le.headers.forEach((Ae,De)=>me.headers.set(De,Ae));let ce=Ir(le.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&me.headers.set("Expires",new Date(te+1e3*ce["max-age"]).toUTCString());let Oe=me.headers.get("Expires");Oe&&(new Date(Oe).getTime()-te<42e4||function(Ae,De){if(_o===void 0)try{new Response(new ReadableStream),_o=!0}catch{_o=!1}_o?De(Ae.body):Ae.blob().then(De)}(le,Ae=>{let De=new g.Response(Ae,me);B(ae),ji[ae]&&ji[ae].then(Qe=>Qe.put(K(J.url),De)).catch(Qe=>ot(Qe.message))}))}(_,z,U),y=!0,p(null,G,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(G=>{b||p(new Error(G.message))})};return w?function(k,z){let U=Ol(k.url);if(B(U),!ji[U])return z(null);let G=K(k.url);ji[U].then(J=>{J.match(G).then(le=>{let te=function(ae){if(!ae)return!1;let me=new Date(ae.headers.get("Expires")||0),ce=Ir(ae.headers.get("Cache-Control")||"");return me>Date.now()&&!ce["no-cache"]}(le);J.delete(G),te&&J.put(G,le.clone()),z(null,le,te)}).catch(z)}).catch(z)}(_,O):O(null,null),{cancel:()=>{b=!0,y||d.abort()}}}(i,e);if(Xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(u,p){let d=new g.XMLHttpRequest;d.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let _ in u.headers)d.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=u.credentials==="include",d.onerror=()=>{p(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let _=d.response;if(u.type==="json")try{_=JSON.parse(d.response)}catch(y){return p(y)}p(null,_,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else p(new be(d.statusText,d.status,u.url))},d.send(u.body),{cancel:()=>d.abort()}}(i,e)},Te=function(i,e){return ye(wt(i,{type:"arrayBuffer"}),e)},Ge=function(i,e){return ye(wt(i,{method:"POST"}),e)},ut=function(i,e){return ye(wt(i,{method:"GET"}),e)};function Xe(i){let e=g.document.createElement("a");return e.href=i,e.protocol===g.document.location.protocol&&e.host===g.document.location.host}let St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ot,xt;Ot=[],xt=0;let Pt=function(i,e){if(No.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),xt>=Jt.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ot.push(d),d}xt++;let r=!1,u=()=>{if(!r)for(r=!0,xt--;Ot.length&&xt<Jt.MAX_PARALLEL_IMAGE_REQUESTS;){let d=Ot.shift(),{requestParameters:_,callback:y,cancelled:b}=d;b||(d.cancel=Pt(_,y).cancel)}},p=Te(i,(d,_,y,b)=>{u(),d?e(d):_&&(g.createImageBitmap?function(w,S){let O=new g.Blob([new Uint8Array(w)],{type:"image/png"});g.createImageBitmap(O).then(C=>{S(null,C)}).catch(C=>{S(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(w,S)=>e(w,S,y,b)):function(w,S){let O=new g.Image,C=g.URL;O.onload=()=>{S(null,O),C.revokeObjectURL(O.src),O.onload=null,g.requestAnimationFrame(()=>{O.src=St})},O.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let k=new g.Blob([new Uint8Array(w)],{type:"image/png"});O.src=w.byteLength?C.createObjectURL(k):St}(_,(w,S)=>e(w,S,y,b)))});return{cancel:()=>{p.cancel(),u()}}};function Ut(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function dr(i,e,r){if(r&&r[i]){let u=r[i].indexOf(e);u!==-1&&r[i].splice(u,1)}}class Tr{constructor(e,r={}){wt(this,r),this.type=e}}class mr extends Tr{constructor(e,r={}){super("error",wt({error:e},r))}}class Et{on(e,r){return this._listeners=this._listeners||{},Ut(e,r,this._listeners),this}off(e,r){return dr(e,r,this._listeners),dr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ut(e,r,this._oneTimeListeners),this):new Promise(u=>this.once(e,u))}fire(e,r){typeof e=="string"&&(e=new Tr(e,r||{}));let u=e.type;if(this.listens(u)){e.target=this;let p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(let y of p)y.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(let y of d)dr(u,y,this._oneTimeListeners),y.call(this,e);let _=this._eventedParent;_&&(wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof mr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var qe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Qi(i,...e){for(let r of e)for(let u in r)i[u]=r[u];return i}function Gr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function jo(i){if(Array.isArray(i))return i.map(jo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let e={};for(let r in i)e[r]=jo(i[r]);return e}return Gr(i)}class ic extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var qn=ic;class nc{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[u,p]of r)this.bindings[u]=p}concat(e){return new nc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var E0=nc;let _s={kind:"null"},ct={kind:"number"},Vt={kind:"string"},Gt={kind:"boolean"},Rn={kind:"color"},Dn={kind:"object"},zt={kind:"value"},Cl={kind:"collator"},Pl={kind:"formatted"},Ml={kind:"resolvedImage"};function en(i,e){return{kind:"array",itemType:i,N:e}}function Nr(i){if(i.kind==="array"){let e=Nr(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}let Jm=[_s,ct,Vt,Gt,Rn,Pl,Dn,en(zt),Ml];function ys(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ys(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(let r of Jm)if(!ys(r,e))return null}}return`Expected ${Nr(i)} but found ${Nr(e)} instead.`}function oc(i,e){return e.some(r=>r.kind===i.kind)}function Vo(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Ep(i){var e={exports:{}};return i(e,e.exports),e.exports}var Go=Ep(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(y){return(y=Math.round(y))<0?0:y>255?255:y}function p(y){return u(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(b=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function _(y,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(b-y)*w*6:2*w<1?b:3*w<2?y+(b-y)*(2/3-w)*6:y}try{e.parseCSSColor=function(y){var b,w=y.replace(/ /g,"").toLowerCase();if(w in r)return r[w].slice();if(w[0]==="#")return w.length===4?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:w.length===7&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var S=w.indexOf("("),O=w.indexOf(")");if(S!==-1&&O+1===w.length){var C=w.substr(0,S),k=w.substr(S+1,O-(S+1)).split(","),z=1;switch(C){case"rgba":if(k.length!==4)return null;z=d(k.pop());case"rgb":return k.length!==3?null:[p(k[0]),p(k[1]),p(k[2]),z];case"hsla":if(k.length!==4)return null;z=d(k.pop());case"hsl":if(k.length!==3)return null;var U=(parseFloat(k[0])%360+360)%360/360,G=d(k[1]),J=d(k[2]),le=J<=.5?J*(G+1):J+G-J*G,te=2*J-le;return[u(255*_(te,le,U+1/3)),u(255*_(te,le,U)),u(255*_(te,le,U-1/3)),z];default:return null}}return null}}catch{}});class ki{constructor(e,r,u,p=1){this.r=e,this.g=r,this.b=u,this.a=p}static parse(e){if(!e)return;if(e instanceof ki)return e;if(typeof e!="string")return;let r=Go.parseCSSColor(e);return r?new ki(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[e,r,u,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(u)},${p})`}toArray(){let{r:e,g:r,b:u,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*u/p,p]}toArray01(){let{r:e,g:r,b:u,a:p}=this;return p===0?[0,0,0,0]:[e/p,r/p,u/p,p]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:u,a:p}=this;return[e,r,u,p]}}ki.black=new ki(0,0,0,1),ki.white=new ki(1,1,1,1),ki.transparent=new ki(0,0,0,0),ki.red=new ki(1,0,0,1),ki.blue=new ki(0,0,1,1);var vr=ki;class Sp{constructor(e,r,u){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ql{constructor(e,r,u,p,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=u,this.fontStack=p,this.textColor=d}}class Vi{constructor(e){this.sections=e}static fromString(e){return new Vi([new ql(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Vi?e:Vi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);let u={};r.fontStack&&(u["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(u["font-scale"]=r.scale),r.textColor&&(u["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(u)}return e}}class Gi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Gi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ip(i,e,r,u){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,e,r,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,e,r,u]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $o(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof vr||i instanceof Sp||i instanceof Vi||i instanceof Gi)return!0;if(Array.isArray(i)){for(let e of i)if(!$o(e))return!1;return!0}if(typeof i=="object"){for(let e in i)if(!$o(i[e]))return!1;return!0}return!1}function Kr(i){if(i===null)return _s;if(typeof i=="string")return Vt;if(typeof i=="boolean")return Gt;if(typeof i=="number")return ct;if(i instanceof vr)return Rn;if(i instanceof Sp)return Cl;if(i instanceof Vi)return Pl;if(i instanceof Gi)return Ml;if(Array.isArray(i)){let e=i.length,r;for(let u of i){let p=Kr(u);if(r){if(r===p)continue;r=zt;break}r=p}return en(r||zt,e)}return Dn}function Rl(i){let e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof vr||i instanceof Vi||i instanceof Gi?i.toString():JSON.stringify(i)}class Ap{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!$o(e[1]))return r.error("invalid value");let u=e[1],p=Kr(u),d=r.expectedType;return p.kind!=="array"||p.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(p=d),new Ap(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vr?["rgba"].concat(this.value.toArray()):this.value instanceof Vi?this.value.serialize():this.value}}var Dl=Ap,fi=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};let Ll={string:Vt,number:ct,boolean:Gt,object:Dn};class Op{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let u,p=1,d=e[0];if(d==="array"){let y,b;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in Ll)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ll[w],p++}else y=zt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],p++}u=en(y,b)}else u=Ll[d];let _=[];for(;p<e.length;p++){let y=r.parse(e[p],p,zt);if(!y)return null;_.push(y)}return new Op(u,_)}evaluate(e){for(let r=0;r<this.args.length;r++){let u=this.args[r].evaluate(e);if(!ys(this.type,Kr(u)))return u;if(r===this.args.length-1)throw new fi(`Expected value to be of type ${Nr(this.type)}, but found ${Nr(Kr(u))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){r.push(u.kind);let p=e.N;(typeof p=="number"||this.args.length>1)&&r.push(p)}}return r.concat(this.args.map(u=>u.serialize()))}}var mn=Op;class kl{constructor(e){this.type=Pl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let u=e[1];if(!Array.isArray(u)&&typeof u=="object")return r.error("First argument must be an image or text section.");let p=[],d=!1;for(let _=1;_<=e.length-1;++_){let y=e[_];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,ct),!b))return null;let w=null;if(y["text-font"]&&(w=r.parse(y["text-font"],1,en(Vt)),!w))return null;let S=null;if(y["text-color"]&&(S=r.parse(y["text-color"],1,Rn),!S))return null;let O=p[p.length-1];O.scale=b,O.font=w,O.textColor=S}else{let b=r.parse(e[_],1,zt);if(!b)return null;let w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,p.push({content:b,scale:null,font:null,textColor:null})}}return new kl(p)}evaluate(e){return new Vi(this.sections.map(r=>{let u=r.content.evaluate(e);return Kr(u)===Ml?new ql("",u,null,null,null):new ql(Rl(u),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let u={};r.scale&&(u["font-scale"]=r.scale.serialize()),r.font&&(u["text-font"]=r.font.serialize()),r.textColor&&(u["text-color"]=r.textColor.serialize()),e.push(u)}return e}}class ac{constructor(e){this.type=Ml,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");let u=r.parse(e[1],1,Vt);return u?new ac(u):r.error("No image name provided.")}evaluate(e){let r=this.input.evaluate(e),u=Gi.fromString(r);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(r)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let S0={"to-boolean":Gt,"to-color":Rn,"to-number":ct,"to-string":Vt};class Cp{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let u=e[0];if((u==="to-boolean"||u==="to-string")&&e.length!==2)return r.error("Expected one argument.");let p=S0[u],d=[];for(let _=1;_<e.length;_++){let y=r.parse(e[_],_,zt);if(!y)return null;d.push(y)}return new Cp(p,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,u;for(let p of this.args){if(r=p.evaluate(e),u=null,r instanceof vr)return r;if(typeof r=="string"){let d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(u=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ip(r[0],r[1],r[2],r[3]),!u))return new vr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new fi(u||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let u of this.args){if(r=u.evaluate(e),r===null)return 0;let p=Number(r);if(!isNaN(p))return p}throw new fi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Vi.fromString(Rl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Gi.fromString(Rl(this.args[0].evaluate(e))):Rl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ac(this.args[0]).serialize();let e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var gs=Cp;let I0=["Unknown","Point","LineString","Polygon"];var Qm=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?I0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-i[0])+this.featureDistanceData.bearing[1]*(u*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=vr.parse(i)),e}};class Ma{constructor(e,r,u,p){this.name=e,this.type=r,this._evaluate=u,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let u=e[0],p=Ma.definitions[u];if(!p)return r.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,y=_.filter(([w])=>!Array.isArray(w)||w.length===e.length-1),b=null;for(let[w,S]of y){b=new Ra(r.registry,r.path,null,r.scope);let O=[],C=!1;for(let k=1;k<e.length;k++){let z=e[k],U=Array.isArray(w)?w[k-1]:w.type,G=b.parse(z,1+O.length,U);if(!G){C=!0;break}O.push(G)}if(!C)if(Array.isArray(w)&&w.length!==O.length)b.error(`Expected ${w.length} arguments, but found ${O.length} instead.`);else{for(let k=0;k<O.length;k++){let z=Array.isArray(w)?w[k]:w.type,U=O[k];b.concat(k+1).checkSubtype(z,U.type)}if(b.errors.length===0)return new Ma(u,d,S,O)}}if(y.length===1)r.errors.push(...b.errors);else{let w=(y.length?y:_).map(([O])=>{return C=O,Array.isArray(C)?`(${C.map(Nr).join(", ")})`:`(${Nr(C.type)}...)`;var C}).join(" | "),S=[];for(let O=1;O<e.length;O++){let C=r.parse(e[O],1+S.length);if(!C)return null;S.push(Nr(C.type))}r.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,r){Ma.definitions=r;for(let u in r)e[u]=Ma}}var Ln=Ma;class sc{constructor(e,r,u){this.type=Cl,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let u=e[1];if(typeof u!="object"||Array.isArray(u))return r.error("Collator options argument must be an object.");let p=r.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Gt);if(!p)return null;let d=r.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Gt);if(!d)return null;let _=null;return u.locale&&(_=r.parse(u.locale,1,Vt),!_)?null:new sc(p,d,_)}evaluate(e){return new Sp(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}let Wo=8192;function Pp(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function lc(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function A0(i,e){let r=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*Wo),Math.round(u*p*Wo)]}function O0(i,e,r){let u=i[0]-e[0],p=i[1]-e[1],d=i[0]-r[0],_=i[1]-r[1];return u*_-d*p==0&&u*d<=0&&p*_<=0}function uc(i,e){let r=!1;for(let _=0,y=e.length;_<y;_++){let b=e[_];for(let w=0,S=b.length;w<S-1;w++){if(O0(i,b[w],b[w+1]))return!1;(p=b[w])[1]>(u=i)[1]!=(d=b[w+1])[1]>u[1]&&u[0]<(d[0]-p[0])*(u[1]-p[1])/(d[1]-p[1])+p[0]&&(r=!r)}}var u,p,d;return r}function cc(i,e){for(let r=0;r<e.length;r++)if(uc(i,e[r]))return!0;return!1}function e_(i,e,r,u){let p=u[0]-r[0],d=u[1]-r[1],_=(i[0]-r[0])*d-p*(i[1]-r[1]),y=(e[0]-r[0])*d-p*(e[1]-r[1]);return _>0&&y<0||_<0&&y>0}function C0(i,e,r){for(let w of r)for(let S=0;S<w.length-1;++S)if((y=[(_=w[S+1])[0]-(d=w[S])[0],_[1]-d[1]])[0]*(b=[(p=e)[0]-(u=i)[0],p[1]-u[1]])[1]-y[1]*b[0]!=0&&e_(u,p,d,_)&&e_(d,_,u,p))return!0;var u,p,d,_,y,b;return!1}function t_(i,e){for(let r=0;r<i.length;++r)if(!uc(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(C0(i[r],i[r+1],e))return!1;return!0}function P0(i,e){for(let r=0;r<e.length;r++)if(t_(i,e[r]))return!0;return!1}function _n(i,e,r){let u=[];for(let p=0;p<i.length;p++){let d=[];for(let _=0;_<i[p].length;_++){let y=A0(i[p][_],r);Pp(e,y),d.push(y)}u.push(d)}return u}function Mp(i,e,r){let u=[];for(let p=0;p<i.length;p++){let d=_n(i[p],e,r);u.push(d)}return u}function qp(i,e,r,u){if(i[0]<r[0]||i[0]>r[2]){let p=.5*u,d=i[0]-r[0]>p?-u:r[0]-i[0]>p?u:0;d===0&&(d=i[0]-r[2]>p?-u:r[2]-i[0]>p?u:0),i[0]+=d}Pp(e,i)}function Rp(i,e,r,u){let p=Math.pow(2,u.z)*Wo,d=[u.x*Wo,u.y*Wo],_=[];if(!i)return _;for(let y of i)for(let b of y){let w=[b.x+d[0],b.y+d[1]];qp(w,e,r,p),_.push(w)}return _}function Dp(i,e,r,u){let p=Math.pow(2,u.z)*Wo,d=[u.x*Wo,u.y*Wo],_=[];if(!i)return _;for(let b of i){let w=[];for(let S of b){let O=[S.x+d[0],S.y+d[1]];Pp(e,O),w.push(O)}_.push(w)}if(e[2]-e[0]<=p/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(let b of _)for(let w of b)qp(w,e,r,p)}var y;return _}class vs{constructor(e,r){this.type=Gt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if($o(e[1])){let u=e[1];if(u.type==="FeatureCollection")for(let p=0;p<u.features.length;++p){let d=u.features[p].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new vs(u,u.features[p].geometry)}else if(u.type==="Feature"){let p=u.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new vs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new vs(u,u)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,u){let p=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(u.type==="Polygon"){let y=_n(u.coordinates,d,_),b=Rp(r.geometry(),p,d,_);if(!lc(p,d))return!1;for(let w of b)if(!uc(w,y))return!1}if(u.type==="MultiPolygon"){let y=Mp(u.coordinates,d,_),b=Rp(r.geometry(),p,d,_);if(!lc(p,d))return!1;for(let w of b)if(!cc(w,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,u){let p=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(u.type==="Polygon"){let y=_n(u.coordinates,d,_),b=Dp(r.geometry(),p,d,_);if(!lc(p,d))return!1;for(let w of b)if(!t_(w,y))return!1}if(u.type==="MultiPolygon"){let y=Mp(u.coordinates,d,_),b=Dp(r.geometry(),p,d,_);if(!lc(p,d))return!1;for(let w of b)if(!P0(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var hc=vs;function qa(i){if(i instanceof Ln&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof hc)return!1;let e=!0;return i.eachChild(r=>{e&&!qa(r)&&(e=!1)}),e}function Zo(i){if(i instanceof Ln&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Zo(r)&&(e=!1)}),e}function zl(i,e){if(i instanceof Ln&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(u=>{r&&!zl(u,e)&&(r=!1)}),r}class pc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let u=e[1];return r.scope.has(u)?new pc(u,r.scope.get(u)):r.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var fc=pc;class dc{constructor(e,r=[],u,p=new E0,d=[]){this.registry=e,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=d,this.expectedType=u}parse(e,r,u,p,d={}){return r?this.concat(r,u,p)._parse(e,d):this._parse(e,d)}_parse(e,r){function u(p,d,_){return _==="assert"?new mn(d,[p]):_==="coerce"?new gs(d,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let d=this.registry[p];if(d){let _=d.parse(e,this);if(!_)return null;if(this.expectedType){let y=this.expectedType,b=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else _=u(_,y,r.typeAnnotation||"coerce");else _=u(_,y,r.typeAnnotation||"assert")}if(!(_ instanceof Dl)&&_.type.kind!=="resolvedImage"&&or(_)){let y=new Qm;try{_=new Dl(_.type,_.evaluate(y))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,u){let p=typeof e=="number"?this.path.concat(e):this.path,d=u?this.scope.concat(u):this.scope;return new dc(this.registry,p,r||null,d,this.errors)}error(e,...r){let u=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new qn(u,e))}checkSubtype(e,r){let u=ys(e,r);return u&&this.error(u),u}}var Ra=dc;function or(i){if(i instanceof fc)return or(i.boundExpression);if(i instanceof Ln&&i.name==="error"||i instanceof sc||i instanceof hc)return!1;let e=i instanceof gs||i instanceof mn,r=!0;return i.eachChild(u=>{r=e?r&&or(u):r&&u instanceof Dl}),!!r&&qa(i)&&zl(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function mc(i,e){let r=i.length-1,u,p,d=0,_=r,y=0;for(;d<=_;)if(y=Math.floor((d+_)/2),u=i[y],p=i[y+1],u<=e){if(y===r||e<p)return y;d=y+1}else{if(!(u>e))throw new fi("Input is not a number.");_=y-1}return 0}class Lp{constructor(e,r,u){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[p,d]of u)this.labels.push(p),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let u=r.parse(e[1],1,ct);if(!u)return null;let p=[],d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let _=1;_<e.length;_+=2){let y=_===1?-1/0:e[_],b=e[_+1],w=_,S=_+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(p.length&&p[p.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let O=r.parse(b,S,d);if(!O)return null;d=d||O.type,p.push([y,O])}return new Lp(d,u,p)}evaluate(e){let r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(e);let p=this.input.evaluate(e);if(p<=r[0])return u[0].evaluate(e);let d=r.length;return p>=r[d-1]?u[d-1].evaluate(e):u[mc(r,p)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var kp=Lp;function tr(i,e,r){return i*(1-r)+e*r}function xs(i,e,r){return i.map((u,p)=>tr(u,e[p],r))}var Bl=Object.freeze({__proto__:null,number:tr,color:function(i,e,r){return new vr(tr(i.r,e.r,r),tr(i.g,e.g,r),tr(i.b,e.b,r),tr(i.a,e.a,r))},array:xs});let zp=.95047,Bp=1.08883,Fp=4/29,Ho=6/29,Fl=3*Ho*Ho,M0=Math.PI/180,Np=180/Math.PI;function _c(i){return i>.008856451679035631?Math.pow(i,1/3):i/Fl+Fp}function Up(i){return i>Ho?i*i*i:Fl*(i-Fp)}function jp(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function yc(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function r_(i){let e=yc(i.r),r=yc(i.g),u=yc(i.b),p=_c((.4124564*e+.3575761*r+.1804375*u)/zp),d=_c((.2126729*e+.7151522*r+.072175*u)/1);return{l:116*d-16,a:500*(p-d),b:200*(d-_c((.0193339*e+.119192*r+.9503041*u)/Bp)),alpha:i.a}}function Vp(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,u=isNaN(i.b)?e:e-i.b/200;return e=1*Up(e),r=zp*Up(r),u=Bp*Up(u),new vr(jp(3.2404542*r-1.5371385*e-.4985314*u),jp(-.969266*r+1.8760108*e+.041556*u),jp(.0556434*r-.2040259*e+1.0572252*u),i.alpha)}function i_(i,e,r){let u=e-i;return i+r*(u>180||u<-180?u-360*Math.round(u/360):u)}let Nl={forward:r_,reverse:Vp,interpolate:function(i,e,r){return{l:tr(i.l,e.l,r),a:tr(i.a,e.a,r),b:tr(i.b,e.b,r),alpha:tr(i.alpha,e.alpha,r)}}},bs={forward:function(i){let{l:e,a:r,b:u}=r_(i),p=Math.atan2(u,r)*Np;return{h:p<0?p+360:p,c:Math.sqrt(r*r+u*u),l:e,alpha:i.a}},reverse:function(i){let e=i.h*M0,r=i.c;return Vp({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:i_(i.h,e.h,r),c:tr(i.c,e.c,r),l:tr(i.l,e.l,r),alpha:tr(i.alpha,e.alpha,r)}}};var n_=Object.freeze({__proto__:null,lab:Nl,hcl:bs});class Ul{constructor(e,r,u,p,d){this.type=e,this.operator=r,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(let[_,y]of d)this.labels.push(_),this.outputs.push(y)}static interpolationFactor(e,r,u,p){let d=0;if(e.name==="exponential")d=gc(r,e.base,u,p);else if(e.name==="linear")d=gc(r,1,u,p);else if(e.name==="cubic-bezier"){let _=e.controlPoints;d=new I(_[0],_[1],_[2],_[3]).solve(gc(r,1,u,p))}return d}static parse(e,r){let[u,p,d,..._]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let w=p[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:w}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let w=p.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ct),!d)return null;let y=[],b=null;u==="interpolate-hcl"||u==="interpolate-lab"?b=Rn:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let w=0;w<_.length;w+=2){let S=_[w],O=_[w+1],C=w+3,k=w+4;if(typeof S!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(y.length&&y[y.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);let z=r.parse(O,k,b);if(!z)return null;b=b||z.type,y.push([S,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Ul(b,u,p,d,y):r.error(`Type ${Nr(b)} is not interpolatable.`)}evaluate(e){let r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(e);let p=this.input.evaluate(e);if(p<=r[0])return u[0].evaluate(e);let d=r.length;if(p>=r[d-1])return u[d-1].evaluate(e);let _=mc(r,p),y=Ul.interpolationFactor(this.interpolation,p,r[_],r[_+1]),b=u[_].evaluate(e),w=u[_+1].evaluate(e);return this.operator==="interpolate"?Bl[this.type.kind.toLowerCase()](b,w,y):this.operator==="interpolate-hcl"?bs.reverse(bs.interpolate(bs.forward(b),bs.forward(w),y)):Nl.reverse(Nl.interpolate(Nl.forward(b),Nl.forward(w),y))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)r.push(this.labels[u],this.outputs[u].serialize());return r}}function gc(i,e,r,u){let p=u-r,d=i-r;return p===0?0:e===1?d/p:(Math.pow(e,d)-1)/(Math.pow(e,p)-1)}var Hn=Ul;class Gp{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let u=null,p=r.expectedType;p&&p.kind!=="value"&&(u=p);let d=[];for(let y of e.slice(1)){let b=r.parse(y,1+d.length,u,void 0,{typeAnnotation:"omit"});if(!b)return null;u=u||b.type,d.push(b)}let _=p&&d.some(y=>ys(p,y.type));return new Gp(_?zt:u,d)}evaluate(e){let r,u=null,p=0;for(let d of this.args){if(p++,u=d.evaluate(e),u&&u instanceof Gi&&!u.available&&(r||(r=u),u=null,p===this.args.length))return r;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var o_=Gp;class $p{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let u=[];for(let d=1;d<e.length-1;d+=2){let _=e[d];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,d);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);let y=r.parse(e[d+1],d+1);if(!y)return null;u.push([_,y])}let p=r.parse(e[e.length-1],e.length-1,r.expectedType,u);return p?new $p(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,u]of this.bindings)e.push(r,u.serialize());return e.push(this.result.serialize()),e}}var a_=$p;class Wp{constructor(e,r,u){this.type=e,this.index=r,this.input=u}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=r.parse(e[1],1,ct),p=r.parse(e[2],2,en(r.expectedType||zt));return u&&p?new Wp(p.type.itemType,u,p):null}evaluate(e){let r=this.index.evaluate(e),u=this.input.evaluate(e);if(r<0)throw new fi(`Array index out of bounds: ${r} < 0.`);if(r>=u.length)throw new fi(`Array index out of bounds: ${r} > ${u.length-1}.`);if(r!==Math.floor(r))throw new fi(`Array index must be an integer, but found ${r} instead.`);return u[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var s_=Wp;class Zp{constructor(e,r){this.type=Gt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=r.parse(e[1],1,zt),p=r.parse(e[2],2,zt);return u&&p?oc(u.type,[Gt,Vt,ct,_s,zt])?new Zp(u,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(u.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!Vo(r,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Kr(r))} instead.`);if(!Vo(u,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${Nr(Kr(u))} instead.`);return u.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var q0=Zp;class vc{constructor(e,r,u){this.type=ct,this.needle=e,this.haystack=r,this.fromIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=r.parse(e[1],1,zt),p=r.parse(e[2],2,zt);if(!u||!p)return null;if(!oc(u.type,[Gt,Vt,ct,_s,zt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(u.type)} instead`);if(e.length===4){let d=r.parse(e[3],3,ct);return d?new vc(u,p,d):null}return new vc(u,p)}evaluate(e){let r=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Vo(r,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Kr(r))} instead.`);if(!Vo(u,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${Nr(Kr(u))} instead.`);if(this.fromIndex){let p=this.fromIndex.evaluate(e);return u.indexOf(r,p)}return u.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var R0=vc;class xc{constructor(e,r,u,p,d,_){this.inputType=e,this.type=r,this.input=u,this.cases=p,this.outputs=d,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let u,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);let d={},_=[];for(let w=2;w<e.length-1;w+=2){let S=e[w],O=e[w+1];Array.isArray(S)||(S=[S]);let C=r.concat(w);if(S.length===0)return C.error("Expected at least one branch label.");for(let z of S){if(typeof z!="number"&&typeof z!="string")return C.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return C.error("Numeric branch labels must be integer values.");if(u){if(C.checkSubtype(u,Kr(z)))return null}else u=Kr(z);if(d[String(z)]!==void 0)return C.error("Branch labels must be unique.");d[String(z)]=_.length}let k=r.parse(O,w,p);if(!k)return null;p=p||k.type,_.push(k)}let y=r.parse(e[1],1,zt);if(!y)return null;let b=r.parse(e[e.length-1],e.length-1,p);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(u,y.type)?null:new xc(u,p,y,d,_,b):null}evaluate(e){let r=this.input.evaluate(e);return(Kr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),u=[],p={};for(let _ of r){let y=p[this.cases[_]];y===void 0?(p[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[y][1].push(_)}let d=_=>this.inputType.kind==="number"?Number(_):_;for(let[_,y]of u)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}var l_=xc;class bc{constructor(e,r,u){this.type=e,this.branches=r,this.otherwise=u}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);let p=[];for(let _=1;_<e.length-1;_+=2){let y=r.parse(e[_],_,Gt);if(!y)return null;let b=r.parse(e[_+1],_+1,u);if(!b)return null;p.push([y,b]),u=u||b.type}let d=r.parse(e[e.length-1],e.length-1,u);return d?new bc(u,p,d):null}evaluate(e){for(let[r,u]of this.branches)if(r.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,u]of this.branches)e(r),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var D0=bc;class wc{constructor(e,r,u,p){this.type=e,this.input=r,this.beginIndex=u,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=r.parse(e[1],1,zt),p=r.parse(e[2],2,ct);if(!u||!p)return null;if(!oc(u.type,[en(zt),Vt,zt]))return r.error(`Expected first argument to be of type array or string, but found ${Nr(u.type)} instead`);if(e.length===4){let d=r.parse(e[3],3,ct);return d?new wc(u.type,u,p,d):null}return new wc(u.type,u,p)}evaluate(e){let r=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Vo(r,["string","array"]))throw new fi(`Expected first argument to be of type array or string, but found ${Nr(Kr(r))} instead.`);if(this.endIndex){let p=this.endIndex.evaluate(e);return r.slice(u,p)}return r.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var u_=wc;function Hp(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Xp(i,e,r,u){return u.compare(e,r)===0}function ws(i,e,r){let u=i!=="=="&&i!=="!=";return class vH{constructor(d,_,y){this.type=Gt,this.lhs=d,this.rhs=_,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||_.type.kind==="value"}static parse(d,_){if(d.length!==3&&d.length!==4)return _.error("Expected two or three arguments.");let y=d[0],b=_.parse(d[1],1,zt);if(!b)return null;if(!Hp(y,b.type))return _.concat(1).error(`"${y}" comparisons are not supported for type '${Nr(b.type)}'.`);let w=_.parse(d[2],2,zt);if(!w)return null;if(!Hp(y,w.type))return _.concat(2).error(`"${y}" comparisons are not supported for type '${Nr(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return _.error(`Cannot compare types '${Nr(b.type)}' and '${Nr(w.type)}'.`);u&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new mn(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new mn(b.type,[w])));let S=null;if(d.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(d[3],3,Cl),!S)return null}return new vH(b,w,S)}evaluate(d){let _=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(u&&this.hasUntypedArgument){let b=Kr(_),w=Kr(y);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new fi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let b=Kr(_),w=Kr(y);if(b.kind!=="string"||w.kind!=="string")return e(d,_,y)}return this.collator?r(d,_,y,this.collator.evaluate(d)):e(d,_,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[i];return this.eachChild(_=>{d.push(_.serialize())}),d}}}let L0=ws("==",function(i,e,r){return e===r},Xp),k0=ws("!=",function(i,e,r){return e!==r},function(i,e,r,u){return!Xp(0,e,r,u)}),z0=ws("<",function(i,e,r){return e<r},function(i,e,r,u){return u.compare(e,r)<0}),Tc=ws(">",function(i,e,r){return e>r},function(i,e,r,u){return u.compare(e,r)>0}),c_=ws("<=",function(i,e,r){return e<=r},function(i,e,r,u){return u.compare(e,r)<=0}),h_=ws(">=",function(i,e,r){return e>=r},function(i,e,r,u){return u.compare(e,r)>=0});class Yp{constructor(e,r,u,p,d,_){this.type=Vt,this.number=e,this.locale=r,this.currency=u,this.unit=p,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let u=r.parse(e[1],1,ct);if(!u)return null;let p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let d=null;if(p.locale&&(d=r.parse(p.locale,1,Vt),!d))return null;let _=null;if(p.currency&&(_=r.parse(p.currency,1,Vt),!_))return null;let y=null;if(p.unit&&(y=r.parse(p.unit,1,Vt),!y))return null;let b=null;if(p["min-fraction-digits"]&&(b=r.parse(p["min-fraction-digits"],1,ct),!b))return null;let w=null;return p["max-fraction-digits"]&&(w=r.parse(p["max-fraction-digits"],1,ct),!w)?null:new Yp(u,d,_,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kp{constructor(e){this.type=ct,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let u=r.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Nr(u.type)} instead.`):new Kp(u):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new fi(`Expected value to be of type string or array, but found ${Nr(Kr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}let p_={"==":L0,"!=":k0,">":Tc,"<":z0,">=":h_,"<=":c_,array:mn,at:s_,boolean:mn,case:D0,coalesce:o_,collator:sc,format:kl,image:ac,in:q0,"index-of":R0,interpolate:Hn,"interpolate-hcl":Hn,"interpolate-lab":Hn,length:Kp,let:a_,literal:Dl,match:l_,number:mn,"number-format":Yp,object:mn,slice:u_,step:kp,string:mn,"to-boolean":gs,"to-color":gs,"to-number":gs,"to-string":gs,var:fc,within:hc};function Jp(i,[e,r,u,p]){e=e.evaluate(i),r=r.evaluate(i),u=u.evaluate(i);let d=p?p.evaluate(i):1,_=Ip(e,r,u,d);if(_)throw new fi(_);return new vr(e/255*d,r/255*d,u/255*d,d)}function Qp(i,e){return i in e}function Ec(i,e){let r=e[i];return r===void 0?null:r}function yo(i){return{type:i}}Ln.register(p_,{error:[{kind:"error"},[Vt],(i,[e])=>{throw new fi(e.evaluate(i))}],typeof:[Vt,[zt],(i,[e])=>Nr(Kr(e.evaluate(i)))],"to-rgba":[en(ct,4),[Rn],(i,[e])=>e.evaluate(i).toArray()],rgb:[Rn,[ct,ct,ct],Jp],rgba:[Rn,[ct,ct,ct,ct],Jp],has:{type:Gt,overloads:[[[Vt],(i,[e])=>Qp(e.evaluate(i),i.properties())],[[Vt,Dn],(i,[e,r])=>Qp(e.evaluate(i),r.evaluate(i))]]},get:{type:zt,overloads:[[[Vt],(i,[e])=>Ec(e.evaluate(i),i.properties())],[[Vt,Dn],(i,[e,r])=>Ec(e.evaluate(i),r.evaluate(i))]]},"feature-state":[zt,[Vt],(i,[e])=>Ec(e.evaluate(i),i.featureState||{})],properties:[Dn,[],i=>i.properties()],"geometry-type":[Vt,[],i=>i.geometryType()],id:[zt,[],i=>i.id()],zoom:[ct,[],i=>i.globals.zoom],pitch:[ct,[],i=>i.globals.pitch||0],"distance-from-center":[ct,[],i=>i.distanceFromCenter()],"heatmap-density":[ct,[],i=>i.globals.heatmapDensity||0],"line-progress":[ct,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[ct,[],i=>i.globals.skyRadialProgress||0],accumulated:[zt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ct,yo(ct),(i,e)=>{let r=0;for(let u of e)r+=u.evaluate(i);return r}],"*":[ct,yo(ct),(i,e)=>{let r=1;for(let u of e)r*=u.evaluate(i);return r}],"-":{type:ct,overloads:[[[ct,ct],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[ct],(i,[e])=>-e.evaluate(i)]]},"/":[ct,[ct,ct],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[ct,[ct,ct],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[ct,[ct],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[ct,[ct],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[ct,[ct],(i,[e])=>Math.log(e.evaluate(i))],log2:[ct,[ct],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[ct,[ct],(i,[e])=>Math.sin(e.evaluate(i))],cos:[ct,[ct],(i,[e])=>Math.cos(e.evaluate(i))],tan:[ct,[ct],(i,[e])=>Math.tan(e.evaluate(i))],asin:[ct,[ct],(i,[e])=>Math.asin(e.evaluate(i))],acos:[ct,[ct],(i,[e])=>Math.acos(e.evaluate(i))],atan:[ct,[ct],(i,[e])=>Math.atan(e.evaluate(i))],min:[ct,yo(ct),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[ct,yo(ct),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[ct,[ct],(i,[e])=>Math.abs(e.evaluate(i))],round:[ct,[ct],(i,[e])=>{let r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[ct,[ct],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[ct,[ct],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Gt,[Vt,zt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Gt,[zt],(i,[e])=>i.id()===e.value],"filter-type-==":[Gt,[Vt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Gt,[Vt,zt],(i,[e,r])=>{let u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u<p}],"filter-id-<":[Gt,[zt],(i,[e])=>{let r=i.id(),u=e.value;return typeof r==typeof u&&r<u}],"filter->":[Gt,[Vt,zt],(i,[e,r])=>{let u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u>p}],"filter-id->":[Gt,[zt],(i,[e])=>{let r=i.id(),u=e.value;return typeof r==typeof u&&r>u}],"filter-<=":[Gt,[Vt,zt],(i,[e,r])=>{let u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[Gt,[zt],(i,[e])=>{let r=i.id(),u=e.value;return typeof r==typeof u&&r<=u}],"filter->=":[Gt,[Vt,zt],(i,[e,r])=>{let u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[Gt,[zt],(i,[e])=>{let r=i.id(),u=e.value;return typeof r==typeof u&&r>=u}],"filter-has":[Gt,[zt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Gt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Gt,[en(Vt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Gt,[en(zt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Gt,[Vt,en(zt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Gt,[Vt,en(zt)],(i,[e,r])=>function(u,p,d,_){for(;d<=_;){let y=d+_>>1;if(p[y]===u)return!0;p[y]>u?_=y-1:d=y+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[yo(Gt),(i,e)=>{for(let r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[yo(Gt),(i,e)=>{for(let r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Gt,[Gt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Gt,[Vt],(i,[e])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Vt,[Vt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Vt,[Vt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Vt,yo(zt),(i,e)=>e.map(r=>Rl(r.evaluate(i))).join("")],"resolved-locale":[Vt,[Cl],(i,[e])=>e.evaluate(i).resolvedLocale()]});var jl=p_;function f_(i){return{result:"success",value:i}}function Ts(i){return{result:"error",value:i}}function Es(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function d_(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ef(i){return!!i.expression&&i.expression.interpolated}function lr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Vl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function m_(i){return i}function Gl(i,e){let r=e.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",p=u||!(u||i.property!==void 0),d=i.type||(ef(e)?"exponential":"interval");if(r&&((i=Qi({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],vr.parse(w[1])])),i.default=vr.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!n_[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,y,b;if(d==="exponential")_=tf;else if(d==="interval")_=Xo;else if(d==="categorical"){_=B0,y=Object.create(null);for(let w of i.stops)y[w[0]]=w[1];b=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);_=Ss}if(u){let w={},S=[];for(let k=0;k<i.stops.length;k++){let z=i.stops[k],U=z[0].zoom;w[U]===void 0&&(w[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},S.push(U)),w[U].stops.push([z[0].value,z[1]])}let O=[];for(let k of S)O.push([w[k].zoom,Gl(w[k],e)]);let C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Hn.interpolationFactor.bind(void 0,C),zoomStops:O.map(k=>k[0]),evaluate:({zoom:k},z)=>tf({stops:O,base:i.base},e,k).evaluate(k,z)}}if(p){let w=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Hn.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(i,e,S,y,b)}}return{kind:"source",evaluate(w,S){let O=S&&S.properties?S.properties[i.property]:void 0;return O===void 0?$l(i.default,e.default):_(i,e,O,y,b)}}}function $l(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function B0(i,e,r,u,p){return $l(typeof r===p?u[r]:void 0,i.default,e.default)}function Xo(i,e,r){if(lr(r)!=="number")return $l(i.default,e.default);let u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];let p=mc(i.stops.map(d=>d[0]),r);return i.stops[p][1]}function tf(i,e,r){let u=i.base!==void 0?i.base:1;if(lr(r)!=="number")return $l(i.default,e.default);let p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];let d=mc(i.stops.map(S=>S[0]),r),_=function(S,O,C,k){let z=k-C,U=S-C;return z===0?0:O===1?U/z:(Math.pow(O,U)-1)/(Math.pow(O,z)-1)}(r,u,i.stops[d][0],i.stops[d+1][0]),y=i.stops[d][1],b=i.stops[d+1][1],w=Bl[e.type]||m_;if(i.colorSpace&&i.colorSpace!=="rgb"){let S=n_[i.colorSpace];w=(O,C)=>S.reverse(S.interpolate(S.forward(O),S.forward(C),_))}return typeof y.evaluate=="function"?{evaluate(...S){let O=y.evaluate.apply(void 0,S),C=b.evaluate.apply(void 0,S);if(O!==void 0&&C!==void 0)return w(O,C,_)}}:w(y,b,_)}function Ss(i,e,r){return e.type==="color"?r=vr.parse(r):e.type==="formatted"?r=Vi.fromString(r.toString()):e.type==="resolvedImage"?r=Gi.fromString(r.toString()):lr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),$l(r,i.default,e.default)}class rf{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Qm,this._defaultValue=r?function(u){return u.type==="color"&&(Vl(u.default)||Array.isArray(u.default))?new vr(0,0,0,0):u.type==="color"?vr.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,u,p,d,_,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,u,p,d,_,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new fi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Sc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in jl}function Is(i,e){let r=new Ra(jl,[],e?function(p){let d={color:Rn,string:Vt,number:ct,enum:Vt,boolean:Gt,formatted:Pl,resolvedImage:Ml};return p.type==="array"?en(d[p.value]||zt,p.length):d[p.type]}(e):void 0),u=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?f_(new rf(u,e)):Ts(r.errors)}class nf{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Zo(r.expression)}evaluateWithoutErrorHandling(e,r,u,p,d,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,u,p,d,_)}evaluate(e,r,u,p,d,_){return this._styleExpression.evaluate(e,r,u,p,d,_)}}class Wl{constructor(e,r,u,p){this.kind=e,this.zoomStops=u,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Zo(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,u,p,d,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,u,p,d,_)}evaluate(e,r,u,p,d,_){return this._styleExpression.evaluate(e,r,u,p,d,_)}interpolationFactor(e,r,u){return this.interpolationType?Hn.interpolationFactor(this.interpolationType,e,r,u):0}}function of(i,e){if((i=Is(i,e)).result==="error")return i;let r=i.value.expression,u=qa(r);if(!u&&!Es(e))return Ts([new qn("","data expressions not supported")]);let p=zl(r,["zoom","pitch","distance-from-center"]);if(!p&&!d_(e))return Ts([new qn("","zoom expressions not supported")]);let d=Os(r);return d||p?d instanceof qn?Ts([d]):d instanceof Hn&&!ef(e)?Ts([new qn("",'"interpolate" expressions cannot be used with this property')]):f_(d?new Wl(u?"camera":"composite",i.value,d.labels,d instanceof Hn?d.interpolation:void 0):new nf(u?"constant":"source",i.value)):Ts([new qn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class As{constructor(e,r){this._parameters=e,this._specification=r,Qi(this,Gl(this._parameters,this._specification))}static deserialize(e){return new As(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Os(i){let e=null;if(i instanceof a_)e=Os(i.result);else if(i instanceof o_){for(let r of i.args)if(e=Os(r),e)break}else(i instanceof kp||i instanceof Hn)&&i.input instanceof Ln&&i.input.name==="zoom"&&(e=i);return e instanceof qn||i.eachChild(r=>{let u=Os(r);u instanceof qn?e=u:!e&&u?e=new qn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new qn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ht{constructor(e,r,u,p){this.message=(e?`${e}: `:"")+u,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function tn(i){let e=i.key,r=i.value,u=i.valueSpec||{},p=i.objectElementValidators||{},d=i.style,_=i.styleSpec,y=[],b=lr(r);if(b!=="object")return[new ht(e,r,`object expected, ${b} found`)];for(let w in r){let S=w.split(".")[0],O=u[S]||u["*"],C;p[S]?C=p[S]:u[S]?C=gi:p["*"]?C=p["*"]:u["*"]&&(C=gi),C?y=y.concat(C({key:(e&&`${e}.`)+w,value:r[w],valueSpec:O,style:d,styleSpec:_,object:r,objectKey:w},r)):y.push(new ht(e,r[w],`unknown property "${w}"`))}for(let w in u)p[w]||u[w].required&&u[w].default===void 0&&r[w]===void 0&&y.push(new ht(e,r,`missing required property "${w}"`));return y}function af(i){let e=i.value,r=i.valueSpec,u=i.style,p=i.styleSpec,d=i.key,_=i.arrayElementValidator||gi;if(lr(e)!=="array")return[new ht(d,e,`array expected, ${lr(e)} found`)];if(r.length&&e.length!==r.length)return[new ht(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ht(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(y.function=r.function),lr(r.value)==="object"&&(y=r.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(_({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:u,styleSpec:p,key:`${d}[${w}]`}));return b}function sf(i){let e=i.key,r=i.value,u=i.valueSpec,p=lr(r);if(p==="number"&&r!=r&&(p="NaN"),p!=="number")return[new ht(e,r,`number expected, ${p} found`)];if("minimum"in u){let d=u.minimum;if(lr(u.minimum)==="array"&&(d=u.minimum[i.arrayIndex]),r<d)return[new ht(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in u){let d=u.maximum;if(lr(u.maximum)==="array"&&(d=u.maximum[i.arrayIndex]),r>d)return[new ht(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function Zl(i){let e=i.valueSpec,r=Gr(i.value.type),u,p,d,_={},y=r!=="categorical"&&i.value.property===void 0,b=!y,w=lr(i.value.stops)==="array"&&lr(i.value.stops[0])==="array"&&lr(i.value.stops[0][0])==="object",S=tn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(k){if(r==="identity")return[new ht(k.key,k.value,'identity function may not have a "stops" property')];let z=[],U=k.value;return z=z.concat(af({key:k.key,value:U,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:O})),lr(U)==="array"&&U.length===0&&z.push(new ht(k.key,U,"array must have at least one stop")),z},default:function(k){return gi({key:k.key,value:k.value,valueSpec:e,style:k.style,styleSpec:k.styleSpec})}}});return r==="identity"&&y&&S.push(new ht(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||S.push(new ht(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!ef(i.valueSpec)&&S.push(new ht(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Es(i.valueSpec)?S.push(new ht(i.key,i.value,"property functions not supported")):y&&!d_(i.valueSpec)&&S.push(new ht(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!w||i.value.property!==void 0||S.push(new ht(i.key,i.value,'"property" property is required')),S;function O(k){let z=[],U=k.value,G=k.key;if(lr(U)!=="array")return[new ht(G,U,`array expected, ${lr(U)} found`)];if(U.length!==2)return[new ht(G,U,`array length 2 expected, length ${U.length} found`)];if(w){if(lr(U[0])!=="object")return[new ht(G,U,`object expected, ${lr(U[0])} found`)];if(U[0].zoom===void 0)return[new ht(G,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new ht(G,U,"object stop key must have value")];let J=Gr(U[0].zoom);if(typeof J!="number")return[new ht(G,U[0].zoom,"stop zoom values must be numbers")];if(d&&d>J)return[new ht(G,U[0].zoom,"stop zoom values must appear in ascending order")];J!==d&&(d=J,p=void 0,_={}),z=z.concat(tn({key:`${G}[0]`,value:U[0],valueSpec:{zoom:{}},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:sf,value:C}}))}else z=z.concat(C({key:`${G}[0]`,value:U[0],valueSpec:{},style:k.style,styleSpec:k.styleSpec},U));return Sc(jo(U[1]))?z.concat([new ht(`${G}[1]`,U[1],"expressions are not allowed in function stops.")]):z.concat(gi({key:`${G}[1]`,value:U[1],valueSpec:e,style:k.style,styleSpec:k.styleSpec}))}function C(k,z){let U=lr(k.value),G=Gr(k.value),J=k.value!==null?k.value:z;if(u){if(U!==u)return[new ht(k.key,J,`${U} stop domain type must match previous stop domain type ${u}`)]}else u=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new ht(k.key,J,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&r!=="categorical"){let le=`number expected, ${U} found`;return Es(e)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(k.key,J,le)]}return r!=="categorical"||U!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?r!=="categorical"&&U==="number"&&typeof G=="number"&&typeof p=="number"&&p!==void 0&&G<p?[new ht(k.key,J,"stop domain values must appear in ascending order")]:(p=G,r==="categorical"&&G in _?[new ht(k.key,J,"stop domain values must be unique")]:(_[G]=!0,[])):[new ht(k.key,J,`integer expected, found ${String(G)}`)]}}function kn(i){let e=(i.expressionContext==="property"?of:Is)(jo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(u=>new ht(`${i.key}${u.key}`,i.value,u.message));let r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ht(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Zo(r))return[new ht(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return lf(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!zl(r,["zoom","feature-state"]))return[new ht(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!qa(r))return[new ht(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lf(i,e){let r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let p of e.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];let u=[];return i instanceof Ln&&r.has(i.name)?[new ht(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(p=>{u.push(...lf(p,e))}),u)}function Hl(i){let e=i.key,r=i.value,u=i.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(Gr(r))===-1&&p.push(new ht(e,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(Gr(r))===-1&&p.push(new ht(e,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Xl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let e of i.slice(1))if(!Xl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Yl(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xl(i)||(i=Ic(i));let r=i,u=!0;try{u=function(w){if(!go(w))return w;let S=jo(w);return uf(S),S=__(S),S}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}let p=qe[`filter_${e}`],d=Is(u,p),_=null;if(d.result==="error")throw new Error(d.value.map(w=>`${w.key}: ${w.message}`).join(", "));_=(w,S,O)=>d.value.evaluate(w,S,{},O);let y=null,b=null;if(u!==r){let w=Is(r,p);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,O,C,k,z)=>w.value.evaluate(S,O,{},C,void 0,void 0,k,z),b=!qa(w.value.expression)}return _=_,{filter:_,dynamicFilter:y||void 0,needGeometry:y_(u),needFeature:!!b}}function __(i){if(!Array.isArray(i))return i;let e=function(r){if(F0.has(r[0])){for(let u=1;u<r.length;u++)if(go(r[u]))return!0}return r}(i);return e===!0?e:e.map(r=>__(r))}function uf(i){let e=!1,r=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)e=e||go(i[u]),r.push(i[u+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||go(i[1]);for(let u=2;u<i.length-1;u+=2)r.push(i[u+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||go(i[1]);for(let u=1;u<i.length-1;u+=2)r.push(i[u+1])}e&&(i.length=0,i.push("any",...r));for(let u=1;u<i.length;u++)uf(i[u])}function go(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(go(i[r]))return!0;return!1}let F0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function N0(i,e){return i<e?-1:i>e?1:0}function y_(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(y_(i[e]))return!0;return!1}function Ic(i){if(!i)return!0;let e=i[0];return i.length<=1?e!=="any":e==="=="?cf(i[1],i[2],"=="):e==="!="?Si(cf(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?cf(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ic))):e==="all"?["all"].concat(i.slice(1).map(Ic)):e==="none"?["all"].concat(i.slice(1).map(Ic).map(Si)):e==="in"?Kl(i[1],i.slice(2)):e==="!in"?Si(Kl(i[1],i.slice(2))):e==="has"?Jl(i[1]):e==="!has"?Si(Jl(i[1])):e!=="within"||i;var r}function cf(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Kl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(N0)]]:["filter-in-small",i,["literal",e]]}}function Jl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Si(i){return["!",i]}function Cs(i){return Xl(jo(i.value))?kn(Qi({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):g_(i)}function g_(i){let e=i.value,r=i.key;if(lr(e)!=="array")return[new ht(r,e,`array expected, ${lr(e)} found`)];let u=i.styleSpec,p,d=[];if(e.length<1)return[new ht(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Hl({key:`${r}[0]`,value:e[0],valueSpec:u.filter_operator,style:i.style,styleSpec:i.styleSpec})),Gr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Gr(e[1])==="$type"&&d.push(new ht(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new ht(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=lr(e[1]),p!=="string"&&d.push(new ht(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let _=2;_<e.length;_++)p=lr(e[_]),Gr(e[1])==="$type"?d=d.concat(Hl({key:`${r}[${_}]`,value:e[_],valueSpec:u.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&d.push(new ht(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)d=d.concat(g_({key:`${r}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=lr(e[1]),e.length!==2?d.push(new ht(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&d.push(new ht(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=lr(e[1]),e.length!==2?d.push(new ht(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&d.push(new ht(`${r}[1]`,e[1],`object expected, ${p} found`))}return d}function v_(i,e){let r=i.key,u=i.style,p=i.styleSpec,d=i.value,_=i.objectKey,y=p[`${e}_${i.layerType}`];if(!y)return[];let b=_.match(/^(.*)-transition$/);if(e==="paint"&&b&&y[b[1]]&&y[b[1]].transition)return gi({key:r,value:d,valueSpec:p.transition,style:u,styleSpec:p});let w=i.valueSpec||y[_];if(!w)return[new ht(r,d,`unknown property "${_}"`)];let S;if(lr(d)==="string"&&Es(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(d)))return[new ht(r,d,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];let O=[];return i.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&O.push(new ht(r,d,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Vl(jo(d))&&Gr(d.type)==="identity"&&O.push(new ht(r,d,'"text-font" does not support identity functions'))),O.concat(gi({key:i.key,value:d,valueSpec:w,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:_}))}function x_(i){return v_(i,"paint")}function b_(i){return v_(i,"layout")}function Ac(i){let e=[],r=i.value,u=i.key,p=i.style,d=i.styleSpec;r.type||r.ref||e.push(new ht(u,r,'either "type" or "ref" is required'));let _=Gr(r.type),y=Gr(r.ref);if(r.id){let b=Gr(r.id);for(let w=0;w<i.arrayIndex;w++){let S=p.layers[w];Gr(S.id)===b&&e.push(new ht(u,r.id,`duplicate layer id "${r.id}", previously used at line ${S.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new ht(u,r[w],`"${w}" is prohibited for ref layers`))}),p.layers.forEach(w=>{Gr(w.id)===y&&(b=w)}),b?b.ref?e.push(new ht(u,r.ref,"ref cannot reference another ref layer")):_=Gr(b.type):typeof y=="string"&&e.push(new ht(u,r.ref,`ref layer "${y}" not found`))}else if(_!=="background"&&_!=="sky")if(r.source){let b=p.sources&&p.sources[r.source],w=b&&Gr(b.type);b?w==="vector"&&_==="raster"?e.push(new ht(u,r.source,`layer "${r.id}" requires a raster source`)):w==="raster"&&_!=="raster"?e.push(new ht(u,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&_!=="hillshade"?e.push(new ht(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||w==="geojson"&&b.lineMetrics||e.push(new ht(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ht(u,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ht(u,r.source,`source "${r.source}" not found`))}else e.push(new ht(u,r,'missing required property "source"'));return e=e.concat(tn({key:u,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>gi({key:`${u}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:b=>Cs(Qi({layerType:_},b)),layout:b=>tn({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>b_(Qi({layerType:_},w))}}),paint:b=>tn({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>x_(Qi({layerType:_},w))}})}})),e}function Ps(i){let e=i.value,r=i.key,u=lr(e);return u!=="string"?[new ht(r,e,`string expected, ${u} found`)]:[]}let Oc={promoteId:function({key:i,value:e}){if(lr(e)==="string")return Ps({key:i,value:e});{let r=[];for(let u in e)r.push(...Ps({key:`${i}.${u}`,value:e[u]}));return r}}};function w_(i){let e=i.value,r=i.key,u=i.styleSpec,p=i.style;if(!e.type)return[new ht(r,e,'"type" is required')];let d=Gr(e.type),_;switch(d){case"vector":case"raster":case"raster-dem":return _=tn({key:r,value:e,valueSpec:u[`source_${d.replace("-","_")}`],style:i.style,styleSpec:u,objectElementValidators:Oc}),_;case"geojson":if(_=tn({key:r,value:e,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Oc}),e.cluster)for(let y in e.clusterProperties){let[b,w]=e.clusterProperties[y],S=typeof b=="string"?[b,["accumulated"],["get",y]]:b;_.push(...kn({key:`${r}.${y}.map`,value:w,expressionContext:"cluster-map"})),_.push(...kn({key:`${r}.${y}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return tn({key:r,value:e,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return tn({key:r,value:e,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new ht(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hl({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:u})}}function T_(i){let e=i.value,r=i.styleSpec,u=r.light,p=i.style,d=[],_=lr(e);if(e===void 0)return d;if(_!=="object")return d=d.concat([new ht("light",e,`object expected, ${_} found`)]),d;for(let y in e){let b=y.match(/^(.*)-transition$/);d=d.concat(b&&u[b[1]]&&u[b[1]].transition?gi({key:y,value:e[y],valueSpec:r.transition,style:p,styleSpec:r}):u[y]?gi({key:y,value:e[y],valueSpec:u[y],style:p,styleSpec:r}):[new ht(y,e[y],`unknown property "${y}"`)])}return d}function Cc(i){let e=i.value,r=i.key,u=i.style,p=i.styleSpec,d=p.terrain,_=[],y=lr(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new ht("terrain",e,`object expected, ${y} found`)]),_;for(let b in e){let w=b.match(/^(.*)-transition$/);_=_.concat(w&&d[w[1]]&&d[w[1]].transition?gi({key:b,value:e[b],valueSpec:p.transition,style:u,styleSpec:p}):d[b]?gi({key:b,value:e[b],valueSpec:d[b],style:u,styleSpec:p}):[new ht(b,e[b],`unknown property "${b}"`)])}if(e.source){let b=u.sources&&u.sources[e.source],w=b&&Gr(b.type);b?w!=="raster-dem"&&_.push(new ht(r,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):_.push(new ht(r,e.source,`source "${e.source}" not found`))}else _.push(new ht(r,e,'terrain is missing required property "source"'));return _}function E_(i){let e=i.value,r=i.style,u=i.styleSpec,p=u.fog,d=[],_=lr(e);if(e===void 0)return d;if(_!=="object")return d=d.concat([new ht("fog",e,`object expected, ${_} found`)]),d;for(let y in e){let b=y.match(/^(.*)-transition$/);d=d.concat(b&&p[b[1]]&&p[b[1]].transition?gi({key:y,value:e[y],valueSpec:u.transition,style:r,styleSpec:u}):p[y]?gi({key:y,value:e[y],valueSpec:p[y],style:r,styleSpec:u}):[new ht(y,e[y],`unknown property "${y}"`)])}return d}let hf={"*":()=>[],array:af,boolean:function(i){let e=i.value,r=i.key,u=lr(e);return u!=="boolean"?[new ht(r,e,`boolean expected, ${u} found`)]:[]},number:sf,color:function(i){let e=i.key,r=i.value,u=lr(r);return u!=="string"?[new ht(e,r,`color expected, ${u} found`)]:Go.parseCSSColor(r)===null?[new ht(e,r,`color expected, "${r}" found`)]:[]},enum:Hl,filter:Cs,function:Zl,layer:Ac,object:tn,source:w_,light:T_,terrain:Cc,fog:E_,string:Ps,formatted:function(i){return Ps(i).length===0?[]:kn(i)},resolvedImage:function(i){return Ps(i).length===0?[]:kn(i)},projection:function(i){let e=i.value,r=i.styleSpec,u=r.projection,p=i.style,d=[],_=lr(e);if(_==="object")for(let y in e)d=d.concat(gi({key:y,value:e[y],valueSpec:u[y],style:p,styleSpec:r}));else _!=="string"&&(d=d.concat([new ht("projection",e,`object or string expected, ${_} found`)]));return d}};function gi(i){let e=i.value,r=i.valueSpec,u=i.styleSpec;return r.expression&&Vl(Gr(e))?Zl(i):r.expression&&Sc(jo(e))?kn(i):r.type&&hf[r.type]?hf[r.type](i):tn(Qi({},i,{valueSpec:r.type?u[r.type]:r}))}function U0(i){let e=i.value,r=i.key,u=Ps(i);return u.length||(e.indexOf("{fontstack}")===-1&&u.push(new ht(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&u.push(new ht(r,e,'"glyphs" url must include a "{range}" token'))),u}function Pc(i,e=qe){return vo(gi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:U0,"*":()=>[]}}))}let Mc=i=>vo(x_(i)),S_=i=>vo(b_(i));function vo(i){return i.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function pf(i,e){let r=!1;if(e&&e.length)for(let u of e)i.fire(new mr(new Error(u.message))),r=!0;return r}var Ms=yn;function yn(i,e,r){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(e=p[1])+2*(r=p[2]);for(var d=0;d<this.d*this.d;d++){var _=p[3+d],y=p[3+d+1];u.push(_===y?null:p.subarray(_,y))}var b=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],b),this.bboxes=p.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)u.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var S=r/e*i;this.min=-S,this.max=i+S}yn.prototype.insert=function(i,e,r,u,p){this._forEachCell(e,r,u,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p)},yn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},yn.prototype._insertCell=function(i,e,r,u,p,d){this.cells[p].push(d)},yn.prototype.query=function(i,e,r,u,p){var d=this.min,_=this.max;if(i<=d&&e<=d&&_<=r&&_<=u&&!p)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(i,e,r,u,this._queryCell,y,{},p),y},yn.prototype._queryCell=function(i,e,r,u,p,d,_,y){var b=this.cells[p];if(b!==null)for(var w=this.keys,S=this.bboxes,O=0;O<b.length;O++){var C=b[O];if(_[C]===void 0){var k=4*C;(y?y(S[k+0],S[k+1],S[k+2],S[k+3]):i<=S[k+2]&&e<=S[k+3]&&r>=S[k+0]&&u>=S[k+1])?(_[C]=!0,d.push(w[C])):_[C]=!1}}},yn.prototype._forEachCell=function(i,e,r,u,p,d,_,y){for(var b=this._convertToCellCoord(i),w=this._convertToCellCoord(e),S=this._convertToCellCoord(r),O=this._convertToCellCoord(u),C=b;C<=S;C++)for(var k=w;k<=O;k++){var z=this.d*k+C;if((!y||y(this._convertFromCellCoord(C),this._convertFromCellCoord(k),this._convertFromCellCoord(C+1),this._convertFromCellCoord(k+1)))&&p.call(this,i,e,r,u,z,d,_,y))return}},yn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},yn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},yn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,u=0;u<this.cells.length;u++)r+=this.cells[u].length;var p=new Int32Array(e+r+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var d=e,_=0;_<i.length;_++){var y=i[_];p[3+_]=d,p.set(y,d),d+=y.length}return p[3+i.length]=d,p.set(this.keys,d),p[3+i.length+1]=d+=this.keys.length,p.set(this.bboxes,d),d+=this.bboxes.length,p.buffer};let qc={};function dt(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),qc[e]={klass:i,omit:r.omit||[]}}dt(Object,"Object"),Ms.serialize=function(i,e){let r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},Ms.deserialize=function(i){return new Ms(i.buffer)},Object.defineProperty(Ms,"name",{value:"Grid"}),dt(Ms,"Grid"),dt(vr,"Color"),dt(Error,"Error"),dt(be,"AJAXError"),dt(Gi,"ResolvedImage"),dt(As,"StylePropertyFunction"),dt(rf,"StyleExpression",{omit:["_evaluator"]}),dt(Wl,"ZoomDependentExpression"),dt(nf,"ZoomConstantExpression"),dt(Ln,"CompoundExpression",{omit:["_evaluate"]});for(let i in jl)qc[jl[i]._classRegistryKey]||dt(jl[i],`Expression${i}`);function I_(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function A_(i){return g.ImageBitmap&&i instanceof g.ImageBitmap}function qs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(I_(i)||A_(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){let r=i;return e&&e.push(r.buffer),r}if(i instanceof g.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){let r=[];for(let u of i)r.push(qs(u,e));return r}if(typeof i=="object"){let r=i.constructor,u=r._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);let p=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(let d in i)i.hasOwnProperty(d)&&(qc[u].omit.indexOf(d)>=0||(p[d]=qs(i[d],e)));i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof i)}function Ql(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||I_(i)||A_(i)||ArrayBuffer.isView(i)||i instanceof g.ImageData)return i;if(Array.isArray(i))return i.map(Ql);if(typeof i=="object"){let e=i.$name||"Object",{klass:r}=qc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);let u=Object.create(r.prototype);for(let p of Object.keys(i))p!=="$name"&&(u[p]=Ql(i[p]));return u}throw new Error("can't deserialize object of type "+typeof i)}class O_{constructor(){this.first=!0}update(e,r){let u=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=u,!0))}}let C_=i=>i>=1536&&i<=1791,P_=i=>i>=1872&&i<=1919,M_=i=>i>=2208&&i<=2303,q_=i=>i>=11904&&i<=12031,R_=i=>i>=12032&&i<=12255,eu=i=>i>=12272&&i<=12287,Rc=i=>i>=12288&&i<=12351,ff=i=>i>=12352&&i<=12447,Da=i=>i>=12448&&i<=12543,D_=i=>i>=12544&&i<=12591,df=i=>i>=12704&&i<=12735,L_=i=>i>=12736&&i<=12783,mf=i=>i>=12784&&i<=12799,_f=i=>i>=12800&&i<=13055,yf=i=>i>=13056&&i<=13311,gf=i=>i>=13312&&i<=19903,tu=i=>i>=19968&&i<=40959,Dc=i=>i>=40960&&i<=42127,k_=i=>i>=42128&&i<=42191,z_=i=>i>=44032&&i<=55215,B_=i=>i>=63744&&i<=64255,ru=i=>i>=64336&&i<=65023,F_=i=>i>=65040&&i<=65055,vf=i=>i>=65072&&i<=65103,N_=i=>i>=65104&&i<=65135,xf=i=>i>=65136&&i<=65279,bf=i=>i>=65280&&i<=65519;function Lc(i){for(let e of i)if(kc(e.charCodeAt(0)))return!0;return!1}function j0(i){for(let e of i)if(!V0(e.charCodeAt(0)))return!1;return!0}function V0(i){return!(C_(i)||P_(i)||M_(i)||ru(i)||xf(i))}function kc(i){return!(i!==746&&i!==747&&(i<4352||!(df(i)||D_(i)||vf(i)&&!(i>=65097&&i<=65103)||B_(i)||yf(i)||q_(i)||L_(i)||!(!Rc(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||gf(i)||tu(i)||_f(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||z_(i)||ff(i)||eu(i)||(e=>e>=12688&&e<=12703)(i)||R_(i)||mf(i)||Da(i)&&i!==12540||!(!bf(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!N_(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||F_(i)||(e=>e>=19904&&e<=19967)(i)||Dc(i)||k_(i))))}function iu(i){return!(kc(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Rc(e)||Da(e)||(r=>r>=57344&&r<=63743)(e)||vf(e)||N_(e)||bf(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function f(i){return i>=1424&&i<=2303||ru(i)||xf(i)}function a(i,e){return!(!e&&f(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function h(i){for(let e of i)if(f(e.charCodeAt(0)))return!0;return!1}let m="deferred",v="loading",x="loaded",T=null,E="unavailable",A=null,R=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(E="error"),T&&T(i)};function D(){F.fire(new Tr("pluginStateChange",{pluginStatus:E,pluginURL:A}))}let F=new Et,j=function(){return E},X=function(){if(E!==m||!A)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");E=v,D(),A&&Te({url:A},i=>{i?R(i):(E=x,D())})},W={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>E===x||W.applyArabicShaping!=null,isLoading:()=>E===v,setState(i){E=i.pluginStatus,A=i.pluginURL},isParsed:()=>W.applyArabicShaping!=null&&W.processBidirectionalText!=null&&W.processStyledBidirectionalText!=null,getPluginURL:()=>A};class Z{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new O_,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,u){for(let p of r)if(!a(p.charCodeAt(0),u))return!1;return!0}(e,W.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let e=this.zoom,r=e-Math.floor(e),u=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*r}}}class H{constructor(e,r){this.property=e,this.value=r,this.expression=function(u,p){if(Vl(u))return new As(u,p);if(Sc(u)){let d=of(u,p);if(d.result==="error")throw new Error(d.value.map(_=>`${_.key}: ${_.message}`).join(", "));return d.value}{let d=u;return typeof u=="string"&&p.type==="color"&&(d=vr.parse(u)),{kind:"constant",evaluate:()=>d}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,u){return this.property.possiblyEvaluate(this,e,r,u)}}class ${constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,r){return new Y(this.property,this.value,r,wt({},e.transition,this.transition),e.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Le(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new $(this._values[e].property)),this._values[e].value=new H(this._values[e].property,r===null?void 0:Le(r))}getTransition(e){return Le(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new $(this._values[e].property)),this._values[e].transition=Le(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let u=this.getValue(r);u!==void 0&&(e[r]=u);let p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){let u=new de(this._properties);for(let p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(e,r._values[p]);return u}untransitioned(){let e=new de(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Y{constructor(e,r,u,p,d){let _=p.delay||0,y=p.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+_,this.end=this.begin+y,e.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(e,r,u){let p=e.now||0,d=this.value.possiblyEvaluate(e,r,u),_=this.prior;if(_){if(p>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(p<this.begin)return _.possiblyEvaluate(e,r,u);{let y=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,u),d,Re(y))}}return d}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,u){let p=new fe(this._properties);for(let d of Object.keys(this._values))p._values[d]=this._values[d].possiblyEvaluate(e,r,u);return p}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Le(this._values[e].value)}setValue(e,r){this._values[e]=new H(this._values[e].property,r===null?void 0:Le(r))}serialize(){let e={};for(let r of Object.keys(this._values)){let u=this.getValue(r);u!==void 0&&(e[r]=u)}return e}possiblyEvaluate(e,r,u){let p=new fe(this._properties);for(let d of Object.keys(this._values))p._values[d]=this._values[d].possiblyEvaluate(e,r,u);return p}}class se{constructor(e,r,u){this.property=e,this.value=r,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,u,p){return this.property.evaluate(this.value,this.parameters,e,r,u,p)}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class he{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,u){let p=Bl[this.specification.type];return p?p(e,r,u):e}}class ge{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,u,p){return new se(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},u,p)}:e.expression,r)}interpolate(e,r,u){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new se(this,{kind:"constant",value:void 0},e.parameters);let p=Bl[this.specification.type];return p?new se(this,{kind:"constant",value:p(e.value.value,r.value.value,u)},e.parameters):e}evaluate(e,r,u,p,d,_){return e.kind==="constant"?e.value:e.evaluate(r,u,p,d,_)}}class Ee extends ge{possiblyEvaluate(e,r,u,p){if(e.value===void 0)return new se(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){let d=e.expression.evaluate(r,null,{},u,p),_=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(_,_,_,r);return new se(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){let d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new se(this,{kind:"constant",value:d},r)}return new se(this,e.expression,r)}evaluate(e,r,u,p,d,_){if(e.kind==="source"){let y=e.evaluate(r,u,p,d,_);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},u,p),e.evaluate({zoom:Math.floor(r.zoom)},u,p),e.evaluate({zoom:Math.floor(r.zoom)+1},u,p),r):e.value}_calculate(e,r,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r,other:u}:{from:u,to:r,other:e}}interpolate(e){return e}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,r,u,p){if(e.value!==void 0){if(e.expression.kind==="constant"){let d=e.expression.evaluate(r,null,{},u,p);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new Z(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Z(Math.floor(r.zoom),r)),e.expression.evaluate(new Z(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:u,to:r}}interpolate(e){return e}}class xe{constructor(e){this.specification=e}possiblyEvaluate(e,r,u,p){return!!e.expression.evaluate(r,null,{},u,p)}interpolate(){return!1}}class ze{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new Z(0,{});for(let u in e){let p=e[u];p.specification.overridable&&this.overridableProperties.push(u);let d=this.defaultPropertyValues[u]=new H(p,void 0),_=this.defaultTransitionablePropertyValues[u]=new $(p);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=d.possiblyEvaluate(r)}}}function Ue(i,e){return 256*(i=He(Math.floor(i),0,255))+He(Math.floor(e),0,255)}dt(ge,"DataDrivenProperty"),dt(he,"DataConstantProperty"),dt(Ee,"CrossFadedDataDrivenProperty"),dt(Ye,"CrossFadedProperty"),dt(xe,"ColorRampProperty");let it={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pe{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Je{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ne(i,e=1){let r=0,u=0;return{members:i.map(p=>{let d=it[p.type].BYTES_PER_ELEMENT,_=r=st(r,Math.max(e,d)),y=p.components||1;return u=Math.max(u,d),r+=d*y,{name:p.name,type:p.type,components:y,offset:_}}),size:st(r,Math.max(u,e)),alignment:e}}function st(i,e){return Math.ceil(i/e)*e}class at extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let u=this.length;return this.resize(u+1),this.emplace(u,e,r)}emplace(e,r,u){let p=2*e;return this.int16[p+0]=r,this.int16[p+1]=u,e}}at.prototype.bytesPerElement=4,dt(at,"StructArrayLayout2i4");class yt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){let d=3*e;return this.int16[d+0]=r,this.int16[d+1]=u,this.int16[d+2]=p,e}}yt.prototype.bytesPerElement=6,dt(yt,"StructArrayLayout3i6");class Tt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,u,p)}emplace(e,r,u,p,d){let _=4*e;return this.int16[_+0]=r,this.int16[_+1]=u,this.int16[_+2]=p,this.int16[_+3]=d,e}}Tt.prototype.bytesPerElement=8,dt(Tt,"StructArrayLayout4i8");class qt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,u,p,d,_,y)}emplace(e,r,u,p,d,_,y,b){let w=6*e,S=12*e,O=3*e;return this.int16[w+0]=r,this.int16[w+1]=u,this.uint8[S+4]=p,this.uint8[S+5]=d,this.uint8[S+6]=_,this.uint8[S+7]=y,this.float32[O+2]=b,e}}qt.prototype.bytesPerElement=12,dt(qt,"StructArrayLayout2i4ub1f12");class Wt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,u,p)}emplace(e,r,u,p,d){let _=4*e;return this.float32[_+0]=r,this.float32[_+1]=u,this.float32[_+2]=p,this.float32[_+3]=d,e}}Wt.prototype.bytesPerElement=16,dt(Wt,"StructArrayLayout4f16");class gt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y,b,w,S){let O=this.length;return this.resize(O+1),this.emplace(O,e,r,u,p,d,_,y,b,w,S)}emplace(e,r,u,p,d,_,y,b,w,S,O){let C=10*e;return this.uint16[C+0]=r,this.uint16[C+1]=u,this.uint16[C+2]=p,this.uint16[C+3]=d,this.uint16[C+4]=_,this.uint16[C+5]=y,this.uint16[C+6]=b,this.uint16[C+7]=w,this.uint16[C+8]=S,this.uint16[C+9]=O,e}}gt.prototype.bytesPerElement=20,dt(gt,"StructArrayLayout10ui20");class Lt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y,b){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,u,p,d,_,y,b)}emplace(e,r,u,p,d,_,y,b,w){let S=8*e;return this.uint16[S+0]=r,this.uint16[S+1]=u,this.uint16[S+2]=p,this.uint16[S+3]=d,this.uint16[S+4]=_,this.uint16[S+5]=y,this.uint16[S+6]=b,this.uint16[S+7]=w,e}}Lt.prototype.bytesPerElement=16,dt(Lt,"StructArrayLayout8ui16");class rr extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,u,p,d,_)}emplace(e,r,u,p,d,_,y){let b=6*e;return this.int16[b+0]=r,this.int16[b+1]=u,this.int16[b+2]=p,this.int16[b+3]=d,this.int16[b+4]=_,this.int16[b+5]=y,e}}rr.prototype.bytesPerElement=12,dt(rr,"StructArrayLayout6i12");class Rr extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y,b,w,S,O,C){let k=this.length;return this.resize(k+1),this.emplace(k,e,r,u,p,d,_,y,b,w,S,O,C)}emplace(e,r,u,p,d,_,y,b,w,S,O,C,k){let z=12*e;return this.int16[z+0]=r,this.int16[z+1]=u,this.int16[z+2]=p,this.int16[z+3]=d,this.uint16[z+4]=_,this.uint16[z+5]=y,this.uint16[z+6]=b,this.uint16[z+7]=w,this.int16[z+8]=S,this.int16[z+9]=O,this.int16[z+10]=C,this.int16[z+11]=k,e}}Rr.prototype.bytesPerElement=24,dt(Rr,"StructArrayLayout4i4ui4i24");class $r extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,u,p,d,_)}emplace(e,r,u,p,d,_,y){let b=10*e,w=5*e;return this.int16[b+0]=r,this.int16[b+1]=u,this.int16[b+2]=p,this.float32[w+2]=d,this.float32[w+3]=_,this.float32[w+4]=y,e}}$r.prototype.bytesPerElement=20,dt($r,"StructArrayLayout3i3f20");class xr extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}xr.prototype.bytesPerElement=4,dt(xr,"StructArrayLayout1ul4");class vi extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y,b,w,S,O,C,k){let z=this.length;return this.resize(z+1),this.emplace(z,e,r,u,p,d,_,y,b,w,S,O,C,k)}emplace(e,r,u,p,d,_,y,b,w,S,O,C,k,z){let U=20*e,G=10*e;return this.int16[U+0]=r,this.int16[U+1]=u,this.int16[U+2]=p,this.int16[U+3]=d,this.int16[U+4]=_,this.float32[G+3]=y,this.float32[G+4]=b,this.float32[G+5]=w,this.float32[G+6]=S,this.int16[U+14]=O,this.uint32[G+8]=C,this.uint16[U+18]=k,this.uint16[U+19]=z,e}}vi.prototype.bytesPerElement=40,dt(vi,"StructArrayLayout5i4f1i1ul2ui40");class zn extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,u,p,d,_,y)}emplace(e,r,u,p,d,_,y,b){let w=8*e;return this.int16[w+0]=r,this.int16[w+1]=u,this.int16[w+2]=p,this.int16[w+4]=d,this.int16[w+5]=_,this.int16[w+6]=y,this.int16[w+7]=b,e}}zn.prototype.bytesPerElement=16,dt(zn,"StructArrayLayout3i2i2i16");class xo extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,u,p,d)}emplace(e,r,u,p,d,_){let y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=u,this.float32[y+2]=p,this.int16[b+6]=d,this.int16[b+7]=_,e}}xo.prototype.bytesPerElement=16,dt(xo,"StructArrayLayout2f1f2i16");class Dr extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,u,p)}emplace(e,r,u,p,d){let _=12*e,y=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=u,this.float32[y+1]=p,this.float32[y+2]=d,e}}Dr.prototype.bytesPerElement=12,dt(Dr,"StructArrayLayout2ub2f12");class kr extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){let d=3*e;return this.float32[d+0]=r,this.float32[d+1]=u,this.float32[d+2]=p,e}}kr.prototype.bytesPerElement=12,dt(kr,"StructArrayLayout3f12");class jt extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){let d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=u,this.uint16[d+2]=p,e}}jt.prototype.bytesPerElement=6,dt(jt,"StructArrayLayout3ui6");class ri extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G,J,le,te,ae,me){let ce=this.length;return this.resize(ce+1),this.emplace(ce,e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G,J,le,te,ae,me)}emplace(e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G,J,le,te,ae,me,ce){let Oe=30*e,Ae=15*e,De=60*e;return this.int16[Oe+0]=r,this.int16[Oe+1]=u,this.int16[Oe+2]=p,this.float32[Ae+2]=d,this.float32[Ae+3]=_,this.uint16[Oe+8]=y,this.uint16[Oe+9]=b,this.uint32[Ae+5]=w,this.uint32[Ae+6]=S,this.uint32[Ae+7]=O,this.uint16[Oe+16]=C,this.uint16[Oe+17]=k,this.uint16[Oe+18]=z,this.float32[Ae+10]=U,this.float32[Ae+11]=G,this.uint8[De+48]=J,this.uint8[De+49]=le,this.uint8[De+50]=te,this.uint32[Ae+13]=ae,this.int16[Oe+28]=me,this.uint8[De+58]=ce,e}}ri.prototype.bytesPerElement=60,dt(ri,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ii extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G,J,le,te,ae,me,ce,Oe,Ae,De,Qe,Ce,Be,$e,Fe){let Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G,J,le,te,ae,me,ce,Oe,Ae,De,Qe,Ce,Be,$e,Fe)}emplace(e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G,J,le,te,ae,me,ce,Oe,Ae,De,Qe,Ce,Be,$e,Fe,Ke){let We=38*e,lt=19*e;return this.int16[We+0]=r,this.int16[We+1]=u,this.int16[We+2]=p,this.float32[lt+2]=d,this.float32[lt+3]=_,this.int16[We+8]=y,this.int16[We+9]=b,this.int16[We+10]=w,this.int16[We+11]=S,this.int16[We+12]=O,this.int16[We+13]=C,this.uint16[We+14]=k,this.uint16[We+15]=z,this.uint16[We+16]=U,this.uint16[We+17]=G,this.uint16[We+18]=J,this.uint16[We+19]=le,this.uint16[We+20]=te,this.uint16[We+21]=ae,this.uint16[We+22]=me,this.uint16[We+23]=ce,this.uint16[We+24]=Oe,this.uint16[We+25]=Ae,this.uint16[We+26]=De,this.uint16[We+27]=Qe,this.uint16[We+28]=Ce,this.uint32[lt+15]=Be,this.float32[lt+16]=$e,this.float32[lt+17]=Fe,this.float32[lt+18]=Ke,e}}Ii.prototype.bytesPerElement=76,dt(Ii,"StructArrayLayout3i2f6i15ui1ul3f76");class Ar extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ar.prototype.bytesPerElement=4,dt(Ar,"StructArrayLayout1f4");class Ai extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,d){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,u,p,d)}emplace(e,r,u,p,d,_){let y=5*e;return this.float32[y+0]=r,this.float32[y+1]=u,this.float32[y+2]=p,this.float32[y+3]=d,this.float32[y+4]=_,e}}Ai.prototype.bytesPerElement=20,dt(Ai,"StructArrayLayout5f20");class La extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,u,p)}emplace(e,r,u,p,d){let _=6*e;return this.uint32[3*e+0]=r,this.uint16[_+2]=u,this.uint16[_+3]=p,this.uint16[_+4]=d,e}}La.prototype.bytesPerElement=12,dt(La,"StructArrayLayout1ul3ui12");class zi extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let u=this.length;return this.resize(u+1),this.emplace(u,e,r)}emplace(e,r,u){let p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=u,e}}zi.prototype.bytesPerElement=4,dt(zi,"StructArrayLayout2ui4");class ka extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ka.prototype.bytesPerElement=2,dt(ka,"StructArrayLayout1ui2");class za extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let u=this.length;return this.resize(u+1),this.emplace(u,e,r)}emplace(e,r,u){let p=2*e;return this.float32[p+0]=r,this.float32[p+1]=u,e}}za.prototype.bytesPerElement=8,dt(za,"StructArrayLayout2f8");class Ba extends Pe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ba.prototype.size=12;class Bi extends rr{get(e){return new Ba(this,e)}}dt(Bi,"FillExtrusionExtArray");class Fa extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fa.prototype.size=40;class Yo extends vi{get(e){return new Fa(this,e)}}dt(Yo,"CollisionBoxArray");class nu extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}nu.prototype.size=60;class sI extends ri{get(e){return new nu(this,e)}}dt(sI,"PlacedSymbolArray");class lI extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}lI.prototype.size=76;class uI extends Ii{get(e){return new lI(this,e)}}dt(uI,"SymbolInstanceArray");class cI extends Ar{getoffsetX(e){return this.float32[1*e+0]}}dt(cI,"GlyphOffsetArray");class hI extends yt{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}dt(hI,"SymbolLineVertexArray");class pI extends Pe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}pI.prototype.size=12;class fI extends La{get(e){return new pI(this,e)}}dt(fI,"FeatureIndexArray");class dI extends Pe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}dI.prototype.size=4;class mI extends zi{get(e){return new dI(this,e)}}dt(mI,"FillExtrusionCentroidArray");class _I extends Pe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}_I.prototype.size=12;class yI extends rr{get(e){return new _I(this,e)}}dt(yI,"CircleGlobeExtArray");let XH=Ne([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),YH=Ne([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var gI=Ep(function(i){i.exports=function(e,r){var u,p,d,_,y,b,w,S;for(p=e.length-(u=3&e.length),d=r,y=3432918353,b=461845907,S=0;S<p;)w=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,d=27492+(65535&(_=5*(65535&(d=(d^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(w=0,u){case 3:w^=(255&e.charCodeAt(S+2))<<16;case 2:w^=(255&e.charCodeAt(S+1))<<8;case 1:d^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),KH=Ep(function(i){i.exports=function(e,r){for(var u,p=e.length,d=r^p,_=0;p>=4;)u=1540483477*(65535&(u=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++_;switch(p){case 3:d^=(255&e.charCodeAt(_+2))<<16;case 2:d^=(255&e.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),wf=gI,JH=KH;wf.murmur3=gI,wf.murmur2=JH;class U_{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,u,p){this.ids.push(vI(e)),this.positions.push(r,u,p)}getPositions(e){let r=vI(e),u=0,p=this.ids.length-1;for(;u<p;){let _=u+p>>1;this.ids[_]>=r?p=_:u=_+1}let d=[];for(;this.ids[u]===r;)d.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return d}static serialize(e,r){let u=new Float64Array(e.ids),p=new Uint32Array(e.positions);return G0(u,p,0,u.length-1),r&&r.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(e){let r=new U_;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function vI(i){let e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:wf(String(i))}function G0(i,e,r,u){for(;r<u;){let p=i[r+u>>1],d=r-1,_=u+1;for(;;){do d++;while(i[d]<p);do _--;while(i[_]>p);if(d>=_)break;j_(i,d,_),j_(e,3*d,3*_),j_(e,3*d+1,3*_+1),j_(e,3*d+2,3*_+2)}_-r<u-_?(G0(i,e,r,_),r=_+1):(G0(i,e,_+1,u),u=_)}}function j_(i,e,r){let u=i[e];i[e]=i[r],i[r]=u}dt(U_,"FeaturePositionMap");class Na{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class V_ extends Na{constructor(e){super(e),this.current=0}set(e,r,u){this.fetchUniformLocation(e,r)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class xI extends Na{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,u){this.fetchUniformLocation(e,r)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class bI extends Na{constructor(e){super(e),this.current=vr.transparent}set(e,r,u){this.fetchUniformLocation(e,r)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let QH=new Float32Array(16),eX=new Float32Array(9),tX=new Float32Array(4);function $0(i){return[Ue(255*i.r,255*i.g),Ue(255*i.b,255*i.a)]}class Tf{constructor(e,r,u){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=u}setUniform(e,r,u,p,d){r.set(e,d,p.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new bI(e):new V_(e)}}class zc{constructor(e,r){this.uniformNames=r.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,u,p,d){let _=d==="u_pattern_to"||d==="u_dash_to"?this.patternTo:d==="u_pattern_from"||d==="u_dash_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&r.set(e,d,_)}getBinding(e,r){return r==="u_pattern_from"||r==="u_pattern_to"||r==="u_dash_from"||r==="u_dash_to"?new xI(e):new V_(e)}}class Ua{constructor(e,r,u,p){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,u,p,d,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new Z(0),r,{},d,p,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,u,p,d){let _=this.expression.evaluate({zoom:0},u,p,void 0,d);this._setPaintValue(e,r,_)}_setPaintValue(e,r,u){if(this.type==="color"){let p=$0(u);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bo{constructor(e,r,u,p,d,_){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,u,p,d,_){let y=this.expression.evaluate(new Z(this.zoom),r,{},d,p,_),b=this.expression.evaluate(new Z(this.zoom+1),r,{},d,p,_),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,b)}updatePaintArray(e,r,u,p,d){let _=this.expression.evaluate({zoom:this.zoom},u,p,void 0,d),y=this.expression.evaluate({zoom:this.zoom+1},u,p,void 0,d);this._setPaintValue(e,r,_,y)}_setPaintValue(e,r,u,p){if(this.type==="color"){let d=$0(u),_=$0(p);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],_[0],_[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,u,p,d){let _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=He(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);r.set(e,d,y)}getBinding(e,r){return new V_(e)}}class Rs{constructor(e,r,u,p,d,_,y){this.expression=e,this.type=u,this.useIntegerZoom=p,this.zoom=d,this.layerId=y,this.paintVertexAttributes=(u==="array"?YH:XH).members;for(let b=0;b<r.length;++b);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,u){let p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],u)}updatePaintArray(e,r,u,p,d,_){this._setPaintValues(e,r,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(e,r,u,p){if(!p||!u)return;let{min:d,mid:_,max:y}=u,b=p[d],w=p[_],S=p[y];if(b&&w&&S)for(let O=e;O<r;O++)this._setPaintValue(this.zoomInPaintVertexArray,O,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,O,w,S)}_setPaintValue(e,r,u,p){e.emplace(r,u.tl[0],u.tl[1],u.br[0],u.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],u.pixelRatio,p.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ds{constructor(e,r,u=()=>!0){this.binders={},this._buffers=[];let p=[];for(let d in e.paint._values){if(!u(d))continue;let _=e.paint.get(d);if(!(_ instanceof se&&Es(_.property.specification)))continue;let y=iX(d,e.type),b=_.value,w=_.property.specification.type,S=_.property.useIntegerZoom,O=_.property.specification["property-type"],C=O==="cross-faded"||O==="cross-faded-data-driven",k=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||k)if(b.kind==="source"||k||C){let z=wI(d,w,"source");this.binders[d]=C?new Rs(b,y,w,S,r,z,e.id):new Ua(b,y,w,z),p.push(`/a_${d}`)}else{let z=wI(d,w,"composite");this.binders[d]=new bo(b,y,w,S,r,z),p.push(`/z_${d}`)}else this.binders[d]=C?new zc(b.value,y):new Tf(b.value,y,w),p.push(`/u_${d}`)}this.cacheKey=p.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof Ua||r instanceof bo?r.maxValue:0}populatePaintArrays(e,r,u,p,d,_){for(let y in this.binders){let b=this.binders[y];(b instanceof Ua||b instanceof bo||b instanceof Rs)&&b.populatePaintArray(e,r,u,p,d,_)}}setConstantPatternPositions(e,r){for(let u in this.binders){let p=this.binders[u];p instanceof zc&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,u,p,d,_){let y=!1;for(let b in e){let w=r.getPositions(b);for(let S of w){let O=u.feature(S.index);for(let C in this.binders){let k=this.binders[C];if((k instanceof Ua||k instanceof bo||k instanceof Rs)&&k.expression.isStateDependent===!0){let z=p.paint.get(C);k.expression=z.value,k.updatePaintArray(S.start,S.end,O,e[b],d,_),y=!0}}}}return y}defines(){let e=[];for(let r in this.binders){let u=this.binders[r];(u instanceof Tf||u instanceof zc)&&e.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let u=this.binders[r];if(u instanceof Ua||u instanceof bo||u instanceof Rs)for(let p=0;p<u.paintVertexAttributes.length;p++)e.push(u.paintVertexAttributes[p].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let u=this.binders[r];if(u instanceof Tf||u instanceof zc||u instanceof bo)for(let p of u.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let r=[];for(let u in this.binders){let p=this.binders[u];if(p instanceof Tf||p instanceof zc||p instanceof bo)for(let d of p.uniformNames)r.push({name:d,property:u,binding:p.getBinding(e,d)})}return r}setUniforms(e,r,u,p,d){for(let{name:_,property:y,binding:b}of u)this.binders[y].setUniform(e,b,d,p.get(y),_)}updatePaintBuffers(e){this._buffers=[];for(let r in this.binders){let u=this.binders[r];if(e&&u instanceof Rs){let p=e.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof Ua||u instanceof bo)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(e){for(let r in this.binders){let u=this.binders[r];(u instanceof Ua||u instanceof bo||u instanceof Rs)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof Ua||r instanceof bo||r instanceof Rs)&&r.destroy()}}}class ou{constructor(e,r,u=()=>!0){this.programConfigurations={};for(let p of e)this.programConfigurations[p.id]=new Ds(p,r,u);this.needsUpload=!1,this._featureMap=new U_,this._bufferOffset=0}populatePaintArrays(e,r,u,p,d,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,p,d,_,y);r.id!==void 0&&this._featureMap.add(r.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,u,p,d){for(let _ of u)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,p,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let rX={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function iX(i,e){return rX[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}let nX={"line-pattern":{source:gt,composite:gt},"fill-pattern":{source:gt,composite:gt},"fill-extrusion-pattern":{source:gt,composite:gt},"line-dasharray":{source:Lt,composite:Lt}},oX={color:{source:za,composite:Wt},number:{source:Ar,composite:za}};function wI(i,e,r){let u=nX[i];return u&&u[r]||oX[e][r]}dt(Tf,"ConstantBinder"),dt(zc,"CrossFadedConstantBinder"),dt(Ua,"SourceExpressionBinder"),dt(Rs,"CrossFadedCompositeBinder"),dt(bo,"CompositeExpressionBinder"),dt(Ds,"ProgramConfiguration",{omit:["_buffers"]}),dt(ou,"ProgramConfigurationSet");let G_="-transition";class wo extends Et{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new pe(r.layout)),r.paint)){this._transitionablePaint=new ee(r.paint);for(let u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(let u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fe(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,u={}){r!=null&&this._validate(S_,`layers.${this.id}.layout.${e}`,e,r,u)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Me(e,G_)?this._transitionablePaint.getTransition(e.slice(0,-G_.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,u={}){if(r!=null&&this._validate(Mc,`layers.${this.id}.paint.${e}`,e,r,u))return!1;if(Me(e,G_))return this._transitionablePaint.setTransition(e.slice(0,-G_.length),r||void 0),!1;{let p=this._transitionablePaint._values[e],d=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),y=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);let b=this._transitionablePaint._values[e].value;return b.isDataDriven()||_||d||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ke(e,(r,u)=>!(r===void 0||u==="layout"&&!Object.keys(r).length||u==="paint"&&!Object.keys(r).length))}_validate(e,r,u,p,d={}){return(!d||d.validate!==!1)&&pf(this,e.call(Pc,{key:r,layerType:this.type,objectKey:u,value:p,styleSpec:qe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof se&&Es(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let aX=Ne([{name:"a_pos",components:2,type:"Int16"}],4),sX=Ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class oi{constructor(e=[]){this.segments=e}prepareSegment(e,r,u,p){let d=this.segments[this.segments.length-1];return e>oi.MAX_VERTEX_ARRAY_LENGTH&&ot(`Max vertices per segment is ${oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>oi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==p)&&(d={vertexOffset:r.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(d.sortKey=p),this.segments.push(d)),d}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,u,p){return new oi([{vertexOffset:e,primitiveOffset:r,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dt(oi,"SegmentVector");var Mt=8192;class Ls{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof pr?new pr(e.lng,e.lat):pr.convert(e),this}setSouthWest(e){return this._sw=e instanceof pr?new pr(e.lng,e.lat):pr.convert(e),this}extend(e){let r=this._sw,u=this._ne,p,d;if(e instanceof pr)p=e,d=e;else{if(!(e instanceof Ls))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ls.convert(e)):this.extend(pr.convert(e)):this;if(p=e._sw,d=e._ne,!p||!d)return this}return r||u?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),u.lng=Math.max(d.lng,u.lng),u.lat=Math.max(d.lat,u.lat)):(this._sw=new pr(p.lng,p.lat),this._ne=new pr(d.lng,d.lat)),this}getCenter(){return new pr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pr(this.getWest(),this.getNorth())}getSouthEast(){return new pr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:u}=pr.convert(e),p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(e){return!e||e instanceof Ls?e:new Ls(e)}}let W0=63710088e-1;class pr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pr(Yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,u=this.lat*r,p=e.lat*r,d=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return W0*Math.acos(Math.min(d,1))}toBounds(e=0){let r=360*e/40075017,u=r/Math.cos(Math.PI/180*this.lat);return new Ls(new pr(this.lng-u,this.lat-r),new pr(this.lng+u,this.lat+r))}static convert(e){if(e instanceof pr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new pr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new pr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let TI=2*Math.PI*W0;function Z0(i){return TI*Math.cos(i*Math.PI/180)}function Ko(i){return(180+i)/360}function ja(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Xn(i,e){return i/Z0(e)}function Yn(i){return 360*i-180}function Oi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function EI(i,e){return i*Z0(Oi(e))}let Jo=85.051129;function SI(i){return 1/Math.cos(i*Math.PI/180)}class Bc{constructor(e,r,u=0){this.x=+e,this.y=+r,this.z=+u}static fromLngLat(e,r=0){let u=pr.convert(e);return new Bc(Ko(u.lng),ja(u.lat),Xn(r,u.lat))}toLngLat(){return new pr(Yn(this.x),Oi(this.y))}toAltitude(){return EI(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/TI*SI(Oi(this.y))}}function H0(i,e,r,u,p,d,_,y,b){let w=(e+u)/2,S=(r+p)/2,O=new q(w,S);y(O),function(C,k,z,U,G,J){let le=z-G,te=U-J;return Math.abs((U-k)*le-(z-C)*te)/Math.hypot(le,te)}(O.x,O.y,d.x,d.y,_.x,_.y)>=b?(H0(i,e,r,w,S,d,O,y,b),H0(i,w,S,u,p,O,_,y,b)):i.push(_)}function II(i,e,r){let u=i[0],p=u.x,d=u.y;e(u);let _=[u];for(let y=1;y<i.length;y++){let b=i[y],{x:w,y:S}=b;e(b),H0(_,p,d,w,S,u,b,e,r),p=w,d=S,u=b}return _}function X0(i,e,r,u,p){if(p(e,r)){let d=e.add(r).mult(.5);u(d),X0(i,e,d,u,p),X0(i,d,r,u,p)}else i.push(r)}function lX(i,e,r){let u=i[0];e(u);let p=[u];for(let d=1;d<i.length;d++){let _=i[d];e(_),X0(p,u,_,e,r),u=_}return p}let Y0=Math.pow(2,14)-1,AI=-Y0-1;function uX(i,e){let r=Math.round(i.x*e),u=Math.round(i.y*e);return i.x=He(r,AI,Y0),i.y=He(u,AI,Y0),(r<i.x||r>i.x+1||u<i.y||u>i.y+1)&&ot("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Va(i,e,r){let u=i.loadGeometry(),p=i.extent,d=Mt/p;if(e&&r&&r.projection.isReprojectedInTileSpace){let _=1<<e.z,{scale:y,x:b,y:w,projection:S}=r,O=C=>{let k=Yn((e.x+C.x/p)/_),z=Oi((e.y+C.y/p)/_),U=S.project(k,z);C.x=(U.x*y-b)*p,C.y=(U.y*y-w)*p};for(let C=0;C<u.length;C++)if(i.type!==1)u[C]=II(u[C],O,1);else{let k=[];for(let z of u[C])z.x<0||z.x>=p||z.y<0||z.y>=p||(O(z),k.push(z));u[C]=k}}for(let _ of u)for(let y of _)uX(y,d);return u}function au(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Va(i):[]}}function $_(i,e,r,u,p){i.emplaceBack(2*e+(u+1)/2,2*r+(p+1)/2)}function W_(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class K0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new at,this.indexArray=new jt,this.segments=new oi,this.programConfigurations=new ou(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,u,p){let d=this.layers[0],_=[],y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(let{feature:w,id:S,index:O,sourceLayerIndex:C}of e){let k=this.layers[0]._featureFilter.needGeometry,z=au(w,k);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),z,u))continue;let U=y?y.evaluate(z,{},u):void 0,G={id:S,properties:w.properties,type:w.type,sourceLayerIndex:C,index:O,geometry:k?z.geometry:Va(w,u,p),patterns:{},sortKey:U};_.push(G)}y&&_.sort((w,S)=>w.sortKey-S.sortKey);let b=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new yI,b=p.projection);for(let w of _){let{geometry:S,index:O,sourceLayerIndex:C}=w,k=e[O].feature;this.addFeature(w,S,O,r.availableImages,u,b),r.featureIndex.insert(k,S,O,C,this.index)}}update(e,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aX.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,sX.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,u,p,d,_){for(let y of r)for(let b of y){let w=b.x,S=b.y;if(w<0||w>=Mt||S<0||S>=Mt)continue;if(_){let k=_.projectTilePoint(w,S,d),z=_.upVector(d,w,S),U=this.globeExtVertexArray;W_(U,k,z),W_(U,k,z),W_(U,k,z),W_(U,k,z)}let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=O.vertexLength;$_(this.layoutVertexArray,w,S,-1,-1),$_(this.layoutVertexArray,w,S,1,-1),$_(this.layoutVertexArray,w,S,1,1),$_(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},p,d)}}function OI(i,e){for(let r=0;r<i.length;r++)if(su(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(su(i,e[r]))return!0;return!!J0(i,e)}function cX(i,e,r){return!!su(i,e)||!!Q0(e,i,r)}function CI(i,e){if(i.length===1)return MI(e,i[0]);for(let r=0;r<e.length;r++){let u=e[r];for(let p=0;p<u.length;p++)if(su(i,u[p]))return!0}for(let r=0;r<i.length;r++)if(MI(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(J0(i,e[r]))return!0;return!1}function hX(i,e,r){if(i.length>1){if(J0(i,e))return!0;for(let u=0;u<e.length;u++)if(Q0(e[u],i,r))return!0}for(let u=0;u<i.length;u++)if(Q0(i[u],e,r))return!0;return!1}function J0(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){let u=i[r],p=i[r+1];for(let d=0;d<e.length-1;d++)if(pX(u,p,e[d],e[d+1]))return!0}return!1}function pX(i,e,r,u){return vt(i,r,u)!==vt(e,r,u)&&vt(i,e,r)!==vt(i,e,u)}function Q0(i,e,r){let u=r*r;if(e.length===1)return i.distSqr(e[0])<u;for(let p=1;p<e.length;p++)if(PI(i,e[p-1],e[p])<u)return!0;return!1}function PI(i,e,r){let u=e.distSqr(r);if(u===0)return i.distSqr(e);let p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/u;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function MI(i,e){let r,u,p,d=!1;for(let _=0;_<i.length;_++){r=i[_];for(let y=0,b=r.length-1;y<r.length;b=y++)u=r[y],p=r[b],u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(d=!d)}return d}function su(i,e){let r=!1;for(let u=0,p=i.length-1;u<i.length;p=u++){let d=i[u],_=i[p];d.y>e.y!=_.y>e.y&&e.x<(_.x-d.x)*(e.y-d.y)/(_.y-d.y)+d.x&&(r=!r)}return r}function qI(i,e,r,u,p){for(let _ of i)if(e<=_.x&&r<=_.y&&u>=_.x&&p>=_.y)return!0;let d=[new q(e,r),new q(e,p),new q(u,p),new q(u,r)];if(i.length>2){for(let _ of d)if(su(i,_))return!0}for(let _=0;_<i.length-1;_++)if(fX(i[_],i[_+1],d))return!0;return!1}function fX(i,e,r){let u=r[0],p=r[2];if(i.x<u.x&&e.x<u.x||i.x>p.x&&e.x>p.x||i.y<u.y&&e.y<u.y||i.y>p.y&&e.y>p.y)return!1;let d=vt(i,e,r[0]);return d!==vt(i,e,r[1])||d!==vt(i,e,r[2])||d!==vt(i,e,r[3])}function Fc(i,e,r){let u=e.paint.get(i).value;return u.kind==="constant"?u.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Z_(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function RI(i,e,r,u,p){if(!e[0]&&!e[1])return i;let d=q.convert(e)._mult(p);r==="viewport"&&d._rotate(-u);let _=[];for(let y=0;y<i.length;y++)_.push(i[y].sub(d));return _}function DI(i,e,r,u){let p=q.convert(i)._mult(u);return e==="viewport"&&p._rotate(-r),p}dt(K0,"CircleBucket",{omit:["layers"]});let dX=new ze({"circle-sort-key":new ge(qe.layout_circle["circle-sort-key"])});var mX={paint:new ze({"circle-radius":new ge(qe.paint_circle["circle-radius"]),"circle-color":new ge(qe.paint_circle["circle-color"]),"circle-blur":new ge(qe.paint_circle["circle-blur"]),"circle-opacity":new ge(qe.paint_circle["circle-opacity"]),"circle-translate":new he(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new he(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ge(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ge(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ge(qe.paint_circle["circle-stroke-opacity"])}),layout:dX},H_=1e-6,gn=typeof Float32Array<"u"?Float32Array:Array;function LI(){var i=new gn(9);return gn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Qo(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ex(i,e){var r=e[0],u=e[1],p=e[2],d=e[3],_=e[4],y=e[5],b=e[6],w=e[7],S=e[8],O=e[9],C=e[10],k=e[11],z=e[12],U=e[13],G=e[14],J=e[15],le=r*y-u*_,te=r*b-p*_,ae=r*w-d*_,me=u*b-p*y,ce=u*w-d*y,Oe=p*w-d*b,Ae=S*U-O*z,De=S*G-C*z,Qe=S*J-k*z,Ce=O*G-C*U,Be=O*J-k*U,$e=C*J-k*G,Fe=le*$e-te*Be+ae*Ce+me*Qe-ce*De+Oe*Ae;return Fe?(i[0]=(y*$e-b*Be+w*Ce)*(Fe=1/Fe),i[1]=(p*Be-u*$e-d*Ce)*Fe,i[2]=(U*Oe-G*ce+J*me)*Fe,i[3]=(C*ce-O*Oe-k*me)*Fe,i[4]=(b*Qe-_*$e-w*De)*Fe,i[5]=(r*$e-p*Qe+d*De)*Fe,i[6]=(G*ae-z*Oe-J*te)*Fe,i[7]=(S*Oe-C*ae+k*te)*Fe,i[8]=(_*Be-y*Qe+w*Ae)*Fe,i[9]=(u*Qe-r*Be-d*Ae)*Fe,i[10]=(z*ce-U*ae+J*le)*Fe,i[11]=(O*ae-S*ce-k*le)*Fe,i[12]=(y*De-_*Ce-b*Ae)*Fe,i[13]=(r*Ce-u*De+p*Ae)*Fe,i[14]=(U*te-z*me-G*le)*Fe,i[15]=(S*me-O*te+C*le)*Fe,i):null}function Nc(i,e,r){var u=e[0],p=e[1],d=e[2],_=e[3],y=e[4],b=e[5],w=e[6],S=e[7],O=e[8],C=e[9],k=e[10],z=e[11],U=e[12],G=e[13],J=e[14],le=e[15],te=r[0],ae=r[1],me=r[2],ce=r[3];return i[0]=te*u+ae*y+me*O+ce*U,i[1]=te*p+ae*b+me*C+ce*G,i[2]=te*d+ae*w+me*k+ce*J,i[3]=te*_+ae*S+me*z+ce*le,i[4]=(te=r[4])*u+(ae=r[5])*y+(me=r[6])*O+(ce=r[7])*U,i[5]=te*p+ae*b+me*C+ce*G,i[6]=te*d+ae*w+me*k+ce*J,i[7]=te*_+ae*S+me*z+ce*le,i[8]=(te=r[8])*u+(ae=r[9])*y+(me=r[10])*O+(ce=r[11])*U,i[9]=te*p+ae*b+me*C+ce*G,i[10]=te*d+ae*w+me*k+ce*J,i[11]=te*_+ae*S+me*z+ce*le,i[12]=(te=r[12])*u+(ae=r[13])*y+(me=r[14])*O+(ce=r[15])*U,i[13]=te*p+ae*b+me*C+ce*G,i[14]=te*d+ae*w+me*k+ce*J,i[15]=te*_+ae*S+me*z+ce*le,i}function Ef(i,e,r){var u,p,d,_,y,b,w,S,O,C,k,z,U=r[0],G=r[1],J=r[2];return e===i?(i[12]=e[0]*U+e[4]*G+e[8]*J+e[12],i[13]=e[1]*U+e[5]*G+e[9]*J+e[13],i[14]=e[2]*U+e[6]*G+e[10]*J+e[14],i[15]=e[3]*U+e[7]*G+e[11]*J+e[15]):(p=e[1],d=e[2],_=e[3],y=e[4],b=e[5],w=e[6],S=e[7],O=e[8],C=e[9],k=e[10],z=e[11],i[0]=u=e[0],i[1]=p,i[2]=d,i[3]=_,i[4]=y,i[5]=b,i[6]=w,i[7]=S,i[8]=O,i[9]=C,i[10]=k,i[11]=z,i[12]=u*U+y*G+O*J+e[12],i[13]=p*U+b*G+C*J+e[13],i[14]=d*U+w*G+k*J+e[14],i[15]=_*U+S*G+z*J+e[15]),i}function lu(i,e,r){var u=r[0],p=r[1],d=r[2];return i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i[3]=e[3]*u,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function tx(i,e,r){var u=Math.sin(r),p=Math.cos(r),d=e[4],_=e[5],y=e[6],b=e[7],w=e[8],S=e[9],O=e[10],C=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*p+w*u,i[5]=_*p+S*u,i[6]=y*p+O*u,i[7]=b*p+C*u,i[8]=w*p-d*u,i[9]=S*p-_*u,i[10]=O*p-y*u,i[11]=C*p-b*u,i}function X_(i,e,r){var u=Math.sin(r),p=Math.cos(r),d=e[0],_=e[1],y=e[2],b=e[3],w=e[8],S=e[9],O=e[10],C=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*p-w*u,i[1]=_*p-S*u,i[2]=y*p-O*u,i[3]=b*p-C*u,i[8]=d*u+w*p,i[9]=_*u+S*p,i[10]=y*u+O*p,i[11]=b*u+C*p,i}function kI(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zI(i,e,r){var u,p,d,_=r[0],y=r[1],b=r[2],w=Math.hypot(_,y,b);return w<H_?null:(_*=w=1/w,y*=w,b*=w,u=Math.sin(e),p=Math.cos(e),i[0]=_*_*(d=1-p)+p,i[1]=y*_*d+b*u,i[2]=b*_*d-y*u,i[3]=0,i[4]=_*y*d-b*u,i[5]=y*y*d+p,i[6]=b*y*d+_*u,i[7]=0,i[8]=_*b*d+y*u,i[9]=y*b*d-_*u,i[10]=b*b*d+p,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var _X=Nc;function rx(){var i=new gn(3);return gn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function BI(i){var e=new gn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Sf(i){return Math.hypot(i[0],i[1],i[2])}function Uc(i,e,r){var u=new gn(3);return u[0]=i,u[1]=e,u[2]=r,u}function ks(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function ix(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function FI(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function nx(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function ox(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function To(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Y_(i,e,r,u){return i[0]=e[0]+r[0]*u,i[1]=e[1]+r[1]*u,i[2]=e[2]+r[2]*u,i}function $i(i,e){var r=e[0],u=e[1],p=e[2],d=r*r+u*u+p*p;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i}function Kn(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function ax(i,e,r){var u=e[0],p=e[1],d=e[2],_=r[0],y=r[1],b=r[2];return i[0]=p*b-d*y,i[1]=d*_-u*b,i[2]=u*y-p*_,i}function si(i,e,r){var u=e[0],p=e[1],d=e[2],_=r[3]*u+r[7]*p+r[11]*d+r[15];return i[0]=(r[0]*u+r[4]*p+r[8]*d+r[12])/(_=_||1),i[1]=(r[1]*u+r[5]*p+r[9]*d+r[13])/_,i[2]=(r[2]*u+r[6]*p+r[10]*d+r[14])/_,i}function NI(i,e,r){var u=r[0],p=r[1],d=r[2],_=e[0],y=e[1],b=e[2],w=p*b-d*y,S=d*_-u*b,O=u*y-p*_,C=p*O-d*S,k=d*w-u*O,z=u*S-p*w,U=2*r[3];return S*=U,O*=U,k*=2,z*=2,i[0]=_+(w*=U)+(C*=2),i[1]=y+S+k,i[2]=b+O+z,i}var If,Eo=ix,yX=FI,gX=Sf;function UI(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i}function uu(i,e,r){var u=e[0],p=e[1],d=e[2],_=e[3];return i[0]=r[0]*u+r[4]*p+r[8]*d+r[12]*_,i[1]=r[1]*u+r[5]*p+r[9]*d+r[13]*_,i[2]=r[2]*u+r[6]*p+r[10]*d+r[14]*_,i[3]=r[3]*u+r[7]*p+r[11]*d+r[15]*_,i}function jI(){var i=new gn(4);return gn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function VI(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function GI(i,e,r){r*=.5;var u=e[0],p=e[1],d=e[2],_=e[3],y=Math.sin(r),b=Math.cos(r);return i[0]=u*b+_*y,i[1]=p*b+d*y,i[2]=d*b-p*y,i[3]=_*b-u*y,i}function $I(i,e,r){r*=.5;var u=e[0],p=e[1],d=e[2],_=e[3],y=Math.sin(r),b=Math.cos(r);return i[0]=u*b-d*y,i[1]=p*b+_*y,i[2]=d*b+u*y,i[3]=_*b-p*y,i}rx(),If=new gn(4),gn!=Float32Array&&(If[0]=0,If[1]=0,If[2]=0,If[3]=0),rx(),Uc(1,0,0),Uc(0,1,0),jI(),jI(),LI();class sx{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,u){let p=Kn(r,this.dir);if(Math.abs(p)<1e-6)return!1;let d=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/p;return u[0]=this.pos[0]+this.dir[0]*d,u[1]=this.pos[1]+this.dir[1]*d,u[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,r,u){if(function(k,z){var U=k[0],G=k[1],J=k[2],le=z[0],te=z[1],ae=z[2];return Math.abs(U-le)<=H_*Math.max(1,Math.abs(U),Math.abs(le))&&Math.abs(G-te)<=H_*Math.max(1,Math.abs(G),Math.abs(te))&&Math.abs(J-ae)<=H_*Math.max(1,Math.abs(J),Math.abs(ae))}(this.pos,e)||r===0)return u[0]=u[1]=u[2]=0,!1;let[p,d,_]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],S=p*p+d*d+_*_,O=2*(y*p+b*d+w*_),C=O*O-4*S*(y*y+b*b+w*w-r*r);if(C<0){let k=Math.max(-O/2,0),z=y+p*k,U=b+d*k,G=w+_*k,J=Math.hypot(z,U,G);return u[0]=z*r/J,u[1]=U*r/J,u[2]=G*r/J,!1}{let k=(-O-Math.sqrt(C))/(2*S);if(k<0){let z=Math.hypot(y,b,w);return u[0]=y*r/z,u[1]=b*r/z,u[2]=w*r/z,!1}return u[0]=y+p*k,u[1]=b+d*k,u[2]=w+_*k,!0}}}class lx{constructor(e,r,u,p,d){this.TL=e,this.TR=r,this.BR=u,this.BL=p,this.horizon=d}static fromInvProjectionMatrix(e,r,u){let p=[-1,1,1],d=[1,1,1],_=[1,-1,1],y=[-1,-1,1],b=si(p,p,e),w=si(d,d,e),S=si(_,_,e),O=si(y,y,e);return new lx(b,w,S,O,r/u)}}class ux{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,u,p){let d=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let w=uu([],b,e),S=1/w[3]/r*d;return function(O,C,k){return O[0]=C[0]*k[0],O[1]=C[1]*k[1],O[2]=C[2]*k[2],O[3]=C[3]*k[3],O}(w,w,[S,S,p?1/w[3]:S,S])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let w=$i([],ax([],Eo([],_[b[0]],_[b[1]]),Eo([],_[b[2]],_[b[1]]))),S=-Kn(w,_[b[1]]);return w.concat(S)});return new ux(_,y)}}class rn{static fromPoints(e){let r=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],u=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(let p of e)r[0]=Math.min(r[0],p[0]),r[1]=Math.min(r[1],p[1]),r[2]=Math.min(r[2],p[2]),u[0]=Math.max(u[0],p[0]),u[1]=Math.max(u[1],p[1]),u[2]=Math.max(u[2],p[2]);return new rn(r,u)}constructor(e,r){this.min=e,this.max=r,this.center=To([],ks([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],u=BI(this.min),p=BI(this.max);for(let d=0;d<r.length;d++)u[d]=r[d]?this.min[d]:this.center[d],p[d]=r[d]?this.center[d]:this.max[d];return p[2]=this.max[2],new rn(u,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){let r=this.getCorners(),u=!0;for(let p=0;p<e.planes.length;p++){let d=e.planes[p],_=0;for(let y=0;y<r.length;y++)_+=Kn(d,r[y])+d[3]>=0;if(_===0)return 0;_!==r.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){let b=e.points[y][p]-this.min[p];d=Math.min(d,b),_=Math.max(_,b)}if(_<0||d>this.max[p]-this.min[p])return 0}return 1}}function WI(i,e,r,u,p,d,_,y,b){if(d&&i.queryGeometry.isAboveHorizon)return!1;d&&(b*=i.pixelToTileUnitsFactor);let w=i.tileID.canonical,S=r.projection.upVectorScale(w,r.center.lat,r.worldSize).metersToTile;for(let O of e)for(let C of O){let k=C.add(y),z=p&&r.elevation?r.elevation.exaggeration()*p.getElevationAt(k.x,k.y,!0):0,U=r.projection.projectTilePoint(k.x,k.y,w);if(z>0){let te=r.projection.upVector(w,k.x,k.y);U.x+=te[0]*S*z,U.y+=te[1]*S*z,U.z+=te[2]*S*z}let G=d?k:vX(U.x,U.y,U.z,u),J=d?i.tilespaceRays.map(te=>bX(te,z)):i.queryGeometry.screenGeometry,le=uu([],[U.x,U.y,U.z,1],u);if(!_&&d?b*=le[3]/r.cameraToCenterDistance:_&&!d&&(b*=r.cameraToCenterDistance/le[3]),d){let te=Oi((C.y/Mt+w.y)/(1<<w.z));b/=r.projection.pixelsPerMeter(te,1)/Xn(1,te)}if(cX(J,G,b))return!0}return!1}function vX(i,e,r,u){let p=uu([],[i,e,r,1],u);return new q(p[0]/p[3],p[1]/p[3])}let ZI=Uc(0,0,0),xX=Uc(0,0,1);function bX(i,e){let r=rx();return ZI[2]=e,i.intersectsPlane(ZI,xX,r),new q(r[0],r[1])}class HI extends K0{}function XI(i,{width:e,height:r},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*r*u);return i.width=e,i.height=r,i.data=p,i}function YI(i,e,r){let{width:u,height:p}=e;u===i.width&&p===i.height||(cx(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,p)},r),i.width=u,i.height=p,i.data=e.data)}function cx(i,e,r,u,p,d){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||u.x>e.width-p.width||u.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let _=i.data,y=e.data;for(let b=0;b<p.height;b++){let w=((r.y+b)*i.width+r.x)*d,S=((u.y+b)*e.width+u.x)*d;for(let O=0;O<p.width*d;O++)y[S+O]=_[w+O]}return e}dt(HI,"HeatmapBucket",{omit:["layers"]});class Ga{constructor(e,r){XI(this,e,1,r)}resize(e){YI(this,new Ga(e),1)}clone(){return new Ga({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,u,p,d){cx(e,r,u,p,d,1)}}class vn{constructor(e,r){XI(this,e,4,r)}resize(e){YI(this,new vn(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,u,p,d){cx(e,r,u,p,d,4)}}dt(Ga,"AlphaImage"),dt(vn,"RGBAImage");var wX={paint:new ze({"heatmap-radius":new ge(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ge(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(qe.paint_heatmap["heatmap-opacity"])})};function hx(i){let e={},r=i.resolution||256,u=i.clips?i.clips.length:1,p=i.image||new vn({width:r,height:u}),d=(_,y,b)=>{e[i.evaluationKey]=b;let w=i.expression.evaluate(e);p.data[_+y+0]=Math.floor(255*w.r/w.a),p.data[_+y+1]=Math.floor(255*w.g/w.a),p.data[_+y+2]=Math.floor(255*w.b/w.a),p.data[_+y+3]=Math.floor(255*w.a)};if(i.clips)for(let _=0,y=0;_<u;++_,y+=4*r)for(let b=0,w=0;b<r;b++,w+=4){let S=b/(r-1),{start:O,end:C}=i.clips[_];d(y,w,O*(1-S)+C*S)}else for(let _=0,y=0;_<r;_++,y+=4)d(0,y,_/(r-1));return p}var TX={paint:new ze({"hillshade-illumination-direction":new he(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(qe.paint_hillshade["hillshade-accent-color"])})};let EX=Ne([{name:"a_pos",components:2,type:"Int16"}],4),{members:SX}=EX;var K_=J_,IX=J_;function J_(i,e,r){r=r||2;var u,p,d,_,y,b,w,S=e&&e.length,O=S?e[0]*r:i.length,C=KI(i,0,O,r,!0),k=[];if(!C||C.next===C.prev)return k;if(S&&(C=function(U,G,J,le){var te,ae,me,ce=[];for(te=0,ae=G.length;te<ae;te++)(me=KI(U,G[te]*le,te<ae-1?G[te+1]*le:U.length,le,!1))===me.next&&(me.steiner=!0),ce.push(DX(me));for(ce.sort(MX),te=0;te<ce.length;te++)J=qX(ce[te],J);return J}(i,e,C,r)),i.length>80*r){u=d=i[0],p=_=i[1];for(var z=r;z<O;z+=r)(y=i[z])<u&&(u=y),(b=i[z+1])<p&&(p=b),y>d&&(d=y),b>_&&(_=b);w=(w=Math.max(d-u,_-p))!==0?32767/w:0}return Af(C,k,r,u,p,w,0),k}function KI(i,e,r,u,p){var d,_;if(p===dx(i,e,r,u)>0)for(d=e;d<r;d+=u)_=eA(d,i[d],i[d+1],_);else for(d=r-u;d>=e;d-=u)_=eA(d,i[d],i[d+1],_);return _&&Q_(_,_.next)&&(Cf(_),_=_.next),_}function cu(i,e){if(!i)return i;e||(e=i);var r,u=i;do if(r=!1,u.steiner||!Q_(u,u.next)&&ii(u.prev,u,u.next)!==0)u=u.next;else{if(Cf(u),(u=e=u.prev)===u.next)break;r=!0}while(r||u!==e);return e}function Af(i,e,r,u,p,d,_){if(i){!_&&d&&function(S,O,C,k){var z=S;do z.z===0&&(z.z=px(z.x,z.y,O,C,k)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==S);z.prevZ.nextZ=null,z.prevZ=null,function(U){var G,J,le,te,ae,me,ce,Oe,Ae=1;do{for(J=U,U=null,ae=null,me=0;J;){for(me++,le=J,ce=0,G=0;G<Ae&&(ce++,le=le.nextZ);G++);for(Oe=Ae;ce>0||Oe>0&&le;)ce!==0&&(Oe===0||!le||J.z<=le.z)?(te=J,J=J.nextZ,ce--):(te=le,le=le.nextZ,Oe--),ae?ae.nextZ=te:U=te,te.prevZ=ae,ae=te;J=le}ae.nextZ=null,Ae*=2}while(me>1)}(z)}(i,u,p,d);for(var y,b,w=i;i.prev!==i.next;)if(y=i.prev,b=i.next,d?OX(i,u,p,d):AX(i))e.push(y.i/r|0),e.push(i.i/r|0),e.push(b.i/r|0),Cf(i),i=b.next,w=b.next;else if((i=b)===w){_?_===1?Af(i=CX(cu(i),e,r),e,r,u,p,d,2):_===2&&PX(i,e,r,u,p,d):Af(cu(i),e,r,u,p,d,1);break}}}function AX(i){var e=i.prev,r=i,u=i.next;if(ii(e,r,u)>=0)return!1;for(var p=e.x,d=r.x,_=u.x,y=e.y,b=r.y,w=u.y,S=p<d?p<_?p:_:d<_?d:_,O=y<b?y<w?y:w:b<w?b:w,C=p>d?p>_?p:_:d>_?d:_,k=y>b?y>w?y:w:b>w?b:w,z=u.next;z!==e;){if(z.x>=S&&z.x<=C&&z.y>=O&&z.y<=k&&jc(p,y,d,b,_,w,z.x,z.y)&&ii(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function OX(i,e,r,u){var p=i.prev,d=i,_=i.next;if(ii(p,d,_)>=0)return!1;for(var y=p.x,b=d.x,w=_.x,S=p.y,O=d.y,C=_.y,k=y<b?y<w?y:w:b<w?b:w,z=S<O?S<C?S:C:O<C?O:C,U=y>b?y>w?y:w:b>w?b:w,G=S>O?S>C?S:C:O>C?O:C,J=px(k,z,e,r,u),le=px(U,G,e,r,u),te=i.prevZ,ae=i.nextZ;te&&te.z>=J&&ae&&ae.z<=le;){if(te.x>=k&&te.x<=U&&te.y>=z&&te.y<=G&&te!==p&&te!==_&&jc(y,S,b,O,w,C,te.x,te.y)&&ii(te.prev,te,te.next)>=0||(te=te.prevZ,ae.x>=k&&ae.x<=U&&ae.y>=z&&ae.y<=G&&ae!==p&&ae!==_&&jc(y,S,b,O,w,C,ae.x,ae.y)&&ii(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;te&&te.z>=J;){if(te.x>=k&&te.x<=U&&te.y>=z&&te.y<=G&&te!==p&&te!==_&&jc(y,S,b,O,w,C,te.x,te.y)&&ii(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ae&&ae.z<=le;){if(ae.x>=k&&ae.x<=U&&ae.y>=z&&ae.y<=G&&ae!==p&&ae!==_&&jc(y,S,b,O,w,C,ae.x,ae.y)&&ii(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function CX(i,e,r){var u=i;do{var p=u.prev,d=u.next.next;!Q_(p,d)&&JI(p,u,u.next,d)&&Of(p,d)&&Of(d,p)&&(e.push(p.i/r|0),e.push(u.i/r|0),e.push(d.i/r|0),Cf(u),Cf(u.next),u=i=d),u=u.next}while(u!==i);return cu(u)}function PX(i,e,r,u,p,d){var _=i;do{for(var y=_.next.next;y!==_.prev;){if(_.i!==y.i&&LX(_,y)){var b=QI(_,y);return _=cu(_,_.next),b=cu(b,b.next),Af(_,e,r,u,p,d,0),void Af(b,e,r,u,p,d,0)}y=y.next}_=_.next}while(_!==i)}function MX(i,e){return i.x-e.x}function qX(i,e){var r=function(p,d){var _,y=d,b=p.x,w=p.y,S=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var O=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(O<=b&&O>S&&(S=O,_=y.x<y.next.x?y:y.next,O===b))return _}y=y.next}while(y!==d);if(!_)return null;var C,k=_,z=_.x,U=_.y,G=1/0;y=_;do b>=y.x&&y.x>=z&&b!==y.x&&jc(w<U?b:S,w,z,U,w<U?S:b,w,y.x,y.y)&&(C=Math.abs(w-y.y)/(b-y.x),Of(y,p)&&(C<G||C===G&&(y.x>_.x||y.x===_.x&&RX(_,y)))&&(_=y,G=C)),y=y.next;while(y!==k);return _}(i,e);if(!r)return e;var u=QI(r,i);return cu(u,u.next),cu(r,r.next)}function RX(i,e){return ii(i.prev,i,e.prev)<0&&ii(e.next,i,i.next)<0}function px(i,e,r,u,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function DX(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function jc(i,e,r,u,p,d,_,y){return(p-_)*(e-y)>=(i-_)*(d-y)&&(i-_)*(u-y)>=(r-_)*(e-y)&&(r-_)*(d-y)>=(p-_)*(u-y)}function LX(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,u){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==u.i&&p.next.i!==u.i&&JI(p,p.next,r,u))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(Of(i,e)&&Of(e,i)&&function(r,u){var p=r,d=!1,_=(r.x+u.x)/2,y=(r.y+u.y)/2;do p.y>y!=p.next.y>y&&p.next.y!==p.y&&_<(p.next.x-p.x)*(y-p.y)/(p.next.y-p.y)+p.x&&(d=!d),p=p.next;while(p!==r);return d}(i,e)&&(ii(i.prev,i,e.prev)||ii(i,e.prev,e))||Q_(i,e)&&ii(i.prev,i,i.next)>0&&ii(e.prev,e,e.next)>0)}function ii(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Q_(i,e){return i.x===e.x&&i.y===e.y}function JI(i,e,r,u){var p=ty(ii(i,e,r)),d=ty(ii(i,e,u)),_=ty(ii(r,u,i)),y=ty(ii(r,u,e));return p!==d&&_!==y||!(p!==0||!ey(i,r,e))||!(d!==0||!ey(i,u,e))||!(_!==0||!ey(r,i,u))||!(y!==0||!ey(r,e,u))}function ey(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function ty(i){return i>0?1:i<0?-1:0}function Of(i,e){return ii(i.prev,i,i.next)<0?ii(i,e,i.next)>=0&&ii(i,i.prev,e)>=0:ii(i,e,i.prev)<0||ii(i,i.next,e)<0}function QI(i,e){var r=new fx(i.i,i.x,i.y),u=new fx(e.i,e.x,e.y),p=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,u.next=r,r.prev=u,d.next=u,u.prev=d,u}function eA(i,e,r,u){var p=new fx(i,e,r);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function Cf(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function fx(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dx(i,e,r,u){for(var p=0,d=e,_=r-u;d<r;d+=u)p+=(i[_]-i[d])*(i[d+1]+i[_+1]),_=d;return p}function kX(i,e,r,u,p){tA(i,e,r||0,u||i.length-1,p||zX)}function tA(i,e,r,u,p){for(;u>r;){if(u-r>600){var d=u-r+1,_=e-r+1,y=Math.log(d),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(d-b)/d)*(_-d/2<0?-1:1);tA(i,e,Math.max(r,Math.floor(e-_*b/d+w)),Math.min(u,Math.floor(e+(d-_)*b/d+w)),p)}var S=i[e],O=r,C=u;for(Pf(i,r,e),p(i[u],S)>0&&Pf(i,r,u);O<C;){for(Pf(i,O,C),O++,C--;p(i[O],S)<0;)O++;for(;p(i[C],S)>0;)C--}p(i[r],S)===0?Pf(i,r,C):Pf(i,++C,u),C<=e&&(r=C+1),e<=C&&(u=C-1)}}function Pf(i,e,r){var u=i[e];i[e]=i[r],i[r]=u}function zX(i,e){return i<e?-1:i>e?1:0}function mx(i,e){let r=i.length;if(r<=1)return[i];let u=[],p,d;for(let _=0;_<r;_++){let y=nr(i[_]);y!==0&&(i[_].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(p&&u.push(p),p=[i[_]]):p.push(i[_]))}if(p&&u.push(p),e>1)for(let _=0;_<u.length;_++)u[_].length<=e||(kX(u[_],e,1,u[_].length-1,BX),u[_]=u[_].slice(0,e));return u}function BX(i,e){return e.area-i.area}function _x(i,e,r){let u=r.patternDependencies,p=!1;for(let d of e){let _=d.paint.get(`${i}-pattern`);_.isConstant()||(p=!0);let y=_.constantOr(null);y&&(p=!0,u[y.to]=!0,u[y.from]=!0)}return p}function yx(i,e,r,u,p){let d=p.patternDependencies;for(let _ of e){let y=_.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:u-1},r,{},p.availableImages),w=y.evaluate({zoom:u},r,{},p.availableImages),S=y.evaluate({zoom:u+1},r,{},p.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,d[b]=!0,d[w]=!0,d[S]=!0,r.patterns[_.id]={min:b,mid:w,max:S}}}return r}J_.deviation=function(i,e,r,u){var p=e&&e.length,d=Math.abs(dx(i,0,p?e[0]*r:i.length,r));if(p)for(var _=0,y=e.length;_<y;_++)d-=Math.abs(dx(i,e[_]*r,_<y-1?e[_+1]*r:i.length,r));var b=0;for(_=0;_<u.length;_+=3){var w=u[_]*r,S=u[_+1]*r,O=u[_+2]*r;b+=Math.abs((i[w]-i[O])*(i[S+1]-i[w+1])-(i[w]-i[S])*(i[O+1]-i[w+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},J_.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},u=0,p=0;p<i.length;p++){for(var d=0;d<i[p].length;d++)for(var _=0;_<e;_++)r.vertices.push(i[p][d][_]);p>0&&r.holes.push(u+=i[p-1].length)}return r},K_.default=IX;class ry{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new at,this.indexArray=new jt,this.indexArray2=new zi,this.programConfigurations=new ou(e.layers,e.zoom),this.segments=new oi,this.segments2=new oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,u,p){this.hasPattern=_x("fill",this.layers,r);let d=this.layers[0].layout.get("fill-sort-key"),_=[];for(let{feature:y,id:b,index:w,sourceLayerIndex:S}of e){let O=this.layers[0]._featureFilter.needGeometry,C=au(y,O);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),C,u))continue;let k=d?d.evaluate(C,{},u,r.availableImages):void 0,z={id:b,properties:y.properties,type:y.type,sourceLayerIndex:S,index:w,geometry:O?C.geometry:Va(y,u,p),patterns:{},sortKey:k};_.push(z)}d&&_.sort((y,b)=>y.sortKey-b.sortKey);for(let y of _){let{geometry:b,index:w,sourceLayerIndex:S}=y;if(this.hasPattern){let O=yx("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(O)}else this.addFeature(y,b,w,u,{},r.availableImages);r.featureIndex.insert(e[w].feature,b,w,S,this.index)}}update(e,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u,p)}addFeatures(e,r,u,p,d){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SX),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,u,p,d,_=[]){for(let y of mx(r,500)){let b=0;for(let z of y)b+=z.length;let w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=w.vertexLength,O=[],C=[];for(let z of y){if(z.length===0)continue;z!==y[0]&&C.push(O.length/2);let U=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),G=U.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(G+z.length-1,G),O.push(z[0].x),O.push(z[0].y);for(let J=1;J<z.length;J++)this.layoutVertexArray.emplaceBack(z[J].x,z[J].y),this.indexArray2.emplaceBack(G+J-1,G+J),O.push(z[J].x),O.push(z[J].y);U.vertexLength+=z.length,U.primitiveLength+=z.length}let k=K_(O,C);for(let z=0;z<k.length;z+=3)this.indexArray.emplaceBack(S+k[z],S+k[z+1],S+k[z+2]);w.vertexLength+=b,w.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,d,_,p)}}dt(ry,"FillBucket",{omit:["layers","patternFeatures"]});let FX=new ze({"fill-sort-key":new ge(qe.layout_fill["fill-sort-key"])});var NX={paint:new ze({"fill-antialias":new he(qe.paint_fill["fill-antialias"]),"fill-opacity":new ge(qe.paint_fill["fill-opacity"]),"fill-color":new ge(qe.paint_fill["fill-color"]),"fill-outline-color":new ge(qe.paint_fill["fill-outline-color"]),"fill-translate":new he(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new he(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ee(qe.paint_fill["fill-pattern"])}),layout:FX};let UX=Ne([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),jX=Ne([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VX=Ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:GX}=UX;var rA=Vc;function Vc(i,e,r,u,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=p,i.readFields($X,this,e)}function $X(i,e,r){i==1?e.id=r.readVarint():i==2?function(u,p){for(var d=u.readVarint()+u.pos;u.pos<d;){var _=p._keys[u.readVarint()],y=p._values[u.readVarint()];p.properties[_]=y}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function WX(i){for(var e,r,u=0,p=0,d=i.length,_=d-1;p<d;_=p++)u+=((r=i[_]).x-(e=i[p]).x)*(e.y+r.y);return u}Vc.types=["Unknown","Point","LineString","Polygon"],Vc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,u=1,p=0,d=0,_=0,y=[];i.pos<r;){if(p<=0){var b=i.readVarint();u=7&b,p=b>>3}if(p--,u===1||u===2)d+=i.readSVarint(),_+=i.readSVarint(),u===1&&(e&&y.push(e),e=[]),e.push(new q(d,_));else{if(u!==7)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Vc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,u=0,p=0,d=0,_=1/0,y=-1/0,b=1/0,w=-1/0;i.pos<e;){if(u<=0){var S=i.readVarint();r=7&S,u=S>>3}if(u--,r===1||r===2)(p+=i.readSVarint())<_&&(_=p),p>y&&(y=p),(d+=i.readSVarint())<b&&(b=d),d>w&&(w=d);else if(r!==7)throw new Error("unknown command "+r)}return[_,b,y,w]},Vc.prototype.toGeoJSON=function(i,e,r){var u,p,d=this.extent*Math.pow(2,r),_=this.extent*i,y=this.extent*e,b=this.loadGeometry(),w=Vc.types[this.type];function S(k){for(var z=0;z<k.length;z++){var U=k[z];k[z]=[360*(U.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<b.length;u++)O[u]=b[u][0];S(b=O);break;case 2:for(u=0;u<b.length;u++)S(b[u]);break;case 3:for(b=function(k){var z=k.length;if(z<=1)return[k];for(var U,G,J=[],le=0;le<z;le++){var te=WX(k[le]);te!==0&&(G===void 0&&(G=te<0),G===te<0?(U&&J.push(U),U=[k[le]]):U.push(k[le]))}return U&&J.push(U),J}(b),u=0;u<b.length;u++)for(p=0;p<b[u].length;p++)S(b[u][p])}b.length===1?b=b[0]:w="Multi"+w;var C={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(C.id=this.id),C};var iA=nA;function nA(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(ZX,this,e),this.length=this._features.length}function ZX(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(u){for(var p=null,d=u.readVarint()+u.pos;u.pos<d;){var _=u.readVarint()>>3;p=_===1?u.readString():_===2?u.readFloat():_===3?u.readDouble():_===4?u.readVarint64():_===5?u.readVarint():_===6?u.readSVarint():_===7?u.readBoolean():null}return p}(r))}function HX(i,e,r){if(i===3){var u=new iA(r,r.readVarint()+r.pos);u.length&&(e[u.name]=u)}}nA.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new rA(this._pbf,e,this.extent,this._keys,this._values)};var hu={VectorTile:function(i,e){this.layers=i.readFields(HX,{},e)},VectorTileFeature:rA,VectorTileLayer:iA};function iy(i,e,r,u){let p=[],d=u===0?(_,y,b,w,S,O)=>{_.push(new q(O,b+(O-y)/(w-y)*(S-b)))}:(_,y,b,w,S,O)=>{_.push(new q(y+(O-b)/(S-b)*(w-y),O))};for(let _ of i){let y=[];for(let b of _){if(b.length<=2)continue;let w=[];for(let C=0;C<b.length-1;C++){let k=b[C].x,z=b[C].y,U=b[C+1].x,G=b[C+1].y,J=u===0?k:z,le=u===0?U:G;J<e?le>e&&d(w,k,z,U,G,e):J>r?le<r&&d(w,k,z,U,G,r):w.push(b[C]),le<e&&J>=e&&d(w,k,z,U,G,e),le>r&&J<=r&&d(w,k,z,U,G,r)}let S=b[b.length-1],O=u===0?S.x:S.y;O>=e&&O<=r&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),y.push(w))}y.length&&p.push(y)}return p}let XX=hu.VectorTileFeature.types,YX=Math.pow(2,13);function Mf(i,e,r,u,p,d,_,y){i.emplaceBack((e<<1)+_,(r<<1)+d,(Math.floor(u*YX)<<1)+p,Math.round(y))}function qf(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class oA{constructor(){this.acc=new q(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new q(e.x,e.y),this.max=new q(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let u=this.min,p=this.max;e.x<u.x?u.x=e.x:e.x>p.x&&(p.x=e.x),e.y<u.y?u.y=e.y:e.y>p.y&&(p.y=e.y),((e.x===0||e.x===Mt)&&e.x===r.x)!=((e.y===0||e.y===Mt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,tr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,tr(r.y,e.y,(Mt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,tr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,tr(r.x,e.x,(Mt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[e];r<u[0]&&(u[0]=r),r>u[1]&&(u[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let u=e.x===0?0:1;this.addBorderIntersection(u,r.y),this.addBorderIntersection(u,e.y)}else{let u=e.y===0?2:3;this.addBorderIntersection(u,r.x),this.addBorderIntersection(u,e.x)}}centroid(){let e=this.polyCount.reduce((r,u)=>r+u.edges,0);return e!==0?this.acc.div(e)._round():new q(0,0)}span(){return new q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Rf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Tt,this.centroidVertexArray=new mI,this.indexArray=new jt,this.programConfigurations=new ou(e.layers,e.zoom),this.segments=new oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,u,p){this.features=[],this.hasPattern=_x("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){let _=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*_/(_*_+1)/Mt/(1<<d.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:_,index:y,sourceLayerIndex:b}of e){let w=this.layers[0]._featureFilter.needGeometry,S=au(d,w);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),S,u))continue;let O={id:_,sourceLayerIndex:b,index:y,geometry:w?S.geometry:Va(d,u,p),properties:d.properties,type:d.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(yx("fill-extrusion",this.layers,O,this.zoom,r)):this.addFeature(O,O.geometry,y,u,{},r.availableImages,p),r.featureIndex.insert(d,O.geometry,y,b,this.index,C)}this.sortBorders()}addFeatures(e,r,u,p,d){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,r,u,p,d)}this.sortBorders()}update(e,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,GX),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,VX.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,jX.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,u,p,d,_,y){let b=[new q(0,0),new q(Mt,Mt)],w=y.projection,S=w.name==="globe",O=this.enableTerrain&&!S?new oA:null,C=XX[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bi);let k=mx(r,500);for(let J=k.length-1;J>=0;J--){let le=k[J];(le.length===0||(z=le[0]).every(te=>te.x<=0)||z.every(te=>te.x>=Mt)||z.every(te=>te.y<=0)||z.every(te=>te.y>=Mt))&&k.splice(J,1)}var z;let U;if(S)U=pA(k,b,p);else{U=[];for(let J of k)U.push({polygon:J,bounds:b})}let G=C?this.edgeRadius:0;for(let{polygon:J,bounds:le}of U){let te=0,ae=0;for(let ce of J)C&&!ce[0].equals(ce[ce.length-1])&&ce.push(ce[0]),ae+=C?ce.length-1:ce.length;let me=this.segments.prepareSegment((C?5:4)*ae,this.layoutVertexArray,this.indexArray);if(C){let ce=[],Oe=[];te=me.vertexLength;for(let De of J){let Qe,Ce;De.length&&De!==J[0]&&Oe.push(ce.length/2),Qe=De[1].sub(De[0])._perp()._unit();for(let Be=1;Be<De.length;Be++){let $e=De[Be],Fe=De[Be===De.length-1?1:Be+1],{x:Ke,y:We}=$e;if(G){Ce=Fe.sub($e)._perp()._unit();let lt=Qe.add(Ce)._unit(),kt=G*Math.min(4,1/(Qe.x*lt.x+Qe.y*lt.y));Ke+=kt*lt.x,We+=kt*lt.y,Qe=Ce}Mf(this.layoutVertexArray,Ke,We,0,0,1,1,0),me.vertexLength++,ce.push($e.x,$e.y),S&&qf(this.layoutVertexExtArray,w.projectTilePoint(Ke,We,p),w.upVector(p,Ke,We))}}let Ae=K_(ce,Oe);for(let De=0;De<Ae.length;De+=3)this.indexArray.emplaceBack(te+Ae[De],te+Ae[De+2],te+Ae[De+1]),me.primitiveLength++}for(let ce of J){O&&ce.length&&O.startRing(ce[0]);let Oe,Ae,De,Qe=ce.length>4&&uA(ce[ce.length-2],ce[0],ce[1]),Ce=G?KX(ce[ce.length-2],ce[0],ce[1],G):0;Ae=ce[1].sub(ce[0])._perp()._unit();for(let Be=1,$e=0;Be<ce.length;Be++){let Fe=ce[Be-1],Ke=ce[Be],We=ce[Be===ce.length-1?1:Be+1];if(O&&C&&O.currentPolyCount.top++,lA(Ke,Fe,le)){G&&(Ae=We.sub(Ke)._perp()._unit());continue}O&&O.append(Ke,Fe);let lt=Ke.sub(Fe)._perp(),kt=lt.x/(Math.abs(lt.x)+Math.abs(lt.y)),Bt=lt.y>0?1:0,bt=Fe.dist(Ke);if($e+bt>32768&&($e=0),G){De=We.sub(Ke)._perp()._unit();let pt=sA(Fe,Ke,We,aA(Ae,De),G);isNaN(pt)&&(pt=0);let Cr=Ke.sub(Fe)._unit();Fe=Fe.add(Cr.mult(Ce))._round(),Ke=Ke.add(Cr.mult(-pt))._round(),Ce=pt,Ae=De}let nt=me.vertexLength,Zt=ce.length>4&&uA(Fe,Ke,We),Dt=cA($e,Qe,!0);if(Mf(this.layoutVertexArray,Fe.x,Fe.y,kt,Bt,0,0,Dt),Mf(this.layoutVertexArray,Fe.x,Fe.y,kt,Bt,0,1,Dt),$e+=bt,Dt=cA($e,Zt,!1),Qe=Zt,Mf(this.layoutVertexArray,Ke.x,Ke.y,kt,Bt,0,0,Dt),Mf(this.layoutVertexArray,Ke.x,Ke.y,kt,Bt,0,1,Dt),me.vertexLength+=4,this.indexArray.emplaceBack(nt+0,nt+1,nt+2),this.indexArray.emplaceBack(nt+1,nt+3,nt+2),me.primitiveLength+=2,G){let pt=te+(Be===1?ce.length-2:Be-2),Cr=Be===1?te:pt+1;if(this.indexArray.emplaceBack(nt+1,pt,nt+3),this.indexArray.emplaceBack(pt,Cr,nt+3),me.primitiveLength+=2,Oe===void 0&&(Oe=nt),!lA(We,ce[Be],le)){let Er=Be===ce.length-1?Oe:me.vertexLength;this.indexArray.emplaceBack(nt+2,nt+3,Er),this.indexArray.emplaceBack(nt+3,Er+1,Er),this.indexArray.emplaceBack(nt+3,Cr,Er+1),me.primitiveLength+=3}}if(S){let pt=this.layoutVertexExtArray,Cr=w.projectTilePoint(Fe.x,Fe.y,p),Er=w.projectTilePoint(Ke.x,Ke.y,p),zr=w.upVector(p,Fe.x,Fe.y),Ft=w.upVector(p,Ke.x,Ke.y);qf(pt,Cr,zr),qf(pt,Cr,zr),qf(pt,Er,Ft),qf(pt,Er,Ft)}}C&&(te+=ce.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;let J=O.borders,le=this.featuresOnBorder.push(O)-1;for(let te=0;te<4;te++)J[te][0]!==Number.MAX_VALUE&&this.borders[te].push(le)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,d,_,p)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,u)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}encodeCentroid(e,r,u=!0){let p,d;if(e)if(e.y!==0){let y=r.span()._mult(this.tileToMeter);p=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else p=Math.ceil(7*(e.x+450)),d=0;else p=0,d=+u;let _=u?this.centroidVertexArray.length:r.vertexArrayOffset;for(let y of r.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(_++,p,d);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(_++,0,d),this.centroidVertexArray.emplace(_++,p,d)}}}function aA(i,e){let r=i.add(e)._unit();return i.x*r.x+i.y*r.y}function KX(i,e,r,u){let p=e.sub(i)._perp()._unit(),d=r.sub(e)._perp()._unit();return sA(i,e,r,aA(p,d),u)}function sA(i,e,r,u,p){let d=Math.sqrt(1-u*u);return Math.min(i.dist(e)/3,e.dist(r)/3,p*d/u)}function lA(i,e,r){return i.x<r[0].x&&e.x<r[0].x||i.x>r[1].x&&e.x>r[1].x||i.y<r[0].y&&e.y<r[0].y||i.y>r[1].y&&e.y>r[1].y}function uA(i,e,r){if(i.x<0||i.x>=Mt||e.x<0||e.x>=Mt||r.x<0||r.x>=Mt)return!1;let u=r.sub(e),p=u.perp(),d=i.sub(e);return(u.x*d.x+u.y*d.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(d.x*d.x+d.y*d.y))>-.866&&p.x*d.x+p.y*d.y<0}function cA(i,e,r){let u=e?2|i:-3&i;return r?1|u:-2&u}function hA(){let i=Math.PI/32,e=Math.tan(i),r=W0;return r*Math.sqrt(1+2*e*e)-r}function pA(i,e,r){let u=1<<r.z,p=Yn(r.x/u),d=Yn((r.x+1)/u),_=Oi(r.y/u),y=Oi((r.y+1)/u);return function(b,w,S,O,C=0,k){let z=[];if(!b.length||!S||!O)return z;let U=(ce,Oe)=>{for(let Ae of ce)z.push({polygon:Ae,bounds:Oe})},G=Math.ceil(Math.log2(S)),J=Math.ceil(Math.log2(O)),le=G-J,te=[];for(let ce=0;ce<Math.abs(le);ce++)te.push(le>0?0:1);for(let ce=0;ce<Math.min(G,J);ce++)te.push(0),te.push(1);let ae=b;if(ae=iy(ae,w[0].y-C,w[1].y+C,1),ae=iy(ae,w[0].x-C,w[1].x+C,0),!ae.length)return z;let me=[];for(te.length?me.push({polygons:ae,bounds:w,depth:0}):U(ae,w);me.length;){let ce=me.pop(),Oe=ce.depth,Ae=te[Oe],De=ce.bounds[0],Qe=ce.bounds[1],Ce=Ae===0?De.x:De.y,Be=Ae===0?Qe.x:Qe.y,$e=k?k(Ae,Ce,Be):.5*(Ce+Be),Fe=iy(ce.polygons,Ce-C,$e+C,Ae),Ke=iy(ce.polygons,$e-C,Be+C,Ae);if(Fe.length){let We=[De,new q(Ae===0?$e:Qe.x,Ae===1?$e:Qe.y)];te.length>Oe+1?me.push({polygons:Fe,bounds:We,depth:Oe+1}):U(Fe,We)}if(Ke.length){let We=[new q(Ae===0?$e:De.x,Ae===1?$e:De.y),Qe];te.length>Oe+1?me.push({polygons:Ke,bounds:We,depth:Oe+1}):U(Ke,We)}}return z}(i,e,Math.ceil((d-p)/11.25),Math.ceil((_-y)/11.25),1,(b,w,S)=>{if(b===0)return .5*(w+S);{let O=Oi((r.y+w/Mt)/u);return(ja(.5*(Oi((r.y+S/Mt)/u)+O))*u-r.y)*Mt}})}dt(Rf,"FillExtrusionBucket",{omit:["layers","features"]}),dt(oA,"PartMetadata");let JX=new ze({"fill-extrusion-edge-radius":new he(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var QX={paint:new ze({"fill-extrusion-opacity":new he(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ge(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ee(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ge(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ge(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:JX};function fA(i,e,r){var u=2*Math.PI*6378137/256/Math.pow(2,r);return[i*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class ny{constructor(e,r,u){this.z=e,this.x=r,this.y=u,this.key=Df(0,e,e,r,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let u=function(d,_,y){var b=fA(256*d,256*(_=Math.pow(2,y)-_-1),y),w=fA(256*(d+1),256*(_+1),y);return b[0]+","+b[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),p=function(d,_,y){let b,w="";for(let S=d;S>0;S--)b=1<<S-1,w+=(_&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dA{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Df(e,r.z,r.z,r.x,r.y)}}class Wi{constructor(e,r,u,p,d){this.overscaledZ=e,this.wrap=r,this.canonical=new ny(u,+p,+d),this.key=r===0&&e===u?this.canonical.key:Df(r,e,u,p,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new Wi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Df(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-e;return Df(this.wrap*+r,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Wi(r,this.wrap,r,u,p),new Wi(r,this.wrap,r,u+1,p),new Wi(r,this.wrap,r,u,p+1),new Wi(r,this.wrap,r,u+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Wi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Df(i,e,r,u,p){let d=1<<Math.min(r,22),_=d*(p%d)+u%d;return i&&r<22&&(_+=d*d*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*_+r)+(e-r)}function Lf(i,e){return i.x*e.x+i.y*e.y}function mA(i,e){if(i.length===1){let r=0,u=e[r++],p;for(;!p||u.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){let d=e[r],_=i[0],y=p.sub(u),b=d.sub(u),w=_.sub(u),S=Lf(y,y),O=Lf(y,b),C=Lf(b,b),k=Lf(w,y),z=Lf(w,b),U=S*C-O*O,G=(C*k-O*z)/U,J=(S*z-O*k)/U,le=u.z*(1-G-J)+p.z*G+d.z*J;if(isFinite(le))return le}return 1/0}{let r=1/0;for(let u of e)r=Math.min(r,u.z);return r}}function oy(i){let e=new q(i[0],i[1]);return e.z=i[2],e}function _A(i,e,r,u,p,d,_,y){let b=_*p.getElevationAt(i,e,!0,!0),w=d[0]!==0,S=w?d[1]===0?_*(d[0]/7-450):_*function(O,C,k){let z=Math.floor(C[0]/8),U=Math.floor(C[1]/8),G=10*(C[0]-8*z),J=10*(C[1]-8*U),le=O.getElevationAt(z,U,!0,!0),te=O.getMeterToDEM(k),ae=Math.floor(.5*(G*te-1)),me=Math.floor(.5*(J*te-1)),ce=O.tileCoordToPixel(z,U),Oe=2*ae+1,Ae=2*me+1,De=function(Ke,We,lt,kt,Bt){return[Ke.getElevationAtPixel(We,lt,!0),Ke.getElevationAtPixel(We+Bt,lt,!0),Ke.getElevationAtPixel(We,lt+Bt,!0),Ke.getElevationAtPixel(We+kt,lt+Bt,!0)]}(O,ce.x-ae,ce.y-me,Oe,Ae),Qe=Math.abs(De[0]-De[1]),Ce=Math.abs(De[2]-De[3]),Be=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),$e=Math.min(.25,.5*te*(Qe+Ce)/Oe),Fe=Math.min(.25,.5*te*Be/Ae);return le+Math.max($e*G,Fe*J)}(p,d,y):b;return{base:b+(r===0)?-1:r,top:w?Math.max(S+u,b+r+2):b+u}}dt(ny,"CanonicalTileID"),dt(Wi,"OverscaledTileID",{omit:["projMatrix"]});let eY=Ne([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:tY}=eY,rY=Ne([{name:"a_packed",components:4,type:"Float32"}]),{members:iY}=rY,nY=hu.VectorTileFeature.types,oY=Math.cos(Math.PI/180*37.5);class ay{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new qt,this.layoutVertexArray2=new Wt,this.indexArray=new jt,this.programConfigurations=new ou(e.layers,e.zoom),this.segments=new oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,u,p){this.hasPattern=_x("line",this.layers,r);let d=this.layers[0].layout.get("line-sort-key"),_=[];for(let{feature:S,id:O,index:C,sourceLayerIndex:k}of e){let z=this.layers[0]._featureFilter.needGeometry,U=au(S,z);if(!this.layers[0]._featureFilter.filter(new Z(this.zoom),U,u))continue;let G=d?d.evaluate(U,{},u):void 0,J={id:O,properties:S.properties,type:S.type,sourceLayerIndex:k,index:C,geometry:z?U.geometry:Va(S,u,p),patterns:{},sortKey:G};_.push(J)}d&&_.sort((S,O)=>S.sortKey-O.sortKey);let{lineAtlas:y,featureIndex:b}=r,w=this.addConstantDashes(y);for(let S of _){let{geometry:O,index:C,sourceLayerIndex:k}=S;if(w&&this.addFeatureDashes(S,y),this.hasPattern){let z=yx("line",this.layers,S,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(S,O,C,u,y.positions,r.availableImages);b.insert(e[C].feature,O,C,k,this.index)}}addConstantDashes(e){let r=!1;for(let u of this.layers){let p=u.paint.get("line-dasharray").value,d=u.layout.get("line-cap").value;if(p.kind!=="constant"||d.kind!=="constant")r=!0;else{let _=d.value,y=p.value;if(!y)continue;e.addDash(y.from,_),e.addDash(y.to,_),y.other&&e.addDash(y.other,_)}}return r}addFeatureDashes(e,r){let u=this.zoom;for(let p of this.layers){let d=p.paint.get("line-dasharray").value,_=p.layout.get("line-cap").value;if(d.kind==="constant"&&_.kind==="constant")continue;let y,b,w,S,O,C;if(d.kind==="constant"){let G=d.value;if(!G)continue;y=G.other||G.to,b=G.to,w=G.from}else y=d.evaluate({zoom:u-1},e),b=d.evaluate({zoom:u},e),w=d.evaluate({zoom:u+1},e);_.kind==="constant"?S=O=C=_.value:(S=_.evaluate({zoom:u-1},e),O=_.evaluate({zoom:u},e),C=_.evaluate({zoom:u+1},e)),r.addDash(y,S),r.addDash(b,O),r.addDash(w,C);let k=r.getKey(y,S),z=r.getKey(b,O),U=r.getKey(w,C);e.patterns[p.id]={min:k,mid:z,max:U}}}update(e,r,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u,p)}addFeatures(e,r,u,p,d){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,u,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,iY)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tY),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,u,p,d,_){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),S=y.get("line-miter-limit"),O=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let C of r)this.addLine(C,e,b,w,S,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,d,_,p)}addLine(e,r,u,p,d,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let y=nY[r.type]==="Polygon",b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;u==="bevel"&&(d=1.05);let S=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray),C,k,z,U,G;this.e1=this.e2=-1,y&&(C=e[b-2],G=e[w].sub(C)._unit()._perp());for(let J=w;J<b;J++){if(z=J===b-1?y?e[w+1]:void 0:e[J+1],z&&e[J].equals(z))continue;G&&(U=G),C&&(k=C),C=e[J],G=z?z.sub(C)._unit()._perp():U,U=U||G;let le=U.add(G);le.x===0&&le.y===0||le._unit();let te=U.x*G.x+U.y*G.y,ae=le.x*G.x+le.y*G.y,me=ae!==0?1/ae:1/0,ce=2*Math.sqrt(2-2*ae),Oe=ae<oY&&k&&z,Ae=U.x*G.y-U.y*G.x>0;if(Oe&&J>w){let Ce=C.dist(k);if(Ce>2*S){let Be=C.sub(C.sub(k)._mult(S/Ce)._round());this.updateDistance(k,Be),this.addCurrentVertex(Be,U,0,0,O),k=Be}}let De=k&&z,Qe=De?u:y?"butt":p;if(De&&Qe==="round"&&(me<_?Qe="miter":me<=2&&(Qe="fakeround")),Qe==="miter"&&me>d&&(Qe="bevel"),Qe==="bevel"&&(me>2&&(Qe="flipbevel"),me<d&&(Qe="miter")),k&&this.updateDistance(k,C),Qe==="miter")le._mult(me),this.addCurrentVertex(C,le,0,0,O);else if(Qe==="flipbevel"){if(me>100)le=G.mult(-1);else{let Ce=me*U.add(G).mag()/U.sub(G).mag();le._perp()._mult(Ce*(Ae?-1:1))}this.addCurrentVertex(C,le,0,0,O),this.addCurrentVertex(C,le.mult(-1),0,0,O)}else if(Qe==="bevel"||Qe==="fakeround"){let Ce=-Math.sqrt(me*me-1),Be=Ae?Ce:0,$e=Ae?0:Ce;if(k&&this.addCurrentVertex(C,U,Be,$e,O),Qe==="fakeround"){let Fe=Math.round(180*ce/Math.PI/20);for(let Ke=1;Ke<Fe;Ke++){let We=Ke/Fe;if(We!==.5){let kt=We-.5;We+=We*kt*(We-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*kt*kt+(.848013+te*(.215638*te-1.06021)))}let lt=G.sub(U)._mult(We)._add(U)._unit()._mult(Ae?-1:1);this.addHalfVertex(C,lt.x,lt.y,!1,Ae,0,O)}}z&&this.addCurrentVertex(C,G,-Be,-$e,O)}else if(Qe==="butt")this.addCurrentVertex(C,le,0,0,O);else if(Qe==="square"){let Ce=k?1:-1;k||this.addCurrentVertex(C,le,Ce,Ce,O),this.addCurrentVertex(C,le,0,0,O),k&&this.addCurrentVertex(C,le,Ce,Ce,O)}else Qe==="round"&&(k&&(this.addCurrentVertex(C,U,0,0,O),this.addCurrentVertex(C,U,1,1,O,!0)),z&&(this.addCurrentVertex(C,G,-1,-1,O,!0),this.addCurrentVertex(C,G,0,0,O)));if(Oe&&J<b-1){let Ce=C.dist(z);if(Ce>2*S){let Be=C.add(z.sub(C)._mult(S/Ce)._round());this.updateDistance(C,Be),this.addCurrentVertex(Be,G,0,0,O),C=Be}}}}addCurrentVertex(e,r,u,p,d,_=!1){let y=r.y*p-r.x,b=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*u,r.y-r.x*u,_,!1,u,d),this.addHalfVertex(e,y,b,_,!0,-p,d)}addHalfVertex({x:e,y:r},u,p,d,_,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),_?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}dt(ay,"LineBucket",{omit:["layers","patternFeatures"]});let aY=new ze({"line-cap":new ge(qe.layout_line["line-cap"]),"line-join":new ge(qe.layout_line["line-join"]),"line-miter-limit":new he(qe.layout_line["line-miter-limit"]),"line-round-limit":new he(qe.layout_line["line-round-limit"]),"line-sort-key":new ge(qe.layout_line["line-sort-key"])});var yA={paint:new ze({"line-opacity":new ge(qe.paint_line["line-opacity"]),"line-color":new ge(qe.paint_line["line-color"]),"line-translate":new he(qe.paint_line["line-translate"]),"line-translate-anchor":new he(qe.paint_line["line-translate-anchor"]),"line-width":new ge(qe.paint_line["line-width"]),"line-gap-width":new ge(qe.paint_line["line-gap-width"]),"line-offset":new ge(qe.paint_line["line-offset"]),"line-blur":new ge(qe.paint_line["line-blur"]),"line-dasharray":new Ee(qe.paint_line["line-dasharray"]),"line-pattern":new Ee(qe.paint_line["line-pattern"]),"line-gradient":new xe(qe.paint_line["line-gradient"]),"line-trim-offset":new he(qe.paint_line["line-trim-offset"])}),layout:aY};let gA=new class extends ge{possiblyEvaluate(i,e){return e=new Z(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,u){return e=wt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,u)}}(yA.paint.properties["line-width"].specification);function vA(i,e){return e>0?e+2*i:i}gA.useIntegerZoom=!0;let sY=Ne([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lY=Ne([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uY=Ne([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ne([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let cY=Ne([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),hY=Ne([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let xA=Ne([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pY=Ne([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ne([{name:"triangle",components:3,type:"Uint16"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ne([{type:"Float32",name:"offsetX"}]),Ne([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ci=24;let ea=128;function gx(i,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Z(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:u,interpolationType:p}=r,d=0;for(;d<u.length&&u[d]<=i;)d++;d=Math.max(0,d-1);let _=d;for(;_<u.length&&u[_]<i+1;)_++;_=Math.min(u.length-1,_);let y=u[d],b=u[_];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:p}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new Z(y)),maxSize:r.evaluate(new Z(b)),interpolationType:p}}}function sy(i,{uSize:e,uSizeT:r},{lowerSize:u,upperSize:p}){return i.kind==="source"?u/ea:i.kind==="composite"?tr(u/ea,p/ea,r):e}function Gc(i,e){let r=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:p,minZoom:d,maxZoom:_}=i,y=p?He(Hn.interpolationFactor(p,e,d,_),0,1):0;i.kind==="camera"?u=tr(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:u}}var fY=Object.freeze({__proto__:null,getSizeData:gx,evaluateSizeForFeature:sy,evaluateSizeForZoom:Gc,SIZE_PACK_FACTOR:ea});function dY(i,e,r){return i.sections.forEach(u=>{u.text=function(p,d,_){let y=d.layout.get("text-transform").evaluate(_,{});return y==="uppercase"?p=p.toLocaleUpperCase():y==="lowercase"&&(p=p.toLocaleLowerCase()),W.applyArabicShaping&&(p=W.applyArabicShaping(p)),p}(u.text,e,r)}),i}let kf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function mY(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function _Y(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var bA=function(i,e,r,u,p){var d,_,y=8*p-u-1,b=(1<<y)-1,w=b>>1,S=-7,O=r?p-1:0,C=r?-1:1,k=i[e+O];for(O+=C,d=k&(1<<-S)-1,k>>=-S,S+=y;S>0;d=256*d+i[e+O],O+=C,S-=8);for(_=d&(1<<-S)-1,d>>=-S,S+=u;S>0;_=256*_+i[e+O],O+=C,S-=8);if(d===0)d=1-w;else{if(d===b)return _?NaN:1/0*(k?-1:1);_+=Math.pow(2,u),d-=w}return(k?-1:1)*_*Math.pow(2,d-u)},wA=function(i,e,r,u,p,d){var _,y,b,w=8*d-p-1,S=(1<<w)-1,O=S>>1,C=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=u?0:d-1,z=u?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,_=S):(_=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-_))<1&&(_--,b*=2),(e+=_+O>=1?C/b:C*Math.pow(2,1-O))*b>=2&&(_++,b/=2),_+O>=S?(y=0,_=S):_+O>=1?(y=(e*b-1)*Math.pow(2,p),_+=O):(y=e*Math.pow(2,O-1)*Math.pow(2,p),_=0));p>=8;i[r+k]=255&y,k+=z,y/=256,p-=8);for(_=_<<p|y,w+=p;w>0;i[r+k]=255&_,k+=z,_/=256,w-=8);i[r+k-z]|=128*U},zf=Or;function Or(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Or.Varint=0,Or.Fixed64=1,Or.Bytes=2,Or.Fixed32=5;var vx=4294967296,TA=1/vx,EA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function $a(i){return i.type===Or.Bytes?i.readVarint()+i.pos:i.pos+1}function $c(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function SA(i,e,r){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(u);for(var p=r.pos-1;p>=i;p--)r.buf[p+u]=r.buf[p]}function yY(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function gY(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function vY(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function xY(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function bY(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function wY(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function TY(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function EY(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function SY(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function ly(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Wc(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function IA(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function IY(i,e,r){e.glyphs=[],i===1&&r.readMessage(AY,e)}function AY(i,e,r){if(i===3){let{id:u,bitmap:p,width:d,height:_,left:y,top:b,advance:w}=r.readMessage(OY,{});e.glyphs.push({id:u,bitmap:new Ga({width:d+6,height:_+6},p),metrics:{width:d,height:_,left:y,top:b,advance:w}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function OY(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function xx(i){let e=0,r=0;for(let _ of i)e+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,y)=>y.h-_.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],p=0,d=0;for(let _ of i)for(let y=u.length-1;y>=0;y--){let b=u[y];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,d=Math.max(d,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===b.w&&_.h===b.h){let w=u.pop();y<u.length&&(u[y]=w)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(u.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:p,h:d,fill:e/(p*d)||0}}Or.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var u=this.readVarint(),p=u>>3,d=this.pos;this.type=7&u,i(p,e,this),this.pos===d&&this.skip(u)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=ly(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=IA(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ly(this.buf,this.pos)+ly(this.buf,this.pos+4)*vx;return this.pos+=8,i},readSFixed64:function(){var i=ly(this.buf,this.pos)+IA(this.buf,this.pos+4)*vx;return this.pos+=8,i},readFloat:function(){var i=bA(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=bA(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,u=this.buf;return e=127&(r=u[this.pos++]),r<128?e:(e|=(127&(r=u[this.pos++]))<<7,r<128?e:(e|=(127&(r=u[this.pos++]))<<14,r<128?e:(e|=(127&(r=u[this.pos++]))<<21,r<128?e:function(p,d,_){var y,b,w=_.buf;if(y=(112&(b=w[_.pos++]))>>4,b<128||(y|=(127&(b=w[_.pos++]))<<3,b<128)||(y|=(127&(b=w[_.pos++]))<<10,b<128)||(y|=(127&(b=w[_.pos++]))<<17,b<128)||(y|=(127&(b=w[_.pos++]))<<24,b<128)||(y|=(1&(b=w[_.pos++]))<<31,b<128))return $c(p,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&EA?function(r,u,p){return EA.decode(r.subarray(u,p))}(this.buf,e,i):function(r,u,p){for(var d="",_=u;_<p;){var y,b,w,S=r[_],O=null,C=S>239?4:S>223?3:S>191?2:1;if(_+C>p)break;C===1?S<128&&(O=S):C===2?(192&(y=r[_+1]))==128&&(O=(31&S)<<6|63&y)<=127&&(O=null):C===3?(b=r[_+2],(192&(y=r[_+1]))==128&&(192&b)==128&&((O=(15&S)<<12|(63&y)<<6|63&b)<=2047||O>=55296&&O<=57343)&&(O=null)):C===4&&(b=r[_+2],w=r[_+3],(192&(y=r[_+1]))==128&&(192&b)==128&&(192&w)==128&&((O=(15&S)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,C=1):O>65535&&(O-=65536,d+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),d+=String.fromCharCode(O),_+=C}return d}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Or.Bytes)return i.push(this.readVarint(e));var r=$a(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Or.Bytes)return i.push(this.readSVarint());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Or.Bytes)return i.push(this.readBoolean());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Or.Bytes)return i.push(this.readFloat());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Or.Bytes)return i.push(this.readDouble());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Or.Bytes)return i.push(this.readFixed32());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Or.Bytes)return i.push(this.readSFixed32());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Or.Bytes)return i.push(this.readFixed64());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Or.Bytes)return i.push(this.readSFixed64());var e=$a(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Or.Varint)for(;this.buf[this.pos++]>127;);else if(e===Or.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Or.Fixed32)this.pos+=4;else{if(e!==Or.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Wc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Wc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Wc(this.buf,-1&i,this.pos),Wc(this.buf,Math.floor(i*TA),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Wc(this.buf,-1&i,this.pos),Wc(this.buf,Math.floor(i*TA),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var u,p;if(e>=0?(u=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,_,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(u,0,r),function(d,_){var y=(7&d)<<4;_.buf[_.pos++]|=y|((d>>>=3)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(u,p,d){for(var _,y,b=0;b<p.length;b++){if((_=p.charCodeAt(b))>55295&&_<57344){if(!y){_>56319||b+1===p.length?(u[d++]=239,u[d++]=191,u[d++]=189):y=_;continue}if(_<56320){u[d++]=239,u[d++]=191,u[d++]=189,y=_;continue}_=y-55296<<10|_-56320|65536,y=null}else y&&(u[d++]=239,u[d++]=191,u[d++]=189,y=null);_<128?u[d++]=_:(_<2048?u[d++]=_>>6|192:(_<65536?u[d++]=_>>12|224:(u[d++]=_>>18|240,u[d++]=_>>12&63|128),u[d++]=_>>6&63|128),u[d++]=63&_|128)}return d}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&SA(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),wA(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),wA(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var u=this.pos-r;u>=128&&SA(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,e,r){this.writeTag(i,Or.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,yY,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,gY,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,bY,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,vY,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,xY,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,wY,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,TY,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,EY,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,SY,e)},writeBytesField:function(i,e){this.writeTag(i,Or.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Or.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Or.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Or.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Or.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Or.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Or.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Or.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Or.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Or.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class bx{constructor(e,{pixelRatio:r,version:u,stretchX:p,stretchY:d,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=d,this.content=_,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class AA{constructor(e,r){let u={},p={};this.haveRenderCallbacks=[];let d=[];this.addImages(e,u,d),this.addImages(r,p,d);let{w:_,h:y}=xx(d),b=new vn({width:_||1,height:y||1});for(let w in e){let S=e[w],O=u[w].paddedRect;vn.copy(S.data,b,{x:0,y:0},{x:O.x+1,y:O.y+1},S.data)}for(let w in r){let S=r[w],O=p[w].paddedRect,C=O.x+1,k=O.y+1,z=S.data.width,U=S.data.height;vn.copy(S.data,b,{x:0,y:0},{x:C,y:k},S.data),vn.copy(S.data,b,{x:0,y:U-1},{x:C,y:k-1},{width:z,height:1}),vn.copy(S.data,b,{x:0,y:0},{x:C,y:k+U},{width:z,height:1}),vn.copy(S.data,b,{x:z-1,y:0},{x:C-1,y:k},{width:1,height:U}),vn.copy(S.data,b,{x:0,y:0},{x:C+z,y:k},{width:1,height:U})}this.image=b,this.iconPositions=u,this.patternPositions=p}addImages(e,r,u){for(let p in e){let d=e[p],_={x:0,y:0,w:d.data.width+2,h:d.data.height+2};u.push(_),r[p]=new bx(_,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),r),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),r)}patchUpdatedImage(e,r,u){if(!e||!r||e.version===r.version)return;e.version=r.version;let[p,d]=e.tl;u.update(r.data,void 0,{x:p,y:d})}}dt(bx,"ImagePosition"),dt(AA,"ImageAtlas");let Bn={horizontal:1,vertical:2,horizontalOnly:3};class Bf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){let u=new Bf;return u.scale=e||1,u.fontStack=r,u}static forImage(e){let r=new Bf;return r.imageName=e,r}}class Zc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let u=new Zc;for(let p=0;p<e.sections.length;p++){let d=e.sections[p];d.image?u.addImageSection(d):u.addTextSection(d,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,u){let p="";for(let d=0;d<r.length;d++){let _=r.charCodeAt(d+1)||null,y=r.charCodeAt(d-1)||null;p+=!u&&(_&&iu(_)&&!kf[r[d+1]]||y&&iu(y)&&!kf[r[d-1]])||!kf[r[d]]?r[d]:kf[r[d]]}return p}(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&uy[this.text.charCodeAt(u)];u++)e++;let r=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&uy[this.text.charCodeAt(u)];u--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let u=new Zc;return u.text=this.text.substring(e,r),u.sectionIndex=this.sectionIndex.slice(e,r),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Bf.forText(e.scale,e.fontStack||r));let u=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(u)}addImageSection(e){let r=e.image?e.image.name:"";if(r.length===0)return void ot("Can't add FormattedSection with an empty image.");let u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Bf.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wx(i,e,r,u,p,d,_,y,b,w,S,O,C,k,z,U){let G=Zc.fromFeature(i,p),J;O===Bn.vertical&&G.verticalizePunctuation(C);let{processBidirectionalText:le,processStyledBidirectionalText:te}=W;if(le&&G.sections.length===1){J=[];let ce=le(G.toString(),Tx(G,w,d,e,u,k,z));for(let Oe of ce){let Ae=new Zc;Ae.text=Oe,Ae.sections=G.sections;for(let De=0;De<Oe.length;De++)Ae.sectionIndex.push(0);J.push(Ae)}}else if(te){J=[];let ce=te(G.text,G.sectionIndex,Tx(G,w,d,e,u,k,z));for(let Oe of ce){let Ae=new Zc;Ae.text=Oe[0],Ae.sectionIndex=Oe[1],Ae.sections=G.sections,J.push(Ae)}}else J=function(ce,Oe){let Ae=[],De=ce.text,Qe=0;for(let Ce of Oe)Ae.push(ce.substring(Qe,Ce)),Qe=Ce;return Qe<De.length&&Ae.push(ce.substring(Qe,De.length)),Ae}(G,Tx(G,w,d,e,u,k,z));let ae=[],me={positionedLines:ae,text:G.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ce,Oe,Ae,De,Qe,Ce,Be,$e,Fe,Ke,We,lt){let kt=0,Bt=0,bt=0,nt=$e==="right"?1:$e==="left"?0:.5,Zt=!1;for(let Ft of Qe){let ir=Ft.getSections();for(let Pr of ir){if(Pr.imageName)continue;let Sr=Oe[Pr.fontStack];if(Sr&&(Zt=Sr.ascender!==void 0&&Sr.descender!==void 0,!Zt))break}if(!Zt)break}let Dt=0;for(let Ft of Qe){Ft.trim();let ir=Ft.getMaxScale(),Pr=(ir-1)*Ci,Sr={positionedGlyphs:[],lineOffset:0};ce.positionedLines[Dt]=Sr;let br=Sr.positionedGlyphs,Lr=0;if(!Ft.length()){Bt+=Ce,++Dt;continue}let Ur=0,xi=0;for(let Kt=0;Kt<Ft.length();Kt++){let Zr=Ft.getSection(Kt),Fi=Ft.getSectionIndex(Kt),ur=Ft.getCharCode(Kt),jr=Zr.scale,Zi=null,Br=null,Jr=null,bi=Ci,di=0,Pi=!(Fe===Bn.horizontal||!We&&!kc(ur)||We&&(uy[ur]||(pt=ur,C_(pt)||P_(pt)||M_(pt)||ru(pt)||xf(pt))));if(Zr.imageName){let Hi=De[Zr.imageName];if(!Hi)continue;Jr=Zr.imageName,ce.iconsInText=ce.iconsInText||!0,Br=Hi.paddedRect;let wi=Hi.displaySize;jr=jr*Ci/lt,Zi={width:wi[0],height:wi[1],left:1,top:-3,advance:Pi?wi[1]:wi[0],localGlyph:!1},di=Zt?-Zi.height*jr:ir*Ci-17-wi[1]*jr,bi=Zi.advance;let Ha=(Pi?wi[0]:wi[1])*jr-Ci*ir;Ha>0&&Ha>Lr&&(Lr=Ha)}else{let Hi=Ae[Zr.fontStack];if(!Hi)continue;Hi[ur]&&(Br=Hi[ur]);let wi=Oe[Zr.fontStack];if(!wi)continue;let Ha=wi.glyphs[ur];if(!Ha)continue;if(Zi=Ha.metrics,bi=ur!==8203?Ci:0,Zt){let eh=wi.ascender!==void 0?Math.abs(wi.ascender):0,Yf=wi.descender!==void 0?Math.abs(wi.descender):0,Kf=(eh+Yf)*jr;Ur<Kf&&(Ur=Kf,xi=(eh-Yf)/2*jr),di=-eh*jr}else di=(ir-jr)*Ci-17}Pi?(ce.verticalizable=!0,br.push({glyph:ur,imageName:Jr,x:kt,y:Bt+di,vertical:Pi,scale:jr,localGlyph:Zi.localGlyph,fontStack:Zr.fontStack,sectionIndex:Fi,metrics:Zi,rect:Br}),kt+=bi*jr+Ke):(br.push({glyph:ur,imageName:Jr,x:kt,y:Bt+di,vertical:Pi,scale:jr,localGlyph:Zi.localGlyph,fontStack:Zr.fontStack,sectionIndex:Fi,metrics:Zi,rect:Br}),kt+=Zi.advance*jr+Ke)}br.length!==0&&(bt=Math.max(kt-Ke,bt),Zt?qA(br,nt,Lr,xi,Ce*ir/2):qA(br,nt,Lr,0,Ce/2)),kt=0;let nn=Ce*ir+Lr;Sr.lineOffset=Math.max(Lr,Pr),Bt+=nn,++Dt}var pt;let Cr=Bt,{horizontalAlign:Er,verticalAlign:zr}=Ex(Be);(function(Ft,ir,Pr,Sr,br,Lr){let Ur=(ir-Pr)*br,xi=-Lr*Sr;for(let nn of Ft)for(let Kt of nn.positionedGlyphs)Kt.x+=Ur,Kt.y+=xi})(ce.positionedLines,nt,Er,zr,bt,Cr),ce.top+=-zr*Cr,ce.bottom=ce.top+Cr,ce.left+=-Er*bt,ce.right=ce.left+bt,ce.hasBaseline=Zt}(me,e,r,u,J,_,y,b,O,w,C,U),!function(ce){for(let Oe of ce)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(ae)&&me}let uy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},CY={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function OA(i,e,r,u,p,d){if(e.imageName){let _=u[e.imageName];return _?_.displaySize[0]*e.scale*Ci/d+p:0}{let _=r[e.fontStack],y=_&&_.glyphs[i];return y?y.metrics.advance*e.scale+p:0}}function CA(i,e,r,u){let p=Math.pow(i-e,2);return u?i<e?p/2:2*p:p+Math.abs(r)*r}function PY(i,e,r){let u=0;return i===10&&(u-=1e4),r&&(u+=150),i!==40&&i!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function PA(i,e,r,u,p,d){let _=null,y=CA(e,r,p,d);for(let b of u){let w=CA(e-b.x,r,p,d)+b.badness;w<=y&&(_=b,y=w)}return{index:i,x:e,priorBreak:_,badness:y}}function MA(i){return i?MA(i.priorBreak).concat(i.index):[]}function Tx(i,e,r,u,p,d,_){if(d!=="point")return[];if(!i)return[];let y=[],b=function(C,k,z,U,G,J){let le=0;for(let te=0;te<C.length();te++){let ae=C.getSection(te);le+=OA(C.getCharCode(te),ae,U,G,k,J)}return le/Math.max(1,Math.ceil(le/z))}(i,e,r,u,p,_),w=i.text.indexOf("\u200B")>=0,S=0;for(let C=0;C<i.length();C++){let k=i.getSection(C),z=i.getCharCode(C);if(uy[z]||(S+=OA(z,k,u,p,e,_)),C<i.length()-1){let U=!((O=z)<11904||!(df(O)||D_(O)||vf(O)||B_(O)||yf(O)||q_(O)||L_(O)||Rc(O)||gf(O)||tu(O)||_f(O)||bf(O)||ff(O)||eu(O)||R_(O)||mf(O)||Da(O)||F_(O)||k_(O)||Dc(O)));(CY[z]||U||k.imageName)&&y.push(PA(C+1,S,b,y,PY(z,i.getCharCode(C+1),U&&w),!1))}}var O;return MA(PA(i.length(),S,b,y,0,!0))}function Ex(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function qA(i,e,r,u,p){if(!(e||r||u||p))return;let d=i.length-1,_=i[d],y=(_.x+_.metrics.advance*_.scale)*e;for(let b=0;b<=d;b++)i[b].x-=y,i[b].y+=r+u+p}function MY(i,e,r){let{horizontalAlign:u,verticalAlign:p}=Ex(r),d=e[0]-i.displaySize[0]*u,_=e[1]-i.displaySize[1]*p;return{image:i,top:_,bottom:_+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function RA(i,e,r,u,p,d){let _=i.image,y;if(_.content){let G=_.content,J=_.pixelRatio||1;y=[G[0]/J,G[1]/J,_.displaySize[0]-G[2]/J,_.displaySize[1]-G[3]/J]}let b=e.left*d,w=e.right*d,S,O,C,k;r==="width"||r==="both"?(k=p[0]+b-u[3],O=p[0]+w+u[1]):(k=p[0]+(b+w-_.displaySize[0])/2,O=k+_.displaySize[0]);let z=e.top*d,U=e.bottom*d;return r==="height"||r==="both"?(S=p[1]+z-u[0],C=p[1]+U+u[2]):(S=p[1]+(z+U-_.displaySize[1])/2,C=S+_.displaySize[1]),{image:_,top:S,right:O,bottom:C,left:k,collisionPadding:y}}class Wa extends q{constructor(e,r,u,p,d){super(e,r),this.angle=p,this.z=u,d!==void 0&&(this.segment=d)}clone(){return new Wa(this.x,this.y,this.z,this.angle,this.segment)}}function DA(i,e,r,u,p){if(e.segment===void 0)return!0;let d=e,_=e.segment+1,y=0;for(;y>-r/2;){if(_--,_<0)return!1;y-=i[_].dist(d),d=i[_]}y+=i[_].dist(i[_+1]),_++;let b=[],w=0;for(;y<r/2;){let S=i[_],O=i[_+1];if(!O)return!1;let C=i[_-1].angleTo(S)-S.angleTo(O);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:C}),w+=C;y-b[0].distance>u;)w-=b.shift().angleDelta;if(w>p)return!1;_++,y+=S.dist(O)}return!0}function LA(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function kA(i,e,r){return i?.6*e*r:0}function zA(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function qY(i,e,r,u,p,d){let _=kA(r,p,d),y=zA(r,u)*d,b=0,w=LA(i)/2;for(let S=0;S<i.length-1;S++){let O=i[S],C=i[S+1],k=O.dist(C);if(b+k>w){let z=(w-b)/k,U=tr(O.x,C.x,z),G=tr(O.y,C.y,z),J=new Wa(U,G,0,C.angleTo(O),S);return!_||DA(i,J,y,_,e)?J:void 0}b+=k}}function RY(i,e,r,u,p,d,_,y,b){let w=kA(u,d,_),S=zA(u,p),O=S*_,C=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return e-O<e/4&&(e=O+e/4),BA(i,C?e/2*y%e:(S/2+2*d)*_*y%e,e,w,r,O,C,!1,b)}function BA(i,e,r,u,p,d,_,y,b){let w=d/2,S=LA(i),O=0,C=e-r,k=[];for(let z=0;z<i.length-1;z++){let U=i[z],G=i[z+1],J=U.dist(G),le=G.angleTo(U);for(;C+r<O+J;){C+=r;let te=(C-O)/J,ae=tr(U.x,G.x,te),me=tr(U.y,G.y,te);if(ae>=0&&ae<b&&me>=0&&me<b&&C-w>=0&&C+w<=S){let ce=new Wa(ae,me,0,le,z);ce._round(),u&&!DA(i,ce,d,u,p)||k.push(ce)}}O+=J}return y||k.length||_||(k=BA(i,O/2,r,u,p,d,_,!0,b)),k}function FA(i,e,r,u,p){let d=[];for(let _=0;_<i.length;_++){let y=i[_],b;for(let w=0;w<y.length-1;w++){let S=y[w],O=y[w+1];S.x<e&&O.x<e||(S.x<e?S=new q(e,S.y+(e-S.x)/(O.x-S.x)*(O.y-S.y))._round():O.x<e&&(O=new q(e,S.y+(e-S.x)/(O.x-S.x)*(O.y-S.y))._round()),S.y<r&&O.y<r||(S.y<r?S=new q(S.x+(r-S.y)/(O.y-S.y)*(O.x-S.x),r)._round():O.y<r&&(O=new q(S.x+(r-S.y)/(O.y-S.y)*(O.x-S.x),r)._round()),S.x>=u&&O.x>=u||(S.x>=u?S=new q(u,S.y+(u-S.x)/(O.x-S.x)*(O.y-S.y))._round():O.x>=u&&(O=new q(u,S.y+(u-S.x)/(O.x-S.x)*(O.y-S.y))._round()),S.y>=p&&O.y>=p||(S.y>=p?S=new q(S.x+(p-S.y)/(O.y-S.y)*(O.x-S.x),p)._round():O.y>=p&&(O=new q(S.x+(p-S.y)/(O.y-S.y)*(O.x-S.x),p)._round()),b&&S.equals(b[b.length-1])||(b=[S],d.push(b)),b.push(O)))))}}return d}dt(Wa,"Anchor");let Ff=1e20;function NA(i,e,r,u,p,d,_,y,b){for(let w=e;w<e+u;w++)UA(i,r*d+w,d,p,_,y,b);for(let w=r;w<r+p;w++)UA(i,w*d+e,1,u,_,y,b)}function UA(i,e,r,u,p,d,_){d[0]=0,_[0]=-Ff,_[1]=Ff,p[0]=i[e];for(let y=1,b=0,w=0;y<u;y++){p[y]=i[e+y*r];let S=y*y;do{let O=d[b];w=(p[y]-p[O]+S-O*O)/(y-O)/2}while(w<=_[b]&&--b>-1);b++,d[b]=y,_[b]=w,_[b+1]=Ff}for(let y=0,b=0;y<u;y++){for(;_[b+1]<y;)b++;let w=d[b],S=y-w;i[e+y*r]=p[w]+S*S}}let Sx={none:0,ideographs:1,all:2};class Hc{constructor(e,r,u){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){let u=[];for(let p in e)for(let d of e[p])u.push({stack:p,id:d});At(u,({stack:p,id:d},_)=>{let y=this.entries[p];y||(y=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[d];if(b!==void 0)return void _(null,{stack:p,id:d,glyph:b});if(b=this._tinySDF(y,p,d),b)return y.glyphs[d]=b,void _(null,{stack:p,id:d,glyph:b});let w=Math.floor(d/256);if(256*w>65535)return void _(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void _(null,{stack:p,id:d,glyph:b});let S=y.requests[w];S||(S=y.requests[w]=[],Hc.loadGlyphRange(p,w,this.url,this.requestManager,(O,C)=>{if(C){y.ascender=C.ascender,y.descender=C.descender;for(let k in C.glyphs)this._doesCharSupportLocalGlyph(+k)||(y.glyphs[+k]=C.glyphs[+k]);y.ranges[w]=!0}for(let k of S)k(O,C);delete y.requests[w]})),S.push((O,C)=>{O?_(O):C&&_(null,{stack:p,id:d,glyph:C.glyphs[d]||null})})},(p,d)=>{if(p)r(p);else if(d){let _={};for(let{stack:y,id:b,glyph:w}of d)_[y]===void 0&&(_[y]={}),_[y].glyphs===void 0&&(_[y].glyphs={}),_[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},_[y].ascender=this.entries[y].ascender,_[y].descender=this.entries[y].descender;r(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Sx.none&&(this.localGlyphMode===Sx.all?!!this.localFontFamily:!!this.localFontFamily&&(tu(e)||z_(e)||ff(e)||Da(e)||Rc(e)))}_tinySDF(e,r,u){let p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let d=e.tinySDF;if(!d){let U="400";/bold/i.test(r)?U="900":/medium/i.test(r)?U="500":/light/i.test(r)&&(U="200"),d=e.tinySDF=new Hc.TinySDF({fontFamily:p,fontWeight:U,fontSize:48,buffer:6,radius:16}),d.fontWeight=U}if(this.localGlyphs[d.fontWeight][u])return this.localGlyphs[d.fontWeight][u];let _=String.fromCharCode(u),{data:y,width:b,height:w,glyphWidth:S,glyphHeight:O,glyphLeft:C,glyphTop:k,glyphAdvance:z}=d.draw(_);return this.localGlyphs[d.fontWeight][u]={id:u,bitmap:new Ga({width:b,height:w},y),metrics:{width:S/2,height:O/2,left:C/2,top:k/2-27,advance:z/2,localGlyph:!0}}}}function jA(i,e,r,u){let p=[],d=i.image,_=d.pixelRatio,y=d.paddedRect.w-2,b=d.paddedRect.h-2,w=i.right-i.left,S=i.bottom-i.top,O=d.stretchX||[[0,y]],C=d.stretchY||[[0,b]],k=(Ce,Be)=>Ce+Be[1]-Be[0],z=O.reduce(k,0),U=C.reduce(k,0),G=y-z,J=b-U,le=0,te=z,ae=0,me=U,ce=0,Oe=G,Ae=0,De=J;if(d.content&&u){let Ce=d.content;le=cy(O,0,Ce[0]),ae=cy(C,0,Ce[1]),te=cy(O,Ce[0],Ce[2]),me=cy(C,Ce[1],Ce[3]),ce=Ce[0]-le,Ae=Ce[1]-ae,Oe=Ce[2]-Ce[0]-te,De=Ce[3]-Ce[1]-me}let Qe=(Ce,Be,$e,Fe)=>{let Ke=hy(Ce.stretch-le,te,w,i.left),We=py(Ce.fixed-ce,Oe,Ce.stretch,z),lt=hy(Be.stretch-ae,me,S,i.top),kt=py(Be.fixed-Ae,De,Be.stretch,U),Bt=hy($e.stretch-le,te,w,i.left),bt=py($e.fixed-ce,Oe,$e.stretch,z),nt=hy(Fe.stretch-ae,me,S,i.top),Zt=py(Fe.fixed-Ae,De,Fe.stretch,U),Dt=new q(Ke,lt),pt=new q(Bt,lt),Cr=new q(Bt,nt),Er=new q(Ke,nt),zr=new q(We/_,kt/_),Ft=new q(bt/_,Zt/_),ir=e*Math.PI/180;if(ir){let br=Math.sin(ir),Lr=Math.cos(ir),Ur=[Lr,-br,br,Lr];Dt._matMult(Ur),pt._matMult(Ur),Er._matMult(Ur),Cr._matMult(Ur)}let Pr=Ce.stretch+Ce.fixed,Sr=Be.stretch+Be.fixed;return{tl:Dt,tr:pt,bl:Er,br:Cr,tex:{x:d.paddedRect.x+1+Pr,y:d.paddedRect.y+1+Sr,w:$e.stretch+$e.fixed-Pr,h:Fe.stretch+Fe.fixed-Sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zr,pixelOffsetBR:Ft,minFontScaleX:Oe/_/w,minFontScaleY:De/_/S,isSDF:r}};if(u&&(d.stretchX||d.stretchY)){let Ce=VA(O,G,z),Be=VA(C,J,U);for(let $e=0;$e<Ce.length-1;$e++){let Fe=Ce[$e],Ke=Ce[$e+1];for(let We=0;We<Be.length-1;We++)p.push(Qe(Fe,Be[We],Ke,Be[We+1]))}}else p.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return p}function cy(i,e,r){let u=0;for(let p of i)u+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return u}function VA(i,e,r){let u=[{fixed:-1,stretch:0}];for(let[p,d]of i){let _=u[u.length-1];u.push({fixed:p-_.stretch,stretch:_.stretch}),u.push({fixed:p-_.stretch,stretch:_.stretch+(d-p)})}return u.push({fixed:e+1,stretch:r}),u}function hy(i,e,r,u){return i/e*r+u}function py(i,e,r,u){return i-e*r/u}function DY(i,e,r,u){let p=e+i.positionedLines[u].lineOffset;return u===0?r+p/2:r+(p+(e+i.positionedLines[u-1].lineOffset))/2}Hc.loadGlyphRange=function(i,e,r,u,p){let d=256*e,_=d+255,y=u.transformRequest(u.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${d}-${_}`),_e.Glyphs);Te(y,(b,w)=>{if(b)p(b);else if(w){let S={},O=function(C){return new zf(C).readFields(IY,{})}(w);for(let C of O.glyphs)S[C.id]=C;p(null,{glyphs:S,ascender:O.ascender,descender:O.descender})}})},Hc.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=r;let y=this.size=i+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${_} ${d} ${i}px ${p}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(i){let e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:d}=this.ctx.measureText(i),_=Math.ceil(r),y=Math.min(this.size-this.buffer,Math.ceil(d-p)),b=Math.min(this.size-this.buffer,_+Math.ceil(u)),w=y+2*this.buffer,S=b+2*this.buffer,O=Math.max(w*S,0),C=new Uint8ClampedArray(O),k={data:C,width:w,height:S,glyphWidth:y,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return k;let{ctx:z,buffer:U,gridInner:G,gridOuter:J}=this;z.clearRect(U,U,y,b),z.fillText(i,U,U+_);let le=z.getImageData(U,U,y,b);J.fill(Ff,0,O),G.fill(0,0,O);for(let te=0;te<b;te++)for(let ae=0;ae<y;ae++){let me=le.data[4*(te*y+ae)+3]/255;if(me===0)continue;let ce=(te+U)*w+ae+U;if(me===1)J[ce]=0,G[ce]=Ff;else{let Oe=.5-me;J[ce]=Oe>0?Oe*Oe:0,G[ce]=Oe<0?Oe*Oe:0}}NA(J,0,0,w,S,w,this.f,this.v,this.z),NA(G,U,U,y,b,w,this.f,this.v,this.z);for(let te=0;te<O;te++){let ae=Math.sqrt(J[te])-Math.sqrt(G[te]);C[te]=Math.round(255-255*(ae/this.radius+this.cutoff))}return k}};class LY{constructor(e=[],r=kY){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:u}=this,p=r[e];for(;e>0;){let d=e-1>>1,_=r[d];if(u(p,_)>=0)break;r[e]=_,e=d}r[e]=p}_down(e){let{data:r,compare:u}=this,p=this.length>>1,d=r[e];for(;e<p;){let _=1+(e<<1),y=r[_],b=_+1;if(b<this.length&&u(r[b],y)<0&&(_=b,y=r[b]),u(y,d)>=0)break;r[e]=y,e=_}r[e]=d}}function kY(i,e){return i<e?-1:i>e?1:0}function zY(i,e=1,r=!1){let u=1/0,p=1/0,d=-1/0,_=-1/0,y=i[0];for(let k=0;k<y.length;k++){let z=y[k];(!k||z.x<u)&&(u=z.x),(!k||z.y<p)&&(p=z.y),(!k||z.x>d)&&(d=z.x),(!k||z.y>_)&&(_=z.y)}let b=Math.min(d-u,_-p),w=b/2,S=new LY([],BY);if(b===0)return new q(u,p);for(let k=u;k<d;k+=b)for(let z=p;z<_;z+=b)S.push(new Xc(k+w,z+w,w,i));let O=function(k){let z=0,U=0,G=0,J=k[0];for(let le=0,te=J.length,ae=te-1;le<te;ae=le++){let me=J[le],ce=J[ae],Oe=me.x*ce.y-ce.x*me.y;U+=(me.x+ce.x)*Oe,G+=(me.y+ce.y)*Oe,z+=3*Oe}return new Xc(U/z,G/z,0,k)}(i),C=S.length;for(;S.length;){let k=S.pop();(k.d>O.d||!O.d)&&(O=k,r&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,C)),k.max-O.d<=e||(w=k.h/2,S.push(new Xc(k.p.x-w,k.p.y-w,w,i)),S.push(new Xc(k.p.x+w,k.p.y-w,w,i)),S.push(new Xc(k.p.x-w,k.p.y+w,w,i)),S.push(new Xc(k.p.x+w,k.p.y+w,w,i)),C+=4)}return r&&(console.log(`num probes: ${C}`),console.log(`best distance: ${O.d}`)),O.p}function BY(i,e){return e.max-i.max}function Xc(i,e,r,u){this.p=new q(i,e),this.h=r,this.d=function(p,d){let _=!1,y=1/0;for(let b=0;b<d.length;b++){let w=d[b];for(let S=0,O=w.length,C=O-1;S<O;C=S++){let k=w[S],z=w[C];k.y>p.y!=z.y>p.y&&p.x<(z.x-k.x)*(p.y-k.y)/(z.y-k.y)+k.x&&(_=!_),y=Math.min(y,PI(p,k,z))}}return(_?1:-1)*Math.sqrt(y)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}let Ix=Number.POSITIVE_INFINITY,FY=Math.sqrt(2);function GA(i,e){return e[1]!==Ix?function(r,u,p){let d=0,_=0;switch(u=Math.abs(u),p=Math.abs(p),r){case"top-right":case"top-left":case"top":_=p-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-p}switch(r){case"top-right":case"bottom-right":case"right":d=-u;break;case"top-left":case"bottom-left":case"left":d=u}return[d,_]}(i,e[0],e[1]):function(r,u){let p=0,d=0;u<0&&(u=0);let _=u/FY;switch(r){case"top-right":case"top-left":d=_-7;break;case"bottom-right":case"bottom-left":d=7-_;break;case"bottom":d=7-u;break;case"top":d=u-7}switch(r){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=u;break;case"right":p=-u}return[p,d]}(i,e[0])}function NY(i,e,r,u,p,d,_,y,b,w){i.createArrays(),i.tilePixelRatio=Mt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let S=i.layers[0].layout,O=i.layers[0]._unevaluatedLayout._values,C={};if(i.textSizeData.kind==="composite"){let{minZoom:U,maxZoom:G}=i.textSizeData;C.compositeTextSizes=[O["text-size"].possiblyEvaluate(new Z(U),y),O["text-size"].possiblyEvaluate(new Z(G),y)]}if(i.iconSizeData.kind==="composite"){let{minZoom:U,maxZoom:G}=i.iconSizeData;C.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new Z(U),y),O["icon-size"].possiblyEvaluate(new Z(G),y)]}C.layoutTextSize=O["text-size"].possiblyEvaluate(new Z(b+1),y),C.layoutIconSize=O["icon-size"].possiblyEvaluate(new Z(b+1),y),C.textMaxSize=O["text-size"].possiblyEvaluate(new Z(18),y);let k=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",z=S.get("text-size");for(let U of i.features){let G=S.get("text-font").evaluate(U,{},y).join(","),J=z.evaluate(U,{},y),le=C.layoutTextSize.evaluate(U,{},y),te=(C.layoutIconSize.evaluate(U,{},y),{horizontal:{},vertical:void 0}),ae=U.text,me,ce=[0,0];if(ae){let De=ae.toString(),Qe=S.get("text-letter-spacing").evaluate(U,{},y)*Ci,Ce=S.get("text-line-height").evaluate(U,{},y)*Ci,Be=j0(De)?Qe:0,$e=S.get("text-anchor").evaluate(U,{},y),Fe=S.get("text-variable-anchor");if(!Fe){let bt=S.get("text-radial-offset").evaluate(U,{},y);ce=bt?GA($e,[bt*Ci,Ix]):S.get("text-offset").evaluate(U,{},y).map(nt=>nt*Ci)}let Ke=k?"center":S.get("text-justify").evaluate(U,{},y),We=S.get("symbol-placement"),lt=We==="point",kt=We==="point"?S.get("text-max-width").evaluate(U,{},y)*Ci:0,Bt=bt=>{i.allowVerticalPlacement&&Lc(De)&&(te.vertical=wx(ae,e,r,p,G,kt,Ce,$e,bt,Be,ce,Bn.vertical,!0,We,le,J))};if(!k&&Fe){let bt=Ke==="auto"?Fe.map(Zt=>Ax(Zt)):[Ke],nt=!1;for(let Zt=0;Zt<bt.length;Zt++){let Dt=bt[Zt];if(!te.horizontal[Dt])if(nt)te.horizontal[Dt]=te.horizontal[0];else{let pt=wx(ae,e,r,p,G,kt,Ce,"center",Dt,Be,ce,Bn.horizontal,!1,We,le,J);pt&&(te.horizontal[Dt]=pt,nt=pt.positionedLines.length===1)}}Bt("left")}else{if(Ke==="auto"&&(Ke=Ax($e)),lt||S.get("text-writing-mode").indexOf("horizontal")>=0||!Lc(De)){let bt=wx(ae,e,r,p,G,kt,Ce,$e,Ke,Be,ce,Bn.horizontal,!1,We,le,J);bt&&(te.horizontal[Ke]=bt)}Bt(We==="point"?"left":Ke)}}let Oe=!1;if(U.icon&&U.icon.name){let De=u[U.icon.name];De&&(me=MY(p[U.icon.name],S.get("icon-offset").evaluate(U,{},y),S.get("icon-anchor").evaluate(U,{},y)),Oe=De.sdf,i.sdfIcons===void 0?i.sdfIcons=De.sdf:i.sdfIcons!==De.sdf&&ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let Ae=WA(te.horizontal)||te.vertical;i.iconsInText||(i.iconsInText=!!Ae&&Ae.iconsInText),(Ae||me)&&UY(i,U,te,me,u,C,le,0,ce,Oe,_,y,w)}d&&i.generateCollisionDebugBuffers(b,i.collisionBoxArray)}function Ax(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function UY(i,e,r,u,p,d,_,y,b,w,S,O,C){let k=d.textMaxSize.evaluate(e,{},O);k===void 0&&(k=_);let z=i.layers[0].layout,U=z.get("icon-offset").evaluate(e,{},O),G=WA(r.horizontal)||r.vertical,J=C.name==="globe",le=_/24,te=i.tilePixelRatio*k/24,ae=(Be=i.overscaling,i.zoom>18&&Be>2&&(Be>>=1),Math.max(Mt/(512*Be),1)*z.get("symbol-spacing")),me=z.get("text-padding")*i.tilePixelRatio,ce=z.get("icon-padding")*i.tilePixelRatio,Oe=ne(z.get("text-max-angle")),Ae=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",De=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Qe=z.get("symbol-placement"),Ce=ae/2;var Be;let $e=z.get("icon-text-fit"),Fe;u&&$e!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Fe=RA(u,r.vertical,$e,z.get("icon-text-fit-padding"),U,le)),G&&(u=RA(u,G,$e,z.get("icon-text-fit-padding"),U,le)));let Ke=(We,lt,kt)=>{if(lt.x<0||lt.x>=Mt||lt.y<0||lt.y>=Mt)return;let Bt=null;if(J){let{x:bt,y:nt,z:Zt}=C.projectTilePoint(lt.x,lt.y,kt);Bt={anchor:new Wa(bt,nt,Zt,0,void 0),up:C.upVector(kt,lt.x,lt.y)}}(function(bt,nt,Zt,Dt,pt,Cr,Er,zr,Ft,ir,Pr,Sr,br,Lr,Ur,xi,nn,Kt,Zr,Fi,ur,jr,Zi,Br,Jr){let bi=bt.addToLineVertexArray(nt,Dt),di,Pi,Hi,wi,Ha,eh,Yf,Kf=0,CO=0,PO=0,MO=0,Gx=-1,$x=-1,oa={},qO=wf(""),du=Zt?Zt.anchor:nt,Wx=0,Zx=0;if(Ft._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Wx,Zx]=Ft.layout.get("text-offset").evaluate(ur,{},Jr).map(xn=>xn*Ci):(Wx=Ft.layout.get("text-radial-offset").evaluate(ur,{},Jr)*Ci,Zx=Ix),bt.allowVerticalPlacement&&pt.vertical){let xn=pt.vertical;if(Ur)eh=Ox(xn),zr&&(Yf=Ox(zr));else{let bn=Ft.layout.get("text-rotate").evaluate(ur,{},Jr)+90;Hi=fy(ir,du,nt,Pr,Sr,br,xn,Lr,bn,xi),zr&&(wi=fy(ir,du,nt,Pr,Sr,br,zr,Kt,bn))}}if(Cr){let xn=Ft.layout.get("icon-rotate").evaluate(ur,{},Jr),bn=Ft.layout.get("icon-text-fit")!=="none",Jf=jA(Cr,xn,Zi,bn),Xx=zr?jA(zr,xn,Zi,bn):void 0;Pi=fy(ir,du,nt,Pr,Sr,br,Cr,Kt,xn),Kf=4*Jf.length;let RO=bt.iconSizeData,mu=null;RO.kind==="source"?(mu=[ea*Ft.layout.get("icon-size").evaluate(ur,{},Jr)],mu[0]>zs&&ot(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):RO.kind==="composite"&&(mu=[ea*jr.compositeIconSizes[0].evaluate(ur,{},Jr),ea*jr.compositeIconSizes[1].evaluate(ur,{},Jr)],(mu[0]>zs||mu[1]>zs)&&ot(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,Jf,mu,Fi,Zr,ur,!1,Zt,nt,bi.lineStartIndex,bi.lineLength,-1,Br,Jr),Gx=bt.icon.placedSymbolArray.length-1,Xx&&(CO=4*Xx.length,bt.addSymbols(bt.icon,Xx,mu,Fi,Zr,ur,Bn.vertical,Zt,nt,bi.lineStartIndex,bi.lineLength,-1,Br,Jr),$x=bt.icon.placedSymbolArray.length-1)}for(let xn in pt.horizontal){let bn=pt.horizontal[xn];di||(qO=wf(bn.text),Ur?Ha=Ox(bn):di=fy(ir,du,nt,Pr,Sr,br,bn,Lr,Ft.layout.get("text-rotate").evaluate(ur,{},Jr),xi));let Jf=bn.positionedLines.length===1;if(PO+=$A(bt,Zt,nt,bn,Er,Ft,Ur,ur,xi,bi,pt.vertical?Bn.horizontal:Bn.horizontalOnly,Jf?Object.keys(pt.horizontal):[xn],oa,Gx,jr,Br,Jr),Jf)break}pt.vertical&&(MO+=$A(bt,Zt,nt,pt.vertical,Er,Ft,Ur,ur,xi,bi,Bn.vertical,["vertical"],oa,$x,jr,Br,Jr));let Vs=-1,Hx=(xn,bn)=>xn?Math.max(xn,bn):bn;Vs=Hx(Ha,Vs),Vs=Hx(eh,Vs),Vs=Hx(Yf,Vs);let vK=Vs>-1?1:0;bt.glyphOffsetArray.length>=Fs.MAX_GLYPHS&&ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ur.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,ur.sortKey),bt.symbolInstances.emplaceBack(du.x,du.y,du.z,nt.x,nt.y,oa.right>=0?oa.right:-1,oa.center>=0?oa.center:-1,oa.left>=0?oa.left:-1,oa.vertical>=0?oa.vertical:-1,Gx,$x,qO,di!==void 0?di:bt.collisionBoxArray.length,di!==void 0?di+1:bt.collisionBoxArray.length,Hi!==void 0?Hi:bt.collisionBoxArray.length,Hi!==void 0?Hi+1:bt.collisionBoxArray.length,Pi!==void 0?Pi:bt.collisionBoxArray.length,Pi!==void 0?Pi+1:bt.collisionBoxArray.length,wi||bt.collisionBoxArray.length,wi?wi+1:bt.collisionBoxArray.length,Pr,PO,MO,Kf,CO,vK,0,Wx,Zx,Vs)})(i,lt,Bt,We,r,u,p,Fe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,me,Ae,b,0,ce,De,U,e,d,w,S,O)};if(Qe==="line")for(let We of FA(e.geometry,0,0,Mt,Mt)){let lt=RY(We,ae,Oe,r.vertical||G,u,24,te,i.overscaling,Mt);for(let kt of lt){let Bt=G;Bt&&jY(i,Bt.text,Ce,kt)||Ke(We,kt,O)}}else if(Qe==="line-center"){for(let We of e.geometry)if(We.length>1){let lt=qY(We,Oe,r.vertical||G,u,24,te);lt&&Ke(We,lt,O)}}else if(e.type==="Polygon")for(let We of mx(e.geometry,0)){let lt=zY(We,16);Ke(We[0],new Wa(lt.x,lt.y,0,0,void 0),O)}else if(e.type==="LineString")for(let We of e.geometry)Ke(We,new Wa(We[0].x,We[0].y,0,0,void 0),O);else if(e.type==="Point")for(let We of e.geometry)for(let lt of We)Ke([lt],new Wa(lt.x,lt.y,0,0,void 0),O)}let zs=32640;function $A(i,e,r,u,p,d,_,y,b,w,S,O,C,k,z,U,G){let J=function(ae,me,ce,Oe,Ae,De,Qe,Ce){let Be=[];if(me.positionedLines.length===0)return Be;let $e=Oe.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Fe=function(Bt){let bt=Bt[0],nt=Bt[1],Zt=bt*nt;return Zt>0?[bt,-nt]:Zt<0?[-bt,nt]:bt===0?[nt,bt]:[nt,-bt]}(ce),Ke=Math.abs(me.top-me.bottom);for(let Bt of me.positionedLines)Ke-=Bt.lineOffset;let We=me.positionedLines.length,lt=Ke/We,kt=me.top-ce[1];for(let Bt=0;Bt<We;++Bt){let bt=me.positionedLines[Bt];kt=DY(me,lt,kt,Bt);for(let nt of bt.positionedGlyphs){if(!nt.rect)continue;let Zt=nt.rect||{},Dt=4,pt=!0,Cr=1,Er=0;if(nt.imageName){let Br=Qe[nt.imageName];if(!Br)continue;if(Br.sdf){ot("SDF images are not supported in formatted text and will be ignored.");continue}pt=!1,Cr=Br.pixelRatio,Dt=1/Cr}let zr=(Ae||Ce)&&nt.vertical,Ft=nt.metrics.advance*nt.scale/2,ir=nt.metrics,Pr=nt.rect;if(Pr===null)continue;Ce&&me.verticalizable&&(Er=nt.imageName?Ft-nt.metrics.width*nt.scale/2:0);let Sr=Ae?[nt.x+Ft,nt.y]:[0,0],br=[0,0],Lr=[0,0],Ur=!1;Ae||(zr?(Lr=[nt.x+Ft+Fe[0],nt.y+Fe[1]-Er],Ur=!0):br=[nt.x+Ft+ce[0],nt.y+ce[1]-Er]);let xi=Pr.w*nt.scale/(Cr*(nt.localGlyph?2:1)),nn=Pr.h*nt.scale/(Cr*(nt.localGlyph?2:1)),Kt,Zr,Fi,ur;if(zr){let Br=nt.y-kt,Jr=new q(-Ft,Ft-Br),bi=-Math.PI/2,di=new q(...Lr);Kt=new q(-Ft+br[0],br[1]),Kt._rotateAround(bi,Jr)._add(di),Kt.x+=-Br+Ft,Kt.y-=(ir.left-Dt)*nt.scale;let Pi=nt.imageName?ir.advance*nt.scale:Ci*nt.scale,Hi=String.fromCharCode(nt.glyph);mY(Hi)?Kt.x+=(1-Dt)*nt.scale:_Y(Hi)?Kt.x+=Pi-ir.height*nt.scale+(-Dt-1)*nt.scale:Kt.x+=nt.imageName||ir.width+2*Dt===Pr.w&&ir.height+2*Dt===Pr.h?(Pi-nn)/2:(Pi-(ir.height+2*Dt)*nt.scale)/2,Zr=new q(Kt.x,Kt.y-xi),Fi=new q(Kt.x+nn,Kt.y),ur=new q(Kt.x+nn,Kt.y-xi)}else{let Br=(ir.left-Dt)*nt.scale-Ft+br[0],Jr=(-ir.top-Dt)*nt.scale+br[1],bi=Br+xi,di=Jr+nn;Kt=new q(Br,Jr),Zr=new q(bi,Jr),Fi=new q(Br,di),ur=new q(bi,di)}if($e){let Br;Br=Ae?new q(0,0):Ur?new q(Fe[0],Fe[1]):new q(ce[0],ce[1]),Kt._rotateAround($e,Br),Zr._rotateAround($e,Br),Fi._rotateAround($e,Br),ur._rotateAround($e,Br)}let jr=new q(0,0),Zi=new q(0,0);Be.push({tl:Kt,tr:Zr,bl:Fi,br:ur,tex:Zt,writingMode:me.writingMode,glyphOffset:Sr,sectionIndex:nt.sectionIndex,isSDF:pt,pixelOffsetTL:jr,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}}return Be}(0,u,b,d,_,y,p,i.allowVerticalPlacement),le=i.textSizeData,te=null;le.kind==="source"?(te=[ea*d.layout.get("text-size").evaluate(y,{},G)],te[0]>zs&&ot(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(te=[ea*z.compositeTextSizes[0].evaluate(y,{},G),ea*z.compositeTextSizes[1].evaluate(y,{},G)],(te[0]>zs||te[1]>zs)&&ot(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,J,te,b,_,y,S,e,r,w.lineStartIndex,w.lineLength,k,U,G);for(let ae of O)C[ae]=i.text.placedSymbolArray.length-1;return 4*J.length}function WA(i){for(let e in i)return i[e];return null}function fy(i,e,r,u,p,d,_,y,b,w){let S=_.top,O=_.bottom,C=_.left,k=_.right,z=_.collisionPadding;if(z&&(C-=z[0],S-=z[1],k+=z[2],O+=z[3]),b){let U=new q(C,S),G=new q(k,S),J=new q(C,O),le=new q(k,O),te=ne(b),ae=new q(0,0);w&&(ae=new q(w[0],w[1])),U._rotateAround(te,ae),G._rotateAround(te,ae),J._rotateAround(te,ae),le._rotateAround(te,ae),C=Math.min(U.x,G.x,J.x,le.x),k=Math.max(U.x,G.x,J.x,le.x),S=Math.min(U.y,G.y,J.y,le.y),O=Math.max(U.y,G.y,J.y,le.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,C,S,k,O,y,u,p,d),i.length-1}function Ox(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let e=i.bottom-i.top;return e>0?Math.max(10,e):null}function jY(i,e,r,u){let p=i.compareText;if(e in p){let d=p[e];for(let _=d.length-1;_>=0;_--)if(u.dist(d[_])<r)return!0}else p[e]=[];return p[e].push(u),!1}let VY=Ne([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ZA}=VY,HA=Ne([{name:"a_pos_3",components:3,type:"Int16"}]);var Nf=Ne([{name:"a_pos",type:"Int16",components:2}]);let Za=Mt/Math.PI/2,Cx=2*Xn(1,0)*Za*Math.PI,Yc=[64,32,16],So=-Za,Io=Za,GY=[new rn([So,So,So],[Io,Io,Io]),new rn([So,So,So],[0,0,Io]),new rn([0,So,So],[Io,0,Io]),new rn([So,0,So],[0,Io,Io]),new rn([0,0,So],[Io,Io,Io])];function XA(i,e,r,u=!0){let p=To([],i._camera.position,i.worldSize),d=[e,r,1,1];uu(d,d,i.pixelMatrixInverse),UI(d,d,1/d[3]);let _=$i([],Eo([],d,p)),y=i.globeMatrix,b=[y[12],y[13],y[14]],w=Eo([],b,p),S=Sf(w),O=$i([],w),C=i.worldSize/(2*Math.PI),k=Kn(O,_),z=Math.asin(C/S);if(z<Math.acos(k)){if(!u)return null;let Qe=[],Ce=[];To(Qe,_,S/k),$i(Ce,Eo(Ce,Qe,w)),$i(_,ks(_,w,To(_,Ce,Math.tan(z)*S)))}let U=[];new sx(p,_).closestPointOnSphere(b,C,U);let G=$i([],Li(y,0)),J=$i([],Li(y,1)),le=$i([],Li(y,2)),te=Kn(G,U),ae=Kn(J,U),me=Kn(le,U),ce=Ie(Math.asin(-ae/C)),Oe=Ie(Math.atan2(te,me));Oe=i.center.lng+function(Qe,Ce){let Be=(Ce-Qe+180)%360-180;return Be<-180?Be+360:Be}(i.center.lng,Oe);let Ae=Ko(Oe),De=He(ja(ce),0,1);return new Bc(Ae,De)}class $Y{constructor(e,r,u){this.a=Eo([],e,u),this.b=Eo([],r,u),this.center=u;let p=$i([],this.a),d=$i([],this.b);this.angle=Math.acos(Kn(p,d))}}function Px(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(u,p,d,_){let y=Math.sin(d);return u*(Math.sin((1-_)*d)/y)+p*(Math.sin(_*d)/y)}(i.a[e],i.b[e],i.angle,He(r,0,1))+i.center[e]}function ta(i){if(i.z<=1)return GY[i.z+2*i.y+i.x];let e=Mx(dy(i));return rn.fromPoints(e)}function YA(i,e){let r=Vf(e.zoom);if(r===0)return ta(i);let u=dy(i),p=Mx(u),d=Ko(u.getWest())*e.worldSize,_=Ko(u.getEast())*e.worldSize,y=ja(u.getNorth())*e.worldSize,b=ja(u.getSouth())*e.worldSize,w=[d,y,0],S=[_,y,0],O=[d,b,0],C=[_,b,0],k=ex([],e.globeMatrix);return si(w,w,k),si(S,S,k),si(O,O,k),si(C,C,k),p[0]=xs(p[0],O,r),p[1]=xs(p[1],C,r),p[2]=xs(p[2],S,r),p[3]=xs(p[3],w,r),rn.fromPoints(p)}function KA(i,e,r,u,p){for(let d of r)si(d,d,u),To(d,d,p),nx(i,i,d),ox(e,e,d)}function WY(i,e,r){let u=e/i.worldSize,p=Number.MAX_VALUE,d=[-p,-p,-p],_=[p,p,p],y=i.globeMatrix;if(r.z<=1)return KA(_,d,ta(r).getCorners(),y,u),new rn(_,d);let b=dy(r),w=Mx(b);if(KA(_,d,w,y,u),b.contains(i.center)){d[2]=0;let Oe=i.point,Ae=[Oe.x*u,Oe.y*u,0];return nx(_,_,Ae),ox(d,d,Ae),new rn(_,d)}let S=[y[12]*u,y[13]*u,y[14]*u],O=b.getCenter(),C=He(i.center.lat,-85.051129,Jo),k=He(O.lat,-85.051129,Jo),z=Ko(i.center.lng),U=ja(C),G=z-Ko(O.lng),J=U-ja(k);G>.5?G-=1:G<-.5&&(G+=1);let le=0;Math.abs(G)>Math.abs(J)?le=G>=0?1:3:(le=J>=0?0:2,Y_(S,S,[y[4]*u,y[5]*u,y[6]*u],-Math.sin(ne(J>=0?b.getSouth():b.getNorth()))*Za));let te=w[le],ae=w[(le+1)%4],me=new $Y(te,ae,S),ce=[Px(me,0)||te[0],Px(me,1)||te[1],Px(me,2)||te[2]];return _[2]=Math.min(te[2],ae[2]),nx(_,_,ce),ox(d,d,ce),new rn(_,d)}function dy({x:i,y:e,z:r}){let u=1/(1<<r),p=new pr(Yn(i*u),Oi((e+1)*u)),d=new pr(Yn((i+1)*u),Oi(e*u));return new Ls(p,d)}function Mx(i){let e=ne(i.getNorth()),r=ne(i.getSouth()),u=Math.cos(e),p=Math.cos(r),d=Math.sin(e),_=Math.sin(r),y=i.getWest(),b=i.getEast();return[Kc(p,_,y),Kc(p,_,b),Kc(u,d,b),Kc(u,d,y)]}function Kc(i,e,r,u=Za){return r=ne(r),[i*Math.sin(r)*u,-e*u,i*Math.cos(r)*u]}function my(i,e,r){return Kc(Math.cos(ne(i)),Math.sin(ne(i)),e,r)}function Uf(i,e,r,u){let p=1<<r.z,d=(i/Mt+r.x)/p;return my(Oi((e/Mt+r.y)/p),Yn(d),u)}function _y({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}let JA=new Float64Array(16);function jf(i){let e=_y(i),r=kI(JA,[e,e,e]);return Ef(r,r,((u=[])[0]=-(p=i.min)[0],u[1]=-p[1],u[2]=-p[2],u));var u,p}function qx(i){let e=(u=i.min,(r=JA)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=u[0],r[13]=u[1],r[14]=u[2],r[15]=1,r);var r,u;let p=1/_y(i);return lu(e,e,[p,p,p])}function QA(i,e,r,u,p){let d=function(b){let w=Mt/(2*Math.PI);return b/(2*Math.PI)/w}(r),_=[i,e,-r/(2*Math.PI)],y=Qo(new Float64Array(16));return Ef(y,y,_),lu(y,y,[d,d,d]),tx(y,y,ne(-p)),X_(y,y,ne(-u)),y}function Vf(i){return It(5,6,i)}function eO(i,e){let r=my(e.lat,e.lng);return d=(u=ix([],function(k){let z=my(k._center.lat,k._center.lng),U=ax([],Uc(0,1,0),z),G=zI([],-k.angle,z);U=si(U,U,G),zI(G,-k._pitch,U);let J=$i([],z);return To(J,J,k.cameraToCenterDistance/k.pixelsPerMeter*Cx),si(J,J,G),ks([],z,J)}(i),r))[0],_=u[1],y=u[2],b=(p=r)[0],w=p[1],S=p[2],C=(O=Math.sqrt(d*d+_*_+y*y)*Math.sqrt(b*b+w*w+S*S))&&Kn(u,p)/O,Math.acos(Math.min(Math.max(C,-1),1));var u,p,d,_,y,b,w,S,O,C}let tO=ne(85),ZY=Math.cos(tO),HY=Math.sin(tO);function rO(i,e){let r=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,p=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),d=Math.sin(r)*p/Math.sin(Math.max(Math.PI/2-i._pitch-r,.01)),_=Math.sin(i._pitch)*d+p;return Math.min(1.01*_,p*(1/i._horizonShift))}function pu(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};let r=Math.pow(2,-i.z),u=i.x*r,p=(i.x+1)*r,d=i.y*r,_=(i.y+1)*r,y=Yn(u),b=Yn(p),w=Oi(d),S=Oi(_),O=e.project(y,w),C=e.project(b,w),k=e.project(b,S),z=e.project(y,S),U=Math.min(O.x,C.x,k.x,z.x),G=Math.min(O.y,C.y,k.y,z.y),J=Math.max(O.x,C.x,k.x,z.x),le=Math.max(O.y,C.y,k.y,z.y),te=r/16;function ae(ce,Oe,Ae,De,Qe,Ce){let Be=(Ae+Qe)/2,$e=(De+Ce)/2,Fe=e.project(Yn(Be),Oi($e)),Ke=Math.max(0,U-Fe.x,G-Fe.y,Fe.x-J,Fe.y-le);U=Math.min(U,Fe.x),J=Math.max(J,Fe.x),G=Math.min(G,Fe.y),le=Math.max(le,Fe.y),Ke>te&&(ae(ce,Fe,Ae,De,Be,$e),ae(Fe,Oe,Be,$e,Qe,Ce))}ae(O,C,u,d,p,d),ae(C,k,p,d,p,_),ae(k,z,p,_,u,_),ae(z,O,u,_,u,d),U-=te,G-=te,J+=te,le+=te;let me=1/Math.max(J-U,le-G);return{scale:me,x:U*me,y:G*me,x2:J*me,y2:le*me,projection:e}}let XY=Qo(new Float32Array(16));class Bs{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new pr(0,0)}projectTilePoint(e,r,u){return{x:e,y:r,z:0}}locationPoint(e,r,u=!0){return e._coordinatePoint(e.locationCoordinate(r),u)}pixelsPerMeter(e,r){return Xn(1,e)*r}pixelSpaceConversion(e,r,u){return 1}farthestPixelDistance(e){return rO(e,e.pixelsPerMeter)}pointCoordinate(e,r,u,p){let d=e.horizonLineFromTop(!1),_=new q(r,Math.max(d,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,p))}pointCoordinate3D(e,r,u){let p=new q(r,u);if(e.elevation)return e.elevation.pointCoordinate(p);{let d=this.pointCoordinate(e,p.x,p.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);let u=e.horizonLineFromTop();return r.y<u}createInversionMatrix(e,r){return XY}createTileMatrix(e,r,u){let p,d,_,y=u.canonical,b=Qo(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=pu(y,this);p=1,d=w.x+u.wrap*w.scale,_=w.y,lu(b,b,[p/w.scale,p/w.scale,e.pixelsPerMeter/r])}else p=r/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*u.wrap)*p,_=y.y*p;return Ef(b,b,[d,_,0]),lu(b,b,[p/Mt,p/Mt,1]),b}upVector(e,r,u){return[0,0,1]}upVectorScale(e,r,u){return{metersToTile:1}}}class YY extends Bs{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,u]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(ne(r));this.n=(p+Math.sin(ne(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n:u,c:p,r0:d}=this,_=ne(e-this.center[0]),y=ne(r),b=Math.sqrt(p-2*u*Math.sin(y))/u;return{x:b*Math.sin(_*u),y:b*Math.cos(_*u)-d,z:0}}unproject(e,r){let{n:u,c:p,r0:d}=this,_=d+r,y=Math.atan2(e,Math.abs(_))*Math.sign(_);_*u<0&&(y-=Math.PI*Math.sign(e)*Math.sign(_));let b=ne(this.center[0])*u;y=Yt(y,-Math.PI-b,Math.PI-b);let w=Ie(y/u)+this.center[0],S=Math.asin(He((p-(e*e+_*_)*u*u)/(2*u),-1,1)),O=He(Ie(S),-85.051129,Jo);return new pr(w,O)}}let Gf=1.340264,$f=-.081106,Wf=893e-6,Zf=.003796,yy=Math.sqrt(3)/2;class KY extends Bs{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let u=Math.asin(yy*Math.sin(r)),p=u*u,d=p*p*p;return{x:.5*(e*Math.cos(u)/(yy*(Gf+3*$f*p+d*(7*Wf+9*Zf*p)))/Math.PI+.5),y:1-.5*(u*(Gf+$f*p+d*(Wf+Zf*p))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let u=r=(2*(1-r)-1)*Math.PI,p=u*u,d=p*p*p;for(let S,O,C,k=0;k<12&&(O=u*(Gf+$f*p+d*(Wf+Zf*p))-r,C=Gf+3*$f*p+d*(7*Wf+9*Zf*p),S=O/C,u=He(u-S,-Math.PI/3,Math.PI/3),p=u*u,d=p*p*p,!(Math.abs(S)<1e-12));++k);let _=yy*e*(Gf+3*$f*p+d*(7*Wf+9*Zf*p))/Math.cos(u),y=Math.asin(Math.sin(u)/yy),b=He(180*_/Math.PI,-180,180),w=He(180*y/Math.PI,-85.051129,Jo);return new pr(b,w)}}class JY extends Bs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let u=360*(e-.5),p=He(360*(.5-r),-85.051129,Jo);return new pr(u,p)}}let Jc=Math.PI/2;function gy(i){return Math.tan((Jc+i)/2)}class QY extends Bs{constructor(e){super(e),this.center=e.center||[0,30];let[r,u]=this.parallels=e.parallels||[30,30],p=ne(r),d=ne(u),_=Math.cos(p);this.n=p===d?Math.sin(p):Math.log(_/Math.cos(d))/Math.log(gy(d)/gy(p)),this.f=_*Math.pow(gy(p),this.n)/this.n}project(e,r){r=ne(r),e=ne(e-this.center[0]);let u=1e-6,{n:p,f:d}=this;d>0?r<-Jc+u&&(r=-Jc+u):r>Jc-u&&(r=Jc-u);let _=d/Math.pow(gy(r),p),y=_*Math.sin(p*e),b=d-_*Math.cos(p*e);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;let{n:u,f:p}=this,d=p-r,_=Math.sign(d),y=Math.sign(u)*Math.sqrt(e*e+d*d),b=Math.atan2(e,Math.abs(d))*_;d*u<0&&(b-=Math.PI*Math.sign(e)*_);let w=He(Ie(b/u)+this.center[0],-180,180),S=He(Ie(2*Math.atan(Math.pow(p/y,1/u))-Jc),-85.051129,Jo);return new pr(w,S)}}class iO extends Bs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Ko(e),y:ja(r),z:0}}unproject(e,r){let u=Yn(e),p=Oi(r);return new pr(u,p)}}let nO=ne(Jo);class eK extends Bs{project(e,r){let u=(r=ne(r))*r,p=u*u;return{x:.5*((e=ne(e))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let u=r=(2*(1-r)-1)*Math.PI,p=25,d=0,_=u*u;do{_=u*u;let w=_*_;d=(u*(1.007226+_*(.015085+w*(.028874*_-.044475-.005916*w)))-r)/(1.007226+_*(.045255+w*(.259866*_-.311325-.005916*11*w))),u=He(u-d,-nO,nO)}while(Math.abs(d)>1e-6&&--p>0);_=u*u;let y=He(Ie(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),b=Ie(u);return new pr(y,b)}}let oO=ne(Jo);class tK extends Bs{project(e,r){r=ne(r),e=ne(e);let u=Math.cos(r),p=2/Math.PI,d=Math.acos(u*Math.cos(e/2)),_=Math.sin(d)/d,y=.5*(e*p+2*u*Math.sin(e/2)/_)||0,b=.5*(r+Math.sin(r)/_)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let u=e=(2*e-.5)*Math.PI,p=r=(2*(1-r)-1)*Math.PI,d=25,_=1e-6,y=0,b=0;do{let w=Math.cos(p),S=Math.sin(p),O=2*S*w,C=S*S,k=w*w,z=Math.cos(u/2),U=Math.sin(u/2),G=2*z*U,J=U*U,le=1-k*z*z,te=le?1/le:0,ae=le?Math.acos(w*z)*Math.sqrt(1/le):0,me=.5*(2*ae*w*U+2*u/Math.PI)-e,ce=.5*(ae*S+p)-r,Oe=.5*te*(k*J+ae*w*z*C)+1/Math.PI,Ae=te*(G*O/4-ae*S*U),De=.125*te*(O*U-ae*S*k*G),Qe=.5*te*(C*z+ae*J*w)+.5,Ce=Ae*De-Qe*Oe;y=(ce*Ae-me*Qe)/Ce,b=(me*De-ce*Oe)/Ce,u=He(u-y,-Math.PI,Math.PI),p=He(p-b,-oO,oO)}while((Math.abs(y)>_||Math.abs(b)>_)&&--d>0);return new pr(Ie(u),Ie(p))}}class aO extends Bs{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:u,cosPhi:p}=this;return{x:ne(e)*p*u+.5,y:-Math.sin(ne(r))/p*u+.5,z:0}}unproject(e,r){let{scale:u,cosPhi:p}=this,d=-(r-.5)/u,_=He(Ie((e-.5)/u)/p,-180,180),y=Math.asin(He(d*p,-1,1)),b=He(Ie(y),-85.051129,Jo);return new pr(_,b)}}class rK extends iO{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,r,u){let p=Uf(e,r,u);return si(p,p,jf(ta(u))),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,r){let u=my(r.lat,r.lng),p=$i([],u),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Y_(u,u,p,Xn(1,0)*Mt*d);let _=Qo(new Float64Array(16));return Nc(_,e.pixelMatrix,e.globeMatrix),si(u,u,_),new q(u[0],u[1])}pixelsPerMeter(e,r){return Xn(1,0)*r}pixelSpaceConversion(e,r,u){let p=tr(Xn(1,45)*r,Xn(1,e)*r,u);return this.pixelsPerMeter(e,r)/p}createTileMatrix(e,r,u){let p=qx(ta(u.canonical));return Nc(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,r){let{center:u}=e,p=jf(ta(r));return X_(p,p,ne(u.lng)),tx(p,p,ne(u.lat)),lu(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,r,u,p){return XA(e,r,u,!0)||new Bc(0,0)}pointCoordinate3D(e,r,u){let p=this.pointCoordinate(e,r,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,r){return!XA(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(p,d){let _=p.cameraToCenterDistance,y=p._centerAltitude*d,b=p._camera,w=p._camera.forward(),S=ks([],To([],w,-_),[0,0,y]),O=p.worldSize/(2*Math.PI),C=[0,0,-O],k=p.width/p.height,z=Math.tan(p.fovAboveCenter),U=To([],b.up(),z),G=To([],b.right(),z*k),J=$i([],ks([],ks([],w,U),G)),le=[],te;if(new sx(S,J).closestPointOnSphere(C,O,le)){let ae=ks([],le,C),me=Eo([],ae,S);te=Math.cos(p.fovAboveCenter)*Sf(me)}else{let ae=Eo([],S,C),me=Eo([],C,S);$i(me,me);let ce=Sf(ae)-O;te=Math.sqrt(ce*(ce+2*O));let Oe=Math.acos(te/(O+ce))-Math.acos(Kn(w,me));te*=Math.cos(Oe)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=Vf(e.zoom);if(u>0){let p=rO(e,Xn(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return tr(r,p+d*(1-Math.cos(_)),Math.pow(u,10))}return r}upVector(e,r,u){return Uf(r,u,e,1)}upVectorScale(e){return{metersToTile:Cx*_y(ta(e))}}}function sO(i){let e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new iO(i);case"equirectangular":return new JY(i);case"naturalEarth":return new eK(i);case"equalEarth":return new KY(i);case"winkelTripel":return new tK(i);case"albers":return r?new aO(i):new YY(i);case"lambertConformalConic":return r?new aO(i):new QY(i);case"globe":return new rK(i)}throw new Error(`Invalid projection name: ${i.name}`)}let iK=hu.VectorTileFeature.types,nK=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vy(i,e,r,u,p,d,_,y,b,w,S,O,C){let k=y?Math.min(zs,Math.round(y[0])):0,z=y?Math.min(zs,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*u),Math.round(32*p),d,_,(k<<1)+(b?1:0),z,16*w,16*S,256*O,256*C)}function xy(i,e,r,u,p,d,_){i.emplaceBack(e,r,u,p,d,_)}function by(i,e,r,u,p){i.emplaceBack(e,r,u,p),i.emplaceBack(e,r,u,p),i.emplaceBack(e,r,u,p),i.emplaceBack(e,r,u,p)}function oK(i){for(let e of i.sections)if(h(e.text))return!0;return!1}class Rx{constructor(e){this.layoutVertexArray=new Rr,this.indexArray=new jt,this.programConfigurations=e,this.segments=new oi,this.dynamicLayoutVertexArray=new Wt,this.opacityVertexArray=new xr,this.placedSymbolArray=new sI,this.globeExtVertexArray=new $r}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sY.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uY.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,nK,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lY.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}dt(Rx,"SymbolBuffers");class Dx{constructor(e,r,u){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new u,this.segments=new oi,this.collisionVertexArray=new Dr,this.collisionVertexArrayExt=new kr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,cY.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,hY.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}dt(Dx,"CollisionBuffers");class Fs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qo([]),this.placementViewportMatrix=Qo([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gx(this.zoom,r["text-size"]),this.iconSizeData=gx(this.zoom,r["icon-size"]);let u=this.layers[0].layout,p=u.get("symbol-sort-key"),d=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>Bn[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Rx(new ou(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rx(new ou(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new cI,this.lineVertexArray=new hI,this.symbolInstances=new uI}calculateGlyphDependencies(e,r,u,p,d){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,p&&d){let y=kf[e.charAt(_)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,u,p){let d=this.layers[0],_=d.layout,y=this.projection.name==="globe",b=_.get("text-font"),w=_.get("text-field"),S=_.get("icon-image"),O=(w.value.kind!=="constant"||w.value.value instanceof Vi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),C=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,k=_.get("symbol-sort-key");if(this.features=[],!O&&!C)return;let z=r.iconDependencies,U=r.glyphDependencies,G=r.availableImages,J=new Z(this.zoom);for(let{feature:le,id:te,index:ae,sourceLayerIndex:me}of e){let ce=d._featureFilter.needGeometry,Oe=au(le,ce);if(!d._featureFilter.filter(J,Oe,u))continue;if(ce||(Oe.geometry=Va(le,u,p)),y&&le.type!==1&&u.z<=5){let Ce=Oe.geometry,Be=.98078528056;for(let $e=0;$e<Ce.length;$e++)Ce[$e]=lX(Ce[$e],Fe=>Fe,(Fe,Ke)=>Kn(Uf(Fe.x,Fe.y,u,1),Uf(Ke.x,Ke.y,u,1))<Be)}let Ae,De;if(O){let Ce=d.getValueAndResolveTokens("text-field",Oe,u,G),Be=Vi.factory(Ce);oK(Be)&&(this.hasRTLText=!0),(!this.hasRTLText||j()==="unavailable"||this.hasRTLText&&W.isParsed())&&(Ae=dY(Be,d,Oe))}if(C){let Ce=d.getValueAndResolveTokens("icon-image",Oe,u,G);De=Ce instanceof Gi?Ce:Gi.fromString(Ce)}if(!Ae&&!De)continue;let Qe=this.sortFeaturesByKey?k.evaluate(Oe,{},u):void 0;if(this.features.push({id:te,text:Ae,icon:De,index:ae,sourceLayerIndex:me,geometry:Oe.geometry,properties:le.properties,type:iK[le.type],sortKey:Qe}),De&&(z[De.name]=!0),Ae){let Ce=b.evaluate(Oe,{},u).join(","),Be=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Bn.vertical)>=0;for(let $e of Ae.sections)if($e.image)z[$e.image.name]=!0;else{let Fe=Lc(Ae.toString()),Ke=$e.fontStack||Ce,We=U[Ke]=U[Ke]||{};this.calculateGlyphDependencies($e.text,We,Be,this.allowVerticalPlacement,Fe)}}}_.get("symbol-placement")==="line"&&(this.features=function(le){let te={},ae={},me=[],ce=0;function Oe(Ce){me.push(le[Ce]),ce++}function Ae(Ce,Be,$e){let Fe=ae[Ce];return delete ae[Ce],ae[Be]=Fe,me[Fe].geometry[0].pop(),me[Fe].geometry[0]=me[Fe].geometry[0].concat($e[0]),Fe}function De(Ce,Be,$e){let Fe=te[Be];return delete te[Be],te[Ce]=Fe,me[Fe].geometry[0].shift(),me[Fe].geometry[0]=$e[0].concat(me[Fe].geometry[0]),Fe}function Qe(Ce,Be,$e){let Fe=$e?Be[0][Be[0].length-1]:Be[0][0];return`${Ce}:${Fe.x}:${Fe.y}`}for(let Ce=0;Ce<le.length;Ce++){let Be=le[Ce],$e=Be.geometry,Fe=Be.text?Be.text.toString():null;if(!Fe){Oe(Ce);continue}let Ke=Qe(Fe,$e),We=Qe(Fe,$e,!0);if(Ke in ae&&We in te&&ae[Ke]!==te[We]){let lt=De(Ke,We,$e),kt=Ae(Ke,We,me[lt].geometry);delete te[Ke],delete ae[We],ae[Qe(Fe,me[kt].geometry,!0)]=kt,me[lt].geometry=null}else Ke in ae?Ae(Ke,We,$e):We in te?De(Ke,We,$e):(Oe(Ce),te[Ke]=ce-1,ae[We]=ce-1)}return me.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,te)=>le.sortKey-te.sortKey)}update(e,r,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,u,p),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,u,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sO(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let u=this.lineVertexArray.length,p=e.segment;if(p!==void 0){let d=e.dist(r[p+1]),_=e.dist(r[p]),y={};for(let b=p+1;b<r.length;b++)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:d},b<r.length-1&&(d+=r[b+1].dist(r[b]));for(let b=p||0;b>=0;b--)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){let w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,r,u,p,d,_,y,b,w,S,O,C,k,z){let U=e.indexArray,G=e.layoutVertexArray,J=e.globeExtVertexArray,le=e.segments.prepareSegment(4*r.length,G,U,this.canOverlap?_.sortKey:void 0),te=this.glyphOffsetArray.length,ae=le.vertexLength,me=this.allowVerticalPlacement&&y===Bn.vertical?Math.PI/2:0,ce=_.text&&_.text.sections;for(let Ae=0;Ae<r.length;Ae++){let{tl:De,tr:Qe,bl:Ce,br:Be,tex:$e,pixelOffsetTL:Fe,pixelOffsetBR:Ke,minFontScaleX:We,minFontScaleY:lt,glyphOffset:kt,isSDF:Bt,sectionIndex:bt}=r[Ae],nt=le.vertexLength,Zt=kt[1];if(vy(G,w.x,w.y,De.x,Zt+De.y,$e.x,$e.y,u,Bt,Fe.x,Fe.y,We,lt),vy(G,w.x,w.y,Qe.x,Zt+Qe.y,$e.x+$e.w,$e.y,u,Bt,Ke.x,Fe.y,We,lt),vy(G,w.x,w.y,Ce.x,Zt+Ce.y,$e.x,$e.y+$e.h,u,Bt,Fe.x,Ke.y,We,lt),vy(G,w.x,w.y,Be.x,Zt+Be.y,$e.x+$e.w,$e.y+$e.h,u,Bt,Ke.x,Ke.y,We,lt),b){let Dt=b.anchor,pt=b.up;xy(J,Dt.x,Dt.y,Dt.z,pt[0],pt[1],pt[2]),xy(J,Dt.x,Dt.y,Dt.z,pt[0],pt[1],pt[2]),xy(J,Dt.x,Dt.y,Dt.z,pt[0],pt[1],pt[2]),xy(J,Dt.x,Dt.y,Dt.z,pt[0],pt[1],pt[2]),by(e.dynamicLayoutVertexArray,Dt.x,Dt.y,Dt.z,me)}else by(e.dynamicLayoutVertexArray,w.x,w.y,w.z,me);U.emplaceBack(nt,nt+1,nt+2),U.emplaceBack(nt+1,nt+2,nt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),Ae!==r.length-1&&bt===r[Ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,_,_.index,{},k,z,ce&&ce[bt])}let Oe=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,w.x,w.y,te,this.glyphOffsetArray.length-te,ae,S,O,w.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],y,0,!1,0,C,0)}_commitLayoutVertex(e,r,u,p,d,_,y){e.emplaceBack(r,u,p,d,_,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,u,p,d,_,y){let b=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),w=b.vertexLength,S=y.tileAnchorX,O=y.tileAnchorY;for(let k=0;k<4;k++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),u.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(u.layoutVertexArray,p,d,_,S,O,new q(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,d,_,S,O,new q(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,d,_,S,O,new q(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,d,_,S,O,new q(e.x1,e.y2)),b.vertexLength+=4;let C=u.indexArray;C.emplaceBack(w,w+1),C.emplaceBack(w+1,w+2),C.emplaceBack(w+2,w+3),C.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,u,p,d,_){for(let y=p;y<d;y++){let b=u.get(y),w=this.getSymbolInstanceTextSize(e,_,r,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,r,u,p,d,_){for(let y=p;y<d;y++){let b=u.get(y),w=this.getSymbolInstanceIconSize(e,r,y);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dx(zn,xA.members,zi),this.iconCollisionBox=new Dx(zn,xA.members,zi);let u=Gc(this.iconSizeData,e),p=Gc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let _=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(p,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(p,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,r,u,p){let d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:p),_=sy(this.textSizeData,e,d)/Ci;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,r,u){let p=this.icon.placedSymbolArray.get(u),d=sy(this.iconSizeData,e,p);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,u){e.emplaceBack(r,-u,-u),e.emplaceBack(r,u,-u),e.emplaceBack(r,u,u),e.emplaceBack(r,-u,u)}_updateTextDebugCollisionBoxes(e,r,u,p,d,_){for(let y=p;y<d;y++){let b=u.get(y),w=this.getSymbolInstanceTextSize(e,_,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,r,u,p,d){for(let _=p;_<d;_++){let y=u.get(_),b=this.getSymbolInstanceIconSize(e,r,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=Gc(this.iconSizeData,e),p=Gc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let _=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(p,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(p,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(u,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,u,p,d,_,y,b,w){let S={};for(let O=r;O<u;O++){let C=e.get(O);S.textBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.textFeatureIndex=C.featureIndex;break}for(let O=p;O<d;O++){let C=e.get(O);S.verticalTextBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.verticalTextFeatureIndex=C.featureIndex;break}for(let O=_;O<y;O++){let C=e.get(O);S.iconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.iconFeatureIndex=C.featureIndex;break}for(let O=b;O<w;O++){let C=e.get(O);S.verticalIconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.verticalIconFeatureIndex=C.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let u=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){let u=e.placedSymbolArray.get(r),p=u.vertexStartIndex+4*u.numGlyphs;for(let d=u.vertexStartIndex;d<p;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),u=Math.cos(e),p=[],d=[],_=[];for(let y=0;y<this.symbolInstances.length;++y){_.push(y);let b=this.symbolInstances.get(y);p.push(0|Math.round(r*b.tileAnchorX+u*b.tileAnchorY)),d.push(b.featureIndex)}return _.sort((y,b)=>p[y]-p[b]||d[b]-d[y]),_}addToSortKeyRanges(e,r){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===r?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let u=this.symbolInstances.get(r);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,d,_)=>{p>=0&&_.indexOf(p)===d&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}dt(Fs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Fs.MAX_GLYPHS=65535,Fs.addDynamicAttributes=by;let aK=new ze({"symbol-placement":new he(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new he(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ge(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(qe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new he(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ge(qe.layout_symbol["icon-size"]),"icon-text-fit":new he(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new he(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ge(qe.layout_symbol["icon-image"]),"icon-rotate":new ge(qe.layout_symbol["icon-rotate"]),"icon-padding":new he(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new he(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new ge(qe.layout_symbol["icon-offset"]),"icon-anchor":new ge(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(qe.layout_symbol["text-rotation-alignment"]),"text-field":new ge(qe.layout_symbol["text-field"]),"text-font":new ge(qe.layout_symbol["text-font"]),"text-size":new ge(qe.layout_symbol["text-size"]),"text-max-width":new ge(qe.layout_symbol["text-max-width"]),"text-line-height":new ge(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new ge(qe.layout_symbol["text-letter-spacing"]),"text-justify":new ge(qe.layout_symbol["text-justify"]),"text-radial-offset":new ge(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new ge(qe.layout_symbol["text-anchor"]),"text-max-angle":new he(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new he(qe.layout_symbol["text-writing-mode"]),"text-rotate":new ge(qe.layout_symbol["text-rotate"]),"text-padding":new he(qe.layout_symbol["text-padding"]),"text-keep-upright":new he(qe.layout_symbol["text-keep-upright"]),"text-transform":new ge(qe.layout_symbol["text-transform"]),"text-offset":new ge(qe.layout_symbol["text-offset"]),"text-allow-overlap":new he(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(qe.layout_symbol["text-ignore-placement"]),"text-optional":new he(qe.layout_symbol["text-optional"])});var Lx={paint:new ze({"icon-opacity":new ge(qe.paint_symbol["icon-opacity"]),"icon-color":new ge(qe.paint_symbol["icon-color"]),"icon-halo-color":new ge(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ge(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ge(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new he(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(qe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ge(qe.paint_symbol["text-opacity"]),"text-color":new ge(qe.paint_symbol["text-color"],{runtimeType:Rn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ge(qe.paint_symbol["text-halo-color"]),"text-halo-width":new ge(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new ge(qe.paint_symbol["text-halo-blur"]),"text-translate":new he(qe.paint_symbol["text-translate"]),"text-translate-anchor":new he(qe.paint_symbol["text-translate-anchor"])}),layout:aK};class lO{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_s,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dt(lO,"FormatSectionOverride",{omit:["defaultValue"]});class wy extends wo{constructor(e){super(e,Lx)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let p=[];for(let d of u)p.indexOf(d)<0&&p.push(d);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,u,p){let d=this.layout.get(e).evaluate(r,{},u,p),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Sc(_.value)||!d?d:function(y,b){return b.replace(/{([^{}]+)}/g,(w,S)=>S in y?String(y[S]):"")}(r.properties,d)}createBucket(e){return new Fs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Lx.paint.overridableProperties){if(!wy.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),u=new lO(r),p=new rf(u,r.property.specification),d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new nf("source",p):new Wl("composite",p,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new se(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,u){return!(!this.layout||r.isDataDriven()||u.isDataDriven())&&wy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let u=e.get("text-field"),p=Lx.paint.properties[r],d=!1,_=y=>{for(let b of y)if(p.overrides&&p.overrides.hasOverride(b))return void(d=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Vi)_(u.value.value.sections);else if(u.value.kind==="source"){let y=w=>{d||(w instanceof Dl&&Kr(w.value)===Pl?_(w.value.sections):w instanceof kl?_(w.sections):w.eachChild(y))},b=u.value;b._styleExpression&&y(b._styleExpression.expression)}return d}getProgramConfiguration(e){return new Ds(this,e)}}var sK={paint:new ze({"background-color":new he(qe.paint_background["background-color"]),"background-pattern":new Ye(qe.paint_background["background-pattern"]),"background-opacity":new he(qe.paint_background["background-opacity"])})},lK={paint:new ze({"raster-opacity":new he(qe.paint_raster["raster-opacity"]),"raster-hue-rotate":new he(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new he(qe.paint_raster["raster-saturation"]),"raster-contrast":new he(qe.paint_raster["raster-contrast"]),"raster-resampling":new he(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new he(qe.paint_raster["raster-fade-duration"])})};class uK extends wo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var cK={paint:new ze({"sky-type":new he(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(qe.paint_sky["sky-opacity"])})};function kx(i,e,r){let u=[0,0,1],p=VI([]);return $I(p,p,r?-ne(i)+Math.PI:ne(i)),GI(p,p,-ne(e)),NI(u,u,p),$i(u,u)}let hK={circle:class extends wo{constructor(i){super(i,mX)}createBucket(i){return new K0(i)}queryRadius(i){let e=i;return Fc("circle-radius",this,e)+Fc("circle-stroke-width",this,e)+Z_(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,u,p,d,_,y){let b=DI(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return WI(i,u,d,_,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Ds(this,i)}},heatmap:class extends wo{createBucket(i){return new HI(i)}constructor(i){super(i,wX),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Fc("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,u,p,d,_,y){let b=this.paint.get("heatmap-radius").evaluate(e,r);return WI(i,u,d,_,y,!0,!0,new q(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Ds(this,i)}},hillshade:class extends wo{constructor(i){super(i,TX)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends wo{constructor(i){super(i,NX)}getProgramIds(){let i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new Ds(this,i)}recalculate(i,e){super.recalculate(i,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ry(i)}queryRadius(){return Z_(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,u,p,d){return!i.queryGeometry.isAboveHorizon&&CI(RI(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends wo{constructor(i){super(i,QX)}createBucket(i){return new Rf(i)}queryRadius(){return Z_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Ds(this,i)}queryIntersectsFeature(i,e,r,u,p,d,_,y,b){let w=DI(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,r),O=this.paint.get("fill-extrusion-base").evaluate(e,r),C=[0,0],k=y&&d.elevation,z=d.elevation?d.elevation.exaggeration():1,U=i.tile.getBucket(this);if(k&&U instanceof Rf){let le=U.centroidVertexArray,te=b+1;if(te<le.length){let ae=le.get(te);C[0]=ae.a_centroid_pos0,C[1]=ae.a_centroid_pos1}}if(C[0]===0&&C[1]===1)return!1;d.projection.name==="globe"&&(u=pA([u],[new q(0,0),new q(Mt,Mt)],i.tileID.canonical).map(le=>le.polygon).flat());let G=function(le,te,ae,me,ce,Oe,Ae,De,Qe,Ce,Be){return le.projection.name==="globe"?function($e,Fe,Ke,We,lt,kt,Bt,bt,nt,Zt,Dt){let pt=[],Cr=[],Er=$e.projection.upVectorScale(Dt,$e.center.lat,$e.worldSize).metersToTile,zr=[0,0,0,1],Ft=[0,0,0,1],ir=(Sr,br,Lr,Ur)=>{Sr[0]=br,Sr[1]=Lr,Sr[2]=Ur,Sr[3]=1},Pr=hA();Ke>0&&(Ke+=Pr),We+=Pr;for(let Sr of Fe){let br=[],Lr=[];for(let Ur of Sr){let xi=Ur.x+lt.x,nn=Ur.y+lt.y,Kt=$e.projection.projectTilePoint(xi,nn,Dt),Zr=$e.projection.upVector(Dt,Ur.x,Ur.y),Fi=Ke,ur=We;if(Bt){let jr=_A(xi,nn,Ke,We,Bt,bt,nt,Zt);Fi+=jr.base,ur+=jr.top}Ke!==0?ir(zr,Kt.x+Zr[0]*Er*Fi,Kt.y+Zr[1]*Er*Fi,Kt.z+Zr[2]*Er*Fi):ir(zr,Kt.x,Kt.y,Kt.z),ir(Ft,Kt.x+Zr[0]*Er*ur,Kt.y+Zr[1]*Er*ur,Kt.z+Zr[2]*Er*ur),si(zr,zr,kt),si(Ft,Ft,kt),br.push(oy(zr)),Lr.push(oy(Ft))}pt.push(br),Cr.push(Lr)}return[pt,Cr]}(le,te,ae,me,ce,Oe,Ae,De,Qe,Ce,Be):Ae?function($e,Fe,Ke,We,lt,kt,Bt,bt,nt){let Zt=[],Dt=[],pt=[0,0,0,1];for(let Cr of $e){let Er=[],zr=[];for(let Ft of Cr){let ir=Ft.x+We.x,Pr=Ft.y+We.y,Sr=_A(ir,Pr,Fe,Ke,kt,Bt,bt,nt);pt[0]=ir,pt[1]=Pr,pt[2]=Sr.base,pt[3]=1,uu(pt,pt,lt),pt[3]=Math.max(pt[3],1e-5);let br=oy([pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]]);pt[0]=ir,pt[1]=Pr,pt[2]=Sr.top,pt[3]=1,uu(pt,pt,lt),pt[3]=Math.max(pt[3],1e-5);let Lr=oy([pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]]);Er.push(br),zr.push(Lr)}Zt.push(Er),Dt.push(zr)}return[Zt,Dt]}(te,ae,me,ce,Oe,Ae,De,Qe,Ce):function($e,Fe,Ke,We,lt){let kt=[],Bt=[],bt=lt[8]*Fe,nt=lt[9]*Fe,Zt=lt[10]*Fe,Dt=lt[11]*Fe,pt=lt[8]*Ke,Cr=lt[9]*Ke,Er=lt[10]*Ke,zr=lt[11]*Ke;for(let Ft of $e){let ir=[],Pr=[];for(let Sr of Ft){let br=Sr.x+We.x,Lr=Sr.y+We.y,Ur=lt[0]*br+lt[4]*Lr+lt[12],xi=lt[1]*br+lt[5]*Lr+lt[13],nn=lt[2]*br+lt[6]*Lr+lt[14],Kt=lt[3]*br+lt[7]*Lr+lt[15],Zr=Ur+bt,Fi=xi+nt,ur=nn+Zt,jr=Math.max(Kt+Dt,1e-5),Zi=Ur+pt,Br=xi+Cr,Jr=nn+Er,bi=Math.max(Kt+zr,1e-5),di=new q(Zr/jr,Fi/jr);di.z=ur/jr,ir.push(di);let Pi=new q(Zi/bi,Br/bi);Pi.z=Jr/bi,Pr.push(Pi)}kt.push(ir),Bt.push(Pr)}return[kt,Bt]}(te,ae,me,ce,Oe)}(d,u,O,S,w,_,k?y:null,C,z,d.center.lat,i.tileID.canonical),J=i.queryGeometry;return function(le,te,ae){let me=1/0;CI(ae,te)&&(me=mA(ae,te[0]));for(let ce=0;ce<te.length;ce++){let Oe=te[ce],Ae=le[ce];for(let De=0;De<Oe.length-1;De++){let Qe=Oe[De],Ce=[Qe,Oe[De+1],Ae[De+1],Ae[De],Qe];OI(ae,Ce)&&(me=Math.min(me,mA(ae,Ce)))}}return me!==1/0&&me}(G[0],G[1],J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends wo{constructor(i){super(i,yA),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof kp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=gA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ay(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Ds(this,i)}queryRadius(i){let e=i,r=vA(Fc("line-width",this,e),Fc("line-gap-width",this,e)),u=Fc("line-offset",this,e);return r/2+Math.abs(u)+Z_(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,u,p,d){if(i.queryGeometry.isAboveHorizon)return!1;let _=RI(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),y=i.pixelToTileUnitsFactor/2*vA(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(u=function(w,S){let O=[],C=new q(0,0);for(let k=0;k<w.length;k++){let z=w[k],U=[];for(let G=0;G<z.length;G++){let J=z[G-1],le=z[G],te=z[G+1],ae=G===0?C:le.sub(J)._unit()._perp(),me=G===z.length-1?C:te.sub(le)._unit()._perp(),ce=ae._add(me)._unit();ce._mult(1/(ce.x*me.x+ce.y*me.y)),U.push(ce._mult(S)._add(le))}O.push(U)}return O}(u,b*i.pixelToTileUnitsFactor)),function(w,S,O){for(let C=0;C<S.length;C++){let k=S[C];if(w.length>=3){for(let z=0;z<k.length;z++)if(su(w,k[z]))return!0}if(hX(w,k,O))return!0}return!1}(_,u,y)}isTileClipped(){return!0}},symbol:wy,background:class extends wo{constructor(i){super(i,sK)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends wo{constructor(i){super(i,lK)}getProgramIds(){return["raster"]}},sky:class extends wo{constructor(i){super(i,cK),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),p=!u,d=i.style.light,_=d.properties.get("position");return p&&d.properties.get("anchor")==="viewport"&&ot("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?kx(_.azimuthal,90-_.polar,e):kx(u[0],90-u[1],e)}let r=this.paint.get("sky-gradient-center");return kx(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class Hf{constructor(e,r,u,p){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(r,p)}update(e,r,u){let{width:p,height:d}=e,{context:_}=this,{gl:y}=_,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:S,ImageData:O,ImageBitmap:C}=g;if(y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),u||this.size&&this.size[0]===p&&this.size[1]===d){let{x:k,y:z}=u||{x:0,y:0};e instanceof b||e instanceof w||e instanceof S||e instanceof O||C&&e instanceof C?y.texSubImage2D(y.TEXTURE_2D,0,k,z,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,k,z,p,d,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[p,d],e instanceof b||e instanceof w||e instanceof S||e instanceof O||C&&e instanceof C?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,p,d,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){let{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class zx{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Ga({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let u=this.getKey(e,r);return this.positions[u]}trim(){let e=this.width,r=this.height=gr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,u){let p=[],d=e.length%2==1?-e[e.length-1]*u:0,_=e[0]*u,y=!0;p.push({left:d,right:_,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){y=!y;let S=e[w];d=b*u,b+=S,_=b*u,p.push({left:d,right:_,isDash:y,zeroLength:S===0})}return p}addRoundDash(e,r,u){let p=r/2;for(let d=-u;d<=u;d++){let _=this.width*(this.nextRow+u+d),y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);let S=Math.abs(w-b.left),O=Math.abs(w-b.right),C=Math.min(S,O),k,z=d/u*(p+1);if(b.isDash){let U=p-Math.abs(z);k=Math.sqrt(C*C+U*U)}else k=p-Math.sqrt(C*C+z*z);this.image.data[_+w]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){let w=e[b],S=e[b+1];w.zeroLength?e.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(b,1))}let u=e[0],p=e[e.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);let d=this.width*this.nextRow,_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let w=Math.abs(b-y.left),S=Math.abs(b-y.right),O=Math.min(w,S);this.image.data[d+b]=Math.max(0,Math.min(255,(y.isDash?O:-O)+r+128))}}addDash(e,r){let u=this.getKey(e,r);if(this.positions[u])return this.positions[u];let p=r==="round",d=p?7:0,_=2*d+1;if(this.nextRow+_>this.height)return ot("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let S=0;S<e.length;S++)e[S]<0&&(ot("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),y+=e[S];if(y!==0){let S=this.width/y,O=this.getDashRanges(e,this.width,S);p?this.addRoundDash(O,S,d):this.addRegularDash(O,r==="square"?.5*S:0)}let b=this.nextRow+d;this.nextRow+=_;let w={tl:[b,d],br:[y,0]};return this.positions[u]=w,w}}dt(zx,"LineAtlas");class pK{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fK{constructor(){this.tasks={},this.taskQueue=[],ei(["process"],this),this.invoker=new pK(this.process),this.nextId=0}add(e,r){let u=this.nextId++,p=function({type:d,isSymbolTile:_,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||_?d!=="parseTile"||_?d==="parseTile"&&_?300-y:d==="maybePrepare"&&_?400-y:500:200-y:100-y}(r);if(p===0){Xt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:e,metadata:r,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Xt();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let p=0;p<this.taskQueue.length;p++){let d=this.tasks[this.taskQueue[p]];d.priority<r&&(r=d.priority,e=p)}if(e===null)return null;let u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class uO{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let u=e[r];this._stringToNumber[u]=r,this._numberToString[r]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let dK=["tile","layer","source","sourceLayer","state"];class cO{constructor(e,r,u,p,d){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=u,this._y=p,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let r of dK)this[r]!==void 0&&(e[r]=this[r]);return e}}let Jn=32,ra=33,Ns=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,u=0,p=0,d=0,_=0,y=0;for(1&e?p=d=_=Jn:r=u=y=Jn;(e>>=1)>1;){let w=r+p>>1,S=u+d>>1;1&e?(p=r,d=u,r=_,u=y):(r=p,u=d,p=_,d=y),_=w,y=S}let b=4*i;Ns[b+0]=r,Ns[b+1]=u,Ns[b+2]=p,Ns[b+3]=d}let ia=new Uint16Array(2178),Us=new Uint8Array(1089),Ty=new Uint16Array(1089);function hO(i){return i===0?-.03125:i===32?.03125:0}var pO=Ne([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let fO={type:2,extent:Mt,loadGeometry:()=>[[new q(0,0),new q(8193,0),new q(8193,8193),new q(0,8193),new q(0,0)]]};class Bx{constructor(e,r,u,p,d){this.tileID=e,this.uid=pi(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(e){let r=e+this.timeAdded;r<dn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=pu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,u){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,d){let _={};if(!d)return _;for(let y of p){let b=y.layerIds.map(w=>d.getLayer(w)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(S=>S.id===w)[0]));for(let w of b)_[w.id]=y}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(let p in this.buckets){let d=this.buckets[p];if(d instanceof Fs){if(this.hasSymbolBuckets=!0,!u)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let p in this.buckets){let d=this.buckets[p];if(d instanceof Fs&&d.hasRTLText){this.hasRTLText=!0,W.isLoading()||W.isLoaded()||j()!=="deferred"||X();break}}this.queryPadding=0;for(let p in this.buckets){let d=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(p).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Yo}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(let u in this.buckets){let p=this.buckets[u];p.uploadPending()&&p.upload(e)}let r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hf(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hf(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hf(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,u,p,d,_,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:y,transform:_,params:d,tileTransform:this.tileTransform},e,r,u):{}}querySourceFeatures(e,r){let u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;let p=u.loadVTLayers(),d=r?r.sourceLayer:"",_=p._geojsonTileLayer||p[d];if(!_)return;let y=Yl(r&&r.filter),{z:b,x:w,y:S}=this.tileID.canonical,O={z:b,x:w,y:S};for(let C=0;C<_.length;C++){let k=_.feature(C);if(y.needGeometry){let G=au(k,!0);if(!y.filter(new Z(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!y.filter(new Z(this.tileID.overscaledZ),k))continue;let z=u.getId(k,d),U=new cO(k,b,w,S,z);U.tile=O,e.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let r=this.expirationTime;if(e.cacheControl){let u=Ir(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let u=Date.now(),p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{let d=this.expirationTime-r;d?this.expirationTime=u+Math.max(d,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;let u=this.latestFeatureIndex.loadVTLayers(),p=r.style.listImages();for(let d in this.buckets){if(!r.style.hasLayer(d))continue;let _=this.buckets[d],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=u[y],w=e[y];if(!b||!w||Object.keys(w).length===0)continue;if(_.update(w,b,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof ay||_ instanceof ry){let O=r.style._getSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&O&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(O.id,this.tileID)}let S=r&&r.style&&r.style.getLayer(d);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<dn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=dn.now()+e}setTexture(e,r){let u=r.context,p=u.gl;this.texture=r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Hf(u,e,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(e,r){let u={};for(let p of r)u[p]=!0;this.dependencies[e]=u}hasDependency(e,r){for(let u of e){let p=this.dependencies[u];if(p){for(let d of r)if(p[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;let u=Va(fO,this.tileID.canonical,this.tileTransform)[0],p=new at,d=new ka;for(let _=0;_<u.length;_++){let{x:y,y:b}=u[_];p.emplaceBack(y,b),d.emplaceBack(_)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(p,Nf.members),this._tileDebugSegments=oi.simpleSegment(0,0,p.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;let u=Va(fO,this.tileID.canonical,this.tileTransform)[0],p,d;if(this.isRaster){let _=function(y,b){let w=pu(y,b),S=Math.pow(2,y.z);for(let G=0;G<ra;G++)for(let J=0;J<ra;J++){let le=Yn((y.x+(J+hO(J))/Jn)/S),te=Oi((y.y+(G+hO(G))/Jn)/S),ae=b.project(le,te),me=G*ra+J;ia[2*me+0]=Math.round((ae.x*w.scale-w.x)*Mt),ia[2*me+1]=Math.round((ae.y*w.scale-w.y)*Mt)}Us.fill(0),Ty.fill(0);for(let G=2045;G>=0;G--){let J=4*G,le=Ns[J+0],te=Ns[J+1],ae=Ns[J+2],me=Ns[J+3],ce=le+ae>>1,Oe=te+me>>1,Ae=ce+Oe-te,De=Oe+le-ce,Qe=te*ra+le,Ce=me*ra+ae,Be=Oe*ra+ce,$e=Math.hypot((ia[2*Qe+0]+ia[2*Ce+0])/2-ia[2*Be+0],(ia[2*Qe+1]+ia[2*Ce+1])/2-ia[2*Be+1])>=16;if(Us[Be]=Us[Be]||($e?1:0),G<1022){let Fe=(te+De>>1)*ra+(le+Ae>>1),Ke=(me+De>>1)*ra+(ae+Ae>>1);Us[Be]=Us[Be]||Us[Fe]||Us[Ke]}}let O=new Tt,C=new jt,k=0;function z(G,J){let le=J*ra+G;return Ty[le]===0&&(O.emplaceBack(ia[2*le+0],ia[2*le+1],G*Mt/Jn,J*Mt/Jn),Ty[le]=++k),Ty[le]-1}function U(G,J,le,te,ae,me){let ce=G+le>>1,Oe=J+te>>1;if(Math.abs(G-ae)+Math.abs(J-me)>1&&Us[Oe*ra+ce])U(ae,me,G,J,ce,Oe),U(le,te,ae,me,ce,Oe);else{let Ae=z(G,J),De=z(le,te),Qe=z(ae,me);C.emplaceBack(Ae,De,Qe)}}return U(0,0,Jn,Jn,Jn,0),U(Jn,Jn,0,0,0,Jn),{vertices:O,indices:C}}(this.tileID.canonical,r);p=_.vertices,d=_.indices}else{p=new Tt,d=new jt;for(let{x:y,y:b}of u)p.emplaceBack(y,b,0,0);let _=K_(p.int16,void 0,4);for(let y=0;y<_.length;y+=3)d.emplaceBack(_[y],_[y+1],_[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(p,pO.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=oi.simpleSegment(0,0,p.length,d.length)}_makeGlobeTileDebugBuffers(e,r){let u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;let p=this.tileID.canonical,d=jf(YA(p,r)),_=Vf(r.zoom),y;_>0&&(y=ex(new Float64Array(16),r.globeMatrix));let b=(p.x+.5)/(1<<p.z)-Ko(r.center.lng),w=0;b>.5?w=-1:b<-.5&&(w=1),this._makeGlobeTileDebugBorderBuffer(e,p,r,d,y,_,w),this._makeGlobeTileDebugTextBuffer(e,p,r,d,y,_,w)}_globePoint(e,r,u,p,d,_,y,b){let w=Uf(e,r,u);if(_){let S=1<<u.z,O=[((e/Mt+u.x)/S+b)*p,(r/Mt+u.y)/S*p,0];si(O,O,_),w=xs(w,O,y)}return si(w,w,d)}_makeGlobeTileDebugBorderBuffer(e,r,u,p,d,_,y){let b=new at,w=new ka,S=new yt,O=(k,z,U,G,J)=>{let le=(U-k)/(J-1),te=(G-z)/(J-1),ae=b.length;for(let me=0;me<J;me++){let ce=k+me*le,Oe=z+me*te;b.emplaceBack(ce,Oe);let Ae=this._globePoint(ce,Oe,r,u.worldSize,p,d,_,y);S.emplaceBack(Ae[0],Ae[1],Ae[2]),w.emplaceBack(ae+me)}},C=Mt;O(0,0,C,0,16),O(C,0,C,C,16),O(C,C,0,C,16),O(0,C,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(b,Nf.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,HA.members),this._tileDebugSegments=oi.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugTextBuffer(e,r,u,p,d,_,y){let b=new at,w=new jt,S=new yt,O=25;w.reserve(32),b.reserve(O),S.reserve(O);let C=(k,z)=>O*k+z;for(let k=0;k<O;k++){let z=2048*k;for(let U=0;U<O;U++){let G=2048*U;b.emplaceBack(G,z);let J=this._globePoint(G,z,r,u.worldSize,p,d,_,y);S.emplaceBack(J[0],J[1],J[2])}}for(let k=0;k<4;k++)for(let z=0;z<4;z++){let U=C(k,z),G=C(k,z+1),J=C(k+1,z),le=C(k+1,z+1);w.emplaceBack(U,G,J),w.emplaceBack(J,G,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,Nf.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,HA.members),this._tileDebugTextSegments=oi.simpleSegment(0,0,O,32)}}class mK{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,u){let p=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},wt(this.stateChanges[e][p],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(let d in this.state[e])d!==p&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(let d in this.state[e][p])u[d]||(this.deletedStates[e][p][d]=null)}else for(let d in u)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][d]===null&&delete this.deletedStates[e][p][d]}removeFeatureState(e,r,u){if(this.deletedStates[e]===null)return;let p=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&r!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][u]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(u in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][u]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,r){let u=String(r),p=wt({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let d=this.deletedStates[e][r];if(d===null)return{};for(let _ in d)delete p[_]}return p}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){let u={};for(let p in this.stateChanges){this.state[p]=this.state[p]||{};let d={};for(let _ in this.stateChanges[p])this.state[p][_]||(this.state[p][_]={}),wt(this.state[p][_],this.stateChanges[p][_]),d[_]=this.state[p][_];u[p]=d}for(let p in this.deletedStates){this.state[p]=this.state[p]||{};let d={};if(this.deletedStates[p]===null)for(let _ in this.state[p])d[_]={},this.state[p][_]={};else for(let _ in this.deletedStates[p]){if(this.deletedStates[p][_]===null)this.state[p][_]={};else for(let y of Object.keys(this.deletedStates[p][_]))delete this.state[p][_][y];d[_]=this.state[p][_]}u[p]=u[p]||{},wt(u[p],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(let p in e)e[p].setFeatureState(u,r)}}class dO{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let u=this.toIdx(e,r);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function mO(i,e,r,u){let p=0,d=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(r[_]<i[_]||r[_]>e[_])return null}else{let y=1/u[_],b=(i[_]-r[_])*y,w=(e[_]-r[_])*y;if(b>w){let S=b;b=w,w=S}if(b>p&&(p=b),w<d&&(d=w),p>d)return null}return p}function _O(i,e,r,u,p,d,_,y,b,w,S){let O=u-i,C=p-e,k=d-r,z=_-i,U=y-e,G=b-r,J=S[1]*G-S[2]*U,le=S[2]*z-S[0]*G,te=S[0]*U-S[1]*z,ae=O*J+C*le+k*te;if(Math.abs(ae)<1e-15)return null;let me=1/ae,ce=w[0]-i,Oe=w[1]-e,Ae=w[2]-r,De=(ce*J+Oe*le+Ae*te)*me;if(De<0||De>1)return null;let Qe=Oe*k-Ae*C,Ce=Ae*O-ce*k,Be=ce*C-Oe*O,$e=(S[0]*Qe+S[1]*Ce+S[2]*Be)*me;return $e<0||De+$e>1?null:(z*Qe+U*Ce+G*Be)*me}function yO(i,e,r){return(i-e)/(r-e)}function gO(i,e,r,u,p,d,_,y,b){let w=1<<r,S=d-u,O=_-p,C=(i+1)/w*S+u,k=(e+0)/w*O+p,z=(e+1)/w*O+p;y[0]=(i+0)/w*S+u,y[1]=k,b[0]=C,b[1]=z}class vO{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(d){let _=Math.ceil(Math.log2(d.dim/8)),y=[],b=Math.ceil(Math.pow(2,_)),w=1/b,S=(k,z,U,G,J)=>{let le=G?1:0,te=(k+1)*U-le,ae=z*U,me=(z+1)*U-le;J[0]=k*U,J[1]=ae,J[2]=te,J[3]=me},O=new dO(b),C=[];for(let k=0;k<b*b;k++){S(k%b,Math.floor(k/b),w,!1,C);let z=js(C[0],C[1],d),U=js(C[2],C[1],d),G=js(C[2],C[3],d),J=js(C[0],C[3],d);O.minimums.push(Math.min(z,U,G,J)),O.maximums.push(Math.max(z,U,G,J)),O.leaves.push(1)}for(y.push(O),b/=2;b>=1;b/=2){let k=y[y.length-1];O=new dO(b);for(let z=0;z<b*b;z++){S(z%b,Math.floor(z/b),2,!0,C);let U=k.getElevation(C[0],C[1]),G=k.getElevation(C[2],C[1]),J=k.getElevation(C[2],C[3]),le=k.getElevation(C[0],C[3]),te=k.isLeaf(C[0],C[1]),ae=k.isLeaf(C[2],C[1]),me=k.isLeaf(C[2],C[3]),ce=k.isLeaf(C[0],C[3]),Oe=Math.min(U.min,G.min,J.min,le.min),Ae=Math.max(U.max,G.max,J.max,le.max),De=te&&ae&&me&&ce;O.maximums.push(Ae),O.minimums.push(Oe),O.leaves.push(Ae-Oe<=5&&De?1:0)}y.push(O)}return y}(this.dem),u=r.length-1,p=r[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(r,0,0,u,0)}raycastRoot(e,r,u,p,d,_,y=1){return mO([e,r,-100],[u,p,this.maximums[0]*y],d,_)}raycast(e,r,u,p,d,_,y=1){if(!this.nodeCount)return null;let b=this.raycastRoot(e,r,u,p,d,_,y);if(b==null)return null;let w=[],S=[],O=[],C=[],k=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;k.length>0;){let{idx:z,t:U,nodex:G,nodey:J,depth:le}=k.pop();if(this.leaves[z]){gO(G,J,le,e,r,u,p,O,C);let ae=1<<le,me=(G+0)/ae,ce=(G+1)/ae,Oe=(J+0)/ae,Ae=(J+1)/ae,De=js(me,Oe,this.dem)*y,Qe=js(ce,Oe,this.dem)*y,Ce=js(ce,Ae,this.dem)*y,Be=js(me,Ae,this.dem)*y,$e=_O(O[0],O[1],De,C[0],O[1],Qe,C[0],C[1],Ce,d,_),Fe=_O(C[0],C[1],Ce,O[0],C[1],Be,O[0],O[1],De,d,_),Ke=Math.min($e!==null?$e:Number.MAX_VALUE,Fe!==null?Fe:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{let We=Y_([],d,_,U);if(xO(De,Qe,Be,Ce,yO(We[0],O[0],C[0]),yO(We[1],O[1],C[1]))>=We[2])return U}continue}let te=0;for(let ae=0;ae<this._siblingOffset.length;ae++){gO((G<<1)+this._siblingOffset[ae][0],(J<<1)+this._siblingOffset[ae][1],le+1,e,r,u,p,O,C),O[2]=-100,C[2]=this.maximums[this.childOffsets[z]+ae]*y;let me=mO(O,C,d,_);if(me!=null){let ce=me;w[ae]=ce;let Oe=!1;for(let Ae=0;Ae<te&&!Oe;Ae++)ce>=w[S[Ae]]&&(S.splice(Ae,0,ae),Oe=!0);Oe||(S[te]=ae),te++}}for(let ae=0;ae<te;ae++){let me=S[ae];k.push({idx:this.childOffsets[z]+me,t:w[me],nodex:(G<<1)+this._siblingOffset[me][0],nodey:(J<<1)+this._siblingOffset[me][1],depth:le+1})}}return null}_addNode(e,r,u){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,u,p,d){if(e[p].isLeaf(r,u)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let _=p-1,y=e[_],b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){let O=2*r+this._siblingOffset[S][0],C=2*u+this._siblingOffset[S][1],k=y.getElevation(O,C),z=y.isLeaf(O,C),U=this._addNode(k.min,k.max,z);z&&(b|=1<<S),w||(w=U)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(e,2*r+this._siblingOffset[S][0],2*u+this._siblingOffset[S][1],_,w+S)}}function xO(i,e,r,u,p,d){return tr(tr(i,r,d),tr(e,u,d),p)}function js(i,e,r){let u=r.dim,p=He(i*u-.5,0,u-1),d=He(e*u-.5,0,u-1),_=Math.floor(p),y=Math.floor(d),b=Math.min(_+1,u-1),w=Math.min(y+1,u-1);return xO(r.get(_,y),r.get(b,y),r.get(_,w),r.get(b,w),p-_,d-y)}let bO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ey{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,u,p=!1,d=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return ot(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let _=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let b=0;b<_;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(_,b)]=y[this._idx(_-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,_)]=y[this._idx(b,_-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(_,-1)]=y[this._idx(_-1,0)],y[this._idx(-1,_)]=y[this._idx(0,_-1)],y[this._idx(_,_)]=y[this._idx(_-1,_-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new vO(this)}get(e,r,u=!1){u&&(e=He(e,-1,this.dim),r=He(r,-1,this.dim));let p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(e){return bO[e]}get unpackVector(){return bO[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,u){return(256*e*256+256*r+u)/10-1e4}_unpackTerrarium(e,r,u){return 256*e+r+u/256-32768}static pack(e,r){let u=[0,0,0,0],p=Ey.getUnpackVector(r),d=Math.floor((e+p[3])/p[2]);return u[2]=d%256,d=Math.floor(d/256),u[1]=d%256,d=Math.floor(d/256),u[0]=d,u}getPixels(){return new vn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,d=r*this.dim+this.dim,_=u*this.dim,y=u*this.dim+this.dim;switch(r){case-1:p=d-1;break;case 1:d=p+1}switch(u){case-1:_=y-1;break;case 1:y=_+1}let b=-r*this.dim,w=-u*this.dim;for(let S=_;S<y;S++)for(let O=p;O<d;O++){let C=4*this._idx(O,S),k=4*this._idx(O+b,S+w);this.pixels[C+0]=e.pixels[k+0],this.pixels[C+1]=e.pixels[k+1],this.pixels[C+2]=e.pixels[k+2],this.pixels[C+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}dt(Ey,"DEMData"),dt(vO,"DemMinMaxQuadTree",{omit:["dem"]});class _K{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(let e in this.data)for(let r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,u){let p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);let d={value:r,timeout:void 0};if(u!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},u)),this.data[p].push(d),this.order.push(p),this.order.length>this.max){let _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){let r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;let u=e.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),d=this.data[u][p];return this.data[u].splice(p,1),d.timeout&&clearTimeout(d.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(d.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){let r=[];for(let u in this.data)for(let p of this.data[u])e(p.value)||r.push(p);for(let u of r)this.remove(u.value.tileID,u)}}class Qc{constructor(e,r,u){this.func=e,this.mask=r,this.range=u}}Qc.ReadOnly=!1,Qc.ReadWrite=!0,Qc.disabled=new Qc(519,Qc.ReadOnly,[0,1]);let Fx=7680;class Nx{constructor(e,r,u,p,d,_){this.test=e,this.ref=r,this.mask=u,this.fail=p,this.depthFail=d,this.pass=_}}Nx.disabled=new Nx({func:519,mask:0},0,0,Fx,Fx,Fx);class na{constructor(e,r,u){this.blendFunction=e,this.blendColor=r,this.mask=u}}na.Replace=[1,0],na.disabled=new na(na.Replace,vr.transparent,[!1,!1,!1,!1]),na.unblended=new na(na.Replace,vr.transparent,[!0,!0,!0,!0]),na.alphaBlended=new na([1,771],vr.transparent,[!0,!0,!0,!0]);let Ux=1029,jx=2305;class Ao{constructor(e,r,u){this.enable=e,this.mode=r,this.frontFace=u}}Ao.disabled=new Ao(!1,Ux,jx),Ao.backCCW=new Ao(!0,Ux,jx),Ao.backCW=new Ao(!0,Ux,2304),Ao.frontCW=new Ao(!0,1028,2304),Ao.frontCCW=new Ao(!0,1028,jx);class fu extends Et{constructor(e,r,u){super(),this.id=e,this._onlySymbols=u,r.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new _K(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new mK,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(let r in this._tiles){let u=this._tiles[r];this._source.prepareTile(u)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,u.tileID),u.upload(e),u.prepare(this.map.style.imageManager)}else for(let r in this._tiles){let u=this._tiles[r];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Nt(this._tiles).map(e=>e.tileID).sort(wO).map(e=>e.key)}getRenderableIds(e){let r=[];for(let u in this._tiles)this._isIdRenderable(+u,e)&&r.push(this._tiles[u]);return e?r.sort((u,p)=>{let d=u.tileID,_=p.tileID,y=new q(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new q(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||b.y-y.y||b.x-y.x}).map(u=>u.tileID.key):r.map(u=>u.tileID).sort(wO).map(u=>u.key)}hasRenderableParent(e){let r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){let u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,e,r)))}_tileLoaded(e,r,u,p){if(p)if(e.state="errored",p.status!==404)this._source.fire(new mr(p,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=dn.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Tr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let r=this.getRenderableIds();for(let p=0;p<r.length;p++){let d=r[p];if(e.neighboringTiles&&e.neighboringTiles[d]){let _=this.getTileByID(d);u(e,_),u(_,e)}}function u(p,d){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let _=d.tileID.canonical.x-p.tileID.canonical.x,y=d.tileID.canonical.y-p.tileID.canonical.y,b=Math.pow(2,p.tileID.canonical.z),w=d.tileID.key;_===0&&y===0||Math.abs(y)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),d.dem&&p.dem&&(p.dem.backfillBorder(d.dem,_,y),p.neighboringTiles&&p.neighboringTiles[w]&&(p.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,u,p){for(let d in this._tiles){let _=this._tiles[d];if(p[d]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>u)continue;let y=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){let w=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[w.key],_&&_.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){p[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){let u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=e.overscaledZ-1;u>=r;u--){let p=e.scaledTo(u),d=this._getLoadedTile(p);if(d)return d}}_getLoadedTile(e){let r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;let u=Math.ceil(e.width/r)+1,p=Math.ceil(e.height/r)+1,d=Math.floor(u*p*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(y)}handleWrapJump(e){let r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){let u={};for(let p in this._tiles){let d=this._tiles[p];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),u[d.tileID.key]=d}this._tiles=u;for(let p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(let p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(e,r,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Wi(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(p=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(y=>this._source.hasTile(y)))):p=[];let d=this._updateRetainedTiles(p);if(TO(this._source.type)&&p.length!==0){let y={},b={},w=Object.keys(d);for(let O of w){let C=d[O],k=this._tiles[O];if(!k||k.fadeEndTime&&k.fadeEndTime<=dn.now())continue;let z=this.findLoadedParent(C,Math.max(C.overscaledZ-fu.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),y[z.tileID.key]=z.tileID),b[O]=C}let S=p[p.length-1].overscaledZ;for(let O in this._tiles){let C=this._tiles[O];if(d[O]||!C.hasData())continue;let k=C.tileID;for(;k.overscaledZ>S;){k=k.scaledTo(k.overscaledZ-1);let z=this._tiles[k.key];if(z&&z.hasData()&&b[k.key]){d[O]=C.tileID;break}}}for(let O in y)d[O]||(this._coveredTiles[O]=!0,d[O]=y[O])}for(let y in d)this._tiles[y].clearFadeHold();let _=function(y,b){let w=[];for(let S in y)S in b||w.push(S);return w}(this._tiles,d);for(let y of _){let b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let r={};if(e.length===0)return r;let u={},p=e.reduce((w,S)=>Math.min(w,S.overscaledZ),1/0),d=e[0].overscaledZ,_=Math.max(d-fu.maxOverzooming,this._source.minzoom),y=Math.max(d+fu.maxUnderzooming,this._source.minzoom),b={};for(let w of e){let S=this._addTile(w);r[w.key]=w,S.hasData()||p<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,p,y,r);for(let w of e){let S=this._tiles[w.key];if(S.hasData())continue;if(w.canonical.z>=this._source.maxzoom){let C=w.children(this._source.maxzoom)[0],k=this.getTile(C);if(k&&k.hasData()){r[C.key]=C;continue}}else{let C=w.children(this._source.maxzoom);if(r[C[0].key]&&r[C[1].key]&&r[C[2].key]&&r[C[3].key])continue}let O=S.wasRequested();for(let C=w.overscaledZ-1;C>=_;--C){let k=w.scaledTo(C);if(u[k.key]||(u[k.key]=!0,S=this.getTile(k),!S&&O&&(S=this._addTile(k)),S&&(r[k.key]=k,O=S.wasRequested(),S.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let r=[],u,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);let d=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(d),u)break;p=d}for(let d of r)this._loadedParentTiles[d]=u}}_addTile(e){let r=this._tiles[e.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));let u=Boolean(r);if(!u){let p=this.map?this.map.painter:null;r=new Bx(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,u||this._source.fire(new Tr("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let u=r.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){let r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,u){let p=[],d=this.transform;if(!d)return p;let _=d.projection.name==="globe",y=Ko(d.center.lng);for(let b in this._tiles){let w=this._tiles[b];if(u&&w.clearQueryDebugViz(),w.holdingForFade())continue;let S;if(_){let O=w.tileID.canonical;if(O.z===0){let C=[Math.abs(He(y,...Xf(O,-1))-y),Math.abs(He(y,...Xf(O,1))-y)];S=[0,2*C.indexOf(Math.min(...C))-1]}else{let C=[Math.abs(He(y,...Xf(O,-1))-y),Math.abs(He(y,...Xf(O,0))-y),Math.abs(He(y,...Xf(O,1))-y)];S=[C.indexOf(Math.min(...C))-1]}}else S=[0];for(let O of S){let C=e.containsTile(w,d,r,O);C&&p.push(C)}}return p}getVisibleCoordinates(e){let r=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(let u of r)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(TO(this._source.type))for(let e in this._tiles){let r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=dn.now())return!0}return!1}setFeatureState(e,r,u){this._state.updateState(e=e||"_geojsonTileLayer",r,u)}removeFeatureState(e,r,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,u)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,u){let p=this._tiles[e];p&&p.setDependencies(r,u)}reloadTilesForDependencies(e,r){for(let u in this._tiles)this._tiles[u].hasDependency(e,r)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(e,r))}_preloadTiles(e,r){let u=new Map,p=Array.isArray(e)?e:[e],d=this.map.painter.terrain,_=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(let y of p){let b=y.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let w of b)u.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}At(Array.from(u.values()),(y,b)=>{let w=new Bx(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,S=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),b(S,w)})},r)}}function wO(i,e){let r=Math.abs(2*i.wrap)-+(i.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||u-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function TO(i){return i==="raster"||i==="image"||i==="video"}function Xf(i,e){let r=1<<i.z;return[i.x/r+e,(i.x+1)/r+e]}fu.maxOverzooming=10,fu.maxUnderzooming=3;class Sy{constructor(e,r,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=u}static create(e,r,u){let p=u||e.findDEMTileFor(r);if(!p||!p.dem)return;let d=p.dem,_=p.tileID,y=1<<r.canonical.z-_.canonical.z;return new Sy(p,p.tileSize/Mt/y,[(r.canonical.x/y-_.canonical.x)*d.dim,(r.canonical.y/y-_.canonical.y)*d.dim])}tileCoordToPixel(e,r){let u=r*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(u);return new q(p,d)}getElevationAt(e,r,u,p){let d=e*this._scale+this._offset[0],_=r*this._scale+this._offset[1],y=Math.floor(d),b=Math.floor(_),w=this._dem;return p=!!p,u?tr(tr(w.get(y,b,p),w.get(y,b+1,p),_-b),tr(w.get(y+1,b,p),w.get(y+1,b+1,p),_-b),d-y):w.get(y,b,p)}getElevationAtPixel(e,r,u){return this._dem.get(e,r,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Xn(1,e)*this._dem.stride}}class EO{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ms(Mt,16,0),this.featureIndexArray=new fI,this.promoteId=r}insert(e,r,u,p,d,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,d,_);let b=this.grid;for(let w=0;w<r.length;w++){let S=r[w],O=[1/0,1/0,-1/0,-1/0];for(let C=0;C<S.length;C++){let k=S[C];O[0]=Math.min(O[0],k.x),O[1]=Math.min(O[1],k.y),O[2]=Math.max(O[2],k.x),O[3]=Math.max(O[3],k.y)}O[0]<Mt&&O[1]<Mt&&O[2]>=0&&O[3]>=0&&b.insert(y,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hu.VectorTile(new zf(this.rawTileData)).layers,this.sourceLayerCoder=new uO(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,u,p){this.loadVTLayers();let d=e.params||{},_=Yl(d.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(z,U,G,J)=>qI(y.bufferedTilespaceGeometry,z,U,G,J));S.sort(yK);let O=null;b.elevation&&S.length>0&&(O=Sy.create(b.elevation,this.tileID));let C={},k;for(let z=0;z<S.length;z++){let U=S[z];if(U===k)continue;k=U;let G=this.featureIndexArray.get(U),J=null;this.loadMatchingFeature(C,G,_,d.layers,d.availableImages,r,u,p,(le,te,ae,me=0)=>(J||(J=Va(le,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(y,le,ae,J,this.z,e.transform,e.pixelPosMatrix,O,me)))}return C}loadMatchingFeature(e,r,u,p,d,_,y,b,w){let{featureIndex:S,bucketIndex:O,sourceLayerIndex:C,layoutVertexArrayOffset:k}=r,z=this.bucketLayerIDs[O];if(p&&!function(le,te){for(let ae=0;ae<le.length;ae++)if(te.indexOf(le[ae])>=0)return!0;return!1}(p,z))return;let U=this.sourceLayerCoder.decode(C),G=this.vtLayers[U].feature(S);if(u.needGeometry){let le=au(G,!0);if(!u.filter(new Z(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!u.filter(new Z(this.tileID.overscaledZ),G))return;let J=this.getId(G,U);for(let le=0;le<z.length;le++){let te=z[le];if(p&&p.indexOf(te)<0)continue;let ae=_[te];if(!ae)continue;let me={};J!==void 0&&b&&(me=b.getState(ae.sourceLayer||"_geojsonTileLayer",J));let ce=wt({},y[te]);ce.paint=SO(ce.paint,ae.paint,G,me,d),ce.layout=SO(ce.layout,ae.layout,G,me,d);let Oe=!w||w(G,ae,me,k);if(!Oe)continue;let Ae=new cO(G,this.z,this.x,this.y,J);Ae.layer=ce;let De=e[te];De===void 0&&(De=e[te]=[]),De.push({featureIndex:S,feature:Ae,intersectionZ:Oe})}}lookupSymbolFeatures(e,r,u,p,d,_,y,b){let w={};this.loadVTLayers();let S=Yl(d);for(let O of e)this.loadMatchingFeature(w,{bucketIndex:u,sourceLayerIndex:p,featureIndex:O,layoutVertexArrayOffset:0},S,_,y,b,r);return w}loadFeature(e){let{featureIndex:r,sourceLayerIndex:u}=e;this.loadVTLayers();let p=this.sourceLayerCoder.decode(u),d=this.vtFeatures[p];if(d[r])return d[r];let _=this.vtLayers[p].feature(r);return d[r]=_,_}hasLayer(e){for(let r of this.bucketLayerIDs)for(let u of r)if(e===u)return!0;return!1}getId(e,r){let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u))),u}}function SO(i,e,r,u,p){return tt(i,(d,_)=>{let y=e instanceof fe?e.get(_):null;return y&&y.evaluate?y.evaluate(r,u,p):y})}function yK(i,e){return e-i}dt(EO,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class IO{constructor(e){let r={},u=[];for(let y in e){let b=e[y],w=r[y]={};for(let S in b.glyphs){let O=b.glyphs[+S];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;let C=O.metrics.localGlyph?2:1,k={x:0,y:0,w:O.bitmap.width+2*C,h:O.bitmap.height+2*C};u.push(k),w[S]=k}}let{w:p,h:d}=xx(u),_=new Ga({width:p||1,height:d||1});for(let y in e){let b=e[y];for(let w in b.glyphs){let S=b.glyphs[+w];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;let O=r[y][w],C=S.metrics.localGlyph?2:1;Ga.copy(S.bitmap,_,{x:0,y:0},{x:O.x+C,y:O.y+C},S.bitmap)}}this.image=_,this.positions=r}}dt(IO,"GlyphAtlas");class gK{constructor(e){this.tileID=new Wi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=pu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,u,p,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Yo;let _=new uO(Object.keys(e.layers).sort()),y=new EO(this.tileID,this.promoteId);y.bucketLayerIDs=[];let b={},w=new zx(256,256),S={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:u},O=r.familiesBySource[this.source];for(let me in O){let ce=e.layers[me];if(!ce)continue;let Oe=!1,Ae=!1;for(let Ce of O[me])Ce[0].type==="symbol"?Oe=!0:Ae=!0;if(this.isSymbolTile===!0&&!Oe||this.isSymbolTile===!1&&!Ae)continue;ce.version===1&&ot(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let De=_.encode(me),Qe=[];for(let Ce=0;Ce<ce.length;Ce++){let Be=ce.feature(Ce),$e=y.getId(Be,me);Qe.push({feature:Be,id:$e,index:Ce,sourceLayerIndex:De})}for(let Ce of O[me]){let Be=Ce[0];this.isSymbolTile!==void 0&&Be.type==="symbol"!==this.isSymbolTile||Be.minzoom&&this.zoom<Math.floor(Be.minzoom)||Be.maxzoom&&this.zoom>=Be.maxzoom||Be.visibility!=="none"&&(Vx(Ce,this.zoom,u),(b[Be.id]=Be.createBucket({index:y.bucketLayerIDs.length,layers:Ce,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:De,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Qe,S,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Ce.map($e=>$e.id)))}}let C,k,z,U;w.trim();let G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=tt(S.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(J).length?p.send("getGlyphs",{uid:this.uid,stacks:J},(me,ce)=>{C||(C=me,k=ce,ae.call(this))},void 0,!1,G):k={};let le=Object.keys(S.iconDependencies);le.length?p.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(me,ce)=>{C||(C=me,z=ce,ae.call(this))},void 0,!1,G):z={};let te=Object.keys(S.patternDependencies);function ae(){if(C)return d(C);if(k&&z&&U){let me=new IO(k),ce=new AA(z,U);for(let Oe in b){let Ae=b[Oe];Ae instanceof Fs?(Vx(Ae.layers,this.zoom,u),NY(Ae,k,me.positions,z,ce.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ae.hasPattern&&(Ae instanceof ay||Ae instanceof ry||Ae instanceof Rf)&&(Vx(Ae.layers,this.zoom,u),Ae.addFeatures(S,this.tileID.canonical,ce.patternPositions,u,this.tileTransform))}this.status="done",d(null,{buckets:Nt(b).filter(Oe=>!Oe.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:w,imageAtlas:ce,glyphMap:this.returnDependencies?k:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?me.positions:null})}}te.length?p.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"patterns"},(me,ce)=>{C||(C=me,U=ce,ae.call(this))},void 0,!1,G):U={},ae.call(this)}}function Vx(i,e,r){let u=new Z(e);for(let p of i)p.recalculate(u,r)}class AO{constructor(e){this.entries={},this.scheduler=e}request(e,r,u,p){let d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){let[_,y]=d.result;return this.scheduler?this.scheduler.add(()=>{p(_,y)},r):p(_,y),()=>{}}return d.callbacks.push(p),d.cancel||(d.cancel=u((_,y)=>{d.result=[_,y];for(let b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,y)},r):b(_,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(_=>_!==p),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function OO(i,e,r){let u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},p=>{let d=Te(i.request,(_,y,b,w)=>{_?p(_):y&&p(null,{vectorTile:r?void 0:new hu.VectorTile(new zf(y)),rawData:y,cacheControl:b,expires:w})});return()=>{d.cancel(),p()}},e)}t.ARRAY_TYPE=gn,t.AUTH_ERR_MSG=Ki,t.Aabb=rn,t.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ei(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Xt()?i:g,this.scheduler=new fK}send(i,e,r,u,p=!1,d){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[_]=r);let y=ti(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!r,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:qs(e,y)},y),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(i){let e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){let u=this.cancelCallbacks[r];delete this.cancelCallbacks[r],u&&u.cancel()}else if(e.mustQueue||Xt()){let u=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),u&&u.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){let r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Ql(e.error)):r(null,Ql(e.data)))}else{let r=ti(this.globalScope)?void 0:[],u=e.hasCallback?(d,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:d?qs(d):null,data:qs(_,r)},r)}:d=>{},p=Ql(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,p,u);else if(this.parent.getWorkerSource){let d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],p.source)[d[1]](p,u)}else u(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=ny,t.Color=vr,t.ColorMode=na,t.CullFaceMode=Ao,t.DEMData=Ey,t.DataConstantProperty=he,t.DedupedRequest=AO,t.DepthMode=Qc,t.EXTENT=Mt,t.Elevation=class{isDataAvailableAtPoint(i){let e=this._source();if(!e||i.y<0||i.y>1)return!1;let r=e.getSource().maxzoom,u=1<<r,p=Math.floor(i.x),d=Math.floor((i.x-p)*u),_=Math.floor(i.y*u),y=this.findDEMTileFor(new Wi(r,p,r,d,_));return!(!y||!y.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);let u=this._source();if(!u||i.y<0||i.y>1)return e;let p=u.getSource().maxzoom,d=1<<p,_=Math.floor(i.x),y=i.x-_,b=new Wi(p,_,p,Math.floor(y*d),Math.floor(i.y*d)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;let S=w.dem,O=1<<w.tileID.canonical.z,C=(y*O-w.tileID.canonical.x)*S.dim,k=(i.y*O-w.tileID.canonical.y)*S.dim,z=Math.floor(C),U=Math.floor(k);return(r?this.exaggeration():1)*tr(tr(S.get(z,U),S.get(z,U+1),k-U),tr(S.get(z+1,U),S.get(z+1,U+1),k-U),C-z)}getAtTileOffset(i,e,r){let u=1<<i.canonical.z;return this.getAtPointOrZero(new Bc(i.wrap+(i.canonical.x+e/Mt)/u,(i.canonical.y+r/Mt)/u))}getAtTileOffsetFunc(i,e,r,u){return p=>{let d=this.getAtTileOffset(i,p.x,p.y),_=u.upVector(i.canonical,p.x,p.y);return To(_,_,d*u.upVectorScale(i.canonical,e,r).metersToTile),_}}getForTilePoints(i,e,r,u){let p=Sy.create(this,i,u);return!!p&&(e.forEach(d=>{d[2]=this.exaggeration()*p.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(i){let e=this.findDEMTileFor(i);if(!e||!e.dem)return null;let r=e.dem.tree,u=e.tileID,p=1<<i.canonical.z-u.canonical.z,d=i.canonical.x/p-u.canonical.x,_=i.canonical.y/p-u.canonical.y,y=0;for(let b=0;b<i.canonical.z-u.canonical.z&&!r.leaves[y];b++){d*=2,_*=2;let w=2*Math.floor(_)+Math.floor(d);y=r.childOffsets[y]+w,d%=1,_%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=mr,t.EvaluationParameters=Z,t.Event=Tr,t.Evented=Et,t.FillExtrusionBucket=Rf,t.Frustum=ux,t.FrustumCorners=lx,t.GLOBE_METERS_TO_ECEF=Cx,t.GLOBE_RADIUS=Za,t.GLOBE_SCALE_MATCH_LATITUDE=45,t.GLOBE_ZOOM_THRESHOLD_MAX=6,t.GLOBE_ZOOM_THRESHOLD_MIN=5,t.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();for(let i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(let i of this._wireframeSegments)i.destroy()}}_createGrid(i){let e=new at,r=new jt,u=65;for(let p=0;p<u;p++)for(let d=0;d<u;d++)e.emplaceBack(d,p);this._gridSegments=[];for(let p=0,d=0;p<Yc.length;p++){let _=Yc[p];for(let b=0;b<_;b++)for(let w=0;w<64;w++){let S=b*u+w;r.emplaceBack(S+1,S,S+u),r.emplaceBack(S+u,S+u+1,S+1)}let y=64*_*2;this._gridSegments.push(oi.simpleSegment(0,d,(_+1)*u,y)),d+=y}this._gridBuffer=i.createVertexBuffer(e,Nf.members),this._gridIndexBuffer=i.createIndexBuffer(r,!0)}_createPoles(i){let e=new jt;for(let p=0;p<=64;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);let r=new Ai,u=new Ai;this._poleSegments=[];for(let p=0,d=0;p<5;p++){let _=360/(1<<p);r.emplaceBack(0,-Za,0,.5,0),u.emplaceBack(0,-Za,0,.5,1);for(let y=0;y<=64;y++){let b=y/64,w=tr(0,_,b),[S,O,C]=Kc(ZY,HY,w,Za);r.emplaceBack(S,O,C,b,0),u.emplaceBack(S,O,C,b,1)}this._poleSegments.push(oi.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,ZA,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,ZA,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){let r=new zi,u=64,p=u+1;this._wireframeSegments=[];for(let d=0,_=0;d<Yc.length;d++){let y=Yc[d];for(let w=0;w<y;w++)for(let S=0;S<u;S++){let O=w*p+S;r.emplaceBack(O,O+1),r.emplaceBack(O,O+p),r.emplaceBack(O,O+p+1)}let b=y*u*3;this._wireframeSegments.push(oi.simpleSegment(0,_,(y+1)*p,b)),_+=b}this._wireframeIndexBuffer=i.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},t.GlyphManager=Hc,t.ImagePosition=bx,t.LineAtlas=zx,t.LngLat=pr,t.LngLatBounds=Ls,t.LocalGlyphMode=Sx,t.MAX_MERCATOR_LATITUDE=Jo,t.MercatorCoordinate=Bc,t.ONE_EM=Ci,t.OverscaledTileID=Wi,t.Properties=ze,t.RGBAImage=vn,t.Ray=sx,t.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){let i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Tl,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Zn(i))return i;let r=Ji(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Zn(i))return i;let r=Ji(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e,r,u){if(!Zn(i))return i;let p=Ji(i);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),r&&p.params.push(`language=${r}`),u&&p.params.push(`worldview=${u}`),this._makeAPIURL(p,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,u){let p=Ji(i);return Zn(i)?(p.path=`/styles/v1${p.path}/sprite${e}${r}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${e}${r}`,mo(p))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Zn(i))return i;let u=Ji(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&u.authority!=="raster"&&r===512?"@2x":""}${No.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${Jt.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Jt.TILE_URL_VERSION}${u.path}`);let p=this._customAccessToken||function(d){for(let _ of d){let y=_.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(u.params)||Jt.ACCESS_TOKEN;return Jt.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(i,e){let r=Ji(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let u="mapbox://";r.path.match(/^\/raster\/v1\//)?u+=`raster/${r.path.replace(`/${Jt.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${r.path.replace(`/${Jt.TILE_URL_VERSION}/`,"")}`;let p=r.params;return e&&(p=p.filter(d=>!d.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(i,e){let r=!!e&&Zn(e),u=[];for(let p of i.tiles||[])Pa(p)?u.push(this.canonicalizeTileURL(p,r)):u.push(p);return u}_makeAPIURL(i,e){let r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=Ji(Jt.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){let p=i.params.indexOf("secure");p>=0&&i.params.splice(p,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!Jt.REQUIRE_ACCESS_TOKEN)return mo(i);if(e=e||Jt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(p=>p.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),mo(i)}},t.ResourceType=_e,t.SegmentVector=oi,t.SourceCache=fu,t.StencilMode=Nx,t.StructArrayLayout1ui2=ka,t.StructArrayLayout2f1f2i16=xo,t.StructArrayLayout2i4=at,t.StructArrayLayout2ui4=zi,t.StructArrayLayout3f12=kr,t.StructArrayLayout3ui6=jt,t.StructArrayLayout4i8=Tt,t.StructArrayLayout5f20=Ai,t.Texture=Hf,t.Tile=Bx,t.Transitionable=ee,t.Uniform1f=V_,t.Uniform1i=class extends Na{constructor(i){super(i),this.current=0}set(i,e,r){this.fetchUniformLocation(i,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},t.Uniform2f=class extends Na{constructor(i){super(i),this.current=[0,0]}set(i,e,r){this.fetchUniformLocation(i,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},t.Uniform3f=class extends Na{constructor(i){super(i),this.current=[0,0,0]}set(i,e,r){this.fetchUniformLocation(i,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},t.Uniform4f=xI,t.UniformColor=bI,t.UniformMatrix2f=class extends Na{constructor(i){super(i),this.current=tX}set(i,e,r){if(this.fetchUniformLocation(i,e)){for(let u=0;u<4;u++)if(r[u]!==this.current[u]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},t.UniformMatrix3f=class extends Na{constructor(i){super(i),this.current=eX}set(i,e,r){if(this.fetchUniformLocation(i,e)){for(let u=0;u<9;u++)if(r[u]!==this.current[u]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},t.UniformMatrix4f=class extends Na{constructor(i){super(i),this.current=QH}set(i,e,r){if(this.fetchUniformLocation(i,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let u=1;u<16;u++)if(r[u]!==this.current[u]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},t.UnwrappedTileID=dA,t.ValidationError=ht,t.VectorTileWorkerSource=class extends Et{constructor(i,e,r,u,p){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=p||OO,this.loading={},this.loaded={},this.deduped=new AO(i.scheduler),this.isSpriteLoaded=u,this.scheduler=i.scheduler}loadTile(i,e){let r=i.uid,u=i&&i.request,p=u&&u.collectResourceTiming,d=this.loading[r]=new gK(i);d.abort=this.loadVectorData(i,(_,y)=>{let b=!this.loading[r];if(delete this.loading[r],b||_||!y)return d.status="done",b||(this.loaded[r]=d),e(_);let w=y.rawData,S={};y.expires&&(S.expires=y.expires),y.cacheControl&&(S.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new hu.VectorTile(new zf(w));let O=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,k)=>{if(C||!k)return e(C);let z={};if(p){let U=Ia(u);U.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,wt({rawTileData:w.slice(0)},k,S,z))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[r]=d})}reloadTile(i,e){let r=this.loaded,u=i.uid,p=this;if(r&&r[u]){let d=r[u];d.showCollisionBoxes=i.showCollisionBoxes,d.enableTerrain=!!i.enableTerrain,d.projection=i.projection,d.tileTransform=pu(i.tileID.canonical,i.projection);let _=(y,b)=>{let w=d.reloadCallback;w&&(delete d.reloadCallback,d.parse(d.vectorTile,p.layerIndex,this.availableImages,p.actor,w)),e(y,b)};d.status==="parsing"?d.reloadCallback=_:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,e){let r=i.uid,u=this.loading[r];u&&(u.abort&&u.abort(),delete this.loading[r]),e()}removeTile(i,e){let r=this.loaded,u=i.uid;r&&r[u]&&delete r[u],e()}},t.WritingMode=Bn,t.ZoomHistory=O_,t.add=ks,t.addDynamicAttributes=by,t.adjoint=function(i,e){var r=e[0],u=e[1],p=e[2],d=e[3],_=e[4],y=e[5],b=e[6],w=e[7],S=e[8];return i[0]=_*S-y*w,i[1]=p*w-u*S,i[2]=u*y-p*_,i[3]=y*b-d*S,i[4]=r*S-p*b,i[5]=p*d-r*y,i[6]=d*w-_*b,i[7]=u*b-r*w,i[8]=r*_-u*d,i},t.asyncAll=At,t.bezier=Ze,t.bindAll=ei,t.boundsAttributes=pO,t.bufferConvexPolygon=function(i,e){let r=[];for(let u=0;u<i.length;u++){let p=Yt(u-1,-1,i.length-1),d=Yt(u+1,-1,i.length-1),_=i[u],y=i[d],b=i[p].sub(_).unit(),w=y.sub(_).unit(),S=w.angleWithSep(b.x,b.y),O=b.add(w).unit().mult(-1*e/Math.sin(S/2));r.push(_.add(O))}return r},t.cacheEntryPossiblyAdded=function(i){re++,re>rc&&(i.getActor().send("enforceCacheSizeLimit",ms),re=0)},t.calculateGlobeLabelMatrix=function(i,e){let{x:r,y:u}=i.point,p=QA(r,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Nc(p,p,qx(ta(e)))},t.calculateGlobeMatrix=function(i){let{x:e,y:r}=i.point,{lng:u,lat:p}=i._center;return QA(e,r,i.worldSize,u,p)},t.calculateGlobeMercatorMatrix=function(i){let e=i.pixelsPerMeter,r=e/Xn(1,i.center.lat),u=Qo(new Float64Array(16));return Ef(u,u,[i.point.x,i.point.y,0]),lu(u,u,[r,r,e]),Float32Array.from(u)},t.circumferenceAtLatitude=Z0,t.clamp=He,t.clearTileCache=function(i){let e=Q(),r=[];for(let u in ji)e&&r.push(e.delete(u)),delete ji[u];i&&Promise.all(r).catch(i).then(()=>i())},t.clipLine=FA,t.clone=function(i){var e=new gn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},t.clone$1=Le,t.collisionCircleLayout=pY,t.config=Jt,t.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},t.create=function(){var i=new gn(16);return gn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},t.create$1=LI,t.createExpression=Is,t.createLayout=Ne,t.createStyleLayer=function(i){return i.type==="custom"?new uK(i):new hK[i.type](i)},t.cross=ax,t.degToRad=ne,t.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},t.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},t.dot=Kn,t.ease=et,t.easeCubicInOut=Re,t.emitValidationErrors=pf,t.endsWith=Me,t.enforceCacheSizeLimit=function(i){for(let e in ji)B(e),ji[e].then(r=>{r.keys().then(u=>{for(let p=0;p<u.length-i;p++)r.delete(u[p])})})},t.evaluateSizeForFeature=sy,t.evaluateSizeForZoom=Gc,t.evaluateVariableOffset=GA,t.evented=F,t.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},t.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},t.exported=dn,t.exported$1=No,t.extend=wt,t.extend$1=Qi,t.fillExtrusionHeightLift=hA,t.filterObject=ke,t.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},t.fromQuat=function(i,e){var r=e[0],u=e[1],p=e[2],d=e[3],_=r+r,y=u+u,b=p+p,w=r*_,S=u*_,O=u*y,C=p*_,k=p*y,z=p*b,U=d*_,G=d*y,J=d*b;return i[0]=1-O-z,i[1]=S+J,i[2]=C-G,i[3]=0,i[4]=S-J,i[5]=1-w-z,i[6]=k+U,i[7]=0,i[8]=C+G,i[9]=k-U,i[10]=1-w-O,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},t.fromRotation=function(i,e){var r=Math.sin(e),u=Math.cos(e);return i[0]=u,i[1]=r,i[2]=0,i[3]=-r,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},t.fromScaling=kI,t.furthestTileCorner=function(i){let e=Math.round((i+45+360)%360/90)%4;return Se[e]},t.getAABBPointSquareDist=function(i,e,r){let u=0;for(let p=0;p<2;++p){let d=r?r[p]:0;i[p]>d&&(u+=(i[p]-d)*(i[p]-d)),e[p]<d&&(u+=(d-e[p])*(d-e[p]))}return u},t.getAnchorAlignment=Ex,t.getAnchorJustification=Ax,t.getBounds=function(i){let e=1/0,r=1/0,u=-1/0,p=-1/0;for(let d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),u=Math.max(u,d.x),p=Math.max(p,d.y);return{min:new q(e,r),max:new q(u,p)}},t.getColumn=Li,t.getGridMatrix=function(i,e,r){let u=e.getNorth(),p=e.getSouth(),d=e.getWest(),_=.015625;return[0,(e.getEast()-d)*_,1<<i.z,(p-u)/Yc[r],0,i.y,u,d,_]},t.getImage=Pt,t.getJSON=function(i,e){return ye(wt(i,{type:"json"}),e)},t.getLatitudinalLod=function(i){let e=80.051129;i=He(i,-80.051129,e)/e*90;let r=Math.pow(Math.abs(Math.sin(ne(i))),3);return Math.round(r*(Yc.length-1))},t.getMapSessionAPI=Tp,t.getPerformanceMeasurement=Ia,t.getProjection=sO,t.getRTLTextPluginStatus=j,t.getReferrer=ve,t.getTilePoint=function(i,{x:e,y:r},u=0){return new q(((e-u)*i.scale-i.x)*Mt,(r*i.scale-i.y)*Mt)},t.getTileVec3=function(i,e,r=0){return Uc(((e.x-r)*i.scale-i.x)*Mt,(e.y*i.scale-i.y)*Mt,EI(e.z,e.y))},t.getVideo=function(i,e){let r=g.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let u=0;u<i.length;u++){let p=g.document.createElement("source");Xe(i[u])||(r.crossOrigin="Anonymous"),p.src=i[u],r.appendChild(p)}return{cancel:()=>{}}},t.globeCenterToScreenPoint=function(i){let e=[0,0,0],r=Qo(new Float64Array(16));return Nc(r,i.pixelMatrix,i.globeMatrix),si(e,e,r),new q(e[0],e[1])},t.globeDenormalizeECEF=qx,t.globeECEFOrigin=function(i,e){let r=[0,0,0];return si(r,r,jf(ta(e.canonical))),si(r,r,i),r},t.globeNormalizeECEF=jf,t.globePixelsToTileUnits=function(i,e){return Mt/(512*Math.pow(2,i))*_y(ta(e))},t.globePoleMatrixForTile=function(i,e,r){let u=Qo(new Float64Array(16)),p=(e/(1<<i)-.5)*Math.PI*2;return X_(u,r.globeMatrix,p),Float32Array.from(u)},t.globeTileBounds=ta,t.globeTiltAtLngLat=eO,t.globeToMercatorTransition=Vf,t.globeUseCustomAntiAliasing=function(i,e,r){let u=Vf(r.zoom),p=i.style.map._antialias,d=!!e.extStandardDerivatives,_=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!p&&!_&&d},t.identity=Qo,t.identity$1=VI,t.invert=ex,t.isFullscreen=function(){return!!g.document.fullscreenElement||!!g.document.webkitFullscreenElement},t.isLngLatBehindGlobe=function(i,e){return eO(i,e)>Math.PI/2*1.01},t.isMapAuthenticated=function(i){return Uo.has(i)},t.isMapboxURL=Zn,t.isSafariWithAntialiasingBug=function(i){let e=i.navigator?i.navigator.userAgent:null;return!!ti(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.latFromMercatorY=Oi,t.len=gX,t.length=Sf,t.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},t.loadVectorTile=OO,t.makeRequest=ye,t.mapValue=function(i,e,r,u,p){return He((i-e)/(r-e)*(p-u)+u,u,p)},t.mercatorScale=SI,t.mercatorXfromLng=Ko,t.mercatorYfromLat=ja,t.mercatorZfromAltitude=Xn,t.mul=_X,t.mul$1=yX,t.multiply=Nc,t.multiply$1=function(i,e,r){var u=e[0],p=e[1],d=e[2],_=e[3],y=e[4],b=e[5],w=e[6],S=e[7],O=e[8],C=r[0],k=r[1],z=r[2],U=r[3],G=r[4],J=r[5],le=r[6],te=r[7],ae=r[8];return i[0]=C*u+k*_+z*w,i[1]=C*p+k*y+z*S,i[2]=C*d+k*b+z*O,i[3]=U*u+G*_+J*w,i[4]=U*p+G*y+J*S,i[5]=U*d+G*b+J*O,i[6]=le*u+te*_+ae*w,i[7]=le*p+te*y+ae*S,i[8]=le*d+te*b+ae*O,i},t.multiply$2=FI,t.nextPowerOfTwo=gr,t.normalize=$i,t.normalize$1=function(i,e){var r=e[0],u=e[1],p=e[2],d=e[3],_=r*r+u*u+p*p+d*d;return _>0&&(_=1/Math.sqrt(_)),i[0]=r*_,i[1]=u*_,i[2]=p*_,i[3]=d*_,i},t.number=tr,t.ortho=function(i,e,r,u,p,d,_){var y=1/(e-r),b=1/(u-p),w=1/(d-_);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+r)*y,i[13]=(p+u)*b,i[14]=(_+d)*w,i[15]=1,i},t.pbf=zf,t.perspective=function(i,e,r,u,p){var d,_=1/Math.tan(e/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+u)*(d=1/(u-p)),i[14]=2*p*u*d):(i[10]=-1,i[14]=-2*u),i},t.pick=function(i,e){let r={};for(let u=0;u<e.length;u++){let p=e[u];p in i&&(r[p]=i[p])}return r},t.plugin=W,t.pointGeometry=q,t.polygonContainsPoint=su,t.polygonIntersectsBox=qI,t.polygonIntersectsPolygon=OI,t.polygonizeBounds=function(i,e,r=0,u=!0){let p=new q(r,r),d=i.sub(p),_=e.add(p),y=[d,new q(_.x,d.y),_,new q(d.x,_.y)];return u&&y.push(d.clone()),y},t.posAttributes=Nf,t.postMapLoadEvent=ec,t.postTurnstileEvent=Il,t.potpack=xx,t.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},t.radToDeg=Ie,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(i){return i({pluginStatus:E,pluginURL:A}),F.on("pluginStateChange",i),i},t.removeAuthState=function(i){Uo.delete(i)},t.renderColorRamp=hx,t.resample=II,t.rotateX=tx,t.rotateX$1=GI,t.rotateY=X_,t.rotateY$1=$I,t.rotateZ=function(i,e,r){var u=Math.sin(r),p=Math.cos(r),d=e[0],_=e[1],y=e[2],b=e[3],w=e[4],S=e[5],O=e[6],C=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*p+w*u,i[1]=_*p+S*u,i[2]=y*p+O*u,i[3]=b*p+C*u,i[4]=w*p-d*u,i[5]=S*p-_*u,i[6]=O*p-y*u,i[7]=C*p-b*u,i},t.rotateZ$1=function(i,e,r){r*=.5;var u=e[0],p=e[1],d=e[2],_=e[3],y=Math.sin(r),b=Math.cos(r);return i[0]=u*b+p*y,i[1]=p*b-u*y,i[2]=d*b+_*y,i[3]=_*b-d*y,i},t.scale=lu,t.scale$1=UI,t.scale$2=To,t.scaleAndAdd=Y_,t.setCacheLimits=function(i,e){ms=i,rc=e},t.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},t.setRTLTextPlugin=function(i,e,r=!1){if(E===m||E===v||E===x)throw new Error("setRTLTextPlugin cannot be called multiple times.");A=dn.resolveURL(i),E=m,T=e,D(),r||X()},t.smoothstep=It,t.spec=qe,t.storeAuthState=function(i,e){e?Uo.add(i):Uo.delete(i)},t.sub=Eo,t.subtract=ix,t.symbolSize=fY,t.tileAABB=function(i,e,r,u,p,d,_,y,b){if(b.name==="globe")return WY(i,e,new ny(r,u,p));let w=pu({z:r,x:u,y:p},b);return new rn([(d+w.x/w.scale)*e,e*(w.y/w.scale),_],[(d+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},t.tileCornersToBounds=dy,t.tileTransform=pu,t.transformMat3=function(i,e,r){var u=e[0],p=e[1],d=e[2];return i[0]=u*r[0]+p*r[3]+d*r[6],i[1]=u*r[1]+p*r[4]+d*r[7],i[2]=u*r[2]+p*r[5]+d*r[8],i},t.transformMat4=si,t.transformMat4$1=uu,t.transformQuat=NI,t.transitionTileAABBinECEF=YA,t.translate=Ef,t.transpose=function(i,e){if(i===e){var r=e[1],u=e[2],p=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=u,i[7]=p}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},t.triggerPluginCompletionEvent=R,t.uniqueId=pi,t.updateGlobeVertexNormal=function(i,e,r,u,p){let d=5*e+2;i.float32[d+0]=r,i.float32[d+1]=u,i.float32[d+2]=p},t.validateCustomStyleLayer=function(i){let e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFilter=i=>vo(Cs(i)),t.validateFog=i=>vo(E_(i)),t.validateLayer=i=>vo(Ac(i)),t.validateLight=i=>vo(T_(i)),t.validateSource=i=>vo(w_(i)),t.validateStyle=Pc,t.validateTerrain=i=>vo(Cc(i)),t.values=Nt,t.vectorTile=hu,t.version=Aa,t.warnOnce=ot,t.window=g,t.wrap=Yt}),o(["./shared"],function(t){"use strict";function g(Q){if(typeof Q=="number"||typeof Q=="boolean"||typeof Q=="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let N="[";for(let K of Q)N+=`${g(K)},`;return`${N}]`}let B="{";for(let N of Object.keys(Q).sort())B+=`${N}:${g(Q[N])},`;return`${B}}`}function I(Q){let B="";for(let N of t.refProperties)B+=`/${g(Q[N])}`;return B}class P{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,N){for(let re of B)this._layerConfigs[re.id]=re,(this._layers[re.id]=t.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(let re of N)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};let K=function(re,_e){let be={};for(let ye=0;ye<re.length;ye++){let Te=_e&&_e[re[ye].id]||I(re[ye]);_e&&(_e[re[ye].id]=Te);let Ge=be[Te];Ge||(Ge=be[Te]=[]),Ge.push(re[ye])}let ve=[];for(let ye in be)ve.push(be[ye]);return ve}(t.values(this._layerConfigs),this.keyCache);for(let re of K){let _e=re.map(ut=>this._layers[ut.id]),be=_e[0];if(be.visibility==="none")continue;let ve=be.source||"",ye=this.familiesBySource[ve];ye||(ye=this.familiesBySource[ve]={});let Te=be.sourceLayer||"_geojsonTileLayer",Ge=ye[Te];Ge||(Ge=ye[Te]=[]),Ge.push(_e)}}}class q{loadTile(B,N){let{uid:K,encoding:re,rawImageData:_e,padding:be,buildQuadTree:ve}=B,ye=t.window.ImageBitmap&&_e instanceof t.window.ImageBitmap?this.getImageData(_e,be):_e;N(null,new t.DEMData(K,ye,re,be<1,ve))}getImageData(B,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);let K=this.offscreenCanvasContext.getImageData(-N,-N,B.width+2*N,B.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}var L=function Q(B,N){var K,re=B&&B.type;if(re==="FeatureCollection")for(K=0;K<B.features.length;K++)Q(B.features[K],N);else if(re==="GeometryCollection")for(K=0;K<B.geometries.length;K++)Q(B.geometries[K],N);else if(re==="Feature")Q(B.geometry,N);else if(re==="Polygon")V(B.coordinates,N);else if(re==="MultiPolygon")for(K=0;K<B.coordinates.length;K++)V(B.coordinates[K],N);return B};function V(Q,B){if(Q.length!==0){oe(Q[0],B);for(var N=1;N<Q.length;N++)oe(Q[N],!B)}}function oe(Q,B){for(var N=0,K=0,re=0,_e=Q.length,be=_e-1;re<_e;be=re++){var ve=(Q[re][0]-Q[be][0])*(Q[be][1]+Q[re][1]),ye=N+ve;K+=Math.abs(N)>=Math.abs(ve)?N-ye+ve:ve-ye+N,N=ye}N+K>=0!=!!B&&Q.reverse()}let ne=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ie{constructor(B){this._feature=B,this.extent=t.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){let B=[];for(let N of this._feature.geometry)B.push([new t.pointGeometry(N[0],N[1])]);return B}{let B=[];for(let N of this._feature.geometry){let K=[];for(let re of N)K.push(new t.pointGeometry(re[0],re[1]));B.push(K)}return B}}toGeoJSON(B,N,K){return ne.call(this,B,N,K)}}class Se{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=B.length,this._features=B}feature(B){return new Ie(this._features[B])}}var Re=t.vectorTile.VectorTileFeature,Ze=et;function et(Q,B){this.options=B||{},this.features=Q,this.length=Q.length}function He(Q,B){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=B||4096}et.prototype.feature=function(Q){return new He(this.features[Q],this.options.extent)},He.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var B=0;B<Q.length;B++){for(var N=Q[B],K=[],re=0;re<N.length;re++)K.push(new t.pointGeometry(N[re][0],N[re][1]));this.geometry.push(K)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,B=1/0,N=-1/0,K=1/0,re=-1/0,_e=0;_e<Q.length;_e++)for(var be=Q[_e],ve=0;ve<be.length;ve++){var ye=be[ve];B=Math.min(B,ye.x),N=Math.max(N,ye.x),K=Math.min(K,ye.y),re=Math.max(re,ye.y)}return[B,K,N,re]},He.prototype.toGeoJSON=Re.prototype.toGeoJSON;var It=At,Yt=Ze;function At(Q){var B=new t.pbf;return function(N,K){for(var re in N.layers)K.writeMessage(3,Nt,N.layers[re])}(Q,B),B.finish()}function Nt(Q,B){var N;B.writeVarintField(15,Q.version||1),B.writeStringField(1,Q.name||""),B.writeVarintField(5,Q.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<Q.length;N++)K.feature=Q.feature(N),B.writeMessage(2,wt,K);var re=K.keys;for(N=0;N<re.length;N++)B.writeStringField(3,re[N]);var _e=K.values;for(N=0;N<_e.length;N++)B.writeMessage(4,ni,_e[N])}function wt(Q,B){var N=Q.feature;N.id!==void 0&&B.writeVarintField(1,N.id),B.writeMessage(2,Ht,Q),B.writeVarintField(3,N.type),B.writeMessage(4,gr,N)}function Ht(Q,B){var N=Q.feature,K=Q.keys,re=Q.values,_e=Q.keycache,be=Q.valuecache;for(var ve in N.properties){var ye=N.properties[ve],Te=_e[ve];if(ye!==null){Te===void 0&&(K.push(ve),_e[ve]=Te=K.length-1),B.writeVarint(Te);var Ge=typeof ye;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(ye=JSON.stringify(ye));var ut=Ge+":"+ye,Xe=be[ut];Xe===void 0&&(re.push(ye),be[ut]=Xe=re.length-1),B.writeVarint(Xe)}}}function pi(Q,B){return(B<<3)+(7&Q)}function yi(Q){return Q<<1^Q>>31}function gr(Q,B){for(var N=Q.loadGeometry(),K=Q.type,re=0,_e=0,be=N.length,ve=0;ve<be;ve++){var ye=N[ve],Te=1;K===1&&(Te=ye.length),B.writeVarint(pi(1,Te));for(var Ge=K===3?ye.length-1:ye.length,ut=0;ut<Ge;ut++){ut===1&&K!==1&&B.writeVarint(pi(2,Ge-1));var Xe=ye[ut].x-re,St=ye[ut].y-_e;B.writeVarint(yi(Xe)),B.writeVarint(yi(St)),re+=Xe,_e+=St}K===3&&B.writeVarint(pi(7,1))}}function ni(Q,B){var N=typeof Q;N==="string"?B.writeStringField(1,Q):N==="boolean"?B.writeBooleanField(7,Q):N==="number"&&(Q%1!=0?B.writeDoubleField(3,Q):Q<0?B.writeSVarintField(6,Q):B.writeVarintField(5,Q))}function ei(Q,B,N,K,re,_e){if(re-K<=N)return;let be=K+re>>1;Me(Q,B,be,K,re,_e%2),ei(Q,B,N,K,be-1,_e+1),ei(Q,B,N,be+1,re,_e+1)}function Me(Q,B,N,K,re,_e){for(;re>K;){if(re-K>600){let Te=re-K+1,Ge=N-K+1,ut=Math.log(Te),Xe=.5*Math.exp(2*ut/3),St=.5*Math.sqrt(ut*Xe*(Te-Xe)/Te)*(Ge-Te/2<0?-1:1);Me(Q,B,N,Math.max(K,Math.floor(N-Ge*Xe/Te+St)),Math.min(re,Math.floor(N+(Te-Ge)*Xe/Te+St)),_e)}let be=B[2*N+_e],ve=K,ye=re;for(tt(Q,B,K,N),B[2*re+_e]>be&&tt(Q,B,K,re);ve<ye;){for(tt(Q,B,ve,ye),ve++,ye--;B[2*ve+_e]<be;)ve++;for(;B[2*ye+_e]>be;)ye--}B[2*K+_e]===be?tt(Q,B,K,ye):(ye++,tt(Q,B,ye,re)),ye<=N&&(K=ye+1),N<=ye&&(re=ye-1)}}function tt(Q,B,N,K){ke(Q,N,K),ke(B,2*N,2*K),ke(B,2*N+1,2*K+1)}function ke(Q,B,N){let K=Q[B];Q[B]=Q[N],Q[N]=K}function Le(Q,B,N,K){let re=Q-N,_e=B-K;return re*re+_e*_e}It.fromVectorTileJs=At,It.fromGeojsonVt=function(Q,B){B=B||{};var N={};for(var K in Q)N[K]=new Ze(Q[K].features,B),N[K].name=K,N[K].version=B.version,N[K].extent=B.extent;return At({layers:N})},It.GeoJSONWrapper=Yt;let rt=Q=>Q[0],ot=Q=>Q[1];class vt{constructor(B,N=rt,K=ot,re=64,_e=Float64Array){this.nodeSize=re,this.points=B;let be=B.length<65536?Uint16Array:Uint32Array,ve=this.ids=new be(B.length),ye=this.coords=new _e(2*B.length);for(let Te=0;Te<B.length;Te++)ve[Te]=Te,ye[2*Te]=N(B[Te]),ye[2*Te+1]=K(B[Te]);ei(ve,ye,re,0,ve.length-1,0)}range(B,N,K,re){return function(_e,be,ve,ye,Te,Ge,ut){let Xe=[0,_e.length-1,0],St=[],Ot,xt;for(;Xe.length;){let Pt=Xe.pop(),Ut=Xe.pop(),dr=Xe.pop();if(Ut-dr<=ut){for(let Et=dr;Et<=Ut;Et++)Ot=be[2*Et],xt=be[2*Et+1],Ot>=ve&&Ot<=Te&&xt>=ye&&xt<=Ge&&St.push(_e[Et]);continue}let Tr=Math.floor((dr+Ut)/2);Ot=be[2*Tr],xt=be[2*Tr+1],Ot>=ve&&Ot<=Te&&xt>=ye&&xt<=Ge&&St.push(_e[Tr]);let mr=(Pt+1)%2;(Pt===0?ve<=Ot:ye<=xt)&&(Xe.push(dr),Xe.push(Tr-1),Xe.push(mr)),(Pt===0?Te>=Ot:Ge>=xt)&&(Xe.push(Tr+1),Xe.push(Ut),Xe.push(mr))}return St}(this.ids,this.coords,B,N,K,re,this.nodeSize)}within(B,N,K){return function(re,_e,be,ve,ye,Te){let Ge=[0,re.length-1,0],ut=[],Xe=ye*ye;for(;Ge.length;){let St=Ge.pop(),Ot=Ge.pop(),xt=Ge.pop();if(Ot-xt<=Te){for(let mr=xt;mr<=Ot;mr++)Le(_e[2*mr],_e[2*mr+1],be,ve)<=Xe&&ut.push(re[mr]);continue}let Pt=Math.floor((xt+Ot)/2),Ut=_e[2*Pt],dr=_e[2*Pt+1];Le(Ut,dr,be,ve)<=Xe&&ut.push(re[Pt]);let Tr=(St+1)%2;(St===0?be-ye<=Ut:ve-ye<=dr)&&(Ge.push(xt),Ge.push(Pt-1),Ge.push(Tr)),(St===0?be+ye>=Ut:ve+ye>=dr)&&(Ge.push(Pt+1),Ge.push(Ot),Ge.push(Tr))}return ut}(this.ids,this.coords,B,N,K,this.nodeSize)}}let nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Xt=Math.fround||(Ir=new Float32Array(1),Q=>(Ir[0]=+Q,Ir[0]));var Ir;class Yr{constructor(B){this.options=ho(Object.create(nr),B),this.trees=new Array(this.options.maxZoom+1)}load(B){let{log:N,minZoom:K,maxZoom:re,nodeSize:_e}=this.options;N&&console.time("total time");let be=`prepare ${B.length} points`;N&&console.time(be),this.points=B;let ve=[];for(let ye=0;ye<B.length;ye++)B[ye].geometry&&ve.push(co(B[ye],ye));this.trees[re+1]=new vt(ve,Oa,Wn,_e,Float32Array),N&&console.timeEnd(be);for(let ye=re;ye>=K;ye--){let Te=+Date.now();ve=this._cluster(ve,ye),this.trees[ye]=new vt(ve,Oa,Wn,_e,Float32Array),N&&console.log("z%d: %d clusters in %dms",ye,ve.length,+Date.now()-Te)}return N&&console.timeEnd("total time"),this}getClusters(B,N){let K=((B[0]+180)%360+360)%360-180,re=Math.max(-90,Math.min(90,B[1])),_e=B[2]===180?180:((B[2]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)K=-180,_e=180;else if(K>_e){let Ge=this.getClusters([K,re,180,be],N),ut=this.getClusters([-180,re,_e,be],N);return Ge.concat(ut)}let ve=this.trees[this._limitZoom(N)],ye=ve.range(Ia(K),Aa(be),Ia(_e),Aa(re)),Te=[];for(let Ge of ye){let ut=ve.points[Ge];Te.push(ut.numPoints?Li(ut):this.points[ut.index])}return Te}getChildren(B){let N=this._getOriginId(B),K=this._getOriginZoom(B),re="No cluster with the specified id.",_e=this.trees[K];if(!_e)throw new Error(re);let be=_e.points[N];if(!be)throw new Error(re);let ve=this.options.radius/(this.options.extent*Math.pow(2,K-1)),ye=_e.within(be.x,be.y,ve),Te=[];for(let Ge of ye){let ut=_e.points[Ge];ut.parentId===B&&Te.push(ut.numPoints?Li(ut):this.points[ut.index])}if(Te.length===0)throw new Error(re);return Te}getLeaves(B,N,K){let re=[];return this._appendLeaves(re,B,N=N||10,K=K||0,0),re}getTile(B,N,K){let re=this.trees[this._limitZoom(B)],_e=Math.pow(2,B),{extent:be,radius:ve}=this.options,ye=ve/be,Te=(K-ye)/_e,Ge=(K+1+ye)/_e,ut={features:[]};return this._addTileFeatures(re.range((N-ye)/_e,Te,(N+1+ye)/_e,Ge),re.points,N,K,_e,ut),N===0&&this._addTileFeatures(re.range(1-ye/_e,Te,1,Ge),re.points,_e,K,_e,ut),N===_e-1&&this._addTileFeatures(re.range(0,Te,ye/_e,Ge),re.points,-1,K,_e,ut),ut.features.length?ut:null}getClusterExpansionZoom(B){let N=this._getOriginZoom(B)-1;for(;N<=this.options.maxZoom;){let K=this.getChildren(B);if(N++,K.length!==1)break;B=K[0].properties.cluster_id}return N}_appendLeaves(B,N,K,re,_e){let be=this.getChildren(N);for(let ve of be){let ye=ve.properties;if(ye&&ye.cluster?_e+ye.point_count<=re?_e+=ye.point_count:_e=this._appendLeaves(B,ye.cluster_id,K,re,_e):_e<re?_e++:B.push(ve),B.length===K)break}return _e}_addTileFeatures(B,N,K,re,_e,be){for(let ve of B){let ye=N[ve],Te=ye.numPoints,Ge,ut,Xe;if(Te)Ge=fn(ye),ut=ye.x,Xe=ye.y;else{let xt=this.points[ye.index];Ge=xt.properties,ut=Ia(xt.geometry.coordinates[0]),Xe=Aa(xt.geometry.coordinates[1])}let St={type:1,geometry:[[Math.round(this.options.extent*(ut*_e-K)),Math.round(this.options.extent*(Xe*_e-re))]],tags:Ge},Ot;Te?Ot=ye.id:this.options.generateId?Ot=ye.index:this.points[ye.index].id&&(Ot=this.points[ye.index].id),Ot!==void 0&&(St.id=Ot),be.features.push(St)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,N){let K=[],{radius:re,extent:_e,reduce:be,minPoints:ve}=this.options,ye=re/(_e*Math.pow(2,N));for(let Te=0;Te<B.length;Te++){let Ge=B[Te];if(Ge.zoom<=N)continue;Ge.zoom=N;let ut=this.trees[N+1],Xe=ut.within(Ge.x,Ge.y,ye),St=Ge.numPoints||1,Ot=St;for(let xt of Xe){let Pt=ut.points[xt];Pt.zoom>N&&(Ot+=Pt.numPoints||1)}if(Ot>St&&Ot>=ve){let xt=Ge.x*St,Pt=Ge.y*St,Ut=be&&St>1?this._map(Ge,!0):null,dr=(Te<<5)+(N+1)+this.points.length;for(let Tr of Xe){let mr=ut.points[Tr];if(mr.zoom<=N)continue;mr.zoom=N;let Et=mr.numPoints||1;xt+=mr.x*Et,Pt+=mr.y*Et,mr.parentId=dr,be&&(Ut||(Ut=this._map(Ge,!0)),be(Ut,this._map(mr)))}Ge.parentId=dr,K.push(ti(xt/Ot,Pt/Ot,dr,Ot,Ut))}else if(K.push(Ge),Ot>1)for(let xt of Xe){let Pt=ut.points[xt];Pt.zoom<=N||(Pt.zoom=N,K.push(Pt))}}return K}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,N){if(B.numPoints)return N?ho({},B.properties):B.properties;let K=this.points[B.index].properties,re=this.options.map(K);return N&&re===K?ho({},re):re}}function ti(Q,B,N,K,re){return{x:Xt(Q),y:Xt(B),zoom:1/0,id:N,parentId:-1,numPoints:K,properties:re}}function co(Q,B){let[N,K]=Q.geometry.coordinates;return{x:Xt(Ia(N)),y:Xt(Aa(K)),zoom:1/0,index:B,parentId:-1}}function Li(Q){return{type:"Feature",id:Q.id,properties:fn(Q),geometry:{type:"Point",coordinates:[(B=Q.x,360*(B-.5)),er(Q.y)]}};var B}function fn(Q){let B=Q.numPoints,N=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return ho(ho({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:B,point_count_abbreviated:N})}function Ia(Q){return Q/360+.5}function Aa(Q){let B=Math.sin(Q*Math.PI/180),N=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return N<0?0:N>1?1:N}function er(Q){let B=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function ho(Q,B){for(let N in B)Q[N]=B[N];return Q}function Oa(Q){return Q.x}function Wn(Q){return Q.y}function dn(Q,B,N,K){for(var re,_e=K,be=N-B>>1,ve=N-B,ye=Q[B],Te=Q[B+1],Ge=Q[N],ut=Q[N+1],Xe=B+3;Xe<N;Xe+=3){var St=fs(Q[Xe],Q[Xe+1],ye,Te,Ge,ut);if(St>_e)re=Xe,_e=St;else if(St===_e){var Ot=Math.abs(Xe-be);Ot<ve&&(re=Xe,ve=Ot)}}_e>K&&(re-B>3&&dn(Q,B,re,K),Q[re+2]=_e,N-re>3&&dn(Q,re,N,K))}function fs(Q,B,N,K,re,_e){var be=re-N,ve=_e-K;if(be!==0||ve!==0){var ye=((Q-N)*be+(B-K)*ve)/(be*be+ve*ve);ye>1?(N=re,K=_e):ye>0&&(N+=be*ye,K+=ve*ye)}return(be=Q-N)*be+(ve=B-K)*ve}function Jt(Q,B,N,K){var re={id:Q===void 0?null:Q,type:B,geometry:N,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var be=_e.geometry,ve=_e.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")No(_e,be);else if(ve==="Polygon"||ve==="MultiLineString")for(var ye=0;ye<be.length;ye++)No(_e,be[ye]);else if(ve==="MultiPolygon")for(ye=0;ye<be.length;ye++)for(var Te=0;Te<be[ye].length;Te++)No(_e,be[ye][Te])}(re),re}function No(Q,B){for(var N=0;N<B.length;N+=3)Q.minX=Math.min(Q.minX,B[N]),Q.minY=Math.min(Q.minY,B[N+1]),Q.maxX=Math.max(Q.maxX,B[N]),Q.maxY=Math.max(Q.maxY,B[N+1])}function po(Q,B,N,K){if(B.geometry){var re=B.geometry.coordinates,_e=B.geometry.type,be=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),ve=[],ye=B.id;if(N.promoteId?ye=B.properties[N.promoteId]:N.generateId&&(ye=K||0),_e==="Point")fo(re,ve);else if(_e==="MultiPoint")for(var Te=0;Te<re.length;Te++)fo(re[Te],ve);else if(_e==="LineString")Ca(re,ve,be,!1);else if(_e==="MultiLineString"){if(N.lineMetrics){for(Te=0;Te<re.length;Te++)Ca(re[Te],ve=[],be,!1),Q.push(Jt(ye,"LineString",ve,B.properties));return}ds(re,ve,be,!1)}else if(_e==="Polygon")ds(re,ve,be,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(Te=0;Te<B.geometry.geometries.length;Te++)po(Q,{id:ye,geometry:B.geometry.geometries[Te],properties:B.properties},N,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Te=0;Te<re.length;Te++){var Ge=[];ds(re[Te],Ge,be,!0),ve.push(Ge)}}Q.push(Jt(ye,_e,ve,B.properties))}}function fo(Q,B){B.push(wl(Q[0])),B.push(Tl(Q[1])),B.push(0)}function Ca(Q,B,N,K){for(var re,_e,be=0,ve=0;ve<Q.length;ve++){var ye=wl(Q[ve][0]),Te=Tl(Q[ve][1]);B.push(ye),B.push(Te),B.push(0),ve>0&&(be+=K?(re*Te-ye*_e)/2:Math.sqrt(Math.pow(ye-re,2)+Math.pow(Te-_e,2))),re=ye,_e=Te}var Ge=B.length-3;B[2]=1,dn(B,0,Ge,N),B[Ge+2]=1,B.size=Math.abs(be),B.start=0,B.end=B.size}function ds(Q,B,N,K){for(var re=0;re<Q.length;re++){var _e=[];Ca(Q[re],_e,N,K),B.push(_e)}}function wl(Q){return Q/360+.5}function Tl(Q){var B=Math.sin(Q*Math.PI/180),N=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return N<0?0:N>1?1:N}function Ki(Q,B,N,K,re,_e,be,ve){if(K/=B,_e>=(N/=B)&&be<K)return Q;if(be<N||_e>=K)return null;for(var ye=[],Te=0;Te<Q.length;Te++){var Ge=Q[Te],ut=Ge.geometry,Xe=Ge.type,St=re===0?Ge.minX:Ge.minY,Ot=re===0?Ge.maxX:Ge.maxY;if(St>=N&&Ot<K)ye.push(Ge);else if(!(Ot<N||St>=K)){var xt=[];if(Xe==="Point"||Xe==="MultiPoint")Zn(ut,xt,N,K,re);else if(Xe==="LineString")Pa(ut,xt,N,K,re,!1,ve.lineMetrics);else if(Xe==="MultiLineString")Ji(ut,xt,N,K,re,!1);else if(Xe==="Polygon")Ji(ut,xt,N,K,re,!0);else if(Xe==="MultiPolygon")for(var Pt=0;Pt<ut.length;Pt++){var Ut=[];Ji(ut[Pt],Ut,N,K,re,!0),Ut.length&&xt.push(Ut)}if(xt.length){if(ve.lineMetrics&&Xe==="LineString"){for(Pt=0;Pt<xt.length;Pt++)ye.push(Jt(Ge.id,Xe,xt[Pt],Ge.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(xt.length===1?(Xe="LineString",xt=xt[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=xt.length===3?"Point":"MultiPoint"),ye.push(Jt(Ge.id,Xe,xt,Ge.tags))}}}return ye.length?ye:null}function Zn(Q,B,N,K,re){for(var _e=0;_e<Q.length;_e+=3){var be=Q[_e+re];be>=N&&be<=K&&(B.push(Q[_e]),B.push(Q[_e+1]),B.push(Q[_e+2]))}}function Pa(Q,B,N,K,re,_e,be){for(var ve,ye,Te=Ju(Q),Ge=re===0?Qu:El,ut=Q.start,Xe=0;Xe<Q.length-3;Xe+=3){var St=Q[Xe],Ot=Q[Xe+1],xt=Q[Xe+2],Pt=Q[Xe+3],Ut=Q[Xe+4],dr=re===0?St:Ot,Tr=re===0?Pt:Ut,mr=!1;be&&(ve=Math.sqrt(Math.pow(St-Pt,2)+Math.pow(Ot-Ut,2))),dr<N?Tr>N&&(ye=Ge(Te,St,Ot,Pt,Ut,N),be&&(Te.start=ut+ve*ye)):dr>K?Tr<K&&(ye=Ge(Te,St,Ot,Pt,Ut,K),be&&(Te.start=ut+ve*ye)):mo(Te,St,Ot,xt),Tr<N&&dr>=N&&(ye=Ge(Te,St,Ot,Pt,Ut,N),mr=!0),Tr>K&&dr<=K&&(ye=Ge(Te,St,Ot,Pt,Ut,K),mr=!0),!_e&&mr&&(be&&(Te.end=ut+ve*ye),B.push(Te),Te=Ju(Q)),be&&(ut+=ve)}var Et=Q.length-3;St=Q[Et],Ot=Q[Et+1],xt=Q[Et+2],(dr=re===0?St:Ot)>=N&&dr<=K&&mo(Te,St,Ot,xt),Et=Te.length-3,_e&&Et>=3&&(Te[Et]!==Te[0]||Te[Et+1]!==Te[1])&&mo(Te,Te[0],Te[1],Te[2]),Te.length&&B.push(Te)}function Ju(Q){var B=[];return B.size=Q.size,B.start=Q.start,B.end=Q.end,B}function Ji(Q,B,N,K,re,_e){for(var be=0;be<Q.length;be++)Pa(Q[be],B,N,K,re,_e,!1)}function mo(Q,B,N,K){Q.push(B),Q.push(N),Q.push(K)}function Qu(Q,B,N,K,re,_e){var be=(_e-B)/(K-B);return Q.push(_e),Q.push(N+(re-N)*be),Q.push(1),be}function El(Q,B,N,K,re,_e){var be=(_e-N)/(re-N);return Q.push(B+(K-B)*be),Q.push(_e),Q.push(1),be}function Sl(Q,B){for(var N=[],K=0;K<Q.length;K++){var re,_e=Q[K],be=_e.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")re=Il(_e.geometry,B);else if(be==="MultiLineString"||be==="Polygon"){re=[];for(var ve=0;ve<_e.geometry.length;ve++)re.push(Il(_e.geometry[ve],B))}else if(be==="MultiPolygon")for(re=[],ve=0;ve<_e.geometry.length;ve++){for(var ye=[],Te=0;Te<_e.geometry[ve].length;Te++)ye.push(Il(_e.geometry[ve][Te],B));re.push(ye)}N.push(Jt(_e.id,be,re,_e.tags))}return N}function Il(Q,B){var N=[];N.size=Q.size,Q.start!==void 0&&(N.start=Q.start,N.end=Q.end);for(var K=0;K<Q.length;K+=3)N.push(Q[K]+B,Q[K+1],Q[K+2]);return N}function Al(Q,B){if(Q.transformed)return Q;var N,K,re,_e=1<<Q.z,be=Q.x,ve=Q.y;for(N=0;N<Q.features.length;N++){var ye=Q.features[N],Te=ye.geometry,Ge=ye.type;if(ye.geometry=[],Ge===1)for(K=0;K<Te.length;K+=2)ye.geometry.push(ec(Te[K],Te[K+1],B,_e,be,ve));else for(K=0;K<Te.length;K++){var ut=[];for(re=0;re<Te[K].length;re+=2)ut.push(ec(Te[K][re],Te[K][re+1],B,_e,be,ve));ye.geometry.push(ut)}}return Q.transformed=!0,Q}function ec(Q,B,N,K,re,_e){return[Math.round(N*(Q*K-re)),Math.round(N*(B*K-_e))]}function tc(Q,B,N,K,re){for(var _e=B===re.maxZoom?0:re.tolerance/((1<<B)*re.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:K,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<Q.length;ve++){be.numFeatures++,Tp(be,Q[ve],_e,re);var ye=Q[ve].minX,Te=Q[ve].minY,Ge=Q[ve].maxX,ut=Q[ve].maxY;ye<be.minX&&(be.minX=ye),Te<be.minY&&(be.minY=Te),Ge>be.maxX&&(be.maxX=Ge),ut>be.maxY&&(be.maxY=ut)}return be}function Tp(Q,B,N,K){var re=B.geometry,_e=B.type,be=[];if(_e==="Point"||_e==="MultiPoint")for(var ve=0;ve<re.length;ve+=3)be.push(re[ve]),be.push(re[ve+1]),Q.numPoints++,Q.numSimplified++;else if(_e==="LineString")Uo(be,re,Q,N,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(ve=0;ve<re.length;ve++)Uo(be,re[ve],Q,N,_e==="Polygon",ve===0);else if(_e==="MultiPolygon")for(var ye=0;ye<re.length;ye++){var Te=re[ye];for(ve=0;ve<Te.length;ve++)Uo(be,Te[ve],Q,N,!0,ve===0)}if(be.length){var Ge=B.tags||null;if(_e==="LineString"&&K.lineMetrics){for(var ut in Ge={},B.tags)Ge[ut]=B.tags[ut];Ge.mapbox_clip_start=re.start/re.size,Ge.mapbox_clip_end=re.end/re.size}var Xe={geometry:be,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:Ge};B.id!==null&&(Xe.id=B.id),Q.features.push(Xe)}}function Uo(Q,B,N,K,re,_e){var be=K*K;if(K>0&&B.size<(re?be:K))N.numPoints+=B.length/3;else{for(var ve=[],ye=0;ye<B.length;ye+=3)(K===0||B[ye+2]>be)&&(N.numSimplified++,ve.push(B[ye]),ve.push(B[ye+1])),N.numPoints++;re&&function(Te,Ge){for(var ut=0,Xe=0,St=Te.length,Ot=St-2;Xe<St;Ot=Xe,Xe+=2)ut+=(Te[Xe]-Te[Ot])*(Te[Xe+1]+Te[Ot+1]);if(ut>0===Ge)for(Xe=0,St=Te.length;Xe<St/2;Xe+=2){var xt=Te[Xe],Pt=Te[Xe+1];Te[Xe]=Te[St-2-Xe],Te[Xe+1]=Te[St-1-Xe],Te[St-2-Xe]=xt,Te[St-1-Xe]=Pt}}(ve,_e),Q.push(ve)}}function _o(Q,B){var N=(B=this.options=function(re,_e){for(var be in _e)re[be]=_e[be];return re}(Object.create(this.options),B)).debug;if(N&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(re,_e){var be=[];if(re.type==="FeatureCollection")for(var ve=0;ve<re.features.length;ve++)po(be,re.features[ve],_e,ve);else po(be,re.type==="Feature"?re:{geometry:re},_e);return be}(Q,B);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(K=function(re,_e){var be=_e.buffer/_e.extent,ve=re,ye=Ki(re,1,-1-be,be,0,-1,2,_e),Te=Ki(re,1,1-be,2+be,0,-1,2,_e);return(ye||Te)&&(ve=Ki(re,1,-be,1+be,0,-1,2,_e)||[],ye&&(ve=Sl(ye,1).concat(ve)),Te&&(ve=ve.concat(Sl(Te,-1)))),ve}(K,B)).length&&this.splitTile(K,0,0,0),N&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ms(Q,B,N){return 32*((1<<Q)*N+B)+Q}function rc(Q,B){let N=Q.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);let K=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!K)return B(null,null);let re=new Se(K.features),_e=It(re);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),B(null,{vectorTile:re,rawData:_e.buffer})}_o.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_o.prototype.splitTile=function(Q,B,N,K,re,_e,be){for(var ve=[Q,B,N,K],ye=this.options,Te=ye.debug;ve.length;){K=ve.pop(),N=ve.pop(),B=ve.pop(),Q=ve.pop();var Ge=1<<B,ut=ms(B,N,K),Xe=this.tiles[ut];if(!Xe&&(Te>1&&console.time("creation"),Xe=this.tiles[ut]=tc(Q,B,N,K,ye),this.tileCoords.push({z:B,x:N,y:K}),Te)){Te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,N,K,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var St="z"+B;this.stats[St]=(this.stats[St]||0)+1,this.total++}if(Xe.source=Q,re){if(B===ye.maxZoom||B===re)continue;var Ot=1<<re-B;if(N!==Math.floor(_e/Ot)||K!==Math.floor(be/Ot))continue}else if(B===ye.indexMaxZoom||Xe.numPoints<=ye.indexMaxPoints)continue;if(Xe.source=null,Q.length!==0){Te>1&&console.time("clipping");var xt,Pt,Ut,dr,Tr,mr,Et=.5*ye.buffer/ye.extent,qe=.5-Et,Qi=.5+Et,Gr=1+Et;xt=Pt=Ut=dr=null,Tr=Ki(Q,Ge,N-Et,N+Qi,0,Xe.minX,Xe.maxX,ye),mr=Ki(Q,Ge,N+qe,N+Gr,0,Xe.minX,Xe.maxX,ye),Q=null,Tr&&(xt=Ki(Tr,Ge,K-Et,K+Qi,1,Xe.minY,Xe.maxY,ye),Pt=Ki(Tr,Ge,K+qe,K+Gr,1,Xe.minY,Xe.maxY,ye),Tr=null),mr&&(Ut=Ki(mr,Ge,K-Et,K+Qi,1,Xe.minY,Xe.maxY,ye),dr=Ki(mr,Ge,K+qe,K+Gr,1,Xe.minY,Xe.maxY,ye),mr=null),Te>1&&console.timeEnd("clipping"),ve.push(xt||[],B+1,2*N,2*K),ve.push(Pt||[],B+1,2*N,2*K+1),ve.push(Ut||[],B+1,2*N+1,2*K),ve.push(dr||[],B+1,2*N+1,2*K+1)}}},_o.prototype.getTile=function(Q,B,N){var K=this.options,re=K.extent,_e=K.debug;if(Q<0||Q>24)return null;var be=1<<Q,ve=ms(Q,B=(B%be+be)%be,N);if(this.tiles[ve])return Al(this.tiles[ve],re);_e>1&&console.log("drilling down to z%d-%d-%d",Q,B,N);for(var ye,Te=Q,Ge=B,ut=N;!ye&&Te>0;)Te--,Ge=Math.floor(Ge/2),ut=Math.floor(ut/2),ye=this.tiles[ms(Te,Ge,ut)];return ye&&ye.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Te,Ge,ut),_e>1&&console.time("drilling down"),this.splitTile(ye.source,Te,Ge,ut,Q,B,N),_e>1&&console.timeEnd("drilling down"),this.tiles[ve]?Al(this.tiles[ve],re):null):null};class ji extends t.VectorTileWorkerSource{constructor(B,N,K,re,_e){super(B,N,K,re,rc),_e&&(this.loadGeoJSON=_e)}loadData(B,N){let K=B&&B.request,re=K&&K.collectResourceTiming;this.loadGeoJSON(B,(_e,be)=>{if(_e||!be)return N(_e);if(typeof be!="object")return N(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{L(be,!0);try{if(B.filter){let ye=t.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));be={type:"FeatureCollection",features:be.features.filter(Ge=>ye.value.evaluate({zoom:0},Ge))}}this._geoJSONIndex=B.cluster?new Yr(function({superclusterOptions:ye,clusterProperties:Te}){if(!Te||!ye)return ye;let Ge={},ut={},Xe={accumulated:null,zoom:0},St={properties:null},Ot=Object.keys(Te);for(let xt of Ot){let[Pt,Ut]=Te[xt],dr=t.createExpression(Ut),Tr=t.createExpression(typeof Pt=="string"?[Pt,["accumulated"],["get",xt]]:Pt);Ge[xt]=dr.value,ut[xt]=Tr.value}return ye.map=xt=>{St.properties=xt;let Pt={};for(let Ut of Ot)Pt[Ut]=Ge[Ut].evaluate(Xe,St);return Pt},ye.reduce=(xt,Pt)=>{St.properties=Pt;for(let Ut of Ot)Xe.accumulated=xt[Ut],xt[Ut]=ut[Ut].evaluate(Xe,St)},ye}(B)).load(be.features):function(ye,Te){return new _o(ye,Te)}(be,B.geojsonVtOptions)}catch(ye){return N(ye)}this.loaded={};let ve={};if(re){let ye=t.getPerformanceMeasurement(K);ye&&(ve.resourceTiming={},ve.resourceTiming[B.source]=JSON.parse(JSON.stringify(ye)))}N(null,ve)}})}reloadTile(B,N){let K=this.loaded;return K&&K[B.uid]?super.reloadTile(B,N):this.loadTile(B,N)}loadGeoJSON(B,N){if(B.request)t.getJSON(B.request,N);else{if(typeof B.data!="string")return N(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(B.data))}catch{return N(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(K){N(K)}}getClusterChildren(B,N){try{N(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(K){N(K)}}getClusterLeaves(B,N){try{N(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(K){N(K)}}}class Ol{constructor(B){this.self=B,this.actor=new t.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:ji},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,K)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=K},this.self.registerRTLTextPlugin=N=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=N.applyArabicShaping,t.plugin.processBidirectionalText=N.processBidirectionalText,t.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}clearCaches(B,N,K){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],K()}checkIfReady(B,N,K){K()}setReferrer(B,N){this.referrer=N}spriteLoaded(B,N){this.isSpriteLoaded[B]=N;for(let K in this.workerSources[B]){let re=this.workerSources[B][K];for(let _e in re)re[_e]instanceof t.VectorTileWorkerSource&&(re[_e].isSpriteLoaded=N,re[_e].fire(new t.Event("isSpriteLoaded")))}}setImages(B,N,K){this.availableImages[B]=N;for(let re in this.workerSources[B]){let _e=this.workerSources[B][re];for(let be in _e)_e[be].availableImages=N}K()}enableTerrain(B,N,K){this.terrain=N,K()}setProjection(B,N){this.projections[B]=t.getProjection(N)}setLayers(B,N,K){this.getLayerIndex(B).replace(N),K()}updateLayers(B,N,K){this.getLayerIndex(B).update(N.layers,N.removedIds),K()}loadTile(B,N,K){let re=this.enableTerrain?t.extend({enableTerrain:this.terrain},N):N;re.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,N.type,N.source).loadTile(re,K)}loadDEMTile(B,N,K){let re=this.enableTerrain?t.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(B,N.source).loadTile(re,K)}reloadTile(B,N,K){let re=this.enableTerrain?t.extend({enableTerrain:this.terrain},N):N;re.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,N.type,N.source).reloadTile(re,K)}abortTile(B,N,K){this.getWorkerSource(B,N.type,N.source).abortTile(N,K)}removeTile(B,N,K){this.getWorkerSource(B,N.type,N.source).removeTile(N,K)}removeSource(B,N,K){if(!this.workerSources[B]||!this.workerSources[B][N.type]||!this.workerSources[B][N.type][N.source])return;let re=this.workerSources[B][N.type][N.source];delete this.workerSources[B][N.type][N.source],re.removeSource!==void 0?re.removeSource(N,K):K()}loadWorkerSource(B,N,K){try{this.self.importScripts(N.url),K()}catch(re){K(re.toString())}}syncRTLPluginState(B,N,K){try{t.plugin.setState(N);let re=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&re!=null){this.self.importScripts(re);let _e=t.plugin.isParsed();K(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),_e)}}catch(re){K(re.toString())}}getAvailableImages(B){let N=this.availableImages[B];return N||(N=[]),N}getLayerIndex(B){let N=this.layerIndexes[B];return N||(N=this.layerIndexes[B]=new P),N}getWorkerSource(B,N,K){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][N]||(this.workerSources[B][N]={}),this.workerSources[B][N][K]||(this.workerSources[B][N][K]=new this.workerSourceTypes[N]({send:(re,_e,be,ve,ye,Te)=>{this.actor.send(re,_e,be,B,ye,Te)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][N][K]}getDEMWorkerSource(B,N){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][N]||(this.demWorkerSources[B][N]=new q),this.demWorkerSources[B][N]}enforceCacheSizeLimit(B,N){t.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(B,N,K){K(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ol(self)),Ol}),o(["./shared"],function(t){"use strict";function g(f,a){if(Array.isArray(f)){if(!Array.isArray(a)||f.length!==a.length)return!1;for(let h=0;h<f.length;h++)if(!g(f[h],a[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&a!==null){if(typeof a!="object"||Object.keys(f).length!==Object.keys(a).length)return!1;for(let h in f)if(!g(f[h],a[h]))return!1;return!0}return f===a}var I=P;function P(f){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{v=new Worker(T),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(T),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===m.width}()?(q[h=a&&a.failIfMajorPerformanceCaveat]===void 0&&(q[h]=function(m){var v,x=function(T){var E=document.createElement("canvas"),A=Object.create(P.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=T,E.getContext("webgl",A)||E.getContext("experimental-webgl",A)}(m);if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),x.getShaderParameter(v,x.COMPILE_STATUS)===!0)}(h)),q[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(f)}var q={};function L(f,a,h){let m=t.window.document.createElement(f);return a!==void 0&&(m.className=a),h&&h.appendChild(m),m}function V(f,a,h){let m=t.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(let v of Object.keys(a))m.setAttributeNS(null,v,a[v]);return h&&h.appendChild(m),m}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let oe=t.window.document&&t.window.document.documentElement.style,ne=oe&&oe.userSelect!==void 0?"userSelect":"WebkitUserSelect",Ie;function Se(){oe&&ne&&(Ie=oe[ne],oe[ne]="none")}function Re(){oe&&ne&&(oe[ne]=Ie)}function Ze(f){f.preventDefault(),f.stopPropagation(),t.window.removeEventListener("click",Ze,!0)}function et(){t.window.addEventListener("click",Ze,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",Ze,!0)},0)}function He(f,a){let h=f.getBoundingClientRect();return At(f,h,a)}function It(f,a){let h=f.getBoundingClientRect(),m=[];for(let v=0;v<a.length;v++)m.push(At(f,h,a[v]));return m}function Yt(f){return t.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function At(f,a,h){let m=f.offsetWidth===a.width?1:f.offsetWidth/a.width;return new t.pointGeometry((h.clientX-a.left)*m,(h.clientY-a.top)*m)}function Nt(f,a){var h=a[0],m=a[1],v=a[2],x=a[3],T=h*x-v*m;return T?(f[0]=x*(T=1/T),f[1]=-m*T,f[2]=-v*T,f[3]=h*T,f):null}function wt(f){let{userImage:a}=f;return!!(a&&a.render&&a.render())&&(f.data.replace(new Uint8Array(a.data.buffer)),!0)}class Ht extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(let{ids:h,callback:m}of this.requestors)this._notify(h,m);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,h){this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let m=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new t.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),m=!1),m}_validateStretch(a,h){if(!a)return!0;let m=0;for(let v of a){if(v[0]<m||v[1]<v[0]||h<v[1])return!1;m=v[1]}return!0}_validateContent(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){let h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,h){let m=!0;if(!this.isLoaded())for(let v of a)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(a,h):this.requestors.push({ids:a,callback:h})}_notify(a,h){let m={};for(let v of a){this.images[v]||this.fire(new t.Event("styleimagemissing",{id:v}));let x=this.images[v];x?m[v]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:t.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,m)}getPixelSize(){let{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){let h=this.patterns[a],m=this.getImage(a);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{let v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new t.ImagePosition(v,m);this.patterns[a]={bin:v,position:x}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){let h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){let a=[];for(let x in this.patterns)a.push(this.patterns[x].bin);let{w:h,h:m}=t.potpack(a),v=this.atlasImage;v.resize({width:h||1,height:m||1});for(let x in this.patterns){let{bin:T}=this.patterns[x],E=T.x+1,A=T.y+1,R=this.images[x].data,D=R.width,F=R.height;t.RGBAImage.copy(R,v,{x:0,y:0},{x:E,y:A},{width:D,height:F}),t.RGBAImage.copy(R,v,{x:0,y:F-1},{x:E,y:A-1},{width:D,height:1}),t.RGBAImage.copy(R,v,{x:0,y:0},{x:E,y:A+F},{width:D,height:1}),t.RGBAImage.copy(R,v,{x:D-1,y:0},{x:E-1,y:A},{width:1,height:F}),t.RGBAImage.copy(R,v,{x:0,y:0},{x:E+D,y:A},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(let h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;let m=this.images[h];wt(m)&&this.updateImage(h,m)}}}let pi=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(f,a){return function([h,m,v]){let x=t.degToRad(m+90),T=t.degToRad(v);return{x:h*Math.cos(x)*Math.sin(T),y:h*Math.sin(x)*Math.sin(T),z:h*Math.cos(T),azimuthal:m,polar:v}}(f.expression.evaluate(a))}interpolate(f,a,h){return{x:t.number(f.x,a.x,h),y:t.number(f.y,a.y,h),z:t.number(f.z,a.z,h),azimuthal:t.number(f.azimuthal,a.azimuthal,h),polar:t.number(f.polar,a.polar,h)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),yi="-transition";class gr extends t.Evented{constructor(a){super(),this._transitionable=new t.Transitionable(pi),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(t.validateLight,a,h))for(let m in a){let v=a[m];t.endsWith(m,yi)?this._transitionable.setTransition(m.slice(0,-yi.length),v):this._transitionable.setValue(m,v)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,m){return(!m||m.validate!==!1)&&t.emitValidationErrors(this,a.call(t.validateStyle,t.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}let ni=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),ei="-transition";class Me extends t.Evented{constructor(a,h){super(),this._transitionable=new t.Transitionable(ni),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(a){for(let h in a){let m=a[h];t.endsWith(h,ei)?this._transitionable.setTransition(h.slice(0,-ei.length),m):this._transitionable.setValue(h,m)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function tt(f,a,h,m){let v=t.smoothstep(45,65,h),[x,T]=ke(f,m),E=t.length(a),A=1-Math.min(1,Math.exp((E-x)/(T-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*v*f.alpha}function ke(f,a){let h=.5/Math.tan(.5*a);return[f.range[0]+h,f.range[1]+h]}let Le=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"high-color":new t.DataConstantProperty(t.spec.fog["high-color"]),"space-color":new t.DataConstantProperty(t.spec.fog["space-color"]),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"]),"star-intensity":new t.DataConstantProperty(t.spec.fog["star-intensity"])}),rt="-transition";class ot extends t.Evented{constructor(a,h){super(),this._transitionable=new t.Transitionable(Le),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){let a=this._transform,h=a.projection.name==="globe",m=t.globeToMercatorTransition(a.zoom),v=this.properties.get("range"),x=[.5,3];return{range:h?[t.number(x[0],v[0],m),t.number(x[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h={}){if(!this._validate(t.validateFog,a,h)){for(let m of Object.keys(t.spec.fog))a&&a[m]===void 0&&(a[m]=t.spec.fog[m].default);for(let m in a){let v=a[m];t.endsWith(m,rt)?this._transitionable.setTransition(m.slice(0,-rt.length),v):this._transitionable.setValue(m,v)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;let h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.smoothstep(45,65,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(m,v,x){let T=t.MercatorCoordinate.fromLngLat(v),E=x.elevation?x.elevation.getAtPointOrZero(T):0,A=[T.x,T.y,E];return t.transformMat4(A,A,x.mercatorFogMatrix),tt(m,A,x.pitch,x._fov)}(this.state,a,h):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?ke(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,m){return(!m||m.validate!==!1)&&t.emitValidationErrors(this,a.call(t.validateStyle,t.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class vt{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=t.uniqueId();let m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){let x=new vt.Actor(m[v],h,this.id);x.name=`Worker ${v}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,h,m){t.asyncAll(this.actors,(v,x)=>{v.send(a,h,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function nr(f,a,h){return a*(t.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}vt.Actor=t.Actor;class Xt{constructor(a,h,m,v){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,h){let m,v;if(a instanceof t.pointGeometry||typeof a[0]=="number"){let x=t.pointGeometry.convert(a);m=[t.pointGeometry.convert(a)],v=h.isPointAboveHorizon(x)}else{let x=t.pointGeometry.convert(a[0]),T=t.pointGeometry.convert(a[1]);m=[x,T],v=t.polygonizeBounds(x,T).every(E=>h.isPointAboveHorizon(E))}return new Xt(m,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return t.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){let h=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],v=t.polygonizeBounds(h,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),t.bufferConvexPolygon(v,a)}bufferedCameraGeometryGlobe(a){let h=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],v=t.polygonizeBounds(h,m,a),x=this.cameraPoint.clone();switch(3*((x.y>h.y)+(x.y>m.y))+((x.x>h.x)+(x.x>m.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(a,h,m,v=0){let x=a.queryPadding/h._pixelsPerMercatorPixel+1,T=m?this._bufferedCameraMercator(x,h):this._bufferedScreenMercator(x,h),E=a.tileID.wrap+(T.unwrapped?v:0),A=T.polygon.map(H=>t.getTilePoint(a.tileTransform,H,E));if(!t.polygonIntersectsBox(A,0,0,t.EXTENT,t.EXTENT))return;E=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let R=this.screenGeometryMercator.polygon.map(H=>t.getTileVec3(a.tileTransform,H,E)),D=R.map(H=>new t.pointGeometry(H[0],H[1])),F=h.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),j=t.getTileVec3(a.tileTransform,F,E),X=R.map(H=>{let $=t.sub(H,H,j);return t.normalize($,$),new t.Ray(j,$)}),W=nr(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:X,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(Z=t.getBounds(A),Z.min.x=t.clamp(Z.min.x,0,t.EXTENT),Z.min.y=t.clamp(Z.min.y,0,t.EXTENT),Z.max.x=t.clamp(Z.max.x,0,t.EXTENT),Z.max.y=t.clamp(Z.max.y,0,t.EXTENT),Z),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:W};var Z}_bufferedScreenMercator(a,h){let m=ti(a);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(a,h){let m=ti(a);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(x=>h.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(a,h){let m=function(x,T){let E=t.multiply([],T.pixelMatrix,T.globeMatrix),A=[0,-t.GLOBE_RADIUS,0,1],R=[0,t.GLOBE_RADIUS,0,1],D=[0,0,0,1];t.transformMat4$1(A,A,E),t.transformMat4$1(R,R,E),t.transformMat4$1(D,D,E);let F=new t.pointGeometry(A[0]/A[3],A[1]/A[3]),j=new t.pointGeometry(R[0]/R[3],R[1]/R[3]),X=t.polygonContainsPoint(x,F)&&A[3]<D[3],W=t.polygonContainsPoint(x,j)&&R[3]<D[3];if(!X&&!W)return null;let Z=function(fe,he,ge){for(let Ee=1;Ee<fe.length;Ee++){let Ye=Yr(he.pointCoordinate3D(fe[Ee-1]).x),xe=Yr(he.pointCoordinate3D(fe[Ee]).x);if(ge<0){if(Ye<xe)return{idx:Ee,t:-Ye/(xe-1-Ye)}}else if(xe<Ye)return{idx:Ee,t:(1-Ye)/(xe+1-Ye)}}return null}(x,T,X?-1:1);if(!Z)return null;let{idx:H,t:$}=Z,ee=H>1?Ir(x.slice(0,H),T):[],Y=H<x.length?Ir(x.slice(H),T):[];ee=ee.map(fe=>new t.pointGeometry(Yr(fe.x),fe.y)),Y=Y.map(fe=>new t.pointGeometry(Yr(fe.x),fe.y));let de=[...ee];de.length===0&&de.push(Y[Y.length-1]);let pe=t.number(de[de.length-1].y,(Y.length===0?ee[0]:Y[0]).y,$),se;return se=X?[new t.pointGeometry(0,pe),new t.pointGeometry(0,0),new t.pointGeometry(1,0),new t.pointGeometry(1,pe)]:[new t.pointGeometry(1,pe),new t.pointGeometry(1,1),new t.pointGeometry(0,1),new t.pointGeometry(0,pe)],de.push(...se),Y.length===0?de.push(ee[0]):de.push(...Y),{polygon:de.map(fe=>new t.MercatorCoordinate(fe.x,fe.y)),unwrapped:!1}}(a,h);if(m)return m;let v=function(x,T){let E=!1,A=-1/0,R=0;for(let F=0;F<x.length-1;F++)x[F].x>A&&(A=x[F].x,R=F);for(let F=0;F<x.length-1;F++){let j=(R+F)%(x.length-1),X=x[j],W=x[j+1];Math.abs(X.x-W.x)>.5&&(X.x<W.x?(X.x+=1,j===0&&(x[x.length-1].x+=1)):(W.x+=1,j+1===x.length-1&&(x[0].x+=1)),E=!0)}let D=t.mercatorXfromLng(T.center.lng);return E&&D<Math.abs(D-1)&&x.forEach(F=>{F.x-=1}),{polygon:x,unwrapped:E}}(Ir(a,h).map(x=>new t.pointGeometry(Yr(x.x),x.y)),h);return{polygon:v.polygon.map(x=>new t.MercatorCoordinate(x.x,x.y)),unwrapped:v.unwrapped}}}function Ir(f,a){return t.resample(f,h=>{let m=a.pointCoordinate3D(h);h.x=m.x,h.y=m.y},1/256)}function Yr(f){return f<0?1+f%1:f%1}function ti(f){return 100*f|0}function co(f,a,h,m,v){let x=function(T,E){if(T)return v(T);if(E){let A=t.pick(t.extend(E,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(A.vectorLayers=E.vector_layers,A.vectorLayerIds=A.vectorLayers.map(R=>R.id)),E.language_options&&(A.languageOptions=E.language_options),E.language&&E.language[E.id]&&(A.language=E.language[E.id]),E.worldview_options&&(A.worldviewOptions=E.worldview_options),E.worldview?A.worldview=E.worldview[E.id]:E.worldview_default&&(A.worldview=E.worldview_default),A.tiles=a.canonicalizeTileset(A,f.url),v(null,A)}};return f.url?t.getJSON(a.transformRequest(a.normalizeSourceURL(f.url,null,h,m),t.ResourceType.Source),x):t.exported.frame(()=>x(null,f))}class Li{constructor(a,h,m){this.bounds=t.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){let h=Math.pow(2,a.z),m=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*h),v=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*h);return a.x>=m&&a.x<x&&a.y>=v&&a.y<T}}class fn{constructor(a,h,m){this.context=a;let v=a.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){let h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Aa{constructor(a,h,m,v){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=a;let x=a.gl;this.buffer=x.createBuffer(),a.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){let h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let m=0;m<this.attributes.length;m++){let v=h.attributes[this.attributes[m].name];v!==void 0&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,h,m){for(let v=0;v<this.attributes.length;v++){let x=this.attributes[v],T=h.attributes[x.name];T!==void 0&&a.vertexAttribPointer(T,x.components,a[Ia[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class er{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ho extends er{getDefault(){return t.Color.transparent}set(a){let h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Oa extends er{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Wn extends er{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class dn extends er{getDefault(){return[!0,!0,!0,!0]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class fs extends er{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Jt extends er{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class No extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){let h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class po extends er{getDefault(){let a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class fo extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class Ca extends er{getDefault(){return[0,1]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class ds extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class wl extends er{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Tl extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Ki extends er{getDefault(){let a=this.gl;return[a.ONE,a.ZERO]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Zn extends er{getDefault(){return t.Color.transparent}set(a){let h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Pa extends er{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ju extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class Ji extends er{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class mo extends er{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Qu extends er{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class El extends er{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Sl extends er{getDefault(){let a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){let h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Il extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Al extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ec extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class tc extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Tp extends er{getDefault(){return null}set(a){let h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Uo extends er{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class _o extends er{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ms extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class rc extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class ji extends er{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class Ol extends ji{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Q extends ji{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class B extends Q{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class N{constructor(a,h,m,v){this.context=a,this.width=h,this.height=m;let x=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Ol(a,x),v&&(this.depthAttachment=new Q(a,x))}destroy(){let a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){let m=this.depthAttachment.get();m&&a.deleteRenderbuffer(m)}a.deleteFramebuffer(this.framebuffer)}}class K{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ho(this),this.clearDepth=new Oa(this),this.clearStencil=new Wn(this),this.colorMask=new dn(this),this.depthMask=new fs(this),this.stencilMask=new Jt(this),this.stencilFunc=new No(this),this.stencilOp=new po(this),this.stencilTest=new fo(this),this.depthRange=new Ca(this),this.depthTest=new ds(this),this.depthFunc=new wl(this),this.blend=new Tl(this),this.blendFunc=new Ki(this),this.blendColor=new Zn(this),this.blendEquation=new Pa(this),this.cullFace=new Ju(this),this.cullFaceSide=new Ji(this),this.frontFace=new mo(this),this.program=new Qu(this),this.activeTexture=new El(this),this.viewport=new Sl(this),this.bindFramebuffer=new Il(this),this.bindRenderbuffer=new Al(this),this.bindTexture=new ec(this),this.bindVertexBuffer=new tc(this),this.bindElementBuffer=new Tp(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Uo(this),this.pixelStoreUnpack=new _o(this),this.pixelStoreUnpackPremultiplyAlpha=new ms(this),this.pixelStoreUnpackFlipY=new rc(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new fn(this,a,h)}createVertexBuffer(a,h,m){return new Aa(this,a,h,m)}createRenderbuffer(a,h,m){let v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,a,h,m),this.bindRenderbuffer.set(null),x}createFramebuffer(a,h,m){return new N(this,a,h,m)}clear({color:a,depth:h,stencil:m}){let v=this.gl,x=0;a&&(x|=v.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(x|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m!==void 0&&(x|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(x)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){g(a.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class re extends t.Evented{constructor(a,h,m,v){super(),this.id=a,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},h),t.extend(this,t.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=co(this._options,this.map._requestManager,null,null,(a,h)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new t.ErrorEvent(a)):h&&(t.extend(this,h),h.bounds&&(this.tileBounds=new Li(h.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(h.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){let m=t.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);a.request=t.getImage(this.map._requestManager.transformRequest(v,t.ResourceType.Tile),(x,T,E,A)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):x?(a.state="errored",h(x)):T?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:E,expires:A}),a.setTexture(T,this.map.painter),a.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(a,h,m){a.setTexture(h,m)}static unloadTileData(a,h){a.texture&&h.saveTileTexture(a.texture)}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()}hasTransition(){return!1}}let _e;function be(f,a,h,m,v,x,T,E){let A=[f,h,v,a,m,x,1,1,1],R=[T,E,1],D=t.adjoint([],A),[F,j,X]=t.transformMat3(R,R,t.transpose(D,D));return t.multiply$1(A,[F,0,0,0,j,0,0,0,X],A)}class ve extends t.Evented{constructor(a,h,m,v){super(),this.id=a,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h}load(a,h){this._loaded=h||!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(m,v)=>{if(this._loaded=!0,m)this.fire(new t.ErrorEvent(m));else if(v){let{HTMLImageElement:x}=t.window;this.image=v instanceof x?t.exported.getImageData(v):v,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;let h=a.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,x=1/0,T=-1/0,E=-1/0;for(let F of m)v=Math.min(v,F.x),x=Math.min(x,F.y),T=Math.max(T,F.x),E=Math.max(E,F.y);let A=Math.max(T-v,E-x),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),D=Math.pow(2,R);return new t.CanonicalTileID(R,Math.floor((v+T)/2*D),Math.floor((x+E)/2*D))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(let A in this.tiles){let R=this.tiles[A];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;let h=t.tileTransform(this.tileID,this.map.transform.projection),[m,v,x,T]=this.coordinates.map(A=>{let R=h.projection.project(A[0],A[1]);return t.getTilePoint(h,R)._round()});this.perspectiveTransform=function(A,R,D,F,j,X,W,Z,H,$){let ee=be(0,0,A,0,0,R,A,R),Y=be(D,F,j,X,W,Z,H,$);return t.multiply$1(Y,t.adjoint(ee,ee),Y),[Y[6]/Y[8]*A/t.EXTENT,Y[7]/Y[8]*R/t.EXTENT]}(this.width,this.height,m.x,m.y,v.x,v.y,T.x,T.y,x.x,x.y);let E=this._boundsArray=new t.StructArrayLayout4i8;E.emplaceBack(m.x,m.y,0,0),E.emplaceBack(v.x,v.y,t.EXTENT,0),E.emplaceBack(T.x,T.y,0,t.EXTENT),E.emplaceBack(x.x,x.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(E,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let a=this.map.painter.context,h=a.gl;this.texture?this.texture.update(this.image):(this.texture=new t.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(a)}loadTile(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let ye={vector:class extends t.Evented{constructor(f,a,h,m){if(super(),this.id=f,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(a,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(f){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"}));let a=this.language||this.map._language,h=this.worldview||this.map._worldview;this._tileJSONRequest=co(this._options,this.map._requestManager,a,h,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${a}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new t.ErrorEvent(m))):v&&(t.extend(this,v),v.bounds&&(this.tileBounds=new Li(v.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(m)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.load(()=>{let a=this.map.style._getSourceCaches(this.id);for(let h of a)h.clearTiles()})}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}_setLanguage(f){return f===this.language||this.setSourceProperty(()=>{this.language=f}),this}_setWorldview(f){return f===this.worldview?this:this.worldviewOptions&&f&&!this.worldviewOptions[f]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${f}".`),this):(this.setSourceProperty(()=>{this.worldview=f}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(f,a){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(h,t.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired")f.state==="loading"?f.reloadCallback=a:f.request=f.actor.send("reloadTile",m,v.bind(this));else if(f.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",m,v.bind(this),void 0,!0);else{let x=t.loadVectorTile.call({deduped:this._deduped},m,(T,E)=>{T||!E?v.call(this,T):(m.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},f.actor&&f.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);f.request={cancel:x}}function v(x,T){return delete f.request,f.aborted?a(null):x&&x.status!==404?a(x):(T&&T.resourceTiming&&(f.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadVectorData(T,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:re,"raster-dem":class extends re{constructor(f,a,h,m){super(f,a,h,m),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(f,a){let h=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,x){v&&(f.state="errored",a(v)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",a(null))}f.request=t.getImage(this.map._requestManager.transformRequest(h,t.ResourceType.Tile),function(v,x,T,E){if(delete f.request,f.aborted)f.state="unloaded",a(null);else if(v)f.state="errored",a(v);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:E});let A=t.window.ImageBitmap&&x instanceof t.window.ImageBitmap&&(_e==null&&(_e=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&typeof t.window.createImageBitmap=="function"),_e),R=1-(x.width-t.prevPowerOfTwo(x.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let D=A?x:t.exported.getImageData(x,R),F={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:R};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",F,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){let a=f.canonical,h=Math.pow(2,a.z),m=(a.x-1+h)%h,v=a.x===0?f.wrap-1:f.wrap,x=(a.x+1+h)%h,T=a.x+1===h?f.wrap+1:f.wrap,E={};return E[new t.OverscaledTileID(f.overscaledZ,v,a.z,m,a.y).key]={backfilled:!1},E[new t.OverscaledTileID(f.overscaledZ,T,a.z,x,a.y).key]={backfilled:!1},a.y>0&&(E[new t.OverscaledTileID(f.overscaledZ,v,a.z,m,a.y-1).key]={backfilled:!1},E[new t.OverscaledTileID(f.overscaledZ,f.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},E[new t.OverscaledTileID(f.overscaledZ,T,a.z,x,a.y-1).key]={backfilled:!1}),a.y+1<h&&(E[new t.OverscaledTileID(f.overscaledZ,v,a.z,m,a.y+1).key]={backfilled:!1},E[new t.OverscaledTileID(f.overscaledZ,f.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},E[new t.OverscaledTileID(f.overscaledZ,T,a.z,x,a.y+1).key]={backfilled:!1}),E}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends t.Evented{constructor(f,a,h,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(m),this._data=a.data,this._options=t.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;let v=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*v,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*v,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:t.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},a),this}getClusterChildren(f,a){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},a),this}getClusterLeaves(f,a,h,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:a,offset:h},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;let f=t.extend({},this.workerOptions),a=this._data;typeof a=="string"?(f.request=this.map._requestManager.transformRequest(t.exported.resolveURL(a),t.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new t.ErrorEvent(h));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new t.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,a){let h=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(h,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete f.request,f.unloadVectorData(),f.aborted?a(null):m?a(m):(f.loadVectorData(v,this.map.painter,h==="reloadTile"),a(null))),void 0,h==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ve{constructor(f,a,h,m){super(f,a,h,m),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let a of f.urls)this.urls.push(this.map._requestManager.transformRequest(a,t.ResourceType.Source).url);t.getVideo(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new t.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let a=this.video.seekable;f<a.start(0)||f>a.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,a=f.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(f,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ve,canvas:class extends ve{constructor(f,a,h,m){super(f,a,h,m),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends t.Evented{constructor(f,a,h,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Li(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.coveringTiles=this._coveringTiles.bind(this),t.extend(this,t.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:a,y:h,z:m}=f.canonical;return this._implementation.hasTile({x:a,y:h,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,a){let{x:h,y:m,z:v}=f.tileID.canonical,x=new t.window.AbortController,T=this._implementation.loadTile({x:h,y:m,z:v},{signal:x.signal});if(!T)return this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",a(null);T.cancel=()=>x.abort(),f.request=T.then(function(E){return delete f.request,f.aborted?(f.state="unloaded",a(null)):E?function(A){return A instanceof t.window.ImageData||A instanceof t.window.ImageBitmap||A instanceof t.window.HTMLCanvasElement}(E)?(this.loadTileData(f,E),f.state="loaded",void a(null)):(f.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",a(null))}.bind(this)).catch(E=>{E.code!==20&&(f.state="errored",a(E))})}loadTileData(f,a){re.loadTileData(f,a,this._map.painter)}unloadTileData(f){re.unloadTileData(f,this._map.painter)}prepareTile(f){if(!this._implementation.prepareTile)return null;let{x:a,y:h,z:m}=f.tileID.canonical,v=this._implementation.prepareTile({x:a,y:h,z:m});return v?(this.loadTileData(f,v),f.state="loaded",v):null}unloadTile(f,a){if(this.unloadTileData(f),this._implementation.unloadTile){let{x:h,y:m,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:h,y:m,z:v})}a()}abortTile(f,a){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_update(){this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Te=function(f,a,h,m){let v=new ye[a.type](f,a,h,m);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],v),v};function Ge(f,a){let h=t.identity([]);return t.scale(h,h,[.5*f.width,.5*-f.height,1]),t.translate(h,h,[1,-1,0]),t.multiply(h,h,f.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function ut(f,a,h,m,v,x,T,E=!1){let A=f.tilesIn(m,T,E);A.sort(St);let R=[];for(let F of A)R.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(a,h,f._state,F,v,x,Ge(f.transform,F.tile.tileID),E)});let D=function(F){let j={},X={};for(let W of F){let Z=W.queryResults,H=W.wrappedTileID,$=X[H]=X[H]||{};for(let ee in Z){let Y=Z[ee],de=$[ee]=$[ee]||{},pe=j[ee]=j[ee]||[];for(let se of Y)de[se.featureIndex]||(de[se.featureIndex]=!0,pe.push(se))}}return j}(R);for(let F in D)D[F].forEach(j=>{let X=j.feature,W=X.layer;W&&W.type!=="background"&&W.type!=="sky"&&(X.source=W.source,W["source-layer"]&&(X.sourceLayer=W["source-layer"]),X.state=X.id!==void 0?f.getFeatureState(W["source-layer"],X.id):{})});return D}function Xe(f,a){let h=f.getRenderableIds().map(x=>f.getTileByID(x)),m=[],v={};for(let x=0;x<h.length;x++){let T=h[x],E=T.tileID.canonical.key;v[E]||(v[E]=!0,T.querySourceFeatures(m,a))}return m}function St(f,a){let h=f.tileID,m=a.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function Ot(){return iu.workerClass!=null?new iu.workerClass:new t.window.Worker(iu.workerUrl)}let xt="mapboxgl_preloaded_worker_pool";class Pt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Pt.workerCount;)this.workers.push(new Ot);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xt]}numActive(){return Object.keys(this.active).length}}let Ut;function dr(){return Ut||(Ut=new Pt),Ut}function Tr(f,a){let h={};for(let m in f)m!=="ref"&&(h[m]=f[m]);return t.refProperties.forEach(m=>{m in a&&(h[m]=a[m])}),h}function mr(f){f=f.slice();let a=Object.create(null);for(let h=0;h<f.length;h++)a[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=Tr(f[h],a[f[h].ref]));return f}Pt.workerCount=2;let Et={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qe(f,a,h){h.push({command:Et.addSource,args:[f,a[f]]})}function Qi(f,a,h){a.push({command:Et.removeSource,args:[f]}),h[f]=!0}function Gr(f,a,h,m){Qi(f,h,m),qe(f,a,h)}function jo(f,a,h){let m;for(m in f[h])if(f[h].hasOwnProperty(m)&&m!=="data"&&!g(f[h][m],a[h][m]))return!1;for(m in a[h])if(a[h].hasOwnProperty(m)&&m!=="data"&&!g(f[h][m],a[h][m]))return!1;return!0}function ic(f,a,h,m,v,x){let T;for(T in a=a||{},f=f||{})f.hasOwnProperty(T)&&(g(f[T],a[T])||h.push({command:x,args:[m,T,a[T],v]}));for(T in a)a.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(g(f[T],a[T])||h.push({command:x,args:[m,T,a[T],v]}))}function qn(f){return f.id}function nc(f,a){return f[a.id]=a,f}class E0{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=t.clamp(a,0,1);let h=1,m=this._distances[h],v=a*this.paddedLength+this.padding;for(;m<v&&h<this._distances.length;)m=this._distances[++h];let x=h-1,T=this._distances[x],E=m-T,A=E>0?(v-T)/E:0;return this.points[x].mult(1-A).add(this.points[h].mult(A))}}class _s{constructor(a,h,m){let v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(a/m),this.yCellCount=Math.ceil(h/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,m,v,x){this._forEachCell(h,m,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(a,h,m,v){this._forEachCell(h-v,m-v,h+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(m),this.circles.push(v)}_insertBoxCell(a,h,m,v,x,T){this.boxCells[x].push(T)}_insertCircleCell(a,h,m,v,x,T){this.circleCells[x].push(T)}_query(a,h,m,v,x,T){if(m<0||a>this.width||v<0||h>this.height)return!x&&[];let E=[];if(a<=0&&h<=0&&this.width<=m&&this.height<=v){if(x)return!0;for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let R=this.circles[3*A],D=this.circles[3*A+1],F=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:R-F,y1:D-F,x2:R+F,y2:D+F})}return T?E.filter(T):E}return this._forEachCell(a,h,m,v,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?E.length>0:E}_queryCircle(a,h,m,v,x){let T=a-m,E=a+m,A=h-m,R=h+m;if(E<0||T>this.width||R<0||A>this.height)return!v&&[];let D=[];return this._forEachCell(T,A,E,R,this._queryCellCircle,D,{hitTest:v,circle:{x:a,y:h,radius:m},seenUids:{box:{},circle:{}}},x),v?D.length>0:D}query(a,h,m,v,x){return this._query(a,h,m,v,!1,x)}hitTest(a,h,m,v,x){return this._query(a,h,m,v,!0,x)}hitTestCircle(a,h,m,v){return this._queryCircle(a,h,m,!0,v)}_queryCell(a,h,m,v,x,T,E,A){let R=E.seenUids,D=this.boxCells[x];if(D!==null){let j=this.bboxes;for(let X of D)if(!R.box[X]){R.box[X]=!0;let W=4*X;if(a<=j[W+2]&&h<=j[W+3]&&m>=j[W+0]&&v>=j[W+1]&&(!A||A(this.boxKeys[X]))){if(E.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[X],x1:j[W],y1:j[W+1],x2:j[W+2],y2:j[W+3]})}}}let F=this.circleCells[x];if(F!==null){let j=this.circles;for(let X of F)if(!R.circle[X]){R.circle[X]=!0;let W=3*X;if(this._circleAndRectCollide(j[W],j[W+1],j[W+2],a,h,m,v)&&(!A||A(this.circleKeys[X]))){if(E.hitTest)return T.push(!0),!0;{let Z=j[W],H=j[W+1],$=j[W+2];T.push({key:this.circleKeys[X],x1:Z-$,y1:H-$,x2:Z+$,y2:H+$})}}}}}_queryCellCircle(a,h,m,v,x,T,E,A){let R=E.circle,D=E.seenUids,F=this.boxCells[x];if(F!==null){let X=this.bboxes;for(let W of F)if(!D.box[W]){D.box[W]=!0;let Z=4*W;if(this._circleAndRectCollide(R.x,R.y,R.radius,X[Z+0],X[Z+1],X[Z+2],X[Z+3])&&(!A||A(this.boxKeys[W])))return T.push(!0),!0}}let j=this.circleCells[x];if(j!==null){let X=this.circles;for(let W of j)if(!D.circle[W]){D.circle[W]=!0;let Z=3*W;if(this._circlesCollide(X[Z],X[Z+1],X[Z+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[W])))return T.push(!0),!0}}}_forEachCell(a,h,m,v,x,T,E,A){let R=this._convertToXCellCoord(a),D=this._convertToYCellCoord(h),F=this._convertToXCellCoord(m),j=this._convertToYCellCoord(v);for(let X=R;X<=F;X++)for(let W=D;W<=j;W++)if(x.call(this,a,h,m,v,this.xCellCount*W+X,T,E,A))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,m,v,x,T){let E=v-a,A=x-h,R=m+T;return R*R>E*E+A*A}_circleAndRectCollide(a,h,m,v,x,T,E){let A=(T-v)/2,R=Math.abs(a-(v+A));if(R>A+m)return!1;let D=(E-x)/2,F=Math.abs(h-(x+D));if(F>D+m)return!1;if(R<=A||F<=D)return!0;let j=R-A,X=F-D;return j*j+X*X<=m*m}}let ct=Math.tan(85*Math.PI/180);function Vt(f,a,h,m,v,x,T){let E=t.create();if(h)if(x.name==="globe"){let A=t.calculateGlobeLabelMatrix(v,a);t.multiply(E,E,A)}else{let A=Nt([],T);E[0]=A[0],E[1]=A[1],E[4]=A[2],E[5]=A[3],m||t.rotateZ(E,E,v.angle)}else t.multiply(E,v.labelPlaneMatrix,f);return E}function Gt(f,a,h,m,v,x,T){let E=Vt(f,a,h,m,v,x,T);return x.name==="globe"&&h||(E[2]=E[6]=E[10]=E[14]=0),E}function Rn(f,a,h,m,v,x,T){if(h){if(x.name==="globe"){let E=Vt(f,a,h,m,v,x,T);return t.invert(E,E),t.multiply(E,f,E),E}{let E=t.clone(f),A=t.identity([]);return A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],t.multiply(E,E,A),m||t.rotateZ(E,E,-v.angle),E}}return v.glCoordMatrix}function Dn(f,a,h=0){let m=[f.x,f.y,h,1];h?t.transformMat4$1(m,m,a):ki(m,m,a);let v=m[3];return{point:[m[0]/v,m[1]/v,m[2]/v],signedDistanceFromCamera:v}}function zt(f,a){let h=[f[0],f[1],f[2],1];t.transformMat4$1(h,h,a);let m=h[3];return{point:[h[0]/m,h[1]/m,h[2]/m],signedDistanceFromCamera:m}}function Cl(f,a){return Math.min(.5+f/a*.5,1.5)}function Pl(f,a){let h=f[0]/f[3],m=f[1]/f[3];return h>=-a[0]&&h<=a[0]&&m>=-a[1]&&m<=a[1]}function Ml(f,a,h,m,v,x,T,E,A,R){let D=h.transform,F=m?f.textSizeData:f.iconSizeData,j=t.evaluateSizeForZoom(F,h.transform.zoom),X=D.projection.name==="globe",W=[256/h.width*2+1,256/h.height*2+1],Z=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let H=null;X&&(H=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let $=f.lineVertexArray,ee=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,Y=h.transform.width/h.transform.height,de=!1;for(let pe=0;pe<ee.length;pe++){let se=ee.get(pe);if(se.writingMode!==t.WritingMode.vertical||de||pe!==0&&ee.get(pe-1).writingMode===t.WritingMode.horizontal||(de=!0),(se.hidden||se.writingMode===t.WritingMode.vertical)&&!de){Go(se.numGlyphs,Z);continue}de=!1;let fe=new t.pointGeometry(se.tileAnchorX,se.tileAnchorY),he=A?A(fe):[0,0,0],ge=D.projection.projectTilePoint(fe.x,fe.y,R.canonical),Ee=[ge.x+he[0],ge.y+he[1],ge.z+he[2]],Ye=[...Ee,1];if(t.transformMat4$1(Ye,Ye,a),!Pl(Ye,W)){Go(se.numGlyphs,Z);continue}let xe=Cl(h.transform.cameraToCenterDistance,Ye[3]),ze=t.evaluateSizeForFeature(F,j,se),Ue=T?ze/xe:ze*xe,it=Dn(new t.pointGeometry(Ee[0],Ee[1]),v,Ee[2]);if(it.signedDistanceFromCamera<=0){Go(se.numGlyphs,Z);continue}let Pe={},Je=T?null:A,Ne=Jm(se,Ue,!1,E,a,v,x,f.glyphOffsetArray,$,Z,H,it.point,fe,Pe,Y,Je,D.projection,R,T);de=Ne.useVertical,Je&&Ne.needsFlipping&&(Pe={}),(Ne.notEnoughRoom||de||Ne.needsFlipping&&Jm(se,Ue,!0,E,a,v,x,f.glyphOffsetArray,$,Z,H,it.point,fe,Pe,Y,Je,D.projection,R,T).notEnoughRoom)&&Go(se.numGlyphs,Z)}m?(f.text.dynamicLayoutVertexBuffer.updateData(Z),H&&f.text.globeExtVertexBuffer.updateData(H)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),H&&f.icon.globeExtVertexBuffer.updateData(H))}function en(f,a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z){let H=E.glyphStartIndex+E.numGlyphs,$=E.lineStartIndex,ee=E.lineStartIndex+E.lineLength,Y=a.getoffsetX(E.glyphStartIndex),de=a.getoffsetX(H-1),pe=Vo(f*Y,h,m,v,x,T,E.segment,$,ee,A,R,D,F,j,!0,X,W,Z);if(!pe)return null;let se=Vo(f*de,h,m,v,x,T,E.segment,$,ee,A,R,D,F,j,!0,X,W,Z);return se?{first:pe,last:se}:null}function Nr(f,a,h,m){return f.writingMode===t.WritingMode.horizontal&&Math.abs(h.y-a.y)>Math.abs(h.x-a.x)*m?{useVertical:!0}:f.writingMode===t.WritingMode.vertical?a.y<h.y?{needsFlipping:!0}:null:f.flipState!==0&&function(v,x,T){let E=(x.x-v.x)*T;return E===0||Math.abs((x.y-v.y)/E)>ct}(a,h,m)?f.flipState===1?{needsFlipping:!0}:null:a.x>h.x?{needsFlipping:!0}:null}function Jm(f,a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z,H,$,ee){let Y=a/24,de=f.lineOffsetX*Y,pe=f.lineOffsetY*Y,se;if(f.numGlyphs>1){let fe=f.glyphStartIndex+f.numGlyphs,he=f.lineStartIndex,ge=f.lineStartIndex+f.lineLength,Ee=en(Y,E,de,pe,h,F,j,f,A,x,X,Z,!1,H,$,ee);if(!Ee)return{notEnoughRoom:!0};let Ye=zt(Ee.first.point,T).point,xe=zt(Ee.last.point,T).point,ze=new t.pointGeometry(Ye[0],Ye[1]),Ue=new t.pointGeometry(xe[0],xe[1]);if(m&&!h){let it=Nr(f,ze,Ue,W);if(f.flipState=it&&it.needsFlipping?1:2,it)return it}se=[Ee.first];for(let it=f.glyphStartIndex+1;it<fe-1;it++)se.push(Vo(Y*E.getoffsetX(it),de,pe,h,F,j,f.segment,he,ge,A,x,X,Z,!1,!1,H,$,ee));se.push(Ee.last)}else{if(m&&!h){let he=Dn(j,v).point,ge=f.lineStartIndex+f.segment+1,Ee=new t.pointGeometry(A.getx(ge),A.gety(ge)),Ye=Dn(Ee,v),xe=Ye.signedDistanceFromCamera>0?Ye.point:oc(j,Ee,he,1,v,void 0,H,$.canonical),ze=Nr(f,new t.pointGeometry(he[0],he[1]),new t.pointGeometry(xe[0],xe[1]),W);if(f.flipState=ze&&ze.needsFlipping?1:2,ze)return ze}let fe=Vo(Y*E.getoffsetX(f.glyphStartIndex),de,pe,h,F,j,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,A,x,X,Z,!1,!1,H,$,ee);if(!fe)return{notEnoughRoom:!0};se=[fe]}if(D)for(let fe of se)t.updateGlobeVertexNormal(D,R.length+0,fe.up[0],fe.up[1],fe.up[2]),t.updateGlobeVertexNormal(D,R.length+1,fe.up[0],fe.up[1],fe.up[2]),t.updateGlobeVertexNormal(D,R.length+2,fe.up[0],fe.up[1],fe.up[2]),t.updateGlobeVertexNormal(D,R.length+3,fe.up[0],fe.up[1],fe.up[2]),t.addDynamicAttributes(R,fe.point[0],fe.point[1],fe.point[2],fe.angle);else for(let fe of se)t.addDynamicAttributes(R,fe.point[0],fe.point[1],fe.point[2],fe.angle);return{}}function ys(f,a,h,m,v){let x=m.projectTilePoint(f.x,f.y,a);if(!v)return Dn(x,h,x.z);let T=v(f);return Dn(new t.pointGeometry(x.x+T[0],x.y+T[1]),h,x.z+T[2])}function oc(f,a,h,m,v,x,T,E){let A=ys(f.add(f.sub(a)._unit()),E,v,T,x).point,R=t.sub([],h,A);return t.scaleAndAdd([],h,R,m/t.length(R))}function Vo(f,a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z,H,$){let ee=m?f-a:f+a,Y=ee>0?1:-1,de=0;m&&(Y*=-1,de=Math.PI),Y<0&&(de+=Math.PI);let pe=Y>0?E+T:E+T+1,se=v,fe=v,he=0,ge=0,Ee=Math.abs(ee),Ye=[],xe=[],ze=x,Ue=()=>{let gt=pe-Y;return he===0?x:new t.pointGeometry(R.getx(gt),R.gety(gt))},it=()=>oc(Ue(),ze,fe,Ee-he+1,D,j,Z,H.canonical);for(;he+ge<=Ee;){if(pe+=Y,pe<E||pe>=A)return null;if(fe=se,Ye.push(se),X&&xe.push(ze||Ue()),se=F[pe],se===void 0){ze=new t.pointGeometry(R.getx(pe),R.gety(pe));let gt=ys(ze,H.canonical,D,Z,j);se=gt.signedDistanceFromCamera>0?F[pe]=gt.point:it()}else ze=null;he+=ge,ge=t.distance(fe,se)}ze=ze||new t.pointGeometry(R.getx(pe),R.gety(pe));let Pe=Ue();W&&j&&(F[pe]=se=F[pe]===void 0?se:it(),ge=t.distance(fe,se));let Je=(Ee-he)/ge,Ne=ze.sub(Pe).mult(Je)._add(Pe),st=t.sub([],se,fe),at=t.scaleAndAdd([],fe,st,Je),yt=[0,0,1],Tt=st[0],qt=st[1];if($&&(yt=Z.upVector(H.canonical,Ne.x,Ne.y),yt[0]!==0||yt[1]!==0||yt[2]!==1)){let gt=[1,0,0],Lt=[0,1,0];gt[0]=yt[2],gt[1]=0,gt[2]=-yt[0],t.cross(Lt,yt,gt),t.normalize(gt,gt),t.normalize(Lt,Lt),Tt=t.dot(st,gt),qt=t.dot(st,Lt)}if(h){let gt=t.cross([],yt,st);t.normalize(gt,gt),t.scaleAndAdd(at,at,gt,h*Y)}let Wt=de+Math.atan2(qt,Tt);return Ye.push(at),X&&xe.push(Ne),{point:at,angle:Wt,path:Ye,tilePath:xe,up:yt}}let Ep=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Go(f,a){for(let h=0;h<f;h++){let m=a.length;a.resize(m+4),a.float32.set(Ep,4*m)}}function ki(f,a,h){let m=a[0],v=a[1];return f[0]=h[0]*m+h[4]*v+h[12],f[1]=h[1]*m+h[5]*v+h[13],f[3]=h[3]*m+h[7]*v+h[15],f}let vr=100;class Sp{constructor(a,h,m=new _s(a.width+200,a.height+200,25),v=new _s(a.width+200,a.height+200,25)){this.transform=a,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+vr,this.screenBottomBoundary=a.height+vr,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,m,v,x,T,E,A){let R=m.projectedAnchorX,D=m.projectedAnchorY,F=m.projectedAnchorZ,j=m.elevation,X=m.tileID;if(j&&X){let pe=a.getProjection().upVector(X.canonical,m.tileAnchorX,m.tileAnchorY),se=a.getProjection().upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=pe[0]*j*se,D+=pe[1]*j*se,F+=pe[2]*j*se}let W=this.projectAndGetPerspectiveRatio(E,[R,D,F],m.tileID,a.projection.name==="globe"||!!j||this.transform.pitch>0,a.getProjection()),Z=T*W.perspectiveRatio,H=(m.x1*h+v.x-m.padding)*Z+W.point.x,$=(m.y1*h+v.y-m.padding)*Z+W.point.y,ee=(m.x2*h+v.x+m.padding)*Z+W.point.x,Y=(m.y2*h+v.y+m.padding)*Z+W.point.y,de=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(H,$,ee,Y)||!x&&this.grid.hitTest(H,$,ee,Y,A)||de?{box:[],offscreen:!1,occluded:W.occluded}:{box:[H,$,ee,Y],offscreen:this.isOffscreen(H,$,ee,Y),occluded:!1}}placeCollisionCircles(a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z){let H=[],$=this.transform.elevation,ee=$?$.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,a.getProjection()):Pe=>[0,0,0],Y=new t.pointGeometry(m.tileAnchorX,m.tileAnchorY),de=a.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,Z.canonical),pe=ee(Y),se=[de.x+pe[0],de.y+pe[1],de.z+pe[2]],fe=a.projection.name==="globe",he=this.projectAndGetPerspectiveRatio(E,[se[0],se[1],se[2]],Z,fe||!!$||this.transform.pitch>0,a.getProjection()),{perspectiveRatio:ge}=he,Ee=(F?T/ge:T*ge)/t.ONE_EM,Ye=Dn(new t.pointGeometry(se[0],se[1]),A,se[2]).point,xe=he.signedDistanceFromCamera>0?en(Ee,x,m.lineOffsetX*Ee,m.lineOffsetY*Ee,!1,Ye,Y,m,v,A,{},$&&!F?ee:null,F&&!!$,a.getProjection(),Z,F):null,ze=!1,Ue=!1,it=!0;if(xe&&!he.occluded){let Pe=.5*X*ge+W,Je=new t.pointGeometry(-100,-100),Ne=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),st=new E0,at=xe.first,yt=xe.last,Tt=[];for(let gt=at.path.length-1;gt>=1;gt--)Tt.push(at.path[gt]);for(let gt=1;gt<yt.path.length;gt++)Tt.push(yt.path[gt]);let qt=2.5*Pe;if(R){let gt=Tt.map($&&!fe?(Lt,rr)=>{let Rr=ee(rr<at.path.length-1?at.tilePath[at.path.length-1-rr]:yt.tilePath[rr-at.path.length+2]);return Lt[2]=Rr[2],zt(Lt,R)}:Lt=>zt(Lt,R));Tt=gt.some(Lt=>Lt.signedDistanceFromCamera<=0)?[]:gt.map(Lt=>Lt.point)}let Wt=[];if(Tt.length>0){let gt=Tt.map(xr=>new t.pointGeometry(xr[0],xr[1])),Lt=1/0,rr=-1/0,Rr=1/0,$r=-1/0;for(let xr=0;xr<gt.length;xr++)Lt=Math.min(Lt,gt[xr].x),Rr=Math.min(Rr,gt[xr].y),rr=Math.max(rr,gt[xr].x),$r=Math.max($r,gt[xr].y);Wt=Lt>=Je.x&&rr<=Ne.x&&Rr>=Je.y&&$r<=Ne.y?[gt]:rr<Je.x||Lt>Ne.x||$r<Je.y||Rr>Ne.y?[]:t.clipLine([gt],Je.x,Je.y,Ne.x,Ne.y)}for(let gt of Wt){st.reset(gt,.25*Pe);let Lt=0;Lt=st.length<=.5*Pe?1:Math.ceil(st.paddedLength/qt)+1;for(let rr=0;rr<Lt;rr++){let Rr=rr/Math.max(Lt-1,1),$r=st.lerp(Rr),xr=$r.x+vr,vi=$r.y+vr;H.push(xr,vi,Pe,0);let zn=xr-Pe,xo=vi-Pe,Dr=xr+Pe,kr=vi+Pe;if(it=it&&this.isOffscreen(zn,xo,Dr,kr),Ue=Ue||this.isInsideGrid(zn,xo,Dr,kr),!h&&this.grid.hitTestCircle(xr,vi,Pe,j)&&(ze=!0,!D))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!D&&ze||!Ue?[]:H,offscreen:it,collisionDetected:ze,occluded:he.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let h=[],m=1/0,v=1/0,x=-1/0,T=-1/0;for(let D of a){let F=new t.pointGeometry(D.x+vr,D.y+vr);m=Math.min(m,F.x),v=Math.min(v,F.y),x=Math.max(x,F.x),T=Math.max(T,F.y),h.push(F)}let E=this.grid.query(m,v,x,T).concat(this.ignoredGrid.query(m,v,x,T)),A={},R={};for(let D of E){let F=D.key;if(A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;let j=[new t.pointGeometry(D.x1,D.y1),new t.pointGeometry(D.x2,D.y1),new t.pointGeometry(D.x2,D.y2),new t.pointGeometry(D.x1,D.y2)];t.polygonIntersectsPolygon(h,j)&&(A[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(a,h,m,v,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:x},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,m,v,x){let T=h?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:v,collisionGroupID:x};for(let A=0;A<a.length;A+=4)T.insertCircle(E,a[A],a[A+1],a[A+2])}projectAndGetPerspectiveRatio(a,h,m,v,x){let T=[h[0],h[1],h[2],1],E=!1;if(h[2]||this.transform.pitch>0){t.transformMat4$1(T,T,a);let A=x.name==="globe";this.fogState&&m&&!A&&(E=function(R,D,F,j,X,W){let Z=W.calculateFogTileMatrix(X),H=[D,F,j];return t.transformMat4(H,H,Z),tt(R,H,W.pitch,W._fov)}(this.fogState,h[0],h[1],h[2],m.toUnwrapped(),this.transform)>.9)}else ki(T,T,a);return{point:new t.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+vr,(-T[1]/T[3]+1)/2*this.transform.height+vr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:v&&T[2]>T[3]||E}}isOffscreen(a,h,m,v){return m<vr||a>=this.screenRightBoundary||v<vr||h>this.screenBottomBoundary}isInsideGrid(a,h,m,v){return m>=0&&a<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){let a=t.identity([]);return t.translate(a,a,[-100,-100,0]),a}}function ql(f,a,h){let m=a.createTileMatrix(f,f.worldSize,h.toUnwrapped());return t.multiply(new Float32Array(16),f.projMatrix,m)}function Vi(f,a,h){if(a.projection.name===h.projection.name)return f.projMatrix;let m=h.clone();return m.setProjection(a.projection),ql(m,a.getProjection(),f)}function Gi(f,a,h){return a.name===h.projection.name?f.projMatrix:ql(h,a,f)}class Ip{constructor(a,h,m,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class $o{constructor(a,h,m,v,x,T=!1){this.text=new Ip(a?a.text:null,h,m,x),this.icon=new Ip(a?a.icon:null,h,v,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kr{constructor(a,h,m,v=!1){this.text=a,this.icon=h,this.skipFade=m,this.clipped=v}}class Rl{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class Ap{constructor(a,h,m,v,x){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=x}}class Dl{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){let h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[a]}}function fi(f,a,h,m,v){let{horizontalAlign:x,verticalAlign:T}=t.getAnchorAlignment(f),E=-(x-.5)*a,A=-(T-.5)*h,R=t.evaluateVariableOffset(f,m);return new t.pointGeometry(E+R[0]*v,A+R[1]*v)}function Ll(f,a,h,m,v){let x=new t.pointGeometry(f,a);return h&&x._rotate(m?v:-v),x}class Op{constructor(a,h,m,v,x){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new Sp(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Dl(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,m,v){let x=m.getBucket(h),T=m.latestFeatureIndex;if(!x||!T||h.id!==x.layerIds[0])return;let E=x.layers[0].layout,A=m.collisionBoxArray,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),D=m.tileSize/t.EXTENT,F=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);let j=(X=m.tileID,W=x.getProjection(),Z=this.transform,W.name===this.projection?Z.calculateProjMatrix(X.toUnwrapped()):ql(Z,W,X));var X,W,Z;let H=E.get("text-pitch-alignment")==="map",$=E.get("text-rotation-alignment")==="map";h.compileFilter();let ee=h.dynamicFilter(),Y=h.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(m),pe=Gt(j,m.tileID.canonical,H,$,this.transform,x.getProjection(),de),se=null;if(H){let ge=Rn(j,m.tileID.canonical,H,$,this.transform,x.getProjection(),de);se=t.multiply([],this.transform.labelPlaneMatrix,ge)}let fe=null;ee&&m.latestFeatureIndex&&(fe={unwrappedTileID:F,dynamicFilter:ee,dynamicFilterNeedsFeature:Y,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Ap(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,m.tileID);let he={bucket:x,layout:E,posMatrix:j,textLabelPlaneMatrix:pe,labelToScreenMatrix:se,clippingData:fe,scale:R,textPixelRatio:D,holdingForFade:m.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(let ge of x.sortKeyRanges){let{sortKey:Ee,symbolInstanceStart:Ye,symbolInstanceEnd:xe}=ge;a.push({sortKey:Ee,symbolInstanceStart:Ye,symbolInstanceEnd:xe,parameters:he})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:he})}attemptAnchorPlacement(a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z,H,$,ee){let Y=[j.textOffset0,j.textOffset1],de=fi(a,m,v,Y,x),pe=this.collisionIndex.placeCollisionBox(W,x,h,Ll(de.x,de.y,T,E,this.transform.angle),F,A,R,D.predicate);if((!H||this.collisionIndex.placeCollisionBox(W,W.getSymbolInstanceIconSize(ee,this.transform.zoom,X),H,Ll(de.x,de.y,T,E,this.transform.angle),F,A,R,D.predicate).box.length!==0)&&pe.box.length>0){let se;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(se=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:Y,width:m,height:v,anchor:a,textScale:x,prevAnchor:se},this.markUsedJustification(W,a,j,Z),W.allowVerticalPlacement&&(this.markUsedOrientation(W,Z,j),this.placedOrientations[j.crossTileID]=Z),{shift:de,placedGlyphBoxes:pe}}}placeLayerBucketPart(a,h,m,v){let{bucket:x,layout:T,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:D,textPixelRatio:F,holdingForFade:j,collisionBoxArray:X,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:Z,collisionGroup:H}=a.parameters,$=T.get("text-optional"),ee=T.get("icon-optional"),Y=T.get("text-allow-overlap"),de=T.get("icon-allow-overlap"),pe=T.get("text-rotation-alignment")==="map",se=T.get("text-pitch-alignment")==="map",fe=T.get("icon-text-fit")!=="none",he=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let ge=Y&&(de||!x.hasIconData()||ee),Ee=de&&(Y||!x.hasTextData()||$);!x.collisionArrays&&X&&x.deserializeCollisionBoxes(X),m&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,X);let Ye=(xe,ze,Ue)=>{if(D){let Dr={zoom:this.transform.zoom,pitch:this.transform.pitch},kr=null;if(D.dynamicFilterNeedsFeature){let jt=this.retainedQueryData[x.bucketInstanceId];kr=D.featureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:jt.bucketIndex,sourceLayerIndex:jt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(Dr,kr,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new t.pointGeometry(xe.tileAnchorX,xe.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[xe.crossTileID]=new Kr(!1,!1,!1,!0),void(h[xe.crossTileID]=!0)}if(h[xe.crossTileID])return;if(j)return void(this.placements[xe.crossTileID]=new Kr(!1,!1,!1));let it=!1,Pe=!1,Je=!0,Ne=!1,st=!1,at=null,yt={box:null,offscreen:null,occluded:null},Tt={box:null,offscreen:null,occluded:null},qt=null,Wt=null,gt=null,Lt=0,rr=0,Rr=0;Ue.textFeatureIndex?Lt=Ue.textFeatureIndex:xe.useRuntimeCollisionCircles&&(Lt=xe.featureIndex),Ue.verticalTextFeatureIndex&&(rr=Ue.verticalTextFeatureIndex);let $r=Dr=>{Dr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Dr.elevation)&&(Dr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Dr.tileAnchorX,Dr.tileAnchorY):0)},xr=Ue.textBox;if(xr){$r(xr);let Dr=jt=>{let ri=t.WritingMode.horizontal;if(x.allowVerticalPlacement&&!jt&&this.prevPlacement){let Ii=this.prevPlacement.placedOrientations[xe.crossTileID];Ii&&(this.placedOrientations[xe.crossTileID]=Ii,ri=Ii,this.markUsedOrientation(x,ri,xe))}return ri},kr=(jt,ri)=>{if(x.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&Ue.verticalTextBox){for(let Ii of x.writingModes)if(Ii===t.WritingMode.vertical?(yt=ri(),Tt=yt):yt=jt(),yt&&yt.box&&yt.box.length)break}else yt=jt()};if(T.get("text-variable-anchor")){let jt=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xe.crossTileID]){let Ar=this.prevPlacement.variableOffsets[xe.crossTileID];jt.indexOf(Ar.anchor)>0&&(jt=jt.filter(Ai=>Ai!==Ar.anchor),jt.unshift(Ar.anchor))}let ri=(Ar,Ai,La)=>{let zi=x.getSymbolInstanceTextSize(W,xe,this.transform.zoom,ze),ka=(Ar.x2-Ar.x1)*zi+2*Ar.padding,za=(Ar.y2-Ar.y1)*zi+2*Ar.padding,Ba=fe&&!de?Ai:null;Ba&&$r(Ba);let Bi={box:[],offscreen:!1,occluded:!1},Fa=Y?2*jt.length:jt.length;for(let Yo=0;Yo<Fa;++Yo){let nu=this.attemptAnchorPlacement(jt[Yo%jt.length],Ar,ka,za,zi,pe,se,F,E,H,Yo>=jt.length,xe,ze,x,La,Ba,W,Z);if(nu&&(Bi=nu.placedGlyphBoxes,Bi&&Bi.box&&Bi.box.length)){it=!0,at=nu.shift;break}}return Bi};kr(()=>ri(xr,Ue.iconBox,t.WritingMode.horizontal),()=>{let Ar=Ue.verticalTextBox;return Ar&&$r(Ar),x.allowVerticalPlacement&&!(yt&&yt.box&&yt.box.length)&&xe.numVerticalGlyphVertices>0&&Ar?ri(Ar,Ue.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),yt&&(it=yt.box,Je=yt.offscreen,Ne=yt.occluded);let Ii=Dr(yt&&yt.box);if(!it&&this.prevPlacement){let Ar=this.prevPlacement.variableOffsets[xe.crossTileID];Ar&&(this.variableOffsets[xe.crossTileID]=Ar,this.markUsedJustification(x,Ar.anchor,xe,Ii))}}else{let jt=(ri,Ii)=>{let Ar=x.getSymbolInstanceTextSize(W,xe,this.transform.zoom,ze),Ai=this.collisionIndex.placeCollisionBox(x,Ar,ri,new t.pointGeometry(0,0),Y,F,E,H.predicate);return Ai&&Ai.box&&Ai.box.length&&(this.markUsedOrientation(x,Ii,xe),this.placedOrientations[xe.crossTileID]=Ii),Ai};kr(()=>jt(xr,t.WritingMode.horizontal),()=>{let ri=Ue.verticalTextBox;return x.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&ri?($r(ri),jt(ri,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Dr(yt&&yt.box&&yt.box.length)}}if(qt=yt,it=qt&&qt.box&&qt.box.length>0,Je=qt&&qt.offscreen,Ne=qt&&qt.occluded,xe.useRuntimeCollisionCircles){let Dr=x.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex>=0?xe.centerJustifiedTextSymbolIndex:xe.verticalPlacedTextSymbolIndex),kr=t.evaluateSizeForFeature(x.textSizeData,W,Dr),jt=T.get("text-padding");Wt=this.collisionIndex.placeCollisionCircles(x,Y,Dr,x.lineVertexArray,x.glyphOffsetArray,kr,E,A,R,m,se,H.predicate,xe.collisionCircleDiameter*kr/t.ONE_EM,jt,this.retainedQueryData[x.bucketInstanceId].tileID),it=Y||Wt.circles.length>0&&!Wt.collisionDetected,Je=Je&&Wt.offscreen,Ne=Wt.occluded}if(Ue.iconFeatureIndex&&(Rr=Ue.iconFeatureIndex),Ue.iconBox){let Dr=kr=>{$r(kr);let jt=fe&&at?Ll(at.x,at.y,pe,se,this.transform.angle):new t.pointGeometry(0,0),ri=x.getSymbolInstanceIconSize(Z,this.transform.zoom,ze);return this.collisionIndex.placeCollisionBox(x,ri,kr,jt,de,F,E,H.predicate)};Tt&&Tt.box&&Tt.box.length&&Ue.verticalIconBox?(gt=Dr(Ue.verticalIconBox),Pe=gt.box.length>0):(gt=Dr(Ue.iconBox),Pe=gt.box.length>0),Je=Je&&gt.offscreen,st=gt.occluded}let vi=$||xe.numHorizontalGlyphVertices===0&&xe.numVerticalGlyphVertices===0,zn=ee||xe.numIconVertices===0;if(vi||zn?zn?vi||(Pe=Pe&&it):it=Pe&&it:Pe=it=Pe&&it,it&&qt&&qt.box&&this.collisionIndex.insertCollisionBox(qt.box,T.get("text-ignore-placement"),x.bucketInstanceId,Tt&&Tt.box&&rr?rr:Lt,H.ID),Pe&&gt&&this.collisionIndex.insertCollisionBox(gt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,Rr,H.ID),Wt&&(it&&this.collisionIndex.insertCollisionCircles(Wt.circles,T.get("text-ignore-placement"),x.bucketInstanceId,Lt,H.ID),m)){let Dr=x.bucketInstanceId,kr=this.collisionCircleArrays[Dr];kr===void 0&&(kr=this.collisionCircleArrays[Dr]=new Rl);for(let jt=0;jt<Wt.circles.length;jt+=4)kr.circles.push(Wt.circles[jt+0]),kr.circles.push(Wt.circles[jt+1]),kr.circles.push(Wt.circles[jt+2]),kr.circles.push(Wt.collisionDetected?1:0)}let xo=x.projection.name!=="globe";ge=ge&&(xo||!Ne),Ee=Ee&&(xo||!st),this.placements[xe.crossTileID]=new Kr(it||ge,Pe||Ee,Je||x.justReloaded),h[xe.crossTileID]=!0};if(he){let xe=x.getSortedSymbolIndexes(this.transform.angle);for(let ze=xe.length-1;ze>=0;--ze){let Ue=xe[ze];Ye(x.symbolInstances.get(Ue),Ue,x.collisionArrays[Ue])}}else for(let xe=a.symbolInstanceStart;xe<a.symbolInstanceEnd;xe++)Ye(x.symbolInstances.get(xe),xe,x.collisionArrays[xe]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){let xe=this.collisionCircleArrays[x.bucketInstanceId];t.invert(xe.invProjMatrix,E),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(a,h,m,v){let x;x=v===t.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(h)];let T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(let E of T)E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=x>=0&&E!==x?0:m.crossTileID)}markUsedOrientation(a,h,m){let v=h===t.WritingMode.horizontal||h===t.WritingMode.horizontalOnly?h:0,x=h===t.WritingMode.vertical?h:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(let E of T)a.text.placedSymbolArray.get(E).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;let h=this.prevPlacement,m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;let v=h?h.symbolFadeChange(a):1,x=h?h.opacities:{},T=h?h.variableOffsets:{},E=h?h.placedOrientations:{};for(let A in this.placements){let R=this.placements[A],D=x[A];D?(this.opacities[A]=new $o(D,v,R.text,R.icon,null,R.clipped),m=m||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[A]=new $o(null,v,R.text,R.icon,R.skipFade,R.clipped),m=m||R.text||R.icon)}for(let A in x){let R=x[A];if(!this.opacities[A]){let D=new $o(R,v,!1,!1);D.isHidden()||(this.opacities[A]=D,m=m||R.text.placed||R.icon.placed)}}for(let A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(let A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);m?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){let m={};for(let v of h){let x=v.getBucket(a);x&&v.latestFeatureIndex&&a.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,v.collisionBoxArray)}}updateBucketOpacities(a,h,m){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();let v=a.layers[0].layout,x=!!a.layers[0].dynamicFilter(),T=new $o(null,0,!1,!1,!0),E=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),R=v.get("text-variable-anchor"),D=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",X=new $o(null,0,E&&(A||!a.hasIconData()||v.get("icon-optional")),A&&(E||!a.hasTextData()||v.get("text-optional")),!0);!a.collisionArrays&&m&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(m);let W=(H,$,ee)=>{for(let Y=0;Y<$/4;Y++)H.opacityVertexArray.emplaceBack(ee)},Z=0;for(let H=0;H<a.symbolInstances.length;H++){let $=a.symbolInstances.get(H),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:Y,crossTileID:de}=$,pe=this.opacities[de];h[de]?pe=T:pe||(pe=X,this.opacities[de]=pe),h[de]=!0;let se=ee>0||Y>0,fe=$.numIconVertices>0,he=this.placedOrientations[$.crossTileID],ge=he===t.WritingMode.vertical,Ee=he===t.WritingMode.horizontal||he===t.WritingMode.horizontalOnly;if(!se&&!fe||pe.isHidden()||Z++,se){let Ye=Ma(pe.text);W(a.text,ee,ge?Ln:Ye),W(a.text,Y,Ee?Ln:Ye);let xe=pe.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(a.text.placedSymbolArray.get(it).hidden=xe||ge?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=xe||Ee?1:0);let ze=this.variableOffsets[$.crossTileID];ze&&this.markUsedJustification(a,ze.anchor,$,he);let Ue=this.placedOrientations[$.crossTileID];Ue&&(this.markUsedJustification(a,"left",$,Ue),this.markUsedOrientation(a,Ue,$))}if(fe){let Ye=Ma(pe.icon);$.placedIconSymbolIndex>=0&&(W(a.icon,$.numIconVertices,ge?Ln:Ye),a.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=pe.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(W(a.icon,$.numVerticalIconVertices,Ee?Ln:Ye),a.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){let Ye=a.collisionArrays[H];if(Ye){let xe=new t.pointGeometry(0,0),ze=!0;if(Ye.textBox||Ye.verticalTextBox){if(R){let it=this.variableOffsets[de];it?(xe=fi(it.anchor,it.width,it.height,it.textOffset,it.textScale),D&&xe._rotate(F?this.transform.angle:-this.transform.angle)):ze=!1}x&&(ze=!pe.clipped),Ye.textBox&&mn(a.textCollisionBox.collisionVertexArray,pe.text.placed,!ze||ge,xe.x,xe.y),Ye.verticalTextBox&&mn(a.textCollisionBox.collisionVertexArray,pe.text.placed,!ze||Ee,xe.x,xe.y)}let Ue=ze&&Boolean(!Ee&&Ye.verticalIconBox);Ye.iconBox&&mn(a.iconCollisionBox.collisionVertexArray,pe.icon.placed,Ue,j?xe.x:0,j?xe.y:0),Ye.verticalIconBox&&mn(a.iconCollisionBox.collisionVertexArray,pe.icon.placed,!Ue,j?xe.x:0,j?xe.y:0)}}}if(a.fullyClipped=Z===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){let H=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=H.invProjMatrix,a.placementViewportMatrix=H.viewportMatrix,a.collisionCircleArray=H.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){let m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>a}setStale(){this.stale=!0}}function mn(f,a,h,m,v){f.emplaceBack(a?1:0,h?1:0,m||0,v||0),f.emplaceBack(a?1:0,h?1:0,m||0,v||0),f.emplaceBack(a?1:0,h?1:0,m||0,v||0),f.emplaceBack(a?1:0,h?1:0,m||0,v||0)}let kl=Math.pow(2,25),ac=Math.pow(2,24),S0=Math.pow(2,17),Cp=Math.pow(2,16),gs=Math.pow(2,9),I0=Math.pow(2,8),Qm=Math.pow(2,1);function Ma(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let a=f.placed?1:0,h=Math.floor(127*f.opacity);return h*kl+a*ac+h*S0+a*Cp+h*gs+a*I0+h*Qm+a}let Ln=0;class sc{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,h,m,v,x){let T=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(T,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<T.length;){let E=T[this._currentPartIndex];if(h.placeLayerBucketPart(E,this._seenCrossTileIDs,m,E.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Wo{constructor(a,h,m,v,x,T,E,A){this.placement=new Op(a,x,T,E,A),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,h,m){let v=t.exported.now(),x=()=>{let T=t.exported.now()-v;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=h[a[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=E)&&(!T.maxzoom||T.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new sc(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}let Pp=512/t.EXTENT/2;class lc{constructor(a,h,m){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<h.length;v++){let x=h.get(v),T=x.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,a)})}}getScaledCoordinates(a,h){let m=Pp/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*t.EXTENT+a.tileAnchorX)*m),y:Math.floor((h.canonical.y*t.EXTENT+a.tileAnchorY)*m)}}findMatches(a,h,m){let v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let x=0;x<a.length;x++){let T=a.get(x);if(T.crossTileID)continue;let E=this.indexedSymbolInstances[T.key];if(!E)continue;let A=this.getScaledCoordinates(T,h);for(let R of E)if(Math.abs(R.coord.x-A.x)<=v&&Math.abs(R.coord.y-A.y)<=v&&!m[R.crossTileID]){m[R.crossTileID]=!0,T.crossTileID=R.crossTileID;break}}}}class A0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class O0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){let h=Math.round((a-this.lng)/360);if(h!==0)for(let m in this.indexes){let v=this.indexes[m],x={};for(let T in v){let E=v[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),x[E.tileID.key]=E}this.indexes[m]=x}this.lng=a}addBucket(a,h,m){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});let v=this.usedCrossTileIDs[a.overscaledZ];for(let x in this.indexes){let T=this.indexes[x];if(Number(x)>a.overscaledZ)for(let E in T){let A=T[E];A.tileID.isChildOf(a)&&A.findMatches(h.symbolInstances,a,v)}else{let E=T[a.scaledTo(Number(x)).key];E&&E.findMatches(h.symbolInstances,a,v)}}for(let x=0;x<h.symbolInstances.length;x++){let T=h.symbolInstances.get(x);T.crossTileID||(T.crossTileID=m.generate(),v[T.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new lc(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(let m in h.indexedSymbolInstances)for(let v of h.indexedSymbolInstances[m])delete this.usedCrossTileIDs[a][v.crossTileID]}removeStaleBuckets(a){let h=!1;for(let m in this.indexes){let v=this.indexes[m];for(let x in v)a[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[x]),delete v[x],h=!0)}return h}}class uc{constructor(){this.layerIndexes={},this.crossTileIDs=new A0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,m,v){let x=this.layerIndexes[a.id];x===void 0&&(x=this.layerIndexes[a.id]=new O0);let T=!1,E={};v.name!=="globe"&&x.handleWrapJump(m);for(let A of h){let R=A.getBucket(a);R&&a.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(A.tileID,R,this.crossTileIDs)&&(T=!0),E[R.bucketInstanceId]=!0)}return x.removeStaleBuckets(E)&&(T=!0),T}pruneUnusedLayers(a){let h={};a.forEach(m=>{h[m]=!0});for(let m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}let cc=(f,a)=>t.emitValidationErrors(f,a&&a.filter(h=>h.identifier!=="source.canvas")),e_=t.pick(Et,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),C0=t.pick(Et,["setCenter","setZoom","setBearing","setPitch"]),t_={version:8,layers:[],sources:{}},P0={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class _n extends t.Evented{constructor(a,h={}){super(),this.map=a,this.dispatcher=new vt(dr(),this),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(a._requestManager,h.localFontFamily?t.LocalGlyphMode.all:h.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new t.LineAtlas(256,512),this.crossTileSymbolIndex=new uc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());let m=this;this._rtlTextPluginCallback=_n.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,T)=>{if(t.triggerPluginCompletionEvent(x),T&&T.every(E=>E))for(let E in m._sourceCaches){let A=m._sourceCaches[E],R=A.getSource().type;R!=="vector"&&R!=="geojson"||A.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let x=this.getSource(v.sourceId);if(x&&x.vectorLayerIds)for(let T in this._layers){let E=this._layers[T];E.source===x.id&&this._validateLayer(E)}})}loadURL(a,h={}){this.fire(new t.Event("dataloading",{dataType:"style"}));let m=typeof h.validate=="boolean"?h.validate:!t.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);let v=this.map._requestManager.transformRequest(a,t.ResourceType.Style);this._request=t.getJSON(v,(x,T)=>{this._request=null,x?this.fire(new t.ErrorEvent(x)):T&&this._load(T,m)})}loadJSON(a,h={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(a,h.validate!==!1)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(t_,!1)}_updateLayerCount(a,h){let m=h?1:-1;a.is3D()&&(this._num3DLayers+=m),a.type==="circle"&&(this._numCircleLayers+=m),a.type==="symbol"&&(this._numSymbolLayers+=m)}_load(a,h){if(h&&cc(this,t.validateStyle(a)))return;this._loaded=!0,this.stylesheet=t.clone$1(a),this._updateMapProjection();for(let v in a.sources)this.addSource(v,a.sources[v],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);let m=mr(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=t.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new gr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(h,m,v){let x,T,E,A=t.exported.devicePixelRatio>1?"@2x":"",R=t.getJSON(m.transformRequest(m.normalizeSpriteURL(h,A,".json"),t.ResourceType.SpriteJSON),(j,X)=>{R=null,E||(E=j,x=X,F())}),D=t.getImage(m.transformRequest(m.normalizeSpriteURL(h,A,".png"),t.ResourceType.SpriteImage),(j,X)=>{D=null,E||(E=j,T=X,F())});function F(){if(E)v(E);else if(x&&T){let j=t.exported.getImageData(T),X={};for(let W in x){let{width:Z,height:H,x:$,y:ee,sdf:Y,pixelRatio:de,stretchX:pe,stretchY:se,content:fe}=x[W],he=new t.RGBAImage({width:Z,height:H});t.RGBAImage.copy(j,he,{x:$,y:ee},{x:0,y:0},{width:Z,height:H}),X[W]={data:he,pixelRatio:de,sdf:Y,stretchX:pe,stretchY:se,content:fe}}v(null,X)}}return{cancel(){R&&(R.cancel(),R=null),D&&(D.cancel(),D=null)}}}(a,this.map._requestManager,(h,m)=>{if(this._spriteRequest=null,h)this.fire(new t.ErrorEvent(h));else if(m)for(let v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(a){let h=this.getSource(a.source);if(!h)return;let m=a.sourceLayer;m&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(m)===-1)&&this.fire(new t.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){let h=[];for(let m of a){let v=this._layers[m];v.type!=="custom"&&h.push(v.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(let a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&P0[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;let h=this._changed;if(this._changed){let v=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(v.length||x.length)&&this._updateWorkerLayers(v,x);for(let T in this._updatedSources){let E=this._updatedSources[T];E==="reload"?this._reloadSource(T):E==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(let T in this._updatedPaintProps)this._layers[T].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}let m={};for(let v in this._sourceCaches){let x=this._sourceCaches[v];m[v]=x.used,x.used=!1}for(let v of this._order){let x=this._layers[v];if(x.recalculate(a,this._availableImages),!x.isHidden(a.zoom)){let E=this._getLayerSourceCache(x);E&&(E.used=!0)}let T=this.map.painter;if(T){let E=x.getProgramIds();if(!E)continue;let A=x.getProgramConfiguration(a.zoom);for(let R of E)T.useProgram(R,A)}}for(let v in m){let x=this._sourceCaches[v];m[v]!==x.used&&x.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let a=Object.keys(this._changedImages);if(a.length){for(let h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),cc(this,t.validateStyle(a)))return!1;(a=t.clone$1(a)).layers=mr(a.layers);let h=function(v,x){if(!v)return[{command:Et.setStyle,args:[x]}];let T=[];try{if(!g(v.version,x.version))return[{command:Et.setStyle,args:[x]}];g(v.center,x.center)||T.push({command:Et.setCenter,args:[x.center]}),g(v.zoom,x.zoom)||T.push({command:Et.setZoom,args:[x.zoom]}),g(v.bearing,x.bearing)||T.push({command:Et.setBearing,args:[x.bearing]}),g(v.pitch,x.pitch)||T.push({command:Et.setPitch,args:[x.pitch]}),g(v.sprite,x.sprite)||T.push({command:Et.setSprite,args:[x.sprite]}),g(v.glyphs,x.glyphs)||T.push({command:Et.setGlyphs,args:[x.glyphs]}),g(v.transition,x.transition)||T.push({command:Et.setTransition,args:[x.transition]}),g(v.light,x.light)||T.push({command:Et.setLight,args:[x.light]}),g(v.fog,x.fog)||T.push({command:Et.setFog,args:[x.fog]}),g(v.projection,x.projection)||T.push({command:Et.setProjection,args:[x.projection]});let E={},A=[];(function(F,j,X,W){let Z;for(Z in j=j||{},F=F||{})F.hasOwnProperty(Z)&&(j.hasOwnProperty(Z)||Qi(Z,X,W));for(Z in j)j.hasOwnProperty(Z)&&(F.hasOwnProperty(Z)?g(F[Z],j[Z])||(F[Z].type==="geojson"&&j[Z].type==="geojson"&&jo(F,j,Z)?X.push({command:Et.setGeoJSONSourceData,args:[Z,j[Z].data]}):Gr(Z,j,X,W)):qe(Z,j,X))})(v.sources,x.sources,A,E);let R=[];v.layers&&v.layers.forEach(F=>{F.source&&E[F.source]?T.push({command:Et.removeLayer,args:[F.id]}):R.push(F)});let D=v.terrain;D&&E[D.source]&&(T.push({command:Et.setTerrain,args:[void 0]}),D=void 0),T=T.concat(A),g(D,x.terrain)||T.push({command:Et.setTerrain,args:[x.terrain]}),function(F,j,X){j=j||[];let W=(F=F||[]).map(qn),Z=j.map(qn),H=F.reduce(nc,{}),$=j.reduce(nc,{}),ee=W.slice(),Y=Object.create(null),de,pe,se,fe,he,ge,Ee;for(de=0,pe=0;de<W.length;de++)se=W[de],$.hasOwnProperty(se)?pe++:(X.push({command:Et.removeLayer,args:[se]}),ee.splice(ee.indexOf(se,pe),1));for(de=0,pe=0;de<Z.length;de++)se=Z[Z.length-1-de],ee[ee.length-1-de]!==se&&(H.hasOwnProperty(se)?(X.push({command:Et.removeLayer,args:[se]}),ee.splice(ee.lastIndexOf(se,ee.length-pe),1)):pe++,ge=ee[ee.length-de],X.push({command:Et.addLayer,args:[$[se],ge]}),ee.splice(ee.length-de,0,se),Y[se]=!0);for(de=0;de<Z.length;de++)if(se=Z[de],fe=H[se],he=$[se],!Y[se]&&!g(fe,he))if(g(fe.source,he.source)&&g(fe["source-layer"],he["source-layer"])&&g(fe.type,he.type)){for(Ee in ic(fe.layout,he.layout,X,se,null,Et.setLayoutProperty),ic(fe.paint,he.paint,X,se,null,Et.setPaintProperty),g(fe.filter,he.filter)||X.push({command:Et.setFilter,args:[se,he.filter]}),g(fe.minzoom,he.minzoom)&&g(fe.maxzoom,he.maxzoom)||X.push({command:Et.setLayerZoomRange,args:[se,he.minzoom,he.maxzoom]}),fe)fe.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ic(fe[Ee],he[Ee],X,se,Ee.slice(6),Et.setPaintProperty):g(fe[Ee],he[Ee])||X.push({command:Et.setLayerProperty,args:[se,Ee,he[Ee]]}));for(Ee in he)he.hasOwnProperty(Ee)&&!fe.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ic(fe[Ee],he[Ee],X,se,Ee.slice(6),Et.setPaintProperty):g(fe[Ee],he[Ee])||X.push({command:Et.setLayerProperty,args:[se,Ee,he[Ee]]}))}else X.push({command:Et.removeLayer,args:[se]}),ge=ee[ee.lastIndexOf(se)+1],X.push({command:Et.addLayer,args:[he,ge]})}(R,x.layers,T)}catch(E){console.warn("Unable to compute style diff:",E),T=[{command:Et.setStyle,args:[x]}]}return T}(this.serialize(),a).filter(v=>!(v.command in C0));if(h.length===0)return!1;let m=h.filter(v=>!(v.command in e_));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return h.forEach(v=>{v.command!=="setTransition"&&v.command!=="setProjection"&&this[v.command].apply(this,v.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,h){return this.getImage(a)?this.fire(new t.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new t.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,h,m={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(t.validateSource,`sources.${a}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);let v=Te(a,h,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:v.serialize(),sourceId:a}));let x=T=>{let E=(T?"symbol:":"other:")+a,A=this._sourceCaches[E]=new t.SourceCache(E,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[a]=A,A.style=this,A.onAdd(this.map)};x(!1),h.type!=="vector"&&h.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();let h=this.getSource(a);if(!h)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===a)return this.fire(new t.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new t.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));let m=this._getSourceCaches(a);for(let v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getSource(a).setData(h),this._changed=!0}getSource(a){let h=this._getSourceCache(a);return h&&h.getSource()}addLayer(a,h,m={}){this._checkLoaded();let v=a.id;if(this.getLayer(v))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(a.type==="custom"){if(cc(this,t.validateCustomStyleLayer(a)))return;x=t.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(v,a.source),a=t.clone$1(a),a=t.extend(a,{source:v})),this._validate(t.validateLayer,`layers.${v}`,a,{arrayIndex:-1},m))return;x=t.createStyleLayer(a),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}let T=h?this._order.indexOf(h):this._order.length;if(h&&T===-1)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=x;let E=this._getLayerSourceCache(x);if(this._removedLayers[v]&&x.source&&E&&x.type!=="custom"){let A=this._removedLayers[v];delete this._removedLayers[v],A.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",E.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;let m=this._order.indexOf(a);this._order.splice(m,1);let v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new t.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(v,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();let h=this._layers[a];if(!h)return void this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);let m=this._order.indexOf(a);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(let h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,m){this._checkLoaded();let v=this.getLayer(a);v?v.minzoom===h&&v.maxzoom===m||(h!=null&&(v.minzoom=h),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,h,m={}){this._checkLoaded();let v=this.getLayer(a);if(v){if(!g(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(t.validateFilter,`layers.${v.id}.filter`,h,{layerType:v.type},m)||(v.filter=t.clone$1(h),this._updateLayer(v)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){let h=this.getLayer(a);return h&&t.clone$1(h.filter)}setLayoutProperty(a,h,m,v={}){this._checkLoaded();let x=this.getLayer(a);x?g(x.getLayoutProperty(h),m)||(x.setLayoutProperty(h,m,v),this._updateLayer(x)):this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,h){let m=this.getLayer(a);if(m)return m.getLayoutProperty(h);this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,h,m,v={}){this._checkLoaded();let x=this.getLayer(a);x?g(x.getPaintProperty(h),m)||(x.setPaintProperty(h,m,v)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,h){let m=this.getLayer(a);return m&&m.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();let m=a.source,v=a.sourceLayer,x=this.getSource(m);if(!x)return void this.fire(new t.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));let T=x.type;if(T==="geojson"&&v)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));let E=this._getSourceCaches(m);for(let A of E)A.setFeatureState(v,a.id,h)}removeFeatureState(a,h){this._checkLoaded();let m=a.source,v=this.getSource(m);if(!v)return void this.fire(new t.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));let x=v.type,T=x==="vector"?a.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let E=this._getSourceCaches(m);for(let A of E)A.removeFeatureState(T,a.id,h)}getFeatureState(a){this._checkLoaded();let h=a.source,m=a.sourceLayer,v=this.getSource(h);if(v){if(v.type!=="vector"||m)return a.id===void 0&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(m,a.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let a={};for(let h in this._sourceCaches){let m=this._sourceCaches[h].getSource();a[m.id]||(a[m.id]=m.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0;let h=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",h.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){let h=T=>this._layers[T].type==="fill-extrusion",m={},v=[];for(let T=this._order.length-1;T>=0;T--){let E=this._order[T];if(h(E)){m[E]=T;for(let A of a){let R=A[E];if(R)for(let D of R)v.push(D)}}}v.sort((T,E)=>E.intersectionZ-T.intersectionZ);let x=[];for(let T=this._order.length-1;T>=0;T--){let E=this._order[T];if(h(E))for(let A=v.length-1;A>=0;A--){let R=v[A].feature;if(m[R.layer.id]<T)break;x.push(R),v.pop()}else for(let A of a){let R=A[E];if(R)for(let D of R)x.push(D.feature)}}return x}queryRenderedFeatures(a,h,m){h&&h.filter&&this._validate(t.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);let v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let A of h.layers){let R=this._layers[A];if(!R)return this.fire(new t.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[R.source]=!0}}let x=[];h.availableImages=this._availableImages;let T=h&&h.layers?h.layers.some(A=>{let R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),E=Xt.createFromScreenPoints(a,m);for(let A in this._sourceCaches){let R=this._sourceCaches[A].getSource().id;h.layers&&!v[R]||x.push(ut(this._sourceCaches[A],this._layers,this._serializedLayers,E,h,m,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,R,D,F,j,X,W){let Z={},H=X.queryRenderedSymbols(F),$=[];for(let ee of Object.keys(H).map(Number))$.push(W[ee]);$.sort(St);for(let ee of $){let Y=ee.featureIndex.lookupSymbolFeatures(H[ee.bucketInstanceId],R,ee.bucketIndex,ee.sourceLayerIndex,j.filter,j.layers,j.availableImages,A);for(let de in Y){let pe=Z[de]=Z[de]||[],se=Y[de];se.sort((fe,he)=>{let ge=ee.featureSortOrder;if(ge){let Ee=ge.indexOf(fe.featureIndex);return ge.indexOf(he.featureIndex)-Ee}return he.featureIndex-fe.featureIndex});for(let fe of se)pe.push(fe)}}for(let ee in Z)Z[ee].forEach(Y=>{let de=Y.feature,pe=D(A[ee]).getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=pe});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(a,h){h&&h.filter&&this._validate(t.validateFilter,"querySourceFeatures.filter",h.filter,null,h);let m=this._getSourceCaches(a),v=[];for(let x of m)v=v.concat(Xe(x,h));return v}addSourceType(a,h,m){return _n.getSourceType(a)?m(new Error(`A source type called "${a}" already exists.`)):(_n.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();let m=this.light.getLight(),v=!1;for(let T in a)if(!g(a[T],m[T])){v=!0;break}if(!v)return;let x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(h===1){if(typeof a.source=="object"){let m="terrain-dem-src";this.addSource(m,a.source),a=t.clone$1(a),a=t.extend(a,{source:m})}if(this._validate(t.validateTerrain,"terrain",a))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(a,h);else{let m=this.terrain,v=m.get();for(let x of Object.keys(t.spec.terrain))!a.hasOwnProperty(x)&&t.spec.terrain[x].default&&(a[x]=t.spec.terrain[x].default);for(let x in a)if(!g(a[x],v[x])){m.set(a),this.stylesheet.terrain=a;let T=this._setTransitionParameters({duration:0});m.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){let h=this.fog=new ot(a,this.map.transform);this.stylesheet.fog=a;let m=this._setTransitionParameters({duration:0});h.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let h=this.fog,m=h.get();Object.keys(a).length===0&&h.set(a);for(let v in a)if(!g(a[v],m[v])){h.set(a),this.stylesheet.fog=a;let x=this._setTransitionParameters({duration:0});h.updateTransitions(x);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:t.exported.now(),transition:t.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let a=this._order.filter(m=>this.isLayerDraped(this._layers[m])),h=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){let m=this.terrain=new Me(a,h);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let v=this._setTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(let a in this._layers){let h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(let a in this._layers){let h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,m,v,x={}){return(!x||x.validate!==!1)&&cc(this,a.call(t.validateStyle,t.extend({key:h,style:this.serialize(),value:m,styleSpec:t.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let a in this._layers)this._layers[a].setEventedParent(null);for(let a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){let h=this._getSourceCaches(a);for(let m of h)m.clearTiles()}_reloadSource(a){let h=this._getSourceCaches(a);for(let m of h)m.resume(),m.reload()}_updateSources(a){for(let h in this._sourceCaches)this._sourceCaches[h].update(a)}_generateCollisionBoxes(){for(let a in this._sourceCaches){let h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,m,v,x=!1){let T=!1,E=!1,A={};for(let R of this._order){let D=this._layers[R];if(D.type!=="symbol")continue;if(!A[D.source]){let j=this._getLayerSourceCache(D);if(!j)continue;A[D.source]=j.getRenderableIds(!0).map(X=>j.getTileByID(X)).sort((X,W)=>W.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(W.tileID)?-1:1))}let F=this.crossTileSymbolIndex.addLayer(D,A[D.source],a.center.lng,a.projection);T=T||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),a.zoom))&&(this.pauseablePlacement=new Wo(a,this._order,x,h,m,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),E=!0),T&&this.pauseablePlacement.placement.setStale()),E||T)for(let R of this._order){let D=this._layers[R];D.type==="symbol"&&this.placement.updateLayerOpacities(D,A[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(let a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h,m){this.imageManager.getImages(h.icons,m),this._updateTilesForChangedImages();let v=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(a,h,m){this.glyphManager.getGlyphs(h.stacks,m)}getResource(a,h,m){return t.makeRequest(h,m)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){let h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){let h=this._getSourceCaches(a);return h.length===0?(this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):h.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}_n.getSourceType=function(f){return ye[f]},_n.setSourceType=function(f,a){ye[f]=a},_n.registerForPluginStateChange=t.registerForPluginStateChange;var Mp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,qp="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Rp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Dp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,vs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let hc={},qa={},Zo=[];Ra(Mp,Zo),Ra(Rp,Zo),Ra(Dp,Zo),Ra(vs,Zo),hc=or("",Rp),qa=or(vs,Dp);let zl=or(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),pc=Mp,fc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var dc={background:or(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:or(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:or(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:or("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:or(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:or(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:or("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:or("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:or("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:or(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:or(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:or(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:or(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:or(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:or(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:or(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:or(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:or(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:or(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:or(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:or(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:or(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:or(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:or(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:or(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:or(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qp),skyboxGradient:or(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,qp),skyboxCapture:or(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:or(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:or(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ra(f,a){let h=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of h)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=m.split(" ");for(let x of v)a.includes(x)||a.push(x)}}function or(f,a){let h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},x=[...Zo];return Ra(f,x),Ra(a,x),{fragmentSource:f=f.replace(h,(T,E,A,R,D)=>(v[D]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${A} ${R} ${D};
#else
uniform ${A} ${R} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${A} ${R} ${D} = u_${D};
#endif
`)),vertexSource:a=a.replace(h,(T,E,A,R,D)=>{let F=R==="float"?"vec2":"vec4",j=D.match(/color/)?"color":F;return v[D]?E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${A} ${F} a_${D};
varying ${A} ${R} ${D};
#else
uniform ${A} ${R} u_${D};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${A} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${j}(a_${D}, u_${D}_t);
#else
    ${A} ${R} ${D} = u_${D};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${A} ${F} a_${D};
#else
uniform ${A} ${R} u_${D};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${R} ${D} = a_${D};
#else
    ${A} ${R} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${R} ${D} = unpack_mix_${j}(a_${D}, u_${D}_t);
#else
    ${A} ${R} ${D} = u_${D};
#endif
`}),staticAttributes:m,usedDefines:x}}class mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,m,v,x,T,E){this.context=a;let A=this.boundPaintVertexBuffers.length!==v.length;for(let D=0;!A&&D<v.length;D++)this.boundPaintVertexBuffers[D]!==v[D]&&(A=!0);let R=this.boundDynamicVertexBuffers.length!==E.length;for(let D=0;!R&&D<E.length;D++)this.boundDynamicVertexBuffers[D]!==E[D]&&(R=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||A||R||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(h,m,v,x,T,E);else{a.bindVertexArrayOES.set(this.vao);for(let D of E)D&&D.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(a,h,m,v,x,T){let E,A=a.numAttributes,R=this.context,D=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T;else{E=R.currentNumAttributes||0;for(let F=A;F<E;F++)D.disableVertexAttribArray(F)}h.enableAttributes(D,a),h.bind(),h.setVertexAttribPointers(D,a,x);for(let F of m)F.enableAttributes(D,a),F.bind(),F.setVertexAttribPointers(D,a,x);for(let F of T)F&&(F.enableAttributes(D,a),F.bind(),F.setVertexAttribPointers(D,a,x));v&&v.bind(),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Lp(f,a){let h=Math.pow(2,a.canonical.z),m=a.canonical.y;return[new t.MercatorCoordinate(0,m/h).toLngLat().lat,new t.MercatorCoordinate(0,(m+1)/h).toLngLat().lat]}function kp(f,a,h,m,v,x,T){let E=f.context,A=E.gl,R=h.fbo;if(!R)return;f.prepareDrawTile();let D=f.useProgram("hillshade");E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());let F=((Z,H,$,ee)=>{let Y=$.paint.get("hillshade-shadow-color"),de=$.paint.get("hillshade-highlight-color"),pe=$.paint.get("hillshade-accent-color"),se=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=Z.transform.angle);let fe=!Z.options.moving;return{u_matrix:ee||Z.transform.calculateProjMatrix(H.tileID.toUnwrapped(),fe),u_image:0,u_latrange:Lp(0,H.tileID),u_light:[$.paint.get("hillshade-exaggeration"),se],u_shadow:Y,u_highlight:de,u_accent:pe}})(f,h,m,f.terrain?a.projMatrix:null);f.prepareDrawProgram(E,D,a.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=f.getTileBoundsBuffers(h);D.draw(E,A.TRIANGLES,v,x,T,t.CullFaceMode.disabled,F,m.id,j,X,W)}function tr(f,a,h){if(!a.needsDEMTextureUpload)return;let m=f.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||f.getTileTexture(h.stride);let x=h.getPixels();a.demTexture?a.demTexture.update(x,{premultiply:!1}):a.demTexture=new t.Texture(m,x,v.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function xs(f,a,h,m,v,x){let T=f.context,E=T.gl;if(!a.dem)return;let A=a.dem;if(T.activeTexture.set(E.TEXTURE1),tr(f,a,A),!a.demTexture)return;a.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);let R=A.dim;T.activeTexture.set(E.TEXTURE0);let D=a.fbo;if(!D){let W=new t.Texture(T,{width:R,height:R,data:null},E.RGBA);W.bind(E.LINEAR,E.CLAMP_TO_EDGE),D=a.fbo=T.createFramebuffer(R,R,!0),D.colorAttachment.set(W.texture)}T.bindFramebuffer.set(D.framebuffer),T.viewport.set([0,0,R,R]);let{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:X}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(T,E.TRIANGLES,m,v,x,t.CullFaceMode.disabled,((W,Z)=>{let H=Z.stride,$=t.create();return t.ortho($,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate($,$,[0,-t.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[H,H],u_zoom:W.overscaledZ,u_unpack:Z.unpackVector}})(a.tileID,A),h.id,F,j,X),a.needsHillshadePrepare=!1}let Bl=f=>({u_matrix:new t.UniformMatrix4f(f),u_image0:new t.Uniform1i(f),u_skirt_height:new t.Uniform1f(f)}),zp=(f,a)=>({u_matrix:f,u_image0:0,u_skirt_height:a}),Bp=(f,a,h,m,v,x,T,E,A,R,D,F,j,X)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:E,u_frustum_br:A,u_frustum_bl:R,u_globe_pos:D,u_globe_radius:F,u_viewport:j,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9)});function Fp(f,a){return f!=null&&a!=null&&!(!f.hasData()||!a.hasData())&&f.demTexture!=null&&a.demTexture!=null&&f.tileID.key!==a.tileID.key}let Ho=new class{constructor(){this.operations={}}newMorphing(f,a,h,m,v){if(f in this.operations){let x=this.operations[f];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[f]={startTime:m,phase:0,duration:v,from:a,to:h,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let a=this.operations[f];return{from:a.from,to:a.to,phase:a.phase}}update(f){for(let a in this.operations){let h=this.operations[a];for(h.phase=(f-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,f)){delete this.operations[a];break}}}_nextOp(f,a){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=a,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Fl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function M0(f,a){let h=1<<f.z;return!a&&(f.x===0||f.x===h-1)||f.y===0||f.y===h-1}let Np=f=>({u_matrix:f});function _c(f,a,h,m,v){if(v>0){let x=t.exported.now(),T=(x-f.timeAdded)/v,E=a?(x-a.timeAdded)/v:-1,A=h.getSource(),R=m.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!a||Math.abs(a.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),F=D&&f.refreshedUponExpiration?1:t.clamp(D?T:1-E,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),a?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Up extends t.SourceCache{constructor(a){let h={type:"raster-dem",maxzoom:a.transform.maxZoom},m=new vt(dr(),null),v=Te("mock-dem",h,m,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class jp extends t.SourceCache{constructor(a){let h=Te("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new vt(dr(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,m){if(a.freezeTileCoverage)return;this.transform=a;let v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){let E=new t.Tile(T,this._source.tileSize*T.overscaleFactor(),a.tileZoom);E.state="loaded",this._tiles[T.key]=E}return x},{});for(let x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(a){let h=this.proxyCachedFBO[a];if(h!==void 0){let m=Object.values(h);this.renderCachePool.push(...m),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class yc extends t.OverscaledTileID{constructor(a,h,m){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=m}}class r_ extends t.Elevation{constructor(a,h){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[m,v,x]=function(A){let R=new t.StructArrayLayout4i8,D=new t.StructArrayLayout3ui6,F=131;R.reserve(17161),D.reserve(33800);let j=t.EXTENT/128,X=t.EXTENT+j/2,W=X+j;for(let H=-j;H<W;H+=j)for(let $=-j;$<W;$+=j){let ee=$<0||$>X||H<0||H>X?24575:0,Y=t.clamp(Math.round($),0,t.EXTENT),de=t.clamp(Math.round(H),0,t.EXTENT);R.emplaceBack(Y+ee,de,Y,de)}let Z=(H,$)=>{let ee=$*F+H;D.emplaceBack(ee+1,ee,ee+F),D.emplaceBack(ee+F,ee+F+1,ee+1)};for(let H=1;H<129;H++)for(let $=1;$<129;$++)Z($,H);return[0,129].forEach(H=>{for(let $=0;$<130;$++)Z($,H),Z(H,$)}),[R,D,32768]}(),T=a.context;this.gridBuffer=T.createVertexBuffer(m,t.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=t.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jp(h.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);let E=T.gl;this._overlapStencilMode=new t.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Up(h.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,h,m){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;let v=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");let x=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let T=this.getScaledDemTileSize();this.sourceCache.update(h,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),h.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&t.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let h=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=h.getIds().map(A=>{let R=h.getTileByID(A).tileID;return R.projMatrix=m.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){let D=R.transform.pointCoordinate(R.transform.getCameraPoint()),F=new t.pointGeometry(D.x,D.y);A.sort((j,X)=>{if(X.overscaledZ-j.overscaledZ)return X.overscaledZ-j.overscaledZ;let W=new t.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Z=new t.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),H=F.mult(1<<j.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(W)-H.distSqr(Z)})})(v,this.painter),this._previousZoom=m.zoom;let x=this.proxyToSource||{};this.proxyToSource={},v.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let T=this._style._sourceCaches;for(let A in T){let R=T[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,a[A],x),R.usedForTerrain))continue;let D=a[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[h.id]=v.map(A=>new yc(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();let E={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let R=this.terrainTileForTile[A.key];if(!R)continue;let D=R.tileID.key;D in E||(this._visibleDemTiles.push(R),E[D]=D)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;let m=this._findTileCoveringTileID(h,this.sourceCache);m&&(this.terrainTileForTile[h.key]=m)})}_prepareDEMTextures(){let a=this.painter.context,h=a.gl;for(let m in this.terrainTileForTile){let v=this.terrainTileForTile[m],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),tr(this.painter,v,x))}}_prepareDemTileUniforms(a,h,m,v){if(!h||h.demTexture==null)return!1;let x=a.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-x.z),E=v||"";return m[`u_dem_tl${E}`]=[x.x*T%1,x.y*T%1],m[`u_dem_scale${E}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){let m=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(a,m,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0,h=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;let x=v.dem.tree.minimums[0];return x>0&&a++,m+x},0);return a?h/a:0}_updateEmptyDEMTexture(){let a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);let m=this._getLoadedAreaMinimum(),v=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new t.Texture(a,v,h.RGBA,{premultiply:!1}),x}setupElevationDraw(a,h,m){let v=this.painter.context,x=v.gl,T=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let A=this.painter.transform,R=A.projection,D=a.tileID.canonical;T.u_tile_tl_up=R.upVector(D,0,0),T.u_tile_tr_up=R.upVector(D,t.EXTENT,0),T.u_tile_br_up=R.upVector(D,t.EXTENT,t.EXTENT),T.u_tile_bl_up=R.upVector(D,0,t.EXTENT),T.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?t.GLOBE_METERS_TO_ECEF:R.upVectorScale(D,A.center.lat,A.worldSize).metersToTile;let F=null,j=null,X=1;if(m&&m.morphing&&this._useVertexMorphing){let W=m.morphing.srcDemTile,Z=m.morphing.dstDemTile;X=m.morphing.phase,W&&Z&&(this._prepareDemTileUniforms(a,W,T,"_prev")&&(j=W),this._prepareDemTileUniforms(a,Z,T)&&(F=Z))}if(j&&F?(v.activeTexture.set(x.TEXTURE2),F.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),v.activeTexture.set(x.TEXTURE4),j.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=X):(F=this.terrainTileForTile[a.tileID.key],v.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(a,F,T)?F.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&F){let W=(1<<F.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=W}m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),h.setTerrainUniformValues(v,T)}renderToBackBuffer(a){let h=this.painter,m=this.painter.context;a.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,T,E,A){if(v.transform.projection.name==="globe")(function(R,D,F,j,X){let W=R.context,Z=W.gl,H,$,ee=R.options.showTerrainWireframe?2:0,Y=R.transform,de=t.globeUseCustomAntiAliasing(R,W,Y),pe=(it,Pe)=>{if($===it)return;let Je=[Fl[it],"PROJECTION_GLOBE_VIEW"];de&&Je.push("CUSTOM_ANTIALIASING"),Pe&&Je.push(Fl[ee]),H=R.useProgram("globeRaster",null,Je),$=it},se=R.colorModeForRenderPass(),fe=new t.DepthMode(Z.LEQUAL,t.DepthMode.ReadWrite,R.depthRangeFor3D);Ho.update(X);let he=t.calculateGlobeMercatorMatrix(Y),ge=[t.mercatorXfromLng(Y.center.lng),t.mercatorYfromLat(Y.center.lat)],Ee=ee?[!1,!0]:[!1],Ye=R.globeSharedBuffers,xe=[Y.width*t.exported.devicePixelRatio,Y.height*t.exported.devicePixelRatio],ze=Float32Array.from(Y.globeMatrix),Ue={useDenormalizedUpVectorScale:!0};if(Ee.forEach(it=>{$=-1;let Pe=it?Z.LINES:Z.TRIANGLES;for(let Je of j){let Ne=F.getTile(Je),st=t.StencilMode.disabled,at=D.prevTerrainTileForTile[Je.key],yt=D.terrainTileForTile[Je.key];Fp(at,yt)&&Ho.newMorphing(Je.key,at,yt,X,250),W.activeTexture.set(Z.TEXTURE0),Ne.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Tt=Ho.getMorphValuesForProxy(Je.key),qt=Tt?1:0;Tt&&t.extend$1(Ue,{morphing:{srcDemTile:Tt.from,dstDemTile:Tt.to,phase:t.easeCubicInOut(Tt.phase)}});let Wt=t.tileCornersToBounds(Je.canonical),gt=t.getLatitudinalLod(Wt.getCenter().lat),Lt=t.getGridMatrix(Je.canonical,Wt,gt),rr=t.globeNormalizeECEF(t.globeTileBounds(Je.canonical)),Rr=Bp(Y.projMatrix,ze,he,rr,t.globeToMercatorTransition(Y.zoom),ge,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,xe,Lt);if(pe(qt,it),D.setupElevationDraw(Ne,H,Ue),R.prepareDrawProgram(W,H,Je.toUnwrapped()),Ye){let[$r,xr,vi]=it?Ye.getWirefameBuffers(R.context,gt):Ye.getGridBuffers(gt);H.draw(W,Pe,fe,st,se,t.CullFaceMode.backCCW,Rr,"globe_raster",$r,xr,vi)}}}),Ye){let it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&it.push("CUSTOM_ANTIALIASING"),H=R.useProgram("globeRaster",null,it);for(let Pe of j){let{x:Je,y:Ne,z:st}=Pe.canonical,at=Ne===0,yt=Ne===(1<<st)-1,[Tt,qt,Wt,gt]=Ye.getPoleBuffers(st);if(gt&&(at||yt)){let Lt=F.getTile(Pe);W.activeTexture.set(Z.TEXTURE0),Lt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let rr=t.globePoleMatrixForTile(st,Je,Y),Rr=t.globeNormalizeECEF(t.globeTileBounds(Pe.canonical)),$r=(xr,vi)=>xr.draw(W,Z.TRIANGLES,fe,t.StencilMode.disabled,se,t.CullFaceMode.disabled,Bp(Y.projMatrix,rr,rr,Rr,0,ge,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,xe),"globe_pole_raster",vi,Wt,gt);D.setupElevationDraw(Lt,H,Ue),R.prepareDrawProgram(W,H,Pe.toUnwrapped()),at&&$r(H,Tt),yt&&(rr=t.scale(t.create(),rr,[1,-1,1]),$r(H,qt))}}}})(v,x,T,E,A);else{let R=v.context,D=R.gl,F,j,X=v.options.showTerrainWireframe?2:0,W=(Y,de)=>{if(j===Y)return;let pe=[Fl[Y]];de&&pe.push(Fl[X]),F=v.useProgram("terrainRaster",null,pe),j=Y},Z=v.colorModeForRenderPass(),H=new t.DepthMode(D.LEQUAL,t.DepthMode.ReadWrite,v.depthRangeFor3D);Ho.update(A);let $=v.transform,ee=6*Math.pow(1.5,22-$.zoom)*x.exaggeration();(X?[!1,!0]:[!1]).forEach(Y=>{j=-1;let de=Y?D.LINES:D.TRIANGLES,[pe,se]=Y?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(let fe of E){let he=T.getTile(fe),ge=t.StencilMode.disabled,Ee=x.prevTerrainTileForTile[fe.key],Ye=x.terrainTileForTile[fe.key];Fp(Ee,Ye)&&Ho.newMorphing(fe.key,Ee,Ye,A,250),R.activeTexture.set(D.TEXTURE0),he.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);let xe=Ho.getMorphValuesForProxy(fe.key),ze=xe?1:0,Ue;xe&&(Ue={morphing:{srcDemTile:xe.from,dstDemTile:xe.to,phase:t.easeCubicInOut(xe.phase)}});let it=zp(fe.projMatrix,M0(fe.canonical,$.renderWorldCopies)?ee/10:ee);W(ze,Y),x.setupElevationDraw(he,F,Ue),v.prepareDrawProgram(R,F,fe.toUnwrapped()),F.draw(R,de,H,ge,Z,t.CullFaceMode.backCCW,it,"terrain_raster",x.gridBuffer,pe,se)}})}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;let h=this.painter,m=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),E=[],A=h.style.order,R=0;for(let D of x){let F=v.getTileByID(D.proxyTileKey),j=v.proxyCachedFBO[D.key]?v.proxyCachedFBO[D.key][a]:void 0,X=j!==void 0?v.renderCache[j]:this.pool[R++],W=j!==void 0;if(F.texture=X.tex,W&&!X.dirty){E.push(F.tileID);continue}let Z;m.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(m.clear({color:t.Color.transparent,stencil:0}),X.dirty=!1);for(let H=T.start;H<=T.end;++H){let $=h.style._layers[A[H]];if($.isHidden(h.transform.zoom))continue;let ee=h.style._getLayerSourceCache($),Y=ee?this.proxyToSource[D.key][ee.id]:[D];if(!Y)continue;let de=Y;m.viewport.set([0,0,X.fb.width,X.fb.height]),Z!==(ee?ee.id:null)&&(this._setupStencil(X,Y,$,ee),Z=ee?ee.id:null),h.renderLayer(h,ee,$,de)}this.renderedToTile?(X.dirty=!0,E.push(F.tileID)):W||--R,R===5&&(R=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}renderCacheEfficiency(a){let h=a.order.length;if(h===0)return{efficiency:100};let m,v=0,x=0,T=!1;for(let E=0;E<h;++E){let A=a._layers[a.order[E]];this._style.isLayerDraped(A)?(T&&++v,++x):T||(T=!0,m=A.id)}return x===0?{efficiency:100}:{efficiency:100*(1-v/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,h,m){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{let T=x.tileID,E=1<<T.overscaledZ,{x:A,y:R}=T.canonical,D=A/E,F=(A+1)/E,j=R/E,X=(R+1)/E;return{minx:D,miny:j,maxx:F,maxy:X,t:x.dem.tree.raycastRoot(D,j,F,X,a,h,m),tile:x}});v.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(let x of v){if(x.t==null)return null;let T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,a,h,m);if(T!=null)return T}return null}_createFBO(){let a=this.painter.context,h=a.gl,m=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);let v=new t.Texture(a,{width:m[0],height:m[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);let x=a.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(v.texture),x.depthAttachment=new B(a,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{let h=this._style._layers[a],m=h.isHidden(this.painter.transform.zoom),v=h.getCrossfadeParameters(),x=!!v&&v.t!==1,T=h.hasTransition();return h.type!=="custom"&&!m&&(x||T)})}_clearRasterFadeFromRenderCache(){let a=!1;for(let h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof re){a=!0;break}if(a)for(let h=0;h<this._style.order.length;++h){let m=this._style._layers[this._style.order[h]],v=m.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(m);if(m.type!=="raster"||v||!x)continue;let T=m.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let A=this.proxyToSource[E.key][x.id];if(A)for(let R of A){let D=_c(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,T);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){let a=this._style.order,h=a.length;if(h===0)return;let m=[],v,x=0,T=this._style._layers[a[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<h;)T=this._style._layers[a[x]];for(;x<h;++x){let E=this._style._layers[a[x]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?v===void 0&&(v=x):v!==void 0&&(m.push({start:v,end:x-1}),v=void 0))}v!==void 0&&m.push({start:v,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(a){let h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){let T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let E=0;E<T.length;++E){let A=Object.values(T[E]);h.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();let m=this.proxyCoords,v=this._tilesDirty;for(let T=m.length-1;T>=0;T--){let E=m[T];if(h.getTileByID(E.key),h.proxyCachedFBO[E.key]!==void 0){let A=a[E.key],R=this.proxyToSource[E.key],D=0;for(let F in R){let j=R[F],X=A[F];if(!X||X.length!==j.length||j.some((W,Z)=>W!==X[Z]||v[F]&&v[F].hasOwnProperty(W.key))){D=-1;break}++D}for(let F in h.proxyCachedFBO[E.key])h.renderCache[h.proxyCachedFBO[E.key][F]].dirty=D<0||D!==Object.values(A).length}}let x=[...this._drapedRenderBatches];x.sort((T,E)=>E.end-E.start-(T.end-T.start));for(let T of x)for(let E of m){if(h.proxyCachedFBO[E.key])continue;let A=h.renderCachePool.pop();A===void 0&&h.renderCache.length<50&&(A=h.renderCache.length,h.renderCache.push(this._createFBO())),A!==void 0&&(h.proxyCachedFBO[E.key]={},h.proxyCachedFBO[E.key][T.start]=A,h.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let x=this.painter.context,T=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let E;if(m.isTileClipped())E=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(a,h){let m=this.painter,v=this.painter.context,x=v.gl;m._tileClippingMaskIDs={},v.setColorMode(t.ColorMode.disabled),v.setDepthMode(t.DepthMode.disabled);let T=m.useProgram("clippingMask");for(let E of a){let A=m._tileClippingMaskIDs[E.key]=--h;T.draw(v,x.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Np(E.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(a){let h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;let m=[a.x,a.y,1,1];t.transformMat4$1(m,m,h.pixelMatrixInverse),t.scale$1(m,m,1/m[3]),m[0]/=h.worldSize,m[1]/=h.worldSize;let v=h._camera.position,x=t.mercatorZfromAltitude(1,h.center.lat),T=[v[0],v[1],v[2]/x,0],E=t.subtract([],m.slice(0,3),T);t.normalize(E,E);let A=this.raycast(T,E,this._exaggeration);return A!==null&&A?(t.scaleAndAdd(T,T,E,A),T[3]=T[2],T[2]*=x,T):null}drawDepth(){let a=this.painter,h=a.context,m=this.proxySourceCache,v=Math.ceil(a.width),x=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let T=h.gl,E=h.createFramebuffer(v,x,!0);h.activeTexture.set(T.TEXTURE0);let A=new t.Texture(h,{width:v,height:x,data:null},T.RGBA);A.bind(T.NEAREST,T.CLAMP_TO_EDGE),E.colorAttachment.set(A.texture);let R=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,x);E.depthAttachment.set(R),this._depthFBO=E,this._depthTexture=A}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,x]),function(T,E,A,R){if(T.transform.projection.name==="globe")return;let D=T.context,F=D.gl;D.clear({depth:1});let j=T.useProgram("terrainDepth"),X=new t.DepthMode(F.LESS,t.DepthMode.ReadWrite,T.depthRangeFor3D);for(let W of R){let Z=A.getTile(W),H=zp(W.projMatrix,0);E.setupElevationDraw(Z,j),j.draw(D,F.TRIANGLES,X,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,H,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(a,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,m){if(a.getSource()instanceof ve)return this._setupProxiedCoordsForImageSource(a,h,m);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};let v=this.proxiedCoords[a.id]=[],x=this.proxyCoords;for(let E=0;E<x.length;E++){let A=x[E],R=this._findTileCoveringTileID(A,a);if(R){let D=this._createProxiedId(A,R,m[A.key]&&m[A.key][a.id]);v.push(D),this.proxyToSource[A.key][a.id]=[D]}}let T=!1;for(let E=0;E<h.length;E++){let A=a.getTile(h[E]);if(!A||!A.hasData())continue;let R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){let D=this.proxyToSource[R.tileID.key][a.id],F=this._createProxiedId(R.tileID,A,m[R.tileID.key]&&m[R.tileID.key][a.id]);D?D.splice(D.length-1,0,F):this.proxyToSource[R.tileID.key][a.id]=[F],v.push(F),T=!0}}this._sourceTilesOverlap[a.id]=T}_setupProxiedCoordsForImageSource(a,h,m){if(!a.getSource().loaded())return;let v=this.proxiedCoords[a.id]=[],x=this.proxyCoords,T=a.getSource(),E=new t.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),A=T.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((D,F)=>(D.min.x=Math.min(D.min.x,F.x-E.x),D.min.y=Math.min(D.min.y,F.y-E.y),D.max.x=Math.max(D.max.x,F.x-E.x),D.max.y=Math.max(D.max.y,F.y-E.y),D),{min:new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(D,F)=>{let j=D.wrap+D.canonical.x/(1<<D.canonical.z),X=D.canonical.y/(1<<D.canonical.z),W=t.EXTENT/(1<<D.canonical.z),Z=F.wrap+F.canonical.x/(1<<F.canonical.z),H=F.canonical.y/(1<<F.canonical.z);return j+W<Z+A.min.x||j>Z+A.max.x||X+W<H+A.min.y||X>H+A.max.y};for(let D=0;D<x.length;D++){let F=x[D];for(let j=0;j<h.length;j++){let X=a.getTile(h[j]);if(!X||!X.hasData()||R(F,X.tileID))continue;let W=this._createProxiedId(F,X,m[F.key]&&m[F.key][a.id]),Z=this.proxyToSource[F.key][a.id];Z?Z.push(W):this.proxyToSource[F.key][a.id]=[W],v.push(W)}}}_createProxiedId(a,h,m){let v=this.orthoMatrix;if(m){let x=m.find(T=>T.key===h.tileID.key);if(x)return x}if(h.tileID.key!==a.key){let x=a.canonical.z-h.tileID.canonical.z,T,E,A;v=t.create();let R=h.tileID.wrap-a.wrap<<a.overscaledZ;x>0?(T=t.EXTENT>>x,E=T*((h.tileID.canonical.x<<x)-a.canonical.x+R),A=T*((h.tileID.canonical.y<<x)-a.canonical.y)):(T=t.EXTENT<<-x,E=t.EXTENT*(h.tileID.canonical.x-(a.canonical.x+R<<-x)),A=t.EXTENT*(h.tileID.canonical.y-(a.canonical.y<<-x))),t.ortho(v,0,T,0,T,0,1),t.translate(v,v,[E,A,0])}return new yc(h.tileID,a.key,v)}_findTileCoveringTileID(a,h){let m=h.getTile(a);if(m&&m.hasData())return m;let v=this._findCoveringTileCache[h.id],x=v[a.key];if(m=x?h.getTileByID(x):null,m&&m.hasData()||x===null)return m;let T=m?m.tileID:a,E=T.overscaledZ,A=h.getSource().minzoom,R=[];if(!x){let F=h.getSource().maxzoom;if(a.canonical.z>=F){let j=a.canonical.z-F;h.getSource().reparseOverscaled?(E=Math.max(a.canonical.z+2,h.transform.tileZoom),T=new t.OverscaledTileID(E,a.wrap,F,a.canonical.x>>j,a.canonical.y>>j)):j!==0&&(E=F,T=new t.OverscaledTileID(E,a.wrap,F,a.canonical.x>>j,a.canonical.y>>j))}T.key!==a.key&&(R.push(T.key),m=h.getTile(T))}let D=F=>{R.forEach(j=>{v[j]=F}),R.length=0};for(E-=1;E>=A&&(!m||!m.hasData());E--){m&&D(m.tileID.key);let F=T.calculateScaledKey(E);if(m=h.getTileByID(F),m&&m.hasData())break;let j=v[F];if(j===null)break;j===void 0?R.push(F):m=h.getTileByID(j)}return D(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let m=this._tilesDirty[a];m||(m=this._tilesDirty[a]={}),m[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let a=function(h){let m=0,v=new t.StructArrayLayout2ui4,x=131;for(let T=1;T<129;T++){for(let E=1;E<129;E++)m=T*x+E,v.emplaceBack(m,m+1),v.emplaceBack(m,m+x),v.emplaceBack(m+1,m+x),T===128&&v.emplaceBack(m+x,m+x+1);v.emplaceBack(m+1,m+1+x)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Vp{static cacheKey(a,h,m,v){let x=`${h}${v?v.cacheKey:""}`;for(let T of m)a.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(a,h,m,v,x,T){let E=a.gl;this.program=E.createProgram();let A=function(H){let $=[];for(let ee=0;ee<H.length;ee++){if(H[ee]===null)continue;let Y=H[ee].split(" ");$.push(Y.pop())}return $}(m.staticAttributes),R=v?v.getBinderAttributes():[],D=A.concat(R),F=v?v.defines():[];F=F.concat(T.map(H=>`#define ${H}`));let j=F.concat(a.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(fc):fc,fc,pc,zl.fragmentSource,qa.fragmentSource,m.fragmentSource).join(`
`),X=F.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,pc,zl.vertexSource,qa.vertexSource,hc.vertexSource,m.vertexSource).join(`
`),W=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(W,j),E.compileShader(W),E.attachShader(this.program,W);let Z=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(Z,X),E.compileShader(Z),E.attachShader(this.program,Z),this.attributes={},this.numAttributes=D.length;for(let H=0;H<this.numAttributes;H++)D[H]&&(E.bindAttribLocation(this.program,H,D[H]),this.attributes[D[H]]=H);E.linkProgram(this.program),E.deleteShader(Z),E.deleteShader(W),this.fixedUniforms=x(a),this.binderUniforms=v?v.getUniforms(a):[],T.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(H=>({u_dem:new t.Uniform1i(H),u_dem_prev:new t.Uniform1i(H),u_dem_unpack:new t.Uniform4f(H),u_dem_tl:new t.Uniform2f(H),u_dem_scale:new t.Uniform1f(H),u_dem_tl_prev:new t.Uniform2f(H),u_dem_scale_prev:new t.Uniform1f(H),u_dem_size:new t.Uniform1f(H),u_dem_lerp:new t.Uniform1f(H),u_exaggeration:new t.Uniform1f(H),u_depth:new t.Uniform1i(H),u_depth_size_inv:new t.Uniform2f(H),u_meter_to_dem:new t.Uniform1f(H),u_label_plane_matrix_inv:new t.UniformMatrix4f(H),u_tile_tl_up:new t.Uniform3f(H),u_tile_tr_up:new t.Uniform3f(H),u_tile_br_up:new t.Uniform3f(H),u_tile_bl_up:new t.Uniform3f(H),u_tile_up_scale:new t.Uniform1f(H)}))(a)),T.indexOf("FOG")!==-1&&(this.fogUniforms=(H=>({u_fog_matrix:new t.UniformMatrix4f(H),u_fog_range:new t.Uniform2f(H),u_fog_color:new t.Uniform4f(H),u_fog_horizon_blend:new t.Uniform1f(H),u_fog_temporal_offset:new t.Uniform1f(H),u_frustum_tl:new t.Uniform3f(H),u_frustum_tr:new t.Uniform3f(H),u_frustum_br:new t.Uniform3f(H),u_frustum_bl:new t.Uniform3f(H),u_globe_pos:new t.Uniform3f(H),u_globe_radius:new t.Uniform1f(H),u_globe_transition:new t.Uniform1f(H),u_is_globe:new t.Uniform1i(H),u_viewport:new t.Uniform2f(H)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;let m=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in h)m[v].set(this.program,v,h[v])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;let m=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let v in h)m[v].set(this.program,v,h[v])}}draw(a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z){let H=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(m),a.setStencilMode(v),a.setColorMode(x),a.setCullFace(T);for(let ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,E[ee]);W&&W.setUniforms(this.program,a,this.binderUniforms,j,{zoom:X});let $={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[h];for(let ee of F.get()){let Y=ee.vaos||(ee.vaos={});(Y[A]||(Y[A]=new mc)).bind(a,this,R,W?W.getPaintVertexBuffers():[],D,ee.vertexOffset,Z||[]),H.drawElements(h,ee.primitiveLength*$,H.UNSIGNED_SHORT,ee.primitiveOffset*$*2)}}}function i_(f,a,h){let m=1/nr(h,1,a.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),x=h.tileSize*Math.pow(2,a.transform.tileZoom)/v,T=x*(h.tileID.canonical.x+h.tileID.wrap*v),E=x*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E]}}let Nl=t.create(),bs=(f,a,h,m,v,x,T,E,A,R,D)=>{let F=a.style.light,j=F.properties.get("position"),X=[j.x,j.y,j.z],W=t.create$1();F.properties.get("anchor")==="viewport"&&(t.fromRotation(W,-a.transform.angle),t.transformMat3(X,X,W));let Z=F.properties.get("color"),H=a.transform,$={u_matrix:f,u_lightpos:X,u_lightintensity:F.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+h,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x};return H.projection.name==="globe"&&($.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],$.u_zoom_transition=A,$.u_inv_rot_matrix=D,$.u_merc_center=R,$.u_up_dir=H.projection.upVector(new t.CanonicalTileID(0,0,0),R[0]*t.EXTENT,R[1]*t.EXTENT),$.u_height_lift=E),$},n_=(f,a,h,m,v,x,T,E,A,R,D,F,j)=>{let X=bs(f,a,h,m,v,x,T,R,D,F,j),W={u_height_factor:-Math.pow(2,T.overscaledZ)/A.tileSize/8};return t.extend(X,i_(E,a,A),W)},Ul=f=>({u_matrix:f}),gc=(f,a,h,m)=>t.extend(Ul(f),i_(h,a,m)),Hn=(f,a)=>({u_matrix:f,u_world:a}),Gp=(f,a,h,m,v)=>t.extend(gc(f,a,h,m),{u_world:v}),o_=t.create(),$p=(f,a,h,m,v,x)=>{let T=f.transform,E=T.projection.name==="globe",A;if(x.paint.get("circle-pitch-alignment")==="map")if(E){let D=t.globePixelsToTileUnits(T.zoom,a.canonical)*T._pixelsPerMercatorPixel;A=Float32Array.from([D,0,0,D])}else A=T.calculatePixelsToTileUnitsMatrix(h);else A=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);let R={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:f.translatePosMatrix(a.projMatrix,h,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:o_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){R.u_inv_rot_matrix=m,R.u_merc_center=v,R.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],R.u_zoom_transition=t.globeToMercatorTransition(T.zoom);let D=v[0]*t.EXTENT,F=v[1]*t.EXTENT;R.u_up_dir=T.projection.upVector(new t.CanonicalTileID(0,0,0),D,F)}return R},a_=f=>{let a=[];return f.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},Wp=(f,a,h,m)=>{let v=t.EXTENT/h.tileSize;return{u_matrix:f,u_camera_to_center_distance:a.getCameraToCenterDistance(m),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},s_=(f,a,h=1)=>({u_matrix:f,u_color:a,u_overlay:0,u_overlay_scale:h}),Zp=t.create(),q0=(f,a,h,m,v,x,T)=>{let E=f.transform,A=E.projection.name==="globe",R=A?t.globePixelsToTileUnits(E.zoom,a.canonical)*E._pixelsPerMercatorPixel:nr(h,1,x),D={u_matrix:a.projMatrix,u_extrude_scale:R,u_intensity:T,u_inv_rot_matrix:Zp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=m,D.u_merc_center=v,D.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],D.u_zoom_transition=t.globeToMercatorTransition(E.zoom);let F=v[0]*t.EXTENT,j=v[1]*t.EXTENT;D.u_up_dir=E.projection.upVector(new t.CanonicalTileID(0,0,0),F,j)}return D},vc=(f,a,h,m,v,x,T,E)=>{let A=f.transform,R=A.calculatePixelsToTileUnitsMatrix(a),D={u_matrix:l_(f,a,h,v),u_pixels_to_tile_units:R,u_device_pixel_ratio:T,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:E};if(bc(h)){let F=xc(a,f.transform);D.u_texsize=a.lineAtlasTexture.size,D.u_scale=[F,m.fromScale,m.toScale],D.u_mix=m.t}return D},R0=(f,a,h,m,v,x)=>{let T=f.transform,E=xc(a,T);return{u_matrix:l_(f,a,h,v),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:x,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function xc(f,a){return 1/nr(f,1,a.tileZoom)}function l_(f,a,h,m){return f.translatePosMatrix(m||a.tileID.projMatrix,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function bc(f){let a=f.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}let D0=(f,a,h,m,v,x)=>{return{u_matrix:f,u_tl_parent:a,u_scale_parent:h,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(E=v.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(T=v.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:wc(v.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,E};function wc(f){f*=Math.PI/180;let a=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}let u_=t.create(),Hp=(f,a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z)=>{let H=v.transform,$={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:H.width/H.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+m,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:u_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:u_,u_up_vector:[0,-1,0]};return Z.name==="globe"&&($.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],$.u_zoom_transition=F,$.u_inv_rot_matrix=X,$.u_merc_center=j,$.u_camera_forward=H._camera.forward(),$.u_ecef_origin=t.globeECEFOrigin(H.globeMatrix,D.toUnwrapped()),$.u_tile_matrix=Float32Array.from(H.globeMatrix),$.u_up_vector=W),$},Xp=(f,a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z,H)=>t.extend(Hp(f,a,h,m,v,x,T,E,A,R,F,j,X,W,Z,H),{u_gamma_scale:m?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+D}),ws=(f,a,h,m,v,x,T,E,A,R,D,F,j,X,W,Z)=>t.extend(Xp(f,a,h,m,v,x,T,E,!0,A,!0,D,F,j,X,W,Z),{u_texsize_icon:R,u_texture_icon:1}),L0=(f,a,h)=>({u_matrix:f,u_opacity:a,u_color:h}),k0=(f,a,h,m,v,x)=>t.extend(function(T,E,A,R){let D=A.imageManager.getPattern(T.from.toString()),F=A.imageManager.getPattern(T.to.toString()),{width:j,height:X}=A.imageManager.getPixelSize(),W=Math.pow(2,R.tileID.overscaledZ),Z=R.tileSize*Math.pow(2,A.transform.tileZoom)/W,H=Z*(R.tileID.canonical.x+R.tileID.wrap*W),$=Z*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[j,X],u_mix:E.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/nr(R,1,A.transform.tileZoom),u_pixel_coord_upper:[H>>16,$>>16],u_pixel_coord_lower:[65535&H,65535&$]}}(m,x,h,v),{u_matrix:f,u_opacity:a}),z0={fillExtrusion:f=>({u_matrix:new t.UniformMatrix4f(f),u_lightpos:new t.Uniform3f(f),u_lightintensity:new t.Uniform1f(f),u_lightcolor:new t.Uniform3f(f),u_vertical_gradient:new t.Uniform1f(f),u_opacity:new t.Uniform1f(f),u_edge_radius:new t.Uniform1f(f),u_ao:new t.Uniform2f(f),u_tile_id:new t.Uniform3f(f),u_zoom_transition:new t.Uniform1f(f),u_inv_rot_matrix:new t.UniformMatrix4f(f),u_merc_center:new t.Uniform2f(f),u_up_dir:new t.Uniform3f(f),u_height_lift:new t.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new t.UniformMatrix4f(f),u_lightpos:new t.Uniform3f(f),u_lightintensity:new t.Uniform1f(f),u_lightcolor:new t.Uniform3f(f),u_vertical_gradient:new t.Uniform1f(f),u_height_factor:new t.Uniform1f(f),u_edge_radius:new t.Uniform1f(f),u_ao:new t.Uniform2f(f),u_tile_id:new t.Uniform3f(f),u_zoom_transition:new t.Uniform1f(f),u_inv_rot_matrix:new t.UniformMatrix4f(f),u_merc_center:new t.Uniform2f(f),u_up_dir:new t.Uniform3f(f),u_height_lift:new t.Uniform1f(f),u_image:new t.Uniform1i(f),u_texsize:new t.Uniform2f(f),u_pixel_coord_upper:new t.Uniform2f(f),u_pixel_coord_lower:new t.Uniform2f(f),u_scale:new t.Uniform3f(f),u_fade:new t.Uniform1f(f),u_opacity:new t.Uniform1f(f)}),fill:f=>({u_matrix:new t.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new t.UniformMatrix4f(f),u_image:new t.Uniform1i(f),u_texsize:new t.Uniform2f(f),u_pixel_coord_upper:new t.Uniform2f(f),u_pixel_coord_lower:new t.Uniform2f(f),u_scale:new t.Uniform3f(f),u_fade:new t.Uniform1f(f)}),fillOutline:f=>({u_matrix:new t.UniformMatrix4f(f),u_world:new t.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new t.UniformMatrix4f(f),u_world:new t.Uniform2f(f),u_image:new t.Uniform1i(f),u_texsize:new t.Uniform2f(f),u_pixel_coord_upper:new t.Uniform2f(f),u_pixel_coord_lower:new t.Uniform2f(f),u_scale:new t.Uniform3f(f),u_fade:new t.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new t.Uniform1f(f),u_extrude_scale:new t.UniformMatrix2f(f),u_device_pixel_ratio:new t.Uniform1f(f),u_matrix:new t.UniformMatrix4f(f),u_inv_rot_matrix:new t.UniformMatrix4f(f),u_merc_center:new t.Uniform2f(f),u_tile_id:new t.Uniform3f(f),u_zoom_transition:new t.Uniform1f(f),u_up_dir:new t.Uniform3f(f)}),collisionBox:f=>({u_matrix:new t.UniformMatrix4f(f),u_camera_to_center_distance:new t.Uniform1f(f),u_extrude_scale:new t.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new t.UniformMatrix4f(f),u_inv_matrix:new t.UniformMatrix4f(f),u_camera_to_center_distance:new t.Uniform1f(f),u_viewport_size:new t.Uniform2f(f)}),debug:f=>({u_color:new t.UniformColor(f),u_matrix:new t.UniformMatrix4f(f),u_overlay:new t.Uniform1i(f),u_overlay_scale:new t.Uniform1f(f)}),clippingMask:f=>({u_matrix:new t.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new t.Uniform1f(f),u_intensity:new t.Uniform1f(f),u_matrix:new t.UniformMatrix4f(f),u_inv_rot_matrix:new t.UniformMatrix4f(f),u_merc_center:new t.Uniform2f(f),u_tile_id:new t.Uniform3f(f),u_zoom_transition:new t.Uniform1f(f),u_up_dir:new t.Uniform3f(f)}),heatmapTexture:f=>({u_image:new t.Uniform1i(f),u_color_ramp:new t.Uniform1i(f),u_opacity:new t.Uniform1f(f)}),hillshade:f=>({u_matrix:new t.UniformMatrix4f(f),u_image:new t.Uniform1i(f),u_latrange:new t.Uniform2f(f),u_light:new t.Uniform2f(f),u_shadow:new t.UniformColor(f),u_highlight:new t.UniformColor(f),u_accent:new t.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new t.UniformMatrix4f(f),u_image:new t.Uniform1i(f),u_dimension:new t.Uniform2f(f),u_zoom:new t.Uniform1f(f),u_unpack:new t.Uniform4f(f)}),line:f=>({u_matrix:new t.UniformMatrix4f(f),u_pixels_to_tile_units:new t.UniformMatrix2f(f),u_device_pixel_ratio:new t.Uniform1f(f),u_units_to_pixels:new t.Uniform2f(f),u_dash_image:new t.Uniform1i(f),u_gradient_image:new t.Uniform1i(f),u_image_height:new t.Uniform1f(f),u_texsize:new t.Uniform2f(f),u_scale:new t.Uniform3f(f),u_mix:new t.Uniform1f(f),u_alpha_discard_threshold:new t.Uniform1f(f),u_trim_offset:new t.Uniform2f(f)}),linePattern:f=>({u_matrix:new t.UniformMatrix4f(f),u_texsize:new t.Uniform2f(f),u_pixels_to_tile_units:new t.UniformMatrix2f(f),u_device_pixel_ratio:new t.Uniform1f(f),u_image:new t.Uniform1i(f),u_units_to_pixels:new t.Uniform2f(f),u_scale:new t.Uniform3f(f),u_fade:new t.Uniform1f(f),u_alpha_discard_threshold:new t.Uniform1f(f)}),raster:f=>({u_matrix:new t.UniformMatrix4f(f),u_tl_parent:new t.Uniform2f(f),u_scale_parent:new t.Uniform1f(f),u_fade_t:new t.Uniform1f(f),u_opacity:new t.Uniform1f(f),u_image0:new t.Uniform1i(f),u_image1:new t.Uniform1i(f),u_brightness_low:new t.Uniform1f(f),u_brightness_high:new t.Uniform1f(f),u_saturation_factor:new t.Uniform1f(f),u_contrast_factor:new t.Uniform1f(f),u_spin_weights:new t.Uniform3f(f),u_perspective_transform:new t.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new t.Uniform1i(f),u_is_size_feature_constant:new t.Uniform1i(f),u_size_t:new t.Uniform1f(f),u_size:new t.Uniform1f(f),u_camera_to_center_distance:new t.Uniform1f(f),u_rotate_symbol:new t.Uniform1i(f),u_aspect_ratio:new t.Uniform1f(f),u_fade_change:new t.Uniform1f(f),u_matrix:new t.UniformMatrix4f(f),u_label_plane_matrix:new t.UniformMatrix4f(f),u_coord_matrix:new t.UniformMatrix4f(f),u_is_text:new t.Uniform1i(f),u_pitch_with_map:new t.Uniform1i(f),u_texsize:new t.Uniform2f(f),u_tile_id:new t.Uniform3f(f),u_zoom_transition:new t.Uniform1f(f),u_inv_rot_matrix:new t.UniformMatrix4f(f),u_merc_center:new t.Uniform2f(f),u_camera_forward:new t.Uniform3f(f),u_tile_matrix:new t.UniformMatrix4f(f),u_up_vector:new t.Uniform3f(f),u_ecef_origin:new t.Uniform3f(f),u_texture:new t.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new t.Uniform1i(f),u_is_size_feature_constant:new t.Uniform1i(f),u_size_t:new t.Uniform1f(f),u_size:new t.Uniform1f(f),u_camera_to_center_distance:new t.Uniform1f(f),u_rotate_symbol:new t.Uniform1i(f),u_aspect_ratio:new t.Uniform1f(f),u_fade_change:new t.Uniform1f(f),u_matrix:new t.UniformMatrix4f(f),u_label_plane_matrix:new t.UniformMatrix4f(f),u_coord_matrix:new t.UniformMatrix4f(f),u_is_text:new t.Uniform1i(f),u_pitch_with_map:new t.Uniform1i(f),u_texsize:new t.Uniform2f(f),u_texture:new t.Uniform1i(f),u_gamma_scale:new t.Uniform1f(f),u_device_pixel_ratio:new t.Uniform1f(f),u_tile_id:new t.Uniform3f(f),u_zoom_transition:new t.Uniform1f(f),u_inv_rot_matrix:new t.UniformMatrix4f(f),u_merc_center:new t.Uniform2f(f),u_camera_forward:new t.Uniform3f(f),u_tile_matrix:new t.UniformMatrix4f(f),u_up_vector:new t.Uniform3f(f),u_ecef_origin:new t.Uniform3f(f),u_is_halo:new t.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new t.Uniform1i(f),u_is_size_feature_constant:new t.Uniform1i(f),u_size_t:new t.Uniform1f(f),u_size:new t.Uniform1f(f),u_camera_to_center_distance:new t.Uniform1f(f),u_rotate_symbol:new t.Uniform1i(f),u_aspect_ratio:new t.Uniform1f(f),u_fade_change:new t.Uniform1f(f),u_matrix:new t.UniformMatrix4f(f),u_label_plane_matrix:new t.UniformMatrix4f(f),u_coord_matrix:new t.UniformMatrix4f(f),u_is_text:new t.Uniform1i(f),u_pitch_with_map:new t.Uniform1i(f),u_texsize:new t.Uniform2f(f),u_texsize_icon:new t.Uniform2f(f),u_texture:new t.Uniform1i(f),u_texture_icon:new t.Uniform1i(f),u_gamma_scale:new t.Uniform1f(f),u_device_pixel_ratio:new t.Uniform1f(f),u_is_halo:new t.Uniform1i(f)}),background:f=>({u_matrix:new t.UniformMatrix4f(f),u_opacity:new t.Uniform1f(f),u_color:new t.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new t.UniformMatrix4f(f),u_opacity:new t.Uniform1f(f),u_image:new t.Uniform1i(f),u_pattern_tl_a:new t.Uniform2f(f),u_pattern_br_a:new t.Uniform2f(f),u_pattern_tl_b:new t.Uniform2f(f),u_pattern_br_b:new t.Uniform2f(f),u_texsize:new t.Uniform2f(f),u_mix:new t.Uniform1f(f),u_pattern_size_a:new t.Uniform2f(f),u_pattern_size_b:new t.Uniform2f(f),u_scale_a:new t.Uniform1f(f),u_scale_b:new t.Uniform1f(f),u_pixel_coord_upper:new t.Uniform2f(f),u_pixel_coord_lower:new t.Uniform2f(f),u_tile_units_to_pixels:new t.Uniform1f(f)}),terrainRaster:Bl,terrainDepth:Bl,skybox:f=>({u_matrix:new t.UniformMatrix4f(f),u_sun_direction:new t.Uniform3f(f),u_cubemap:new t.Uniform1i(f),u_opacity:new t.Uniform1f(f),u_temporal_offset:new t.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new t.UniformMatrix4f(f),u_color_ramp:new t.Uniform1i(f),u_center_direction:new t.Uniform3f(f),u_radius:new t.Uniform1f(f),u_opacity:new t.Uniform1f(f),u_temporal_offset:new t.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new t.UniformMatrix3f(f),u_sun_direction:new t.Uniform3f(f),u_sun_intensity:new t.Uniform1f(f),u_color_tint_r:new t.Uniform4f(f),u_color_tint_m:new t.Uniform4f(f),u_luminance:new t.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new t.UniformMatrix4f(f),u_globe_matrix:new t.UniformMatrix4f(f),u_normalize_matrix:new t.UniformMatrix4f(f),u_merc_matrix:new t.UniformMatrix4f(f),u_zoom_transition:new t.Uniform1f(f),u_merc_center:new t.Uniform2f(f),u_image0:new t.Uniform1i(f),u_grid_matrix:new t.UniformMatrix3f(f),u_frustum_tl:new t.Uniform3f(f),u_frustum_tr:new t.Uniform3f(f),u_frustum_br:new t.Uniform3f(f),u_frustum_bl:new t.Uniform3f(f),u_globe_pos:new t.Uniform3f(f),u_globe_radius:new t.Uniform1f(f),u_viewport:new t.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new t.Uniform3f(f),u_frustum_tr:new t.Uniform3f(f),u_frustum_br:new t.Uniform3f(f),u_frustum_bl:new t.Uniform3f(f),u_horizon:new t.Uniform1f(f),u_transition:new t.Uniform1f(f),u_fadeout_range:new t.Uniform1f(f),u_color:new t.Uniform4f(f),u_high_color:new t.Uniform4f(f),u_space_color:new t.Uniform4f(f),u_star_intensity:new t.Uniform1f(f),u_star_density:new t.Uniform1f(f),u_star_size:new t.Uniform1f(f),u_temporal_offset:new t.Uniform1f(f),u_horizon_angle:new t.Uniform1f(f),u_rotation_matrix:new t.UniformMatrix4f(f)})},Tc;function c_(f,a,h,m,v,x,T){let E=f.context,A=E.gl,R=f.transform,D=f.useProgram("collisionBox"),F=[],j=0,X=0;for(let de=0;de<m.length;de++){let pe=m[de],se=a.getTile(pe),fe=se.getBucket(h);if(!fe)continue;let he=Vi(pe,fe,R),ge=he;v[0]===0&&v[1]===0||(ge=f.translatePosMatrix(he,se,v,x));let Ee=T?fe.textCollisionBox:fe.iconCollisionBox,Ye=fe.collisionCircleArray;if(Ye.length>0){let xe=t.create(),ze=ge;t.mul(xe,fe.placementInvProjMatrix,R.glCoordMatrix),t.mul(xe,xe,fe.placementViewportMatrix),F.push({circleArray:Ye,circleOffset:X,transform:ze,invTransform:xe,projection:fe.getProjection()}),j+=Ye.length/4,X=j}Ee&&(f.terrain&&f.terrain.setupElevationDraw(se,D),D.draw(E,A.LINES,t.DepthMode.disabled,t.StencilMode.disabled,f.colorModeForRenderPass(),t.CullFaceMode.disabled,Wp(ge,R,se,fe.getProjection()),h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,R.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!T||!F.length)return;let W=f.useProgram("collisionCircle"),Z=new t.StructArrayLayout2f1f2i16;Z.resize(4*j),Z._trim();let H=0;for(let de of F)for(let pe=0;pe<de.circleArray.length/4;pe++){let se=4*pe,fe=de.circleArray[se+0],he=de.circleArray[se+1],ge=de.circleArray[se+2],Ee=de.circleArray[se+3];Z.emplace(H++,fe,he,ge,Ee,0),Z.emplace(H++,fe,he,ge,Ee,1),Z.emplace(H++,fe,he,ge,Ee,2),Z.emplace(H++,fe,he,ge,Ee,3)}(!Tc||Tc.length<2*j)&&(Tc=function(de){let pe=2*de,se=new t.StructArrayLayout3ui6;se.resize(pe),se._trim();for(let fe=0;fe<pe;fe++){let he=6*fe;se.uint16[he+0]=4*fe+0,se.uint16[he+1]=4*fe+1,se.uint16[he+2]=4*fe+2,se.uint16[he+3]=4*fe+2,se.uint16[he+4]=4*fe+3,se.uint16[he+5]=4*fe+0}return se}(j));let $=E.createIndexBuffer(Tc,!0),ee=E.createVertexBuffer(Z,t.collisionCircleLayout.members,!0);for(let de of F){let pe={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(Y=R).getCameraToCenterDistance(de.projection),u_viewport_size:[Y.width,Y.height]};W.draw(E,A.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,f.colorModeForRenderPass(),t.CullFaceMode.disabled,pe,h.id,ee,$,t.SegmentVector.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,R.zoom)}var Y;ee.destroy(),$.destroy()}let h_=t.create();function Yp(f,a,h,m,v,x){let{horizontalAlign:T,verticalAlign:E}=t.getAnchorAlignment(f),A=-(T-.5)*a,R=-(E-.5)*h,D=t.evaluateVariableOffset(f,m);return new t.pointGeometry((A/v+D[0])*x,(R/v+D[1])*x)}function Kp(f,a,h,m,v,x,T,E,A,R,D){let F=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,X=f.icon.dynamicLayoutVertexArray,W={},Z=Gi(E,f.getProjection(),x),H=x.elevation,$=f.getProjection().upVectorScale(E.canonical,x.center.lat,x.worldSize);j.clear();for(let ee=0;ee<F.length;ee++){let Y=F.get(ee),de=f.allowVerticalPlacement&&!Y.placedOrientation,pe=Y.hidden||!Y.crossTileID||de?null:m[Y.crossTileID];if(pe){let se=new t.pointGeometry(Y.tileAnchorX,Y.tileAnchorY),fe=f.getProjection().upVector(E.canonical,se.x,se.y),he=H?H.getAtTileOffset(E,se.x,se.y):0,ge=zt([Y.projectedAnchorX+he*fe[0]*$.metersToTile,Y.projectedAnchorY+he*fe[1]*$.metersToTile,Y.projectedAnchorZ+he*fe[2]*$.metersToTile],h?Z:T),Ee=Cl(x.getCameraToCenterDistance(f.getProjection()),ge.signedDistanceFromCamera),Ye=v.evaluateSizeForFeature(f.textSizeData,R,Y)*Ee/t.ONE_EM;h&&(Ye*=f.tilePixelRatio/A);let{width:xe,height:ze,anchor:Ue,textOffset:it,textScale:Pe}=pe,Je=Yp(Ue,xe,ze,it,Pe,Ye),Ne;if(h){let at=se.add(Je),{x:yt,y:Tt,z:qt}=f.getProjection().projectTilePoint(at.x,at.y,E.canonical);Ne=zt([yt+he*fe[0]*$.metersToTile,Tt+he*fe[1]*$.metersToTile,qt+he*fe[2]*$.metersToTile],T).point}else{let at=a?Je.rotate(-x.angle):Je;Ne=[ge.point[0]+at.x,ge.point[1]+at.y,0]}let st=f.allowVerticalPlacement&&Y.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let at=0;at<Y.numGlyphs;at++)t.addDynamicAttributes(j,Ne[0],Ne[1],Ne[2],st);D&&Y.associatedIconIndex>=0&&(W[Y.associatedIconIndex]={shiftedAnchor:Ne,angle:st})}else Go(Y.numGlyphs,j)}if(D){X.clear();let ee=f.icon.placedSymbolArray;for(let Y=0;Y<ee.length;Y++){let de=ee.get(Y);if(de.hidden)Go(de.numGlyphs,X);else{let pe=W[Y];if(pe)for(let se=0;se<de.numGlyphs;se++)t.addDynamicAttributes(X,pe.shiftedAnchor[0],pe.shiftedAnchor[1],pe.shiftedAnchor[2],pe.angle);else Go(de.numGlyphs,X)}}f.icon.dynamicLayoutVertexBuffer.updateData(X)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function p_(f,a,h){return h.iconsInText&&a?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Jp(f,a,h,m,v,x,T,E,A,R,D,F){let j=f.context,X=j.gl,W=f.transform,Z=E==="map",H=A==="map",$=Z&&h.layout.get("symbol-placement")!=="point",ee=Z&&!H&&!$,Y=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,de=!1,pe=f.depthModeForSublayer(0,t.DepthMode.ReadOnly),se=[t.mercatorXfromLng(W.center.lng),t.mercatorYfromLat(W.center.lat)],fe=h.layout.get("text-variable-anchor"),he=W.projection.name==="globe",ge=[],Ee=[0,-1,0],Ye=Ee;!he&&!W.mercatorFromTransition||Z||(Ye=function(xe){let ze=xe._camera.getWorldToCamera(xe.worldSize,1),Ue=t.multiply([],ze,xe.globeMatrix);t.invert(Ue,Ue);let it=[0,0,0],Pe=[0,1,0,0];return t.transformMat4$1(Pe,Pe,Ue),it[0]=Pe[0],it[1]=Pe[1],it[2]=Pe[2],t.normalize(it,it),it}(W));for(let xe of m){let ze=a.getTile(xe),Ue=ze.getBucket(h);if(!Ue||Ue.projection.name==="mercator"&&he)continue;let it=v?Ue.text:Ue.icon;if(!it||Ue.fullyClipped||!it.segments.get().length)continue;let Pe=it.programConfigurations.get(h.id),Je=v||Ue.sdfIcons,Ne=v?Ue.textSizeData:Ue.iconSizeData,st=H||W.pitch!==0,at=t.evaluateSizeForZoom(Ne,W.zoom),yt,Tt,qt,Wt,gt=[0,0],Lt=null;if(v){if(Tt=ze.glyphAtlasTexture,qt=X.LINEAR,yt=ze.glyphAtlasTexture.size,Ue.iconsInText){gt=ze.imageAtlasTexture.size,Lt=ze.imageAtlasTexture;let Bi=Ne.kind==="composite"||Ne.kind==="camera";Wt=st||f.options.rotating||f.options.zooming||Bi?X.LINEAR:X.NEAREST}}else{let Bi=h.layout.get("icon-size").constantOr(0)!==1||Ue.iconsNeedLinear;Tt=ze.imageAtlasTexture,qt=Je||f.options.rotating||f.options.zooming||Bi||st?X.LINEAR:X.NEAREST,yt=ze.imageAtlasTexture.size}let rr=Ue.projection.name==="globe",Rr=rr?Ye:Ee,$r=rr?t.globeToMercatorTransition(W.zoom):0,xr=Gi(xe,Ue.getProjection(),W),vi=W.calculatePixelsToTileUnitsMatrix(ze),zn=Vt(xr,ze.tileID.canonical,H,Z,W,Ue.getProjection(),vi),xo=f.terrain&&H&&$?t.invert(t.create(),zn):h_,Dr=Rn(xr,ze.tileID.canonical,H,Z,W,Ue.getProjection(),vi),kr=fe&&Ue.hasTextData(),jt=h.layout.get("icon-text-fit")!=="none"&&kr&&Ue.hasIconData();if($){let Bi=W.elevation,Fa=Bi?Bi.getAtTileOffsetFunc(xe,W.center.lat,W.worldSize,Ue.getProjection()):nu=>[0,0,0],Yo=Gt(xr,ze.tileID.canonical,H,Z,W,Ue.getProjection(),vi);Ml(Ue,xr,f,v,Yo,Dr,H,R,Fa,xe)}let ri=$||v&&fe||jt,Ii=f.translatePosMatrix(xr,ze,x,T),Ar=ri?h_:zn,Ai=f.translatePosMatrix(Dr,ze,x,T,!0),La=Ue.getProjection().createInversionMatrix(W,xe.canonical),zi=[];f.terrain&&H&&zi.push("PITCH_WITH_MAP_TERRAIN"),rr&&zi.push("PROJECTION_GLOBE_VIEW"),ri&&zi.push("PROJECTED_POS_ON_VIEWPORT");let ka=Je&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0,za;za=Je?Ue.iconsInText?ws(Ne.kind,at,ee,H,f,Ii,Ar,Ai,yt,gt,xe,$r,se,La,Rr,Ue.getProjection()):Xp(Ne.kind,at,ee,H,f,Ii,Ar,Ai,v,yt,!0,xe,$r,se,La,Rr,Ue.getProjection()):Hp(Ne.kind,at,ee,H,f,Ii,Ar,Ai,v,yt,xe,$r,se,La,Rr,Ue.getProjection());let Ba={program:f.useProgram(p_(Je,v,Ue),Pe,zi),buffers:it,uniformValues:za,atlasTexture:Tt,atlasTextureIcon:Lt,atlasInterpolation:qt,atlasInterpolationIcon:Wt,isSDF:Je,hasHalo:ka,tile:ze,labelPlaneMatrixInv:xo};if(Y&&Ue.canOverlap){de=!0;let Bi=it.segments.get();for(let Fa of Bi)ge.push({segments:new t.SegmentVector([Fa]),sortKey:Fa.sortKey,state:Ba})}else ge.push({segments:it.segments,sortKey:0,state:Ba})}de&&ge.sort((xe,ze)=>xe.sortKey-ze.sortKey);for(let xe of ge){let ze=xe.state;if(f.terrain&&f.terrain.setupElevationDraw(ze.tile,ze.program,{useDepthForOcclusion:!he,labelPlaneMatrixInv:ze.labelPlaneMatrixInv}),j.activeTexture.set(X.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,X.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(j.activeTexture.set(X.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),ze.isSDF){let Ue=ze.uniformValues;ze.hasHalo&&(Ue.u_is_halo=1,Qp(ze.buffers,xe.segments,h,f,ze.program,pe,D,F,Ue)),Ue.u_is_halo=0}Qp(ze.buffers,xe.segments,h,f,ze.program,pe,D,F,ze.uniformValues)}}function Qp(f,a,h,m,v,x,T,E,A){let R=m.context,D=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];v.draw(R,R.gl.TRIANGLES,x,T,E,t.CullFaceMode.disabled,A,h.id,f.layoutVertexBuffer,f.indexBuffer,a,h.paint,m.transform.zoom,f.programConfigurations.get(h.id),D)}function Ec(f,a,h,m,v,x,T){let E=f.context.gl,A=h.paint.get("fill-pattern"),R=A&&A.constantOr(1),D=h.getCrossfadeParameters(),F,j,X,W,Z;T?(j=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=E.LINES):(j=R?"fillPattern":"fill",F=E.TRIANGLES);for(let H of m){let $=a.getTile(H);if(R&&!$.patternsLoaded())continue;let ee=$.getBucket(h);if(!ee)continue;f.prepareDrawTile();let Y=ee.programConfigurations.get(h.id),de=f.useProgram(j,Y);R&&(f.context.activeTexture.set(E.TEXTURE0),$.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers(D));let pe=A.constantOr(null);if(pe&&$.imageAtlas){let fe=$.imageAtlas,he=fe.patternPositions[pe.to.toString()],ge=fe.patternPositions[pe.from.toString()];he&&ge&&Y.setConstantPatternPositions(he,ge)}let se=f.translatePosMatrix(H.projMatrix,$,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){W=ee.indexBuffer2,Z=ee.segments2;let fe=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];X=j==="fillOutlinePattern"&&R?Gp(se,f,D,$,fe):Hn(se,fe)}else W=ee.indexBuffer,Z=ee.segments,X=R?gc(se,f,D,$):Ul(se);f.prepareDrawProgram(f.context,de,H.toUnwrapped()),de.draw(f.context,F,v,f.stencilModeForClipping(H),x,t.CullFaceMode.disabled,X,h.id,ee.layoutVertexBuffer,W,Z,h.paint,f.transform.zoom,Y)}}function yo(f,a,h,m,v,x,T){let E=f.context,A=E.gl,R=f.transform,D=h.paint.get("fill-extrusion-pattern"),F=D.constantOr(1),j=h.getCrossfadeParameters(),X=h.paint.get("fill-extrusion-opacity"),W=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],Z=h.layout.get("fill-extrusion-edge-radius"),H=R.projection.name==="globe"?t.fillExtrusionHeightLift():0,$=R.projection.name==="globe",ee=$?t.globeToMercatorTransition(R.zoom):0,Y=[t.mercatorXfromLng(R.center.lng),t.mercatorYfromLat(R.center.lat)],de=[];$&&(de.push("PROJECTION_GLOBE_VIEW"),f.style.terrainSetForDrapingOnly()&&de.push("TERRAIN")),W[0]>0&&de.push("FAUX_AO");for(let pe of m){let se=a.getTile(pe),fe=se.getBucket(h);if(!fe||fe.projection.name!==R.projection.name)continue;let he=fe.programConfigurations.get(h.id),ge=f.useProgram(F?"fillExtrusionPattern":"fillExtrusion",he,de);if(f.terrain){let Pe=f.terrain;if(f.style.terrainSetForDrapingOnly())Pe.setupElevationDraw(se,ge,{useMeterToDem:!0});else{if(!fe.enableTerrain)continue;if(Pe.setupElevationDraw(se,ge,{useMeterToDem:!0}),jl(E,a,pe,fe,h,Pe),!fe.centroidVertexBuffer){let Je=ge.attributes.a_centroid_pos;Je!==void 0&&A.vertexAttrib2f(Je,0,0)}}}F&&(f.context.activeTexture.set(A.TEXTURE0),se.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),he.updatePaintBuffers(j));let Ee=D.constantOr(null);if(Ee&&se.imageAtlas){let Pe=se.imageAtlas,Je=Pe.patternPositions[Ee.to.toString()],Ne=Pe.patternPositions[Ee.from.toString()];Je&&Ne&&he.setConstantPatternPositions(Je,Ne)}let Ye=f.translatePosMatrix(pe.projMatrix,se,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),xe=R.projection.createInversionMatrix(R,pe.canonical),ze=h.paint.get("fill-extrusion-vertical-gradient"),Ue=F?n_(Ye,f,ze,X,W,Z,pe,j,se,H,ee,Y,xe):bs(Ye,f,ze,X,W,Z,pe,H,ee,Y,xe);f.prepareDrawProgram(E,ge,pe.toUnwrapped());let it=[];f.terrain&&it.push(fe.centroidVertexBuffer),$&&it.push(fe.layoutVertexExtBuffer),ge.draw(E,E.gl.TRIANGLES,v,x,T,t.CullFaceMode.backCCW,Ue,h.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,h.paint,f.transform.zoom,he,it)}}function jl(f,a,h,m,v,x){let T=[$=>{let ee=$.canonical.x-1,Y=$.wrap;return ee<0&&(ee=(1<<$.canonical.z)-1,Y--),new t.OverscaledTileID($.overscaledZ,Y,$.canonical.z,ee,$.canonical.y)},$=>{let ee=$.canonical.x+1,Y=$.wrap;return ee===1<<$.canonical.z&&(ee=0,Y++),new t.OverscaledTileID($.overscaledZ,Y,$.canonical.z,ee,$.canonical.y)},$=>new t.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,($.canonical.y===0?1<<$.canonical.z:$.canonical.y)-1),$=>new t.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y===(1<<$.canonical.z)-1?0:$.canonical.y+1)],E=$=>{let ee=a.getSource().minzoom,Y=pe=>{let se=a.getTileByID(pe);if(se&&se.hasData())return se.getBucket(v)},de=[0,-1,1];for(let pe of de){if($.overscaledZ+pe<ee)continue;let se=Y($.calculateScaledKey($.overscaledZ+pe));if(se)return se}},A=[0,0,0],R=($,ee)=>(A[0]=Math.min($.min.y,ee.min.y),A[1]=Math.max($.max.y,ee.max.y),A[2]=t.EXTENT-ee.min.x>$.max.x?ee.min.x-t.EXTENT:$.max.x,A),D=($,ee)=>(A[0]=Math.min($.min.x,ee.min.x),A[1]=Math.max($.max.x,ee.max.x),A[2]=t.EXTENT-ee.min.y>$.max.y?ee.min.y-t.EXTENT:$.max.y,A),F=[($,ee)=>R($,ee),($,ee)=>R(ee,$),($,ee)=>D($,ee),($,ee)=>D(ee,$)],j=new t.pointGeometry(0,0),X,W,Z,H=($,ee,Y,de,pe)=>{let se=[[de?Y:$,de?$:Y,0],[de?Y:ee,de?ee:Y,0]],fe=pe<0?t.EXTENT+pe:pe,he=[de?fe:($+ee)/2,de?($+ee)/2:fe,0];return Y===0&&pe<0||Y!==0&&pe>0?x.getForTilePoints(Z,[he],!0,W):se.push(he),x.getForTilePoints(h,se,!0,X),Math.max(se[0][2],se[1][2],he[2])/x.exaggeration()};for(let $=0;$<4;$++){let ee=($<2?1:5)-$,Y=m.borders[$];if(Y.length===0)continue;let de=Z=T[$](h),pe=E(de);if(!(pe&&pe instanceof t.FillExtrusionBucket&&pe.enableTerrain)||m.borderDoneWithNeighborZ[$]===pe.canonical.z&&pe.borderDoneWithNeighborZ[ee]===m.canonical.z||(W=x.findDEMTileFor(de),!W||!W.dem))continue;if(!X){let ge=x.findDEMTileFor(h);if(!ge||!ge.dem)return;X=ge}let se=pe.borders[ee],fe=0,he=pe.borderDoneWithNeighborZ[ee]!==m.canonical.z;if(m.canonical.z===pe.canonical.z){for(let ge=0;ge<Y.length;ge++){let Ee=m.featuresOnBorder[Y[ge]],Ye=Ee.borders[$],xe;for(;fe<se.length&&(xe=pe.featuresOnBorder[se[fe]],!(xe.borders[ee][1]>Ye[0]+3));)he&&pe.encodeCentroid(void 0,xe,!1),fe++;if(xe&&fe<se.length){let ze=fe,Ue=0;for(;!(xe.borders[ee][0]>Ye[1]-3)&&(Ue++,++fe!==se.length);)xe=pe.featuresOnBorder[se[fe]];if(xe=pe.featuresOnBorder[se[ze]],Ee.intersectsCount()>1||xe.intersectsCount()>1||Ue!==1){Ue!==1&&(fe=ze),m.encodeCentroid(void 0,Ee,!1),he&&pe.encodeCentroid(void 0,xe,!1);continue}let it=F[$](Ee,xe),Pe=$%2?t.EXTENT-1:0;j.x=H(it[0],Math.min(t.EXTENT-1,it[1]),Pe,$<2,it[2]),j.y=0,m.encodeCentroid(j,Ee,!1),he&&pe.encodeCentroid(j,xe,!1)}else m.encodeCentroid(void 0,Ee,!1)}m.borderDoneWithNeighborZ[$]=pe.canonical.z,m.needsCentroidUpdate=!0,he&&(pe.borderDoneWithNeighborZ[ee]=m.canonical.z,pe.needsCentroidUpdate=!0)}else{for(let ge of Y)m.encodeCentroid(void 0,m.featuresOnBorder[ge],!1);if(he){for(let ge of se)pe.encodeCentroid(void 0,pe.featuresOnBorder[ge],!1);pe.borderDoneWithNeighborZ[ee]=m.canonical.z,pe.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[$]=pe.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}let f_=new t.Color(1,0,0,1),Ts=new t.Color(0,1,0,1),Es=new t.Color(0,0,1,1),d_=new t.Color(1,0,1,1),ef=new t.Color(0,1,1,1);function lr(f,a,h){let m=f.context,v=f.transform,x=m.gl,T=v.projection.name==="globe",E=T?["PROJECTION_GLOBE_VIEW"]:null,A=h.projMatrix;if(T&&t.globeToMercatorTransition(v.zoom)>0){let Ee=t.transitionTileAABBinECEF(h.canonical,v),Ye=t.globeDenormalizeECEF(Ee);A=t.multiply(new Float32Array(16),v.globeMatrix,Ye),t.multiply(A,v.projMatrix,A)}let R=f.useProgram("debug",null,E),D=a.getTileByID(h.key);f.terrain&&f.terrain.setupElevationDraw(D,R);let F=t.DepthMode.disabled,j=t.StencilMode.disabled,X=f.colorModeForRenderPass(),W="$debug";m.activeTexture.set(x.TEXTURE0),f.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T?D._makeGlobeTileDebugBuffers(f.context,v):D._makeDebugTileBoundsBuffers(f.context,v.projection);let Z=D._tileDebugBuffer||f.debugBuffer,H=D._tileDebugIndexBuffer||f.debugIndexBuffer,$=D._tileDebugSegments||f.debugSegments;R.draw(m,x.LINE_STRIP,F,j,X,t.CullFaceMode.disabled,s_(A,t.Color.red),W,Z,H,$,null,null,null,[D._globeTileDebugBorderBuffer]);let ee=D.latestRawTileData,Y=Math.floor((ee&&ee.byteLength||0)/1024),de=a.getTile(h).tileSize,pe=512/Math.min(de,512)*(h.overscaledZ/v.zoom)*.5,se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(se+=` => ${h.overscaledZ}`),se+=` ${Y}kb`,function(Ee,Ye){Ee.initDebugOverlayCanvas();let xe=Ee.debugOverlayCanvas,ze=Ee.context.gl,Ue=Ee.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,xe.width,xe.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(Ye,5,5),Ue.strokeText(Ye,5,5),Ee.debugOverlayTexture.update(xe),Ee.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(f,se);let fe=D._tileDebugTextBuffer||f.debugBuffer,he=D._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,ge=D._tileDebugTextSegments||f.debugSegments;R.draw(m,x.TRIANGLES,F,j,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,s_(A,t.Color.transparent,pe),W,fe,he,ge,null,null,null,[D._globeTileDebugTextBuffer])}function Vl(f,a,h,m){Gl(f,0,a+h/2,f.transform.width,h,m)}function m_(f,a,h,m){Gl(f,a-h/2,0,h,f.transform.height,m)}function Gl(f,a,h,m,v,x){let T=f.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(a*t.exported.devicePixelRatio,h*t.exported.devicePixelRatio,m*t.exported.devicePixelRatio,v*t.exported.devicePixelRatio),T.clear({color:x}),E.disable(E.SCISSOR_TEST)}let $l=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:B0}=$l;function Xo(f,a,h,m){f.emplaceBack(a,h,m)}class tf{constructor(a){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,Xo(this.vertexArray,-1,-1,1),Xo(this.vertexArray,1,-1,1),Xo(this.vertexArray,-1,1,1),Xo(this.vertexArray,1,1,1),Xo(this.vertexArray,-1,-1,-1),Xo(this.vertexArray,1,-1,-1),Xo(this.vertexArray,-1,1,-1),Xo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,B0),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function Ss(f,a,h,m,v,x){let T=f.gl,E=a.paint.get("sky-atmosphere-color"),A=a.paint.get("sky-atmosphere-halo-color"),R=a.paint.get("sky-atmosphere-sun-intensity"),D=((F,j,X,W,Z)=>({u_matrix_3f:F,u_sun_direction:j,u_sun_intensity:X,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),m),v,R,E,A);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,a.skyboxTexture,0),h.draw(f,T.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,D,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}let rf=t.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Sc{constructor(a){let h=new t.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);let m=new t.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,rf.members),this.indexBuffer=a.createIndexBuffer(m),this.segments=t.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Is={symbol:function(f,a,h,m,v){if(f.renderPass!=="translucent")return;let x=t.StencilMode.disabled,T=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(E,A,R,D,F,j,X){let W=A.transform,Z=F==="map",H=j==="map";for(let $ of E){let ee=D.getTile($),Y=ee.getBucket(R);if(!Y||!Y.text||!Y.text.segments.get().length)continue;let de=t.evaluateSizeForZoom(Y.textSizeData,W.zoom),pe=Gi($,Y.getProjection(),W),se=W.calculatePixelsToTileUnitsMatrix(ee),fe=Vt(pe,ee.tileID.canonical,H,Z,W,Y.getProjection(),se),he=R.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(de){let ge=Math.pow(2,W.zoom-ee.tileID.overscaledZ);Kp(Y,Z,H,X,t.symbolSize,W,fe,$,ge,de,he)}}}(m,f,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v),h.paint.get("icon-opacity").constantOr(1)!==0&&Jp(f,a,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,T),h.paint.get("text-opacity").constantOr(1)!==0&&Jp(f,a,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,T),a.map.showCollisionBoxes&&(c_(f,a,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),c_(f,a,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(f,a,h,m){if(f.renderPass!=="translucent")return;let v=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),E=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;let A=f.context,R=A.gl,D=f.transform,F=f.depthModeForSublayer(0,t.DepthMode.ReadOnly),j=t.StencilMode.disabled,X=f.colorModeForRenderPass(),W=D.projection.name==="globe",Z=[t.mercatorXfromLng(D.center.lng),t.mercatorYfromLat(D.center.lat)],H=[];for(let ee=0;ee<m.length;ee++){let Y=m[ee],de=a.getTile(Y),pe=de.getBucket(h);if(!pe||pe.projection.name!==D.projection.name)continue;let se=pe.programConfigurations.get(h.id),fe=a_(h);W&&fe.push("PROJECTION_GLOBE_VIEW");let he=f.useProgram("circle",se,fe),ge=pe.layoutVertexBuffer,Ee=pe.globeExtVertexBuffer,Ye=pe.indexBuffer,xe=D.projection.createInversionMatrix(D,Y.canonical),ze={programConfiguration:se,program:he,layoutVertexBuffer:ge,globeExtVertexBuffer:Ee,indexBuffer:Ye,uniformValues:$p(f,Y,de,xe,Z,h),tile:de};if(E){let Ue=pe.segments.get();for(let it of Ue)H.push({segments:new t.SegmentVector([it]),sortKey:it.sortKey,state:ze})}else H.push({segments:pe.segments,sortKey:0,state:ze})}E&&H.sort((ee,Y)=>ee.sortKey-Y.sortKey);let $={useDepthForOcclusion:!W};for(let ee of H){let{programConfiguration:Y,program:de,layoutVertexBuffer:pe,globeExtVertexBuffer:se,indexBuffer:fe,uniformValues:he,tile:ge}=ee.state,Ee=ee.segments;f.terrain&&f.terrain.setupElevationDraw(ge,de,$),f.prepareDrawProgram(A,de,ge.tileID.toUnwrapped()),de.draw(A,R.TRIANGLES,F,j,X,t.CullFaceMode.disabled,he,h.id,pe,fe,Ee,h.paint,D.zoom,Y,[se])}},heatmap:function(f,a,h,m){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let v=f.context,x=v.gl,T=t.StencilMode.disabled,E=new t.ColorMode([x.ONE,x.ONE],t.Color.transparent,[!0,!0,!0,!0]);(function(X,W,Z,H){let $=X.gl,ee=W.width*H,Y=W.height*H;X.activeTexture.set($.TEXTURE1),X.viewport.set([0,0,ee,Y]);let de=Z.heatmapFbo;if(!de||de&&(de.width!==ee||de.height!==Y)){de&&de.destroy();let pe=$.createTexture();$.bindTexture($.TEXTURE_2D,pe),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),de=Z.heatmapFbo=X.createFramebuffer(ee,Y,!1),function(se,fe,he,ge,Ee,Ye){let xe=se.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,Ee,Ye,0,xe.RGBA,se.extRenderToTextureHalfFloat?se.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),ge.colorAttachment.set(he)}(X,0,pe,de,ee,Y)}else $.bindTexture($.TEXTURE_2D,de.colorAttachment.get()),X.bindFramebuffer.set(de.framebuffer)})(v,f,h,f.transform.projection.name==="globe"?.5:.25),v.clear({color:t.Color.transparent});let A=f.transform,R=A.projection.name==="globe",D=R?["PROJECTION_GLOBE_VIEW"]:null,F=R?t.CullFaceMode.frontCCW:t.CullFaceMode.disabled,j=[t.mercatorXfromLng(A.center.lng),t.mercatorYfromLat(A.center.lat)];for(let X=0;X<m.length;X++){let W=m[X];if(a.hasRenderableParent(W))continue;let Z=a.getTile(W),H=Z.getBucket(h);if(!H||H.projection.name!==A.projection.name)continue;let $=H.programConfigurations.get(h.id),ee=f.useProgram("heatmap",$,D),{zoom:Y}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,ee),f.prepareDrawProgram(v,ee,W.toUnwrapped());let de=A.projection.createInversionMatrix(A,W.canonical);ee.draw(v,x.TRIANGLES,t.DepthMode.disabled,T,E,F,q0(f,W,Z,de,j,Y,h.paint.get("heatmap-intensity")),h.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,h.paint,f.transform.zoom,$,R?[H.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,x){let T=v.context,E=T.gl,A=x.heatmapFbo;if(!A)return;T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),T.activeTexture.set(E.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new t.Texture(T,x.colorRamp,E.RGBA)),R.bind(E.LINEAR,E.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(T,E.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,v.colorModeForRenderPass(),t.CullFaceMode.disabled,((D,F,j,X)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(f,h))},line:function(f,a,h,m){if(f.renderPass!=="translucent")return;let v=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;let T=f.depthModeForSublayer(0,t.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),A=f.terrain&&f.terrain.renderingToTexture?1:t.exported.devicePixelRatio,R=h.paint.get("line-dasharray"),D=R.constantOr(1),F=h.layout.get("line-cap"),j=h.paint.get("line-pattern"),X=j.constantOr(1),W=h.paint.get("line-gradient"),Z=h.getCrossfadeParameters(),H=X?"linePattern":"line",$=f.context,ee=$.gl,Y=(pe=>{let se=[];bc(pe)&&se.push("RENDER_LINE_DASH"),pe.paint.get("line-gradient")&&se.push("RENDER_LINE_GRADIENT");let fe=pe.paint.get("line-trim-offset");fe[0]===0&&fe[1]===0||se.push("RENDER_LINE_TRIM_OFFSET");let he=pe.paint.get("line-pattern").constantOr(1),ge=pe.paint.get("line-opacity").constantOr(1)!==1;return!he&&ge&&se.push("RENDER_LINE_ALPHA_DISCARD"),se})(h),de=Y.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(de=!1);for(let pe of m){let se=a.getTile(pe);if(X&&!se.patternsLoaded())continue;let fe=se.getBucket(h);if(!fe)continue;f.prepareDrawTile();let he=fe.programConfigurations.get(h.id),ge=f.useProgram(H,he,Y),Ee=j.constantOr(null);if(Ee&&se.imageAtlas){let Ne=se.imageAtlas,st=Ne.patternPositions[Ee.to.toString()],at=Ne.patternPositions[Ee.from.toString()];st&&at&&he.setConstantPatternPositions(st,at)}let Ye=R.constantOr(null),xe=F.constantOr(null);if(!X&&Ye&&xe&&se.lineAtlas){let Ne=se.lineAtlas,st=Ne.getDash(Ye.to,xe),at=Ne.getDash(Ye.from,xe);st&&at&&he.setConstantPatternPositions(st,at)}let[ze,Ue]=h.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&ze!==Ue&&(ze===0&&(ze-=1),Ue===1&&(Ue+=1));let it=f.terrain?pe.projMatrix:null,Pe=X?R0(f,se,h,Z,it,A):vc(f,se,h,Z,it,fe.lineClipsArray.length,A,[ze,Ue]);if(W){let Ne=fe.gradients[h.id],st=Ne.texture;if(h.gradientVersion!==Ne.version){let at=256;if(h.stepInterpolant){let yt=a.getSource().maxzoom,Tt=pe.canonical.z===yt?Math.ceil(1<<f.transform.maxZoom-pe.canonical.z):1;at=t.clamp(t.nextPowerOfTwo(fe.maxLineLength/t.EXTENT*1024*Tt),256,$.maxTextureSize)}Ne.gradient=t.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:Ne.gradient||void 0,clips:fe.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new t.Texture($,Ne.gradient,ee.RGBA),Ne.version=h.gradientVersion,st=Ne.texture}$.activeTexture.set(ee.TEXTURE1),st.bind(h.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}D&&($.activeTexture.set(ee.TEXTURE0),se.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),he.updatePaintBuffers(Z)),X&&($.activeTexture.set(ee.TEXTURE0),se.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),he.updatePaintBuffers(Z)),f.prepareDrawProgram($,ge,pe.toUnwrapped());let Je=Ne=>{ge.draw($,ee.TRIANGLES,T,Ne,E,t.CullFaceMode.disabled,Pe,h.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,h.paint,f.transform.zoom,he,[fe.layoutVertexBuffer2])};if(de){let Ne=f.stencilModeForClipping(pe).ref;Ne===0&&f.terrain&&$.clear({stencil:0});let st={func:ee.EQUAL,mask:255};Pe.u_alpha_discard_threshold=.8,Je(new t.StencilMode(st,Ne,255,ee.KEEP,ee.KEEP,ee.INVERT)),Pe.u_alpha_discard_threshold=0,Je(new t.StencilMode(st,Ne,255,ee.KEEP,ee.KEEP,ee.KEEP))}else Je(f.stencilModeForClipping(pe))}de&&(f.resetStencilClippingMasks(),f.terrain&&$.clear({stencil:0}))},fill:function(f,a,h,m){let v=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;let T=f.colorModeForRenderPass(),E=h.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!E.constantOr(1)&&v.constantOr(t.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){let R=f.depthModeForSublayer(1,f.renderPass==="opaque"?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);Ec(f,a,h,m,R,T,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){let R=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);Ec(f,a,h,m,R,T,!0)}},"fill-extrusion":function(f,a,h,m){let v=h.paint.get("fill-extrusion-opacity");if(v!==0&&f.renderPass==="translucent"){let x=new t.DepthMode(f.context.gl.LEQUAL,t.DepthMode.ReadWrite,f.depthRangeFor3D);if(v!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))yo(f,a,h,m,x,t.StencilMode.disabled,t.ColorMode.disabled),yo(f,a,h,m,x,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{let T=f.colorModeForRenderPass();yo(f,a,h,m,x,t.StencilMode.disabled,T)}}},hillshade:function(f,a,h,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;let v=f.context,x=f.depthModeForSublayer(0,t.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),E=f.terrain&&f.terrain.renderingToTexture,[A,R]=f.renderPass!=="translucent"||E?[{},m]:f.stencilConfigForOverlap(m);for(let D of R){let F=a.getTile(D);if(F.needsHillshadePrepare&&f.renderPass==="offscreen")xs(f,F,h,x,t.StencilMode.disabled,T);else if(f.renderPass==="translucent"){let j=E&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):A[D.overscaledZ];kp(f,D,F,h,x,j,T)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,a,h,m,v,x){if(f.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!m.length)return;let T=f.context,E=T.gl,A=a.getSource(),R=f.useProgram("raster"),D=f.colorModeForRenderPass(),F=f.terrain&&f.terrain.renderingToTexture,[j,X]=A instanceof ve||F?[{},m]:f.stencilConfigForOverlap(m),W=X[X.length-1].overscaledZ,Z=!f.options.moving;for(let H of X){let $=F?t.DepthMode.disabled:f.depthModeForSublayer(H.overscaledZ-W,h.paint.get("raster-opacity")===1?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,E.LESS),ee=H.toUnwrapped(),Y=a.getTile(H);if(F&&(!Y||!Y.hasData()))continue;let de=F?H.projMatrix:f.transform.calculateProjMatrix(ee,Z),pe=f.terrain&&F?f.terrain.stencilModeForRTTOverlap(H):j[H.overscaledZ],se=x?0:h.paint.get("raster-fade-duration");Y.registerFadeDuration(se);let fe=a.findLoadedParent(H,0),he=_c(Y,fe,a,f.transform,se),ge,Ee;f.terrain&&f.terrain.prepareDrawTile();let Ye=h.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;T.activeTexture.set(E.TEXTURE0),Y.texture.bind(Ye,E.CLAMP_TO_EDGE),T.activeTexture.set(E.TEXTURE1),fe?(fe.texture.bind(Ye,E.CLAMP_TO_EDGE),ge=Math.pow(2,fe.tileID.overscaledZ-Y.tileID.overscaledZ),Ee=[Y.tileID.canonical.x*ge%1,Y.tileID.canonical.y*ge%1]):Y.texture.bind(Ye,E.CLAMP_TO_EDGE);let xe=D0(de,Ee||[0,0],ge||1,he,h,A instanceof ve?A.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(T,R,ee),A instanceof ve)A.boundsBuffer&&A.boundsSegments&&R.draw(T,E.TRIANGLES,$,t.StencilMode.disabled,D,t.CullFaceMode.disabled,xe,h.id,A.boundsBuffer,f.quadTriangleIndexBuffer,A.boundsSegments);else{let{tileBoundsBuffer:ze,tileBoundsIndexBuffer:Ue,tileBoundsSegments:it}=f.getTileBoundsBuffers(Y);R.draw(T,E.TRIANGLES,$,pe,D,t.CullFaceMode.disabled,xe,h.id,ze,Ue,it)}}f.resetStencilClippingMasks()},background:function(f,a,h,m){let v=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x===0)return;let T=f.context,E=T.gl,A=f.transform,R=A.tileSize,D=h.paint.get("background-pattern");if(f.isPatternMissing(D))return;let F=!D&&v.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==F)return;let j=t.StencilMode.disabled,X=f.depthModeForSublayer(0,F==="opaque"?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),W=f.colorModeForRenderPass(),Z=f.useProgram(D?"backgroundPattern":"background"),H,$=m;$||(H=f.getBackgroundTiles(),$=Object.values(H).map(Y=>Y.tileID)),D&&(T.activeTexture.set(E.TEXTURE0),f.imageManager.bind(f.context));let ee=h.getCrossfadeParameters();for(let Y of $){let de=Y.toUnwrapped(),pe=m?Y.projMatrix:f.transform.calculateProjMatrix(de);f.prepareDrawTile();let se=a?a.getTile(Y):H?H[Y.key]:new t.Tile(Y,R,A.zoom,f),fe=D?k0(pe,x,f,D,{tileID:Y,tileSize:R},ee):L0(pe,x,v);f.prepareDrawProgram(T,Z,de);let{tileBoundsBuffer:he,tileBoundsIndexBuffer:ge,tileBoundsSegments:Ee}=f.getTileBoundsBuffers(se);Z.draw(T,E.TRIANGLES,X,j,W,t.CullFaceMode.disabled,fe,h.id,he,ge,Ee)}},sky:function(f,a,h){let m=f.transform,v=m.projection.name==="mercator"||m.projection.name==="globe"?1:t.smoothstep(7,8,m.zoom),x=h.paint.get("sky-opacity")*v;if(x===0)return;let T=f.context,E=h.paint.get("sky-type"),A=new t.DepthMode(T.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?h.needsSkyboxCapture(f)&&(function(D,F,j,X){let W=D.context,Z=W.gl,H=F.skyboxFbo;if(!H){H=F.skyboxFbo=W.createFramebuffer(32,32,!1),F.skyboxGeometry=new tf(W),F.skyboxTexture=W.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,F.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let de=0;de<6;++de)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(H.framebuffer),W.viewport.set([0,0,32,32]);let $=F.getCenter(D,!0),ee=D.useProgram("skyboxCapture"),Y=new Float64Array(16);t.identity(Y),t.rotateY(Y,Y,.5*-Math.PI),Ss(W,F,ee,Y,$,0),t.identity(Y),t.rotateY(Y,Y,.5*Math.PI),Ss(W,F,ee,Y,$,1),t.identity(Y),t.rotateX(Y,Y,.5*-Math.PI),Ss(W,F,ee,Y,$,2),t.identity(Y),t.rotateX(Y,Y,.5*Math.PI),Ss(W,F,ee,Y,$,3),t.identity(Y),Ss(W,F,ee,Y,$,4),t.identity(Y),t.rotateY(Y,Y,Math.PI),Ss(W,F,ee,Y,$,5),W.viewport.set([0,0,D.width,D.height])}(f,h),h.markSkyboxValid(f)):f.renderPass==="sky"&&function(D,F,j,X,W){let Z=D.context,H=Z.gl,$=D.transform,ee=D.useProgram("skybox");Z.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,F.skyboxTexture);let Y=((de,pe,se,fe,he)=>({u_matrix:de,u_sun_direction:pe,u_cubemap:0,u_opacity:fe,u_temporal_offset:he}))($.skyboxMatrix,F.getCenter(D,!1),0,X,W);D.prepareDrawProgram(Z,ee),ee.draw(Z,H.TRIANGLES,j,t.StencilMode.disabled,D.colorModeForRenderPass(),t.CullFaceMode.backCW,Y,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,h,A,x,R):E==="gradient"&&f.renderPass==="sky"&&function(D,F,j,X,W){let Z=D.context,H=Z.gl,$=D.transform,ee=D.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new tf(Z)),Z.activeTexture.set(H.TEXTURE0);let Y=F.colorRampTexture;Y||(Y=F.colorRampTexture=new t.Texture(Z,F.colorRamp,H.RGBA)),Y.bind(H.LINEAR,H.CLAMP_TO_EDGE);let de=((pe,se,fe,he,ge)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:se,u_radius:t.degToRad(fe),u_opacity:he,u_temporal_offset:ge}))($.skyboxMatrix,F.getCenter(D,!1),F.paint.get("sky-gradient-radius"),X,W);D.prepareDrawProgram(Z,ee),ee.draw(Z,H.TRIANGLES,j,t.StencilMode.disabled,D.colorModeForRenderPass(),t.CullFaceMode.backCW,de,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,h,A,x,R)},debug:function(f,a,h){for(let m=0;m<h.length;m++)lr(f,a,h[m])},custom:function(f,a,h){let m=f.context,v=h.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))t.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(f.renderPass==="offscreen"){let x=v.prerender;x&&(f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),x.call(v,m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),m.setStencilMode(t.StencilMode.disabled);let x=v.renderingMode==="3d"?new t.DepthMode(f.context.gl.LEQUAL,t.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,t.DepthMode.ReadOnly);m.setDepthMode(x),v.render(m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState(),m.bindFramebuffer.set(null)}}};class nf{constructor(a,h){this.context=new K(a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new uc,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,h){let m=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new r_(this,a));let v=this._terrain;this.transform.elevation=m?v:null,v.update(a,this.transform,h)}_updateFog(a){let h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[m,v]=h.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);let x=m+.78*(v-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,h){if(this.width=a*t.exported.devicePixelRatio,this.height=h*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let m of this.style.order)this.style._layers[m].resize()}setup(){let a=this.context,h=new t.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(t.EXTENT,0),h.emplaceBack(0,t.EXTENT),h.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(h,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);let m=new t.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(t.EXTENT,0),m.emplaceBack(0,t.EXTENT),m.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=a.createVertexBuffer(m,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);let v=new t.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);let x=new t.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(t.EXTENT,0,t.EXTENT,0),x.emplaceBack(0,t.EXTENT,0,t.EXTENT),x.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(x,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);let T=new t.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(T);let E=new t.StructArrayLayout1ui2;for(let R of[0,1,3,2,0])E.emplaceBack(R);this.debugIndexBuffer=a.createIndexBuffer(E),this.emptyTexture=new t.Texture(a,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=t.create();let A=this.context.gl;this.stencilClearMode=new t.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(t.window.performance.now()),this.atmosphereBuffer=new Sc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,h.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,Np(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,m){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let A of m)if(this._tileClippingMaskIDs[A.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=h.id;let v=this.context,x=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(t.ColorMode.disabled),v.setDepthMode(t.DepthMode.disabled);let T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of m){let A=h.getTile(E),R=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:F,tileBoundsSegments:j}=this.getTileBoundsBuffers(A);T.draw(v,x.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Np(E.projMatrix),"$clipping",D,F,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let a=this.nextStencilID++,h=this.context.gl;return new t.StencilMode({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);let h=this.context.gl;return new t.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){let h=this.context.gl,m=a.sort((T,E)=>E.overscaledZ-T.overscaledZ),v=m[m.length-1].overscaledZ,x=m[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();let T={};for(let E=0;E<x;E++)T[E+v]=new t.StencilMode({func:h.GEQUAL,mask:255},E+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[T,m]}return[{[v]:t.StencilMode.disabled},m]}colorModeForRenderPass(){let a=this.context.gl;return this._showOverdrawInspector?new t.ColorMode([a.CONSTANT_COLOR,a.ONE],new t.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(a,h,m){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new t.DepthMode(m||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){this.style=a,this.options=h,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();let m=this.style.order,v=this.style._sourceCaches;for(let A in v){let R=v[A];R.used&&R.prepare(this.context)}let x={},T={},E={};for(let A in v){let R=v[A];x[A]=R.getVisibleCoordinates(),T[A]=x[A].slice().reverse(),E[A]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<m.length;A++)if(this.style._layers[m[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),t.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(let A of m){let R=this.style._layers[A],D=a._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;let F=D?T[D.id]:void 0;(R.type==="custom"||R.isSky()||F&&F.length)&&this.renderLayer(this,D,R,F)}if(this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){let A=this.style._layers[m[this.currentLayer]],R=a._getLayerSourceCache(A);if(A.isSky())continue;let D=R?T[R.id]:void 0;this._renderTileClippingMasks(A,R,D),this.renderLayer(this,R,A,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,R){let D=A.context,F=D.gl,j=A.transform,X=new t.DepthMode(F.LEQUAL,t.DepthMode.ReadOnly,[0,1]),W=A.useProgram("globeAtmosphere",null,j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Z=t.globeToMercatorTransition(j.zoom),H=R.properties.get("color").toArray01(),$=R.properties.get("high-color").toArray01(),ee=R.properties.get("space-color").toArray01PremultipliedAlpha(),Y=t.identity$1([]);t.rotateY$1(Y,Y,-t.degToRad(j._center.lng)),t.rotateX$1(Y,Y,t.degToRad(j._center.lat)),t.rotateZ$1(Y,Y,j.angle),t.rotateX$1(Y,Y,-j._pitch);let de=t.fromQuat(new Float32Array(16),Y),pe=t.mapValue(R.properties.get("star-intensity"),0,1,0,.25),se=5e-4,fe=t.mapValue(R.properties.get("horizon-blend"),0,1,se,.25),he=t.globeUseCustomAntiAliasing(A,D,j)&&fe===se?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,ge=A.frameCounter/1e3%1,Ee=t.length(j.globeCenterInViewSpace),Ye=Math.sqrt(Math.pow(Ee,2)-Math.pow(he,2)),xe=Math.acos(Ye/Ee),ze=((it,Pe,Je,Ne,st,at,yt,Tt,qt,Wt,gt,Lt,rr,Rr)=>({u_frustum_tl:it,u_frustum_tr:Pe,u_frustum_br:Je,u_frustum_bl:Ne,u_horizon:st,u_transition:at,u_fadeout_range:yt,u_color:Tt,u_high_color:qt,u_space_color:Wt,u_star_intensity:gt,u_star_size:5*t.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Lt,u_horizon_angle:rr,u_rotation_matrix:Rr}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,Z,fe,H,$,ee,pe,ge,xe,de);A.prepareDrawProgram(D,W);let Ue=A.atmosphereBuffer;Ue&&W.draw(D,F.TRIANGLES,X,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,ze,"skybox",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)}(this,this.style.fog),this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){let A=this.style._layers[m[this.currentLayer]],R=a._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,R,A,R?T[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){let A=this.style._layers[m[this.currentLayer]],R=a._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let D=R?(A.type==="symbol"?E:T)[R.id]:void 0;this._renderTileClippingMasks(A,R,R?x[R.id]:void 0),this.renderLayer(this,R,A,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;t.values(this.style._layers).forEach(R=>{let D=a._getLayerSourceCache(R);D&&!R.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<D.getSource().maxzoom)&&(A=D)}),A&&this.options.showTileBoundaries&&Is.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){let R=A.transform.padding;Vl(A,A.transform.height-(R.top||0),3,f_),Vl(A,R.bottom||0,3,Ts),m_(A,R.left||0,3,Es),m_(A,A.transform.width-(R.right||0),3,d_);let D=A.transform.centerPoint;(function(F,j,X,W){Gl(F,j-1,X-10,2,20,W),Gl(F,j-10,X-1,20,2,W)})(A,D.x,A.transform.height-D.y,ef)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}}renderLayer(a,h,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(m.type)||Is[m.type](a,h,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;let h=this.context.extTimerQuery,m=this.gpuTimers[a.id];m||(m=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),m.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let a=this.context.extTimerQuery,h=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),a.beginQueryEXT(a.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){let a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){let a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){let h={};for(let m in a){let v=a[m],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(v.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(v.query),h[m]=T}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;let h=this.context.extTimerQuery,m=0;for(let v of a)m+=h.getQueryObjectEXT(v,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(v);return m}translatePosMatrix(a,h,m,v,x){if(!m[0]&&!m[1])return a;let T=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){let R=Math.sin(T),D=Math.cos(T);m=[m[0]*D-m[1]*R,m[0]*R+m[1]*D]}let E=[x?m[0]:nr(h,m[0],this.transform.zoom),x?m[1]:nr(h,m[1],this.transform.zoom),0],A=new Float32Array(16);return t.translate(A,a,E),A}saveTileTexture(a){let h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){let h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;let h=this.imageManager.getPattern(a.from.toString()),m=this.imageManager.getPattern(a.to.toString());return!h||!m}currentGlobalDefines(){let a=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),h&&!a&&h.getOpacity(this.transform.pitch)!==0&&m.push("FOG"),a&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(a,h,m){this.cache=this.cache||{};let v=m||[],x=this.currentGlobalDefines().concat(v),T=Vp.cacheKey(dc[a],a,x,h);return this.cache[T]||(this.cache[T]=new Vp(this.context,a,dc[a],h,z0[a],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,h,m){if(this.terrain&&this.terrain.renderingToTexture)return;let v=this.style.fog;if(v){let x=v.getOpacity(this.transform.pitch),T=((E,A,R,D,F,j,X,W,Z,H,$)=>{let ee=E.transform,Y=A.properties.get("color").toArray01();Y[3]=D;let de=E.frameCounter/1e3%1;return{u_fog_matrix:R?ee.calculateFogTileMatrix(R):E.identityMat,u_fog_range:A.getFovAdjustedRange(ee._fov),u_fog_color:Y,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:de,u_frustum_tl:F,u_frustum_tr:j,u_frustum_br:X,u_frustum_bl:W,u_globe_pos:Z,u_globe_radius:H,u_viewport:$,u_globe_transition:t.globeToMercatorTransition(ee.zoom),u_is_globe:+(ee.projection.name==="globe")}})(this,v,m,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.exported.devicePixelRatio,this.transform.height*t.exported.devicePixelRatio]);h.setFogUniformValues(a,T)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){let a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let a=this._backgroundTiles,h=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(let v of m)h[v.key]=a[v.key]||new t.Tile(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Wl{constructor(a=0,h=0,m=0,v=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=m,this.right=v}interpolate(a,h,m){return h.top!=null&&a.top!=null&&(this.top=t.number(a.top,h.top,m)),h.bottom!=null&&a.bottom!=null&&(this.bottom=t.number(a.bottom,h.bottom,m)),h.left!=null&&a.left!=null&&(this.left=t.number(a.left,h.left,m)),h.right!=null&&a.right!=null&&(this.right=t.number(a.right,h.right,m)),this}getCenter(a,h){let m=t.clamp((this.left+a-this.right)/2,0,a),v=t.clamp((this.top+h-this.bottom)/2,0,h);return new t.pointGeometry(m,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Wl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function of(f,a){let h=t.getColumn(f,3);t.fromQuat(f,a),t.setColumn(f,3,h)}function As(f,a){let h=t.identity$1([]);return t.rotateZ$1(h,h,-a),t.rotateX$1(h,h,-f),h}function Os(f,a){let h=[f[0],f[1],0],m=[a[0],a[1],0];if(t.length(h)>=1e-15){let T=t.normalize([],h);t.scale$2(m,T,t.dot(m,T)),a[0]=m[0],a[1]=m[1]}let v=t.cross([],a,f);if(t.len(v)<1e-15)return null;let x=Math.atan2(-v[1],v[0]);return As(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class ht{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){let h=a instanceof t.MercatorCoordinate?a:new t.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=t.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;let m=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(a)):0,v=this.position,x=t.MercatorCoordinate.fromLngLat(a,m),T=[x.x-v.x,x.y-v.y,x.z-v.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Os(T,h)}setPitchBearing(a,h){this.orientation=As(t.degToRad(a),t.degToRad(-h))}}class tn{constructor(a,h){this._transform=t.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){let a=this.position;return new t.MercatorCoordinate(a[0],a[1],a[2])}get position(){let a=t.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&t.setColumn(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||t.identity$1([]),a&&of(this._transform,this._orientation)}getPitchBearing(){let a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=As(a,h),of(this._transform,this._orientation)}forward(){let a=t.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){let a=t.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){let a=t.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){let m=new Float64Array(16);return t.invert(m,this.getWorldToCamera(a,h)),m}getWorldToCameraPosition(a,h,m){let v=this.position;t.scale$2(v,v,-a);let x=new Float64Array(16);return t.fromScaling(x,[m,m,m]),t.translate(x,x,v),x[10]*=h,x}getWorldToCamera(a,h){let m=new Float64Array(16),v=new Float64Array(4),x=this.position;return t.conjugate(v,this._orientation),t.scale$2(x,x,-a),t.fromQuat(m,v),t.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=h,m[9]*=h,m[10]*=h,m[11]*=h,m}getCameraToClipPerspective(a,h,m,v){let x=new Float64Array(16);return t.perspective(x,a,h,m,v),x}getDistanceToElevation(a){let h=a===0?0:t.mercatorZfromAltitude(a,this.position[1]),m=this.forward();return(h-this.position[2])/m[2]}clone(){return new tn([...this.position],[...this.orientation])}}function af(f,a){let h=Zl(f.projection,f.zoom,f.width,f.height),m=function(x,T,E,A,R){let D=new t.LngLat(E.lng-180*kn,E.lat),F=new t.LngLat(E.lng+180*kn,E.lat),j=x.project(D.lng,D.lat),X=x.project(F.lng,F.lat),W=-Math.atan2(X.y-j.y,X.x-j.x),Z=t.MercatorCoordinate.fromLngLat(E);Z.y=t.clamp(Z.y,-.999975,.999975);let H=Z.toLngLat(),$=x.project(H.lng,H.lat),ee=t.MercatorCoordinate.fromLngLat(H);ee.x+=kn;let Y=ee.toLngLat(),de=x.project(Y.lng,Y.lat),pe=Hl(de.x-$.x,de.y-$.y,W),se=t.MercatorCoordinate.fromLngLat(H);se.y+=kn;let fe=se.toLngLat(),he=x.project(fe.lng,fe.lat),ge=Hl(he.x-$.x,he.y-$.y,W),Ee=Math.abs(pe.x)/Math.abs(ge.y),Ye=t.identity([]);t.rotateZ(Ye,Ye,-W*(1-(R?0:A)));let xe=t.identity([]);return t.scale(xe,xe,[1,1-(1-Ee)*A,1]),xe[4]=-ge.x/ge.y*A,t.rotateZ(xe,xe,W),t.multiply(xe,Ye,xe),xe}(f.projection,0,f.center,h,a),v=sf(f);return t.scale(m,m,[v,v,1]),m}function sf(f){let a=f.projection,h=Zl(f.projection,f.zoom,f.width,f.height),m=lf(a,f.center),v=lf(a,t.LngLat.convert(a.center));return Math.pow(2,m*h+(1-h)*v)}function Zl(f,a,h,m,v=1/0){let x=f.range;if(!x)return 0;let T=Math.min(v,Math.max(h,m)),E=Math.log(T/1024)/Math.LN2;return t.smoothstep(x[0]+E,x[1]+E,a)}let kn=1/4e4;function lf(f,a){let h=t.clamp(a.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),m=new t.LngLat(a.lng-180*kn,h),v=new t.LngLat(a.lng+180*kn,h),x=f.project(m.lng,h),T=f.project(v.lng,h),E=t.MercatorCoordinate.fromLngLat(m),A=t.MercatorCoordinate.fromLngLat(v),R=T.x-x.x,D=T.y-x.y,F=A.x-E.x,j=A.y-E.y,X=Math.sqrt((F*F+j*j)/(R*R+D*D));return Math.log(X)/Math.LN2}function Hl(f,a,h){let m=Math.cos(h),v=Math.sin(h);return{x:f*m-a*v,y:f*v+a*m}}class Xl{constructor(a,h,m,v,x,T,E){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new tn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let a=new Xl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a){let h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(a||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};let h=this.projection?this.getProjection():void 0;this.projection=t.getProjection(this.projectionOptions);let m=!g(h,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){let a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.getProjection({name:"mercator"});let h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){let h=-a*Math.PI/180;var m;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(m=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(v,x,T){var E=x[0],A=x[1],R=x[2],D=x[3],F=Math.sin(T),j=Math.cos(T);v[0]=E*j+R*F,v[1]=A*j+D*F,v[2]=E*-F+R*j,v[3]=A*-F+D*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){let h=t.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){let h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop(),v=0,x=0;for(let T=0;T<h.length;T++){let E=new t.pointGeometry(h[T][0]*this.width,m+h[T][1]*(this.height-m)),A=a.pointCoordinate(E);if(!A)continue;let R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);v+=A[3]*R,x+=R}return x===0?NaN:v/x}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(a),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-m,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){let h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude())),m;m=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];let v=t.length(t.sub([],this._camera.position,m));return t.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!t.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){let m=[a.position.x,a.position.y,a.position.z];t.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let a=this._camera.position,h=new ht;return h.position=new t.MercatorCoordinate(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!t.length$1(a))return!1;t.normalize$1(a,a);let h=t.transformQuat([],[0,0,-1],a),m=t.transformQuat([],[0,-1,0],a);if(m[2]<0)return!1;let v=Os(h,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){let h=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=t.clamp(a[2],v/m,v/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,m){this._unmodified=!1,this._edgeInsets.interpolate(a,h,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){let h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){let h=[new t.UnwrappedTileID(0,a)];if(this.renderWorldCopies){let m=this.pointCoordinate(new t.pointGeometry(0,0)),v=this.pointCoordinate(new t.pointGeometry(this.width,0)),x=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new t.pointGeometry(0,this.height)),E=Math.floor(Math.min(m.x,v.x,x.x,T.x)),A=Math.floor(Math.max(m.x,v.x,x.x,T.x)),R=1;for(let D=E-R;D<=A+R;D++)D!==0&&h.push(new t.UnwrappedTileID(D,a))}return h}coveringTiles(a){let h=this.coveringZoomLevel(a),m=h,v=this.elevation&&!a.isTerrainDEM,x=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);let T=this.locationCoordinate(this.center),E=this.center.lat,A=1<<h,R=[A*T.x,A*T.y,0],D=this.projection.name==="globe",F=!D,j=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,F),X=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=A*t.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),H=[A*X.x,A*X.y,Z*(F?1:W)],$=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,Y=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,de=a.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=this.projection.isReprojectedInTileSpace?sf(this):1,se=Pe=>{let Ne=new t.MercatorCoordinate(Pe.x+25e-6,Pe.y,Pe.z),st=new t.MercatorCoordinate(Pe.x,Pe.y+25e-6,Pe.z),at=Pe.toLngLat(),yt=Ne.toLngLat(),Tt=st.toLngLat(),qt=this.locationCoordinate(at),Wt=this.locationCoordinate(yt),gt=this.locationCoordinate(Tt),Lt=Math.hypot(Wt.x-qt.x,Wt.y-qt.y),rr=Math.hypot(gt.x-qt.x,gt.y-qt.y);return Math.sqrt(Lt*rr)*pe/25e-6},fe=Pe=>{let Je=Y,Ne=de;return{aabb:t.tileAABB(this,A,0,0,0,Pe,Ne,Je,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:Je,wrap:Pe,fullyVisible:!1}},he=[],ge=[],Ee=h,Ye=a.reparseOverscaled?m:h,xe=Pe=>Pe*Pe,ze=xe((Z-this._centerAltitude)*W),Ue=Pe=>{if(!this._elevation||!Pe.tileID||!x)return;let Je=this._elevation.getMinMaxForTile(Pe.tileID),Ne=Pe.aabb;Je?(Ne.min[2]=Je.min,Ne.max[2]=Je.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(Pe.shouldSplit=it(Pe),Pe.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},it=Pe=>{if(Pe.zoom<ee)return!0;if(Pe.zoom===Ee)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;let Je=Pe.aabb.distanceX(H),Ne=Pe.aabb.distanceY(H),st=ze,at=1;if(D){st=xe(Pe.aabb.distanceZ(H));let Tt=Math.pow(2,Pe.zoom),qt=t.latFromMercatorY((Pe.y+1)/Tt),Wt=t.latFromMercatorY(Pe.y/Tt),gt=Math.min(Math.max(E,qt),Wt),Lt=t.circumferenceAtLatitude(gt)/t.circumferenceAtLatitude(E);if(at=gt===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Lt/this._mercatorScaleRatio),this.zoom<=t.GLOBE_ZOOM_THRESHOLD_MIN&&Pe.zoom===Ee-1&&Lt>=.9)return!0}else if(v&&(st=xe(Pe.aabb.distanceZ(H)*W)),this.projection.isReprojectedInTileSpace&&m<=5){let Tt=Math.pow(2,Pe.zoom),qt=se(new t.MercatorCoordinate((Pe.x+.5)/Tt,(Pe.y+.5)/Tt));at=qt>.85?1:qt}let yt=Je*Je+Ne*Ne+st;return yt<xe((1<<Ee-Pe.zoom)*$*at*((Tt,qt)=>{if(qt*xe(.707)<Tt)return 1;let Wt=Math.sqrt(qt/Tt);return Wt/(1.4144271570014144+(Math.pow(1.1,Wt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,ze),yt))};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)he.push(fe(-Pe)),he.push(fe(Pe));for(he.push(fe(0));he.length>0;){let Pe=he.pop(),Je=Pe.x,Ne=Pe.y,st=Pe.fullyVisible;if(!st){let at=Pe.aabb.intersects(j);if(at===0)continue;st=at===2}if(Pe.zoom!==Ee&&it(Pe))for(let at=0;at<4;at++){let yt=(Je<<1)+at%2,Tt=(Ne<<1)+(at>>1),qt={aabb:x?Pe.aabb.quadrant(at):t.tileAABB(this,A,Pe.zoom+1,yt,Tt,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:yt,y:Tt,wrap:Pe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};v&&!D&&(qt.tileID=new t.OverscaledTileID(Pe.zoom+1===Ee?Ye:Pe.zoom+1,Pe.wrap,Pe.zoom+1,yt,Tt),Ue(qt)),he.push(qt)}else{let at=Pe.zoom===Ee?Ye:Pe.zoom;if(a.minzoom&&a.minzoom>at)continue;let yt=R[0]-(.5+Je+(Pe.wrap<<Pe.zoom))*(1<<h-Pe.zoom),Tt=R[1]-.5-Ne,qt=Pe.tileID?Pe.tileID:new t.OverscaledTileID(at,Pe.wrap,Pe.zoom,Je,Ne);ge.push({tileID:qt,distanceSq:yt*yt+Tt*Tt})}}if(this.fogCullDistSq){let Pe=this.fogCullDistSq,Je=this.horizonLineFromTop();ge=ge.filter(Ne=>{let st=[0,0,0,1],at=[t.EXTENT,t.EXTENT,0,1],yt=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());t.transformMat4$1(st,st,yt),t.transformMat4$1(at,at,yt);let Tt=t.getAABBPointSquareDist(st,at);if(Tt===0)return!0;let qt=!1,Wt=this._elevation;if(Wt&&Tt>Pe&&Je!==0){let gt=this.calculateProjMatrix(Ne.tileID.toUnwrapped()),Lt;a.isTerrainDEM||(Lt=Wt.getMinMaxForTile(Ne.tileID)),Lt||(Lt={min:de,max:Y});let rr=t.furthestTileCorner(this.rotation),Rr=[rr[0]*t.EXTENT,rr[1]*t.EXTENT,Lt.max];t.transformMat4(Rr,Rr,gt),qt=(1-Rr[1])*this.height*.5<Je}return Tt<Pe||qt})}return ge.sort((Pe,Je)=>Pe.distanceSq-Je.distanceSq).map(Pe=>Pe.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){let h=t.clamp(a.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),m=this.projection.project(a.lng,h);return new t.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,h){let m,v,x=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;m=(h.x-x.x)/E,v=(h.y-x.y)/E}else{let E=this.pointCoordinate(h),A=this.pointCoordinate(x);m=E.x-A.x,v=E.y-A.y}let T=this.locationCoordinate(a);this.setLocation(new t.MercatorCoordinate(T.x-m,T.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){let m=h?t.mercatorZfromAltitude(h,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new t.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){let m=h??this._centerAltitude,v=[a.x,a.y,0,1],x=[a.x,a.y,1,1];t.transformMat4$1(v,v,this.pixelMatrixInverse),t.transformMat4$1(x,x,this.pixelMatrixInverse);let T=x[3];t.scale$1(v,v,1/v[3]),t.scale$1(x,x,1/T);let E=v[2],A=x[2];return{p0:v,p1:x,t:E===A?0:(m-E)/(A-E)}}screenPointToMercatorRay(a){let h=[a.x,a.y,0,1],m=[a.x,a.y,1,1];return t.transformMat4$1(h,h,this.pixelMatrixInverse),t.transformMat4$1(m,m,this.pixelMatrixInverse),t.scale$1(h,h,1/h[3]),t.scale$1(m,m,1/m[3]),h[2]=t.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,m[2]=t.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,t.scale$1(h,h,1/this.worldSize),t.scale$1(m,m,1/this.worldSize),new t.Ray([h[0],h[1],h[2]],t.normalize([],t.sub([],m,h)))}rayIntersectionCoordinate(a){let{p0:h,p1:m,t:v}=a,x=t.mercatorZfromAltitude(h[2],this._center.lat),T=t.mercatorZfromAltitude(m[2],this._center.lat);return new t.MercatorCoordinate(t.number(h[0],m[0],v)/this.worldSize,t.number(h[1],m[1],v)/this.worldSize,t.number(x,T,v))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new t.MercatorCoordinate(h[0],h[1],h[2]);let m=0,v=this.horizonLineFromTop();if(a.y>v)return this.pointCoordinate(a);let x=.02*v,T=a.clone();for(let E=0;E<10&&v-m>x;E++){T.y=t.number(m,v,.66);let A=this.projection.pointCoordinate3D(this,T.x,T.y);A?(v=T.y,h=A):m=T.y}return h?new t.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}_coordinatePoint(a,h){let m=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,m+a.toAltitude(),1];return t.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new t.pointGeometry(v[0]/v[3],v[1]/v[3]):new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(a,h){let m=new t.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new t.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new t.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new t.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom),E=this.pointCoordinate(m,a),A=this.pointCoordinate(v,a),R=this.pointCoordinate(x,h),D=this.pointCoordinate(T,h),F=(j,X)=>(X.y-j.y)/(X.x-j.x);return E.y>1&&A.y>=0?E=new t.MercatorCoordinate((1-D.y)/F(D,E)+D.x,1):E.y<0&&A.y<=1&&(E=new t.MercatorCoordinate(-D.y/F(D,E)+D.x,0)),A.y>1&&E.y>=0?A=new t.MercatorCoordinate((1-R.y)/F(R,A)+R.x,1):A.y<0&&E.y<=1&&(A=new t.MercatorCoordinate(-R.y/F(R,A)+R.x,0)),new t.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(R))}_getBounds3D(){let a=this.elevation;if(!a.visibleDemTiles.length)return this._getBounds(0,0);let h=a.visibleDemTiles.reduce((m,v)=>{if(v.dem){let x=v.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){let h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){let h=a.key,m=this._distanceTileDataCache;if(m[h])return m[h];let v=a.canonical,x=1/this.height,T=this.cameraWorldSize/this.zoomScale(v.z),E=(v.x+Math.pow(2,v.z)*a.wrap)*T,A=v.y*T,R=this.point,D=this.angle,F=Math.sin(-D),j=-Math.cos(-D);return m[h]={bearing:[F,j],center:[(R.x-E)*x,(R.y-A)*x],scale:T/t.EXTENT*x},m[h]}calculateFogTileMatrix(a){let h=a.key,m=this._fogTileMatrixCache;if(m[h])return m[h];let v=this.projection.createTileMatrix(this,this.cameraWorldSize,a);return t.multiply(v,this.worldToFogMatrix,v),m[h]=new Float32Array(v),m[h]}calculateProjMatrix(a,h=!1){let m=a.key,v=h?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];let x=this.calculatePosMatrix(a,this.worldSize);return t.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,x),v[m]=new Float32Array(x),v[m]}calculatePixelsToTileUnitsMatrix(a){let h=a.tileID.key,m=this._pixelsToTileUnitsCache;if(m[h])return m[h];let v=function(x,T){let{scale:E}=x.tileTransform,A=E*t.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return R=new Float32Array(4),j=(D=T.inverseAdjustmentMatrix)[1],X=D[2],W=D[3],H=(F=[A,A])[1],R[0]=D[0]*(Z=F[0]),R[1]=j*Z,R[2]=X*H,R[3]=W*H,R;var R,D,F,j,X,W,Z,H}(a,this);return m[h]=v,m[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let a=this._elevation;this._updateCameraState();let h=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),v=this._camera.forward(),x=t.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,v[2]/=x,t.normalize(v,v);let T=a.raycast(m,v,a.exaggeration());if(T){let E=t.scaleAndAdd([],m,v,T),A=new t.MercatorCoordinate(E[0],E[1],t.mercatorZfromAltitude(E[2],t.latFromMercatorY(E[1]))),R=(A.z+t.length([A.x-m[0],A.y-m[1],A.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;let a=this._elevation;this._updateCameraState();let h=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),v=a.getAtPointOrZero(new t.MercatorCoordinate(...m)),x=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(T<x){let E=this.locationCoordinate(this._center,this._centerAltitude),A=[E.x-m[0],E.y-m[1],E.z-m[2]],R=t.length(A);A[2]-=(x-T)/this._pixelsPerMercatorPixel;let D=t.length(A);if(D===0)return;t.scale$2(A,A,R/D*this._pixelsPerMercatorPixel),this._camera.position=[E.x-A[0],E.y-A[1],E.z*this._pixelsPerMercatorPixel-A[2]],this._camera.orientation=Os(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){let j=this.center;return j.lat=t.clamp(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(j.lng=t.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}let h=this._unmodified,{x:m,y:v}=this.point,x=0,T=m,E=v,A=this.width/2,R=this.height/2,D=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(v-R<D&&(E=D+R),v+R>F&&(E=F-R),F-D<this.height&&(x=Math.max(x,this.height/(F-D)),E=(F+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let j=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,W=this.worldSize/2-(j+X)/2;T=(m+W+this.worldSize)%this.worldSize-W,T-A<j&&(T=j+A),T+A>X&&(T=X-A),X-j<this.width&&(x=Math.max(x,this.width/(X-j)),T=(X+j)/2)}T===m&&E===v||(this.center=this.unproject(new t.pointGeometry(T,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let a=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.mercatorZfromAltitude(1,this.center.lat)/t.mercatorZfromAltitude(1,t.GLOBE_SCALE_MATCH_LATITUDE));let m=Zl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?h:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-a.x/this.width,x[9]=2*a.y/this.height;let T=t.mul([],x,v);if(this.projection.isReprojectedInTileSpace){let pe=this.locationCoordinate(this.center),se=t.identity([]);t.translate(se,se,[pe.x*this.worldSize,pe.y*this.worldSize,0]),t.multiply(se,se,af(this)),t.translate(se,se,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),t.multiply(T,T,se),this.inverseAdjustmentMatrix=function(fe){let he=af(fe,!0);return Nt([],[he[0],he[1],he[4],he[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],T,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=T,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);let E=t.invert([],x);this.frustumCorners=t.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);let A=new Float32Array(16);t.identity(A),t.scale(A,A,[1,-1,1]),t.rotateX(A,A,this._pitch),t.rotateZ(A,A,this.angle);let R=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-a.x/this.width,R[9]=2*(a.y+D)/this.height,this.skyboxMatrix=t.multiply(A,R,A);let F=this.point,j=F.x,X=F.y,W=this.width%2/2,Z=this.height%2/2,H=Math.cos(this.angle),$=Math.sin(this.angle),ee=j-Math.round(j)+H*W+$*Z,Y=X-Math.round(X)+H*Z+$*W,de=new Float64Array(T);if(t.translate(de,de,[ee>.5?ee-1:ee,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=de,T=t.create(),t.scale(T,T,[this.width/2,-this.height/2,1]),t.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=t.create(),t.scale(T,T,[1,-1,1]),t.translate(T,T,[-1,-1,0]),t.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=t.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.calculateGlobeMatrix(this);let pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.transformMat4(pe,pe,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let a=this.cameraWorldSize,h=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[a,a,h];t.scale$2(x,x,v),t.scale$2(m,m,-1),t.multiply$2(m,m,x);let T=t.create();t.translate(T,T,m),t.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,v)}_computeCameraPosition(a){let h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*x,v.y/this.worldSize-m[1]*x,a/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){let h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=a[2],v=1;m>0&&(v=Math.min((h-this._camera.position[2])/m,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,a,v),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){let a=this._camera.position,h=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),x=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),E=Math.max((a[2]-x)/Math.cos(m),T),A=this._zoomFromMercatorZ(E);t.scaleAndAdd(a,a,h,E),this._pitch=t.clamp(m,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(v,-Math.PI,Math.PI),this._setZoom(t.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){let a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){let m=Math.min(a.x,h.x),v=Math.max(a.x,h.x),x=Math.min(a.y,h.y),T=Math.max(a.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new t.pointGeometry(m,x),new t.pointGeometry(v,T),new t.pointGeometry(m,T),new t.pointGeometry(v,x)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(let D of E){let F=this.pointRayIntersection(D);if(F.t<0)return!0;let j=this.rayIntersectionCoordinate(F);if(j.x<A||j.y<0||j.x>R||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.pointGeometry(0,0),new t.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,h){let m=t.length(t.sub([],this._camera.position,a)),v=this._zoomFromMercatorZ(m)+h;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let a=function(h,m){let v=[h[0],h[1],h[2],1];t.transformMat4$1(v,v,m);let x=Math.max(v[3],1e-6);return[v[0]/x,v[1]/x,v[2]/x,x]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.pointGeometry(a[0],a[1])}{let a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,a))}}getCameraToCenterDistance(a){let h=Zl(a,this.zoom,this.width,this.height,1024),m=a.pixelSpaceConversion(this.center.lat,this.worldSize,h);return .5/Math.tan(.5*this._fov)*this.height*m}}function Yl(f,a){let h=!1,m=null,v=()=>{m=null,h&&(f(),m=setTimeout(v,a),h=!1)};return()=>(h=!0,m||v(),m)}class __{constructor(a){this._hashName=a&&encodeURIComponent(a),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yl(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,t.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let a=this._map;if(!a)return"";let h=uf(a);if(this._hashName){let m=this._hashName,v=!1,x=t.window.location.hash.slice(1).split("&").map(T=>{let E=T.split("=")[0];return E===m?(v=!0,`${E}=${h}`):T}).filter(T=>T);return v||x.push(`${m}=${h}`),`#${x.join("&")}`}return`#${h}`}_getCurrentHash(){let a=t.window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(h=m)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){let a=this._map;if(!a)return!1;let h=this._getCurrentHash();if(h.length>=3&&!h.some(m=>isNaN(m))){let m=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){let a=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,a)}}function uf(f,a){let h=f.getCenter(),m=Math.round(100*f.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),T=Math.round(h.lng*x)/x,E=Math.round(h.lat*x)/x,A=f.getBearing(),R=f.getPitch(),D=a?`/${T}/${E}/${m}`:`${m}/${E}/${T}`;return(A||R)&&(D+="/"+Math.round(10*A)/10),R&&(D+=`/${Math.round(R)}`),D}let go={linearity:.3,easing:t.bezier(0,0,.3,1)},F0=t.extend({deceleration:2500,maxSpeed:1400},go),N0=t.extend({deceleration:20,maxSpeed:1400},go),y_=t.extend({deceleration:1e3,maxSpeed:360},go),Ic=t.extend({deceleration:1e3,maxSpeed:90},go);class cf{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:a})}_drainInertiaBuffer(){let a=this._inertiaBuffer,h=t.exported.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let h={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);let m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){let x=Jl(h.pan.mag(),m,t.extend({},F0,a||{}));v.offset=h.pan.mult(x.amount/h.pan.mag()),v.center=this._map.transform.center,Kl(v,x)}if(h.zoom){let x=Jl(h.zoom,m,N0);v.zoom=this._map.transform.zoom+x.amount,Kl(v,x)}if(h.bearing){let x=Jl(h.bearing,m,y_);v.bearing=this._map.transform.bearing+t.clamp(x.amount,-179,179),Kl(v,x)}if(h.pitch){let x=Jl(h.pitch,m,Ic);v.pitch=this._map.transform.pitch+x.amount,Kl(v,x)}if(v.zoom||v.bearing){let x=h.pinchAround===void 0?h.around:h.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Kl(f,a){(!f.duration||f.duration<a.duration)&&(f.duration=a.duration,f.easing=a.easing)}function Jl(f,a,h){let{maxSpeed:m,linearity:v,deceleration:x}=h,T=t.clamp(f*v/(a/1e3),-m,m),E=Math.abs(T)/(x*v);return{easing:h.easing,duration:1e3*E,amount:T*(E/2)}}class Si extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,m,v={}){let x=He(h.getCanvasContainer(),m),T=h.unproject(x);super(a,t.extend({point:x,lngLat:T,originalEvent:m},v)),this._defaultPrevented=!1,this.target=h}}class Cs extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,m){let v=a==="touchend"?m.changedTouches:m.touches,x=It(h.getCanvasContainer(),v),T=x.map(A=>h.unproject(A)),E=x.reduce((A,R,D,F)=>A.add(R.div(F.length)),new t.pointGeometry(0,0));super(a,{points:x,point:E,lngLats:T,lngLat:h.unproject(E),originalEvent:m}),this._defaultPrevented=!1}}class g_ extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,m){super(a,{originalEvent:m}),this._defaultPrevented=!1}}class v_{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new g_(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Si(a.type,this._map,a))}mouseup(a){this._map.fire(new Si(a.type,this._map,a))}preclick(a){let h=t.extend({},a);h.type="preclick",this._map.fire(new Si(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Si(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Si(a.type,this._map,a))}mouseover(a){this._map.fire(new Si(a.type,this._map,a))}mouseout(a){this._map.fire(new Si(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Cs(a.type,this._map,a))}touchmove(a){this._map.fire(new Cs(a.type,this._map,a))}touchend(a){this._map.fire(new Cs(a.type,this._map,a))}touchcancel(a){this._map.fire(new Cs(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class x_{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Si(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Si(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class b_{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(Se(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;let m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;let v=this._startPos;this._lastPos=m,this._box||(this._box=L("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));let x=Math.min(v.x,m.x),T=Math.max(v.x,m.x),E=Math.min(v.y,m.y),A=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${E}px)`,this._box.style.width=T-x+"px",this._box.style.height=A-E+"px")})}mouseupWindow(a,h){if(!this._active||a.button!==0)return;let m=this._startPos,v=h;if(this.reset(),et(),m.x!==v.x||m.y!==v.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:x=>x.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Re(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new t.Event(a,{originalEvent:h}))}}function Ac(f,a){let h={};for(let m=0;m<f.length;m++)h[f[m].identifier]=a[m];return h}class Ps{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){let x=new t.pointGeometry(0,0);for(let T of v)x._add(T);return x.div(v.length)}(h),this.touches=Ac(m,h)))}touchmove(a,h,m){if(this.aborted||!this.centroid)return;let v=Ac(m,h);for(let x in this.touches){let T=this.touches[x],E=v[x];(!E||E.dist(T)>30)&&(this.aborted=!0)}}touchend(a,h,m){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Oc{constructor(a){this.singleTap=new Ps(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,m){this.singleTap.touchstart(a,h,m)}touchmove(a,h,m){this.singleTap.touchmove(a,h,m)}touchend(a,h,m){let v=this.singleTap.touchend(a,h,m);if(v){let x=a.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(x&&T||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class w_{constructor(){this._zoomIn=new Oc({numTouches:1,numTaps:2}),this._zoomOut=new Oc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,m){this._zoomIn.touchstart(a,h,m),this._zoomOut.touchstart(a,h,m)}touchmove(a,h,m){this._zoomIn.touchmove(a,h,m),this._zoomOut.touchmove(a,h,m)}touchend(a,h,m){let v=this._zoomIn.touchend(a,h,m),x=this._zoomOut.touchend(a,h,m);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:a})}):x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let T_={0:1,2:2};class Cc{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;let m=Yt(a);this._correctButton(a,m)&&(this._lastPoint=h,this._eventButton=m)}mousemoveWindow(a,h){let m=this._lastPoint;if(m){if(a.preventDefault(),this._eventButton!=null&&function(v,x){let T=T_[x];return v.buttons===void 0||(v.buttons&T)!==T}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(m,h)}}mouseupWindow(a){this._lastPoint&&Yt(a)===this._eventButton&&(this._moved&&et(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class E_ extends Cc{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class hf extends Cc{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){let m=.8*(h.x-a.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(a){a.preventDefault()}}class gi extends Cc{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){let m=-.5*(h.y-a.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(a){a.preventDefault()}}class U0{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(a,h,m){return this._calculateTransform(a,h,m)}touchmove(a,h,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!t.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,m)}}touchend(a,h,m){this._calculateTransform(a,h,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,m){m.length>0&&(this._active=!0);let v=Ac(m,h),x=new t.pointGeometry(0,0),T=new t.pointGeometry(0,0),E=0;for(let R in v){let D=v[R],F=this._touches[R];F&&(x._add(D),T._add(D.sub(F)),E++,v[R]=D)}if(this._touches=v,E<this._minTouches||!T.mag())return;let A=T.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(E),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Pc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,m){return{}}touchstart(a,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,m){let v=this._firstTwoTouches;if(!v)return;a.preventDefault();let[x,T]=v,E=Mc(m,h,x),A=Mc(m,h,T);if(!E||!A)return;let R=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],R,a)}touchend(a,h,m){if(!this._firstTwoTouches)return;let[v,x]=this._firstTwoTouches,T=Mc(m,h,v),E=Mc(m,h,x);T&&E||(this._active&&et(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Mc(f,a,h){for(let m=0;m<f.length;m++)if(f[m].identifier===h)return a[m]}function S_(f,a){return Math.log(f/a)/Math.LN2}class vo extends Pc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){let m=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(S_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:S_(this._distance,m),pinchAround:h}}}function pf(f,a){return 180*f.angleWith(a)/Math.PI}class Ms extends Pc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){let m=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pf(this._vector,m),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());let h=25/(Math.PI*this._minDiameter)*360,m=pf(a,this._startVector);return Math.abs(m)<h}}function yn(f){return Math.abs(f.y)>Math.abs(f.x)}class qc extends Pc{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,yn(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,m){let v=this._lastPoints;if(!v)return;let x=a[0].sub(v[0]),T=a[1].sub(v[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(a,h,m){if(this._valid!==void 0)return this._valid;let v=a.mag()>=2,x=h.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;let T=a.y>0==h.y>0;return yn(a)&&yn(h)&&T}}let dt={panStep:100,bearingStep:15,pitchStep:10};class I_{constructor(){let a=dt;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,m=0,v=0,x=0,T=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?m=-1:(a.preventDefault(),x=-1);break;case 39:a.shiftKey?m=1:(a.preventDefault(),x=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),T=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:E=>{let A=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:A_,zoom:h?Math.round(A)+h*(a.shiftKey?2:1):A,bearing:E.getBearing()+m*this._bearingStep,pitch:E.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:E.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function A_(f){return f*(2-f)}let qs=4.000244140625;class Ql{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||t.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,m=t.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%qs==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let h=He(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let a=this._map.transform,h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>qs?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&R!==0&&(R=1/R);let D=h(),F=Math.pow(2,D),j=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(j*R))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}let m=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,x=this._easing,T,E=!1;if(this._type==="wheel"&&v&&x){let A=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),R=x(A);T=t.number(v,m,R),A<1?this._frameId||(this._frameId=!0):E=!0}else T=m,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:T-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=t.ease;if(this._prevEase){let m=this._prevEase,v=(t.exported.now()-m.start)/m.duration,x=m.easing(v+.01)-m.easing(v),T=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-T*T);h=t.bezier(T,E,.25,1)}return this._prevEase={start:t.exported.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class O_{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class C_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(a.shiftKey?-1:1),around:m.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class P_{constructor(){this._tap=new Oc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,m){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=h[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(a,h,m))}touchmove(a,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;let v=h[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(a,h,m)}touchend(a,h,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(a,h,m)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M_{constructor(a,h,m){this._el=a,this._mousePan=h,this._touchPan=m}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class q_{constructor(a,h,m){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class R_{constructor(a,h,m,v){this._el=a,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let eu=f=>f.zoom||f.drag||f.pitch||f.rotate;class Rc extends t.Event{}class ff{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){let m=t.sub([],h,a);this.radius=t.length(m[2]<0?t.div([],m,this.constants):[m[0],m[1],0])}projectRay(a){t.div(a,a,this.constants),t.normalize(a,a),t.mul$1(a,a,this.constants);let h=t.scale$2([],a,this.radius);if(h[2]>0){let m=t.scale$2([],[0,0,1],t.dot(h,[0,0,1])),v=t.scale$2([],t.normalize([],[h[0],h[1],0]),this.radius),x=t.add([],h,t.scale$2([],t.sub([],t.add([],v,m),h),2));h[0]=x[0],h[1]=x[1]}return h}}function Da(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class D_{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cf(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ff,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),t.bindAll(["handleEvent","handleWindowEvent"],this);let m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[t.window,"blur",void 0]];for(let[v,x,T]of this._listeners)v.addEventListener(x,v===t.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(let[a,h,m]of this._listeners)a.removeEventListener(h,a===t.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(a){let h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new v_(h,a));let v=h.boxZoom=new b_(h,a);this._add("boxZoom",v);let x=new w_,T=new C_;h.doubleClickZoom=new O_(T,x),this._add("tapZoom",x),this._add("clickZoom",T);let E=new P_;this._add("tapDragZoom",E);let A=h.touchPitch=new qc(h);this._add("touchPitch",A);let R=new hf(a),D=new gi(a);h.dragRotate=new q_(a,R,D),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);let F=new E_(a),j=new U0(h,a);h.dragPan=new M_(m,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]);let X=new Ms,W=new vo;h.touchZoomRotate=new R_(m,W,X,E),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new x_(h));let Z=h.scrollZoom=new Ql(h,this);this._add("scrollZoom",Z,["mousePan"]);let H=h.keyboard=new I_;this._add("keyboard",H);for(let $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[$]&&h[$].enable(a[$])}_add(a,h,m){this._handlers.push({handlerName:a,handler:h,allowed:m}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(let{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(let{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!eu(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,h,m){for(let v in a)if(v!==m&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){let h=[];for(let m of a)this._el.contains(m.target)&&h.push(m);return h}handleEvent(a,h){this._updatingCamera=!0;let m=a.type==="renderFrame",v=m?void 0:a,x={needsRenderFrame:!1},T={},E={},A=a.touches?this._getMapTouches(a.touches):void 0,R=A?It(this._el,A):m?void 0:He(this._el,a);for(let{handlerName:j,handler:X,allowed:W}of this._handlers){if(!X.isEnabled())continue;let Z;this._blockedByActive(E,W,j)?X.reset():X[h||a.type]&&(Z=X[h||a.type](a,R,A),this.mergeHandlerResult(x,T,Z,j,v),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||X.isActive())&&(E[j]=X)}let D={};for(let j in this._previousActiveHandlers)E[j]||(D[j]=v);this._previousActiveHandlers=E,(Object.keys(D).length||Da(x))&&(this._changes.push([x,T,D]),this._triggerRenderFrame()),(Object.keys(E).length||Da(x))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=x;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(a,h,m,v,x){if(!m)return;t.extend(a,m);let T={handlerName:v,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(h.zoom=T),m.panDelta!==void 0&&(h.drag=T),m.pitchDelta!==void 0&&(h.pitch=T),m.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){let a={},h={},m={};for(let[v,x,T]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new t.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(a.around=v.around),v.aroundCoord!==void 0&&(a.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),t.extend(h,x),t.extend(m,T);this._updateMapTransform(a,h,m),this._changes=[]}_updateMapTransform(a,h,m){let v=this._map,x=v.transform,T=ee=>[ee.x,ee.y,ee.z];if((ee=>{let Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!Da(a)){let ee=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ee!==x.zoom&&this._map._update(!0)}if(!Da(a))return void this._fireEvents(h,m,!0);let{panDelta:E,zoomDelta:A,bearingDelta:R,pitchDelta:D,around:F,aroundCoord:j,pinchAround:X}=a;X!==void 0&&(F=X),(ee=>h.drag&&!this._eventsInProgress.drag)()&&F&&(this._dragOrigin=T(x.pointCoordinate3D(F)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),F=F||v.transform.centerPoint,R&&(x.bearing+=R),D&&(x.pitch+=D),x._updateCameraState();let W=[0,0,0];if(E)if(x.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F).dir),Y=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(F.sub(E)).dir);W[0]=Y[0]-ee[0],W[1]=Y[1]-ee[1]}else{let ee=x.pointCoordinate(F);if(x.projection.name==="globe"){E=E.rotate(-x.angle);let Y=x._pixelsPerMercatorPixel/x.worldSize;W[0]=-E.x*t.mercatorScale(t.latFromMercatorY(ee.y))*Y,W[1]=-E.y*t.mercatorScale(x.center.lat)*Y}else{let Y=x.pointCoordinate(F.sub(E));ee&&Y&&(W[0]=Y.x-ee.x,W[1]=Y.y-ee.y)}}let Z=x.zoom,H=[0,0,0];if(A){let ee=T(j||x.pointCoordinate3D(F)),Y={dir:t.normalize([],t.sub([],ee,x._camera.position))};if(Y.dir[2]<0){let de=x.zoomDeltaToMovement(ee,A);t.scale$2(H,Y.dir,de)}}let $=t.add(W,W,H);x._translateCameraConstrained($),A&&Math.abs(x.zoom-Z)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,m,!0)}_fireEvents(a,h,m){let v=eu(this._eventsInProgress),x=eu(a),T={};for(let D in a){let{originalEvent:F}=a[D];this._eventsInProgress[D]||(T[`${D}start`]=F),this._eventsInProgress[D]=a[D]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(let D in T)this._fireEvent(D,T[D]);x&&this._fireEvent("move",x.originalEvent);for(let D in a){let{originalEvent:F}=a[D];this._fireEvent(D,F)}let E={},A;for(let D in this._eventsInProgress){let{handlerName:F,originalEvent:j}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],A=h[F]||j,E[`${D}end`]=A)}for(let D in E)this._fireEvent(D,E[D]);let R=eu(this._eventsInProgress);if(m&&(v||x)&&!R){this._updatingCamera=!0;let D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;D?(F(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new t.Event("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new t.Event(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Rc("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let df="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class L_ extends t.Evented{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,m){return a=t.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,t.extend({offset:a},h),m)}panTo(a,h,m){return this.easeTo(t.extend({center:a},h),m)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,m){return this.easeTo(t.extend({zoom:a},h),m)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,m){return this.easeTo(t.extend({bearing:a},h),m)}resetNorth(a,h){return this.rotateTo(0,t.extend({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){this.transform.projection.name==="globe"&&t.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),a=t.LngLatBounds.convert(a);let m=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),m,h)}_extendCameraOptions(a){let h={top:0,bottom:0,right:0,left:0};if(typeof(a=t.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){let m=a.padding;a.padding={top:m,bottom:m,right:m,left:m}}return a.padding=t.extend(h,a.padding),a}_cameraForBoxAndBearing(a,h,m,v){let x=this._extendCameraOptions(v),T=this.transform,E=T.padding,A=T.project(t.LngLat.convert(a)),R=T.project(t.LngLat.convert(h)),D=new t.pointGeometry(A.x,R.y),F=new t.pointGeometry(R.x,A.y),j=-t.degToRad(m),X=A.rotate(j),W=R.rotate(j),Z=D.rotate(j),H=F.rotate(j),$=new t.pointGeometry(Math.max(X.x,W.x,Z.x,H.x),Math.max(X.y,W.y,Z.y,H.y)),ee=new t.pointGeometry(Math.min(X.x,W.x,Z.x,H.x),Math.min(X.y,W.y,Z.y,H.y)),Y=$.sub(ee),de=(T.width-((E.left||0)+(E.right||0)+x.padding.left+x.padding.right))/Y.x,pe=(T.height-((E.top||0)+(E.bottom||0)+x.padding.top+x.padding.bottom))/Y.y;if(pe<0||de<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let se=Math.min(T.scaleZoom(T.scale*Math.min(de,pe)),x.maxZoom),fe=typeof x.offset.x=="number"&&typeof x.offset.y=="number"?new t.pointGeometry(x.offset.x,x.offset.y):t.pointGeometry.convert(x.offset),he=new t.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(m*Math.PI/180),ge=fe.add(he).mult(T.scale/T.zoomScale(se));return{center:T.unproject(A.add(R).div(2).sub(ge)),zoom:se,bearing:m}}_cameraForBox(a,h,m,v,x){let T=this._extendCameraOptions(x);m=m||0,v=v||0,a=t.LngLat.convert(a),h=t.LngLat.convert(h);let E=this.transform.clone();E.padding=T.padding;let A=this.getFreeCameraOptions(),R=new t.LngLat(.5*(a.lng+h.lng),.5*(a.lat+h.lat)),D=.5*(m+v);if(E._camera.position[2]<t.mercatorZfromAltitude(D,R.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(R),E.setFreeCameraOptions(A);let F=t.MercatorCoordinate.fromLngLat(a),j=t.MercatorCoordinate.fromLngLat(h),X=E.pointRayIntersection(E.centerPoint,D),W=[(Z=E.rayIntersectionCoordinate(X)).x,Z.y,Z.z];var Z;let H=E.screenPointToMercatorRay(E.centerPoint),$=E.projection.name!=="globe",ee,Y=0;do{let de=Math.floor(E.zoom),pe=1<<de,se=Math.min(pe*F.x,pe*j.x),fe=Math.min(pe*F.y,pe*j.y),he=Math.max(pe*F.x,pe*j.x),ge=Math.max(pe*F.y,pe*j.y),Ee=new t.Aabb([se,fe,m],[he,ge,v]),Ye=t.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,de,$);if(Ee.intersects(Ye)!==2){ee&&(E._camera.position=t.scaleAndAdd([],E._camera.position,H.dir,-ee),E._updateStateFromCamera());break}let xe=t.sub([],E._camera.position,W);ee=.5*t.length(xe),E._camera.position=t.scaleAndAdd([],E._camera.position,H.dir,ee);try{E._updateStateFromCamera()}catch{return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Y<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(a,h,m){return this.transform.projection.name==="globe"&&t.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(a,h),h,m)}_raycastElevationBox(a,h){let m=this.transform.elevation;if(!m)return;let v=new t.pointGeometry(a.x,h.y),x=new t.pointGeometry(h.x,a.y),T=m.pointCoordinate(a);if(!T)return;let E=m.pointCoordinate(h);if(!E)return;let A=m.pointCoordinate(v);if(!A)return;let R=m.pointCoordinate(x);if(!R)return;let D=new t.MercatorCoordinate(T[0],T[1]).toLngLat(),F=new t.MercatorCoordinate(E[0],E[1]).toLngLat(),j=new t.MercatorCoordinate(A[0],A[1]).toLngLat(),X=new t.MercatorCoordinate(R[0],R[1]).toLngLat(),W=Math.min(D.lng,Math.min(F.lng,Math.min(j.lng,X.lng))),Z=Math.min(D.lat,Math.min(F.lat,Math.min(j.lat,X.lat))),H=Math.max(D.lng,Math.max(F.lng,Math.max(j.lng,X.lng))),$=Math.max(D.lat,Math.max(F.lat,Math.max(j.lat,X.lat))),ee=Math.min(T[3],Math.min(E[3],Math.min(A[3],R[3]))),Y=Math.max(T[3],Math.max(E[3],Math.max(A[3],R[3])));return{minLngLat:new t.LngLat(W,Z),maxLngLat:new t.LngLat(H,$),minAltitude:ee,maxAltitude:Y}}fitScreenCoordinates(a,h,m,v,x){let T,E,A,R;this.transform.projection.name==="globe"&&t.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");let D=t.pointGeometry.convert(a),F=t.pointGeometry.convert(h),j=this._raycastElevationBox(D,F);if(j)T=j.minLngLat,E=j.maxLngLat,A=j.minAltitude,R=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(D,F))return this;T=this.transform.pointLocation(D),E=this.transform.pointLocation(F)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(a)),this.transform.pointLocation(t.pointGeometry.convert(h)),m,v):this._cameraForBox(T,E,A,R,v),v,x)}_fitInternal(a,h,m){return a?(delete(h=t.extend(a,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(a,h){this.stop();let m=a.preloadOnly?this.transform.clone():this.transform,v=!1,x=!1,T=!1;return"zoom"in a&&m.zoom!==+a.zoom&&(v=!0,m.zoom=+a.zoom),a.center!==void 0&&(m.center=t.LngLat.convert(a.center)),"bearing"in a&&m.bearing!==+a.bearing&&(x=!0,m.bearing=+a.bearing),"pitch"in a&&m.pitch!==+a.pitch&&(T=!0,m.pitch=+a.pitch),a.padding==null||m.isPaddingEqual(a.padding)||(m.padding=a.padding),a.preloadOnly?(this._preloadTiles(m),this):(this.fire(new t.Event("movestart",h)).fire(new t.Event("move",h)),v&&this.fire(new t.Event("zoomstart",h)).fire(new t.Event("zoom",h)).fire(new t.Event("zoomend",h)),x&&this.fire(new t.Event("rotatestart",h)).fire(new t.Event("rotate",h)).fire(new t.Event("rotateend",h)),T&&this.fire(new t.Event("pitchstart",h)).fire(new t.Event("pitch",h)).fire(new t.Event("pitchend",h)),this.fire(new t.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(df),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){let m=this.transform;if(!m.projection.supportsFreeCamera)return t.warnOnce(df),this;this.stop();let v=m.zoom,x=m.pitch,T=m.bearing;m.setFreeCameraOptions(a);let E=v!==m.zoom,A=x!==m.pitch,R=T!==m.bearing;return this.fire(new t.Event("movestart",h)).fire(new t.Event("move",h)),E&&this.fire(new t.Event("zoomstart",h)).fire(new t.Event("zoom",h)).fire(new t.Event("zoomend",h)),R&&this.fire(new t.Event("rotatestart",h)).fire(new t.Event("rotate",h)).fire(new t.Event("rotateend",h)),A&&this.fire(new t.Event("pitchstart",h)).fire(new t.Event("pitch",h)).fire(new t.Event("pitchend",h)),this.fire(new t.Event("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=t.extend({offset:[0,0],duration:500,easing:t.ease},a)).animate===!1||!a.essential&&t.exported.prefersReducedMotion)&&(a.duration=0);let m=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in a?+a.zoom:v,R="bearing"in a?this._normalizeBearing(a.bearing,x):x,D="pitch"in a?+a.pitch:T,F="padding"in a?a.padding:m.padding,j=t.pointGeometry.convert(a.offset),X,W,Z;if(m.projection.name==="globe"){let ge=t.MercatorCoordinate.fromLngLat(m.center),Ee=j.rotate(-m.angle);ge.x+=Ee.x/m.worldSize,ge.y+=Ee.y/m.worldSize;let Ye=ge.toLngLat(),xe=t.LngLat.convert(a.center||Ye);this._normalizeCenter(xe),X=m.centerPoint.add(Ee),W=new t.pointGeometry(ge.x,ge.y).mult(m.worldSize),Z=new t.pointGeometry(t.mercatorXfromLng(xe.lng),t.mercatorYfromLat(xe.lat)).mult(m.worldSize).sub(W)}else{X=m.centerPoint.add(j);let ge=m.pointLocation(X),Ee=t.LngLat.convert(a.center||ge);this._normalizeCenter(Ee),W=m.project(ge),Z=m.project(Ee).sub(W)}let H=m.zoomScale(A-v),$,ee;a.around&&($=t.LngLat.convert(a.around),ee=m.locationPoint($));let Y=this._zooming||A!==v,de=this._rotating||x!==R,pe=this._pitching||D!==T,se=!m.isPaddingEqual(F),fe=ge=>Ee=>{if(Y&&(ge.zoom=t.number(v,A,Ee)),de&&(ge.bearing=t.number(x,R,Ee)),pe&&(ge.pitch=t.number(T,D,Ee)),se&&(ge.interpolatePadding(E,F,Ee),X=ge.centerPoint.add(j)),$)ge.setLocationAtPoint($,ee);else{let Ye=ge.zoomScale(ge.zoom-v),xe=A>v?Math.min(2,H):Math.max(.5,H),ze=Math.pow(xe,1-Ee),Ue=ge.unproject(W.add(Z.mult(Ee*ze)).mult(Ye));ge.setLocationAtPoint(ge.renderWorldCopies?Ue.wrap():Ue,X)}return a.preloadOnly||this._fireMoveEvents(h),ge};if(a.preloadOnly){let ge=this._emulate(fe,a.duration,m);return this._preloadTiles(ge),this}let he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=de,this._pitching=pe,this._padding=se,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,he),this._ease(fe(m),ge=>{m.recenterOnTerrain(),this._afterEase(h,ge)},a),this}_prepareEase(a,h,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||m.moving||this.fire(new t.Event("movestart",a)),this._zooming&&!m.zooming&&this.fire(new t.Event("zoomstart",a)),this._rotating&&!m.rotating&&this.fire(new t.Event("rotatestart",a)),this._pitching&&!m.pitching&&this.fire(new t.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new t.Event("move",a)),this._zooming&&this.fire(new t.Event("zoom",a)),this._rotating&&this.fire(new t.Event("rotate",a)),this._pitching&&this.fire(new t.Event("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let m=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new t.Event("zoomend",a)),v&&this.fire(new t.Event("rotateend",a)),x&&this.fire(new t.Event("pitchend",a)),this.fire(new t.Event("moveend",a))}flyTo(a,h){if(!a.essential&&t.exported.prefersReducedMotion){let st=t.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,h)}this.stop(),a=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},a);let m=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in a?t.clamp(+a.zoom,m.minZoom,m.maxZoom):v,R="bearing"in a?this._normalizeBearing(a.bearing,x):x,D="pitch"in a?+a.pitch:T,F="padding"in a?a.padding:m.padding,j=m.zoomScale(A-v),X=t.pointGeometry.convert(a.offset),W=m.centerPoint.add(X),Z=m.pointLocation(W),H=t.LngLat.convert(a.center||Z);this._normalizeCenter(H);let $=m.project(Z),ee=m.project(H).sub($),Y=a.curve,de=Math.max(m.width,m.height),pe=de/j,se=ee.mag();if("minZoom"in a){let st=t.clamp(Math.min(a.minZoom,v,A),m.minZoom,m.maxZoom),at=de/m.zoomScale(st-v);Y=Math.sqrt(at/se*2)}let fe=Y*Y;function he(st){let at=(pe*pe-de*de+(st?-1:1)*fe*fe*se*se)/(2*(st?pe:de)*fe*se);return Math.log(Math.sqrt(at*at+1)-at)}function ge(st){return(Math.exp(st)-Math.exp(-st))/2}function Ee(st){return(Math.exp(st)+Math.exp(-st))/2}let Ye=he(0),xe=function(st){return Ee(Ye)/Ee(Ye+Y*st)},ze=function(st){return de*((Ee(Ye)*(ge(at=Ye+Y*st)/Ee(at))-ge(Ye))/fe)/se;var at},Ue=(he(1)-Ye)/Y;if(Math.abs(se)<1e-6||!isFinite(Ue)){if(Math.abs(de-pe)<1e-6)return this.easeTo(a,h);let st=pe<de?-1:1;Ue=Math.abs(Math.log(pe/de))/Y,ze=function(){return 0},xe=function(at){return Math.exp(st*Y*at)}}a.duration="duration"in a?+a.duration:1e3*Ue/("screenSpeed"in a?+a.screenSpeed/Y:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);let it=x!==R,Pe=D!==T,Je=!m.isPaddingEqual(F),Ne=st=>at=>{let yt=at*Ue,Tt=1/xe(yt);st.zoom=at===1?A:v+st.scaleZoom(Tt),it&&(st.bearing=t.number(x,R,at)),Pe&&(st.pitch=t.number(T,D,at)),Je&&(st.interpolatePadding(E,F,at),W=st.centerPoint.add(X));let qt=at===1?H:st.unproject($.add(ee.mult(ze(yt))).mult(Tt));return st.setLocationAtPoint(st.renderWorldCopies?qt.wrap():qt,W),st._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),st};if(a.preloadOnly){let st=this._emulate(Ne,a.duration,m);return this._preloadTiles(st),this}return this._zooming=!0,this._rotating=it,this._pitching=Pe,this._padding=Je,this._prepareEase(h,!1),this._ease(Ne(m),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,h)}if(!a){let m=this.handlers;m&&m.stop(!1)}return this}_ease(a,h,m){m.animate===!1||m.duration===0?(a(1),h()):(this._easeStart=t.exported.now(),this._easeOptions=m,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let a=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=t.wrap(a,-180,180);let m=Math.abs(a-h);return Math.abs(a-360-h)<m&&(a-=360),Math.abs(a+360-h)<m&&(a+=360),a}_normalizeCenter(a){let h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;let m=a.lng-h.center.lng;a.lng+=m>180?-360:m<-180?360:0}_emulate(a,h,m){let v=Math.ceil(15*h/1e3),x=[],T=a(m.clone());for(let E=0;E<=v;E++){let A=T(E/v);x.push(A.clone())}return x}}class mf{constructor(a={}){this.options=a,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){let h=this.options&&this.options.compact;return this._map=a,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L("button","mapboxgl-ctrl-attrib-button",this._container),L("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){let m=this._map._getUIString(`AttributionControl.${h}`);a.setAttribute("aria-label",m),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));let h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(a){let m=h.reduce((v,x,T)=>(x.value&&(v+=`${x.key}=${x.value}${T<h.length-1?"&":""}`),v),"?");a.href=`${t.config.FEEDBACK_URL}/${m}#${uf(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let h=this._map.style._sourceCaches;for(let v in h){let x=h[v];if(x.used){let T=x.getSource();T.attribution&&a.indexOf(T.attribution)<0&&a.push(T.attribution)}}a.sort((v,x)=>v.length-x.length),a=a.filter((v,x)=>{for(let T=x+1;T<a.length;T++)if(a[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));let m=a.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,a.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _f{constructor(){t.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=L("div","mapboxgl-ctrl");let h=L("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(let h in a){let m=a[h].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){let a=this._container.children;if(a.length){let h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class yf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){let h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){let h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(let v of m)if(v.id===a)return void(v.cancelled=!0)}run(a=0){let h=this._currentlyRunning=this._queue;this._queue=[];for(let m of h)if(!m.cancelled&&(m.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function gf(f,a,h){if(f=new t.LngLat(f.lng,f.lat),a){let m=new t.LngLat(f.lng-360,f.lat),v=new t.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-h.center.lng)/360),T=h.locationPoint(f).distSqr(a),E=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(m).distSqr(a)<T&&(E||Math.abs(m.lng-h.center.lng)<x)?f=m:h.locationPoint(v).distSqr(a)<T&&(E||Math.abs(v.lng-h.center.lng)<x)&&(f=v)}for(;Math.abs(f.lng-h.center.lng)>180;){let m=h.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}let tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Dc extends t.Evented{constructor(a,h){if(super(),(a instanceof t.window.HTMLElement||h)&&(a=t.extend({element:a},h)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),a&&a.element)this._element=a.element,this._offset=t.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=L("div");let v=41,x=27,T=V("svg",{display:"block",height:v*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${v}`},this._element),E=V("radialGradient",{id:"shadowGradient"},V("defs",{},T));V("stop",{offset:"10%","stop-opacity":.4},E),V("stop",{offset:"100%","stop-opacity":.05},E),V("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),V("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),V("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),V("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=t.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let m=this._element.classList;for(let v in tu)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){let a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=t.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){let h=a.code,m=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(a){let h=a.originalEvent.target,m=this._element;this._popup&&(h===m||m.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let a=this._map;if(!a)return!1;let h=a.unproject(this._pos),m=a.getFreeCameraOptions();if(!m.position)return!1;let v=m.position.toLngLat();return v.distanceTo(h)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let a=this._map;if(!a)return;let h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();let m=a.unproject(h),v;a._showingGlobe()&&t.isLngLatBehindGlobe(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(m),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=.2)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let a=this._pos;if(!a||!this._map)return;let h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${tu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){let a=this._pos,h=this._map,m=this.getPitchAlignment();if(!h||!a||m!=="map")return"";if(!h._showingGlobe()){let A=h.getPitch();return A?`rotateX(${A}deg)`:""}let v=t.radToDeg(t.globeTiltAtLngLat(h.transform,this._lngLat)),x=a.sub(t.globeCenterToScreenPoint(h.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";let E=v/T;return`rotateX(${-x.y*E}deg) rotateY(${x.x*E}deg)`}_calculateZTransform(){let a=this._pos,h=this._map;if(!h||!a)return"";let m=0,v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){let x=h.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=h.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=t.radToDeg(Math.atan2(T.y,T.x))-90}else m=-h.getBearing();else if(v==="horizon"){let x=t.smoothstep(4,6,h.getZoom()),T=t.globeCenterToScreenPoint(h.transform);T.y+=x*h.transform.height;let E=a.sub(T),A=t.radToDeg(Math.atan2(E.y,E.x));m=(A>90?A-270:A+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(a){t.window.cancelAnimationFrame(this._updateFrameId);let h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=gf(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),a===!0?this._updateFrameId=t.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=t.pointGeometry.convert(a),this._update(),this}_onMove(a){let h=this._map;if(h){if(!this._isDragging){let m=this._clickTolerance||h._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(a){let h=this._map;h&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;let h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class k_{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;let h=t.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,m){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+m}}let z_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},B_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ru(f){f.parentNode&&f.parentNode.removeChild(f)}let F_={showCompass:!0,showZoom:!0,visualizePitch:!1};class vf{constructor(a,h,m=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new hf({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,m&&(this.mousePitch=new gi({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),Se()}move(a,h){let m=this.map,v=this.mouseRotate.mousemoveWindow(a,h),x=v&&v.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){let T=this.mousePitch.mousemoveWindow(a,h),E=T&&T.pitchDelta;E&&m.setPitch(m.getPitch()+E)}}off(){let a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Re(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(t.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),He(this.element,a)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,He(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=It(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=It(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let N_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xf={maxWidth:100,unit:"metric"};function bf(f,a,h){let m=Lc(a),v=m/a,x={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=f*v+"px",this._container.innerHTML=`${m}&nbsp;${x}`})}function Lc(f){let a=Math.pow(10,`${Math.floor(f)}`.length-1),h=f/a;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(m){let v=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*v)/v}(h),a*h}let j0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},V0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kc(f=new t.pointGeometry(0,0),a="bottom"){if(typeof f=="number"){let h=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(a){case"top":return new t.pointGeometry(0,f);case"top-left":return new t.pointGeometry(h,h);case"top-right":return new t.pointGeometry(-h,h);case"bottom":return new t.pointGeometry(0,-f);case"bottom-left":return new t.pointGeometry(h,-h);case"bottom-right":return new t.pointGeometry(-h,-h);case"left":return new t.pointGeometry(f,0);case"right":return new t.pointGeometry(-f,0)}return new t.pointGeometry(0,0)}return f instanceof t.pointGeometry||Array.isArray(f)?t.pointGeometry.convert(f):t.pointGeometry.convert(f[a]||[0,0])}let iu={version:t.version,supported:I,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends L_{constructor(f){if((f=t.extend({},B_,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&t.isSafariWithAntialiasingBug(t.window)&&(f.antialias=!1,t.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xl(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=f.language==="auto"?t.window.navigator.language:f.language,this._worldview=f.worldview,this._renderTaskQueue=new yf,this._domRenderTaskQueue=new yf,this._controls=[],this._markers=[],this._mapId=t.uniqueId(),this._locale=t.extend({},z_,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new k_(0),this._useExplicitProjection=!1,this._requestManager=new t.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=t.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),t.window!==void 0&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new D_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new __(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,t.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new mf({customAttribution:f.customAttribution})),this._logoControl=new _f,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new t.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new t.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(f,a){if(a===void 0&&(a=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let h=f.onAdd(this);this._controls.push(f);let m=this._controlPositions[a];return a.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let a=this._controls.indexOf(f);return a>-1&&this._controls.splice(a,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let a=!this._moving;return a&&this.fire(new t.Event("movestart",f)).fire(new t.Event("move",f)),this.fire(new t.Event("resize",f)),a&&this.fire(new t.Event("moveend",f)),this}getBounds(){return this.transform.projection.name==="globe"&&t.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(t.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getLanguage(){return this._language}setLanguage(f){if(this._language=f==="auto"?t.window.navigator.language:f,this.style)for(let a in this.style._sourceCaches){let h=this.style._sourceCaches[a]._source;h._setLanguage&&h._setLanguage(this._language)}for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){if(this._worldview=f,this.style)for(let a in this.style._sourceCaches){let h=this.style._sourceCaches[a]._source;h._setWorldview&&h._setWorldview(f)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,a=f.projection.name,h;a==="globe"&&f.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),h=!0):a==="mercator"&&f.zoom<t.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,a){return this._updateProjection(f||a||{name:"mercator"})}_updateProjection(f){let a;if(a=f.name==="globe"&&this.transform.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(let h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0)}return this}project(f){return this.transform.locationPoint3D(t.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(t.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(f,a,h){if(f==="mouseenter"||f==="mouseover"){let m=!1,v=T=>{let E=a.filter(R=>this.getLayer(R)),A=E.length?this.queryRenderedFeatures(T.point,{layers:E}):[];A.length?m||(m=!0,h.call(this,new Si(f,this,T.originalEvent,{features:A}))):m=!1},x=()=>{m=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:v,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let m=!1,v=T=>{let E=a.filter(A=>this.getLayer(A));(E.length?this.queryRenderedFeatures(T.point,{layers:E}):[]).length?m=!0:m&&(m=!1,h.call(this,new Si(f,this,T.originalEvent)))},x=T=>{m&&(m=!1,h.call(this,new Si(f,this,T.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:v,mouseout:x}}}{let m=v=>{let x=a.filter(E=>this.getLayer(E)),T=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];T.length&&(v.features=T,h.call(this,v),delete v.features)};return{layers:new Set(a),listener:h,delegates:{[f]:m}}}}on(f,a,h){if(h===void 0)return super.on(f,a);Array.isArray(a)||(a=[a]);let m=this._createDelegatedListener(f,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(let v in m.delegates)this.on(v,m.delegates[v]);return this}once(f,a,h){if(h===void 0)return super.once(f,a);Array.isArray(a)||(a=[a]);let m=this._createDelegatedListener(f,a,h);for(let v in m.delegates)this.once(v,m.delegates[v]);return this}off(f,a,h){if(h===void 0)return super.off(f,a);a=new Set(Array.isArray(a)?a:[a]);let m=(x,T)=>{if(x.size!==T.size)return!1;for(let E of x)if(!T.has(E))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(x=>{for(let T=0;T<x.length;T++){let E=x[T];if(E.listener===h&&m(E.layers,a)){for(let A in E.delegates)this.off(A,E.delegates[A]);return x.splice(T,1),this}}})(v),this}queryRenderedFeatures(f,a){return this.style?(a!==void 0||f===void 0||f instanceof t.pointGeometry||Array.isArray(f)||(a=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(f,a){return this.style.querySourceFeatures(f,a)}queryTerrainElevation(f,a){let h=this.transform.elevation;return h?(a=t.extend({},{exaggerated:!0},a),h.getAtPoint(t.MercatorCoordinate.fromLngLat(f),null,a.exaggerated)):null}setStyle(f,a){return(a=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(f,a))}_getUIString(f){let a=this._locale[f];if(a==null)throw new Error(`Missing UI string '${f}'`);return a}_updateStyle(f,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new _n(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new _n(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,a){if(typeof f=="string"){let h=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(h,t.ResourceType.Style);t.getJSON(m,(v,x)=>{v?this.fire(new t.ErrorEvent(v)):x&&this._updateDiff(x,a)})}else typeof f=="object"&&this._updateDiff(f,a)}_updateDiff(f,a){try{this.style.setState(f)&&this._update(!0)}catch(h){t.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(f,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.warnOnce("There is no style added to the map."),!1)}addSource(f,a){return this._lazyInitEmptyStyle(),this.style.addSource(f,a),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){let f=this.style&&this.style._sourceCaches;for(let a in f){let h=f[a]._tiles;for(let m in h){let v=h[m];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(f,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(f,a,h)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,a,{pixelRatio:h=1,sdf:m=!1,stretchX:v,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),a instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&a instanceof t.window.ImageBitmap){let{width:E,height:A,data:R}=t.exported.getImageData(a);this.style.addImage(f,{data:new t.RGBAImage({width:E,height:A},R),pixelRatio:h,stretchX:v,stretchY:x,content:T,sdf:m,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:A}=a,R=a;this.style.addImage(f,{data:new t.RGBAImage({width:E,height:A},new Uint8Array(R.data)),pixelRatio:h,stretchX:v,stretchY:x,content:T,sdf:m,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}updateImage(f,a){let h=this.style.getImage(f);if(!h)return void this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let m=a instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&a instanceof t.window.ImageBitmap?t.exported.getImageData(a):a,{width:v,height:x}=m;v!==void 0&&x!==void 0?v===h.data.width&&x===h.data.height?(h.data.replace(m.data,!(a instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&a instanceof t.window.ImageBitmap)),this.style.updateImage(f,h)):this.fire(new t.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,a){t.getImage(this._requestManager.transformRequest(f,t.ResourceType.Image),(h,m)=>{a(h,m instanceof t.window.HTMLImageElement?t.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,a){return this._lazyInitEmptyStyle(),this.style.addLayer(f,a),this._update(!0)}moveLayer(f,a){return this.style.moveLayer(f,a),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,a,h){return this.style.setLayerZoomRange(f,a,h),this._update(!0)}setFilter(f,a,h={}){return this.style.setFilter(f,a,h),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,a,h,m={}){return this.style.setPaintProperty(f,a,h,m),this._update(!0)}getPaintProperty(f,a){return this.style.getPaintProperty(f,a)}setLayoutProperty(f,a,h,m={}){return this.style.setLayoutProperty(f,a,h,m),this._update(!0)}getLayoutProperty(f,a){return this.style.getLayoutProperty(f,a)}setLight(f,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(f),this.transform):0}setFeatureState(f,a){return this.style.setFeatureState(f,a),this._update()}removeFeatureState(f,a){return this.style.removeFeatureState(f,a),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300,h,m,v,x=this._container;for(;x&&(!m||!v);){let T=t.window.getComputedStyle(x).transform;T&&T!=="none"&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(m=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),x=x.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=L("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let a=this._canvasContainer=L("div","mapboxgl-canvas-container",f);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=L("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let h=this._controlContainer=L("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=L("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,a){let h=t.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(f),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${a}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let a=this._markers.indexOf(f);a!==-1&&this._markers.splice(a,1)}_setupPainter(){let f=t.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);a?(t.storeAuthState(a,!0),this.painter=new nf(a,this.transform),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(a)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let a,h=this.painter.context.extTimerQuery,m=t.exported.now();if(this.listens("gpu-timing-frame")&&(a=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let v=!1,x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let A=this.transform.zoom,R=this.transform.pitch,D=t.exported.now();this.style.zoomHistory.update(A,D);let F=new t.EvaluationParameters(A,{now:D,fadeDuration:x,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=F.crossFadingFactor();j===1&&j===this._crossFadingFactor||(v=!0,this._crossFadingFactor=j),this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){let A=t.exported.now()-m;h.endQueryEXT(h.TIME_ELAPSED_EXT,a),setTimeout(()=>{let R=h.getQueryObjectEXT(a,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(a),this.fire(new t.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),t.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){let A=this.painter.collectGpuTimers();setTimeout(()=>{let R=this.painter.queryGpuTimers(A);this.fire(new t.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){let A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new t.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}let E=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(E||this._repaint)this.triggerRepaint();else{let A=!this.isMoving()&&this.loaded();if(A&&(T=this._updateAverageElevation(m,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let R=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(let f of this._markers)f._update()}_updateAverageElevation(f,a=!1){let h=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((a||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let m=this.transform.averageElevation,v=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;let T=Math.abs(m-v);if(T>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(v),h(v);this._averageElevation.easeTo(v,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(v),h(v)}return!!this._averageElevation.isEasing(f)&&h(this._averageElevation.getValue(f))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===t.AUTH_ERR_MSG||f.status===401)){let a=this.painter.context.gl;t.storeAuthState(a,!1),this._logoControl instanceof _f&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());let h=this.painter.context.gl,m=h.createFramebuffer();function v(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);let T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,m),this._canvasPixelComparison(v(f),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(f,a,h){let m=h[1]-h[0],v=f.length/4;for(let x=0;x<a.length;x++){let T=a[x],E=0;for(let A=0;A<T.length;A+=4)T[A]===f[A]&&T[A+1]===f[A+1]&&T[A+2]===f[A+2]&&T[A+3]===f[A+3]&&(E+=1);m+=(h[x+2]-h[x+1])*(1-E/v)}return m}remove(){this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),t.window!==void 0&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),ru(this._canvasContainer),ru(this._controlContainer),ru(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=t.exported.frame(a=>{let h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(f){let a=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(a,(h,m)=>h._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,a){t.setCacheLimits(f,a)}get version(){return t.version}},NavigationControl:class{constructor(f){this.options=t.extend({},F_,f),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),L("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),L("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{let h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=L("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let a=f.getZoom(),h=a===f.getMaxZoom(),m=a===f.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vf(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,a){let h=L("button",f,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(f,a){if(!this._map)return;let h=this._map._getUIString(`NavigationControl.${a}`);f.setAttribute("aria-label",h),f.firstElementChild&&f.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends t.Evented{constructor(f){super(),this.options=t.extend({geolocation:t.window.navigator.geolocation},N_,f),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){this._supportsGeolocation!==void 0?f(this._supportsGeolocation):t.window.navigator.permissions!==void 0?t.window.navigator.permissions.query({name:"geolocation"}).then(a=>{this._supportsGeolocation=a.state!=="denied",f(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,f(this._supportsGeolocation))}_isOutOfMapMaxBounds(f){let a=this._map.getMaxBounds(),h=f.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",f)),this._finish()}}_updateCamera(f){let a=new t.LngLat(f.coords.longitude,f.coords.latitude),h=f.coords.accuracy,m=this._map.getBearing(),v=t.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),v,{geolocateSource:!0})}_updateMarker(f){if(f){let a=new t.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,a=t.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=L("button","mapboxgl-ctrl-geolocate",this._container),L("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L("div","mapboxgl-user-location"),this._dotElement.appendChild(L("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(L("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Dc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=L("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};t.window.DeviceMotionEvent!==void 0&&typeof t.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientation),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:mf,ScaleControl:class{constructor(f){this.options=t.extend({},xf,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=bf.bind(this)),t.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,m=a._containerWidth/2-f/2,v=a.unproject([m,h]),x=a.unproject([m+f,h]),T=v.distanceTo(x);if(this.options.unit==="imperial"){let E=3.2808*T;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,a,h){let m=Lc(a),v=m/a;this._map._requestDomTask(()=>{this._container.style.width=f*v+"px",this._container.innerHTML=h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(m):`${m}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof t.window.HTMLElement?this._container=f.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=L("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(f){super(),this.options=t.extend(Object.create(j0),f),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=t.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();let a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(t.window.document.createTextNode(f))}setHTML(f){let a=t.window.document.createDocumentFragment(),h=t.window.document.createElement("body"),m;for(h.innerHTML=f;m=h.firstChild,m;)a.appendChild(m);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=L("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(f),this.options.closeButton){let h=this._closeButton=L("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let a;return this._classList.delete(f)?a=!1:(this._classList.add(f),a=!0),this._updateClassList(),a}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let a=this._map,h=this._container,m=this._pos;if(!a||!h||!m)return"bottom";let v=h.offsetWidth,x=h.offsetHeight,T=m.x<v/2,E=m.x>a.transform.width-v/2;if(m.y+f<x)return T?"top-left":E?"top-right":"top";if(m.y>a.transform.height-x){if(T)return"bottom-left";if(E)return"bottom-right"}return T?"left":E?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),f.className=a.join(" ")}_update(f){let a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let m=this._container;if(m||(m=this._container=L("div","mapboxgl-popup",a.getContainer()),this._tip=L("div","mapboxgl-popup-tip",m),m.appendChild(h)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gf(this._lngLat,this._pos,a.transform)),!this._trackPointer||f){let v=this._pos=this._trackPointer&&f?f:a.project(this._lngLat),x=kc(this.options.offset),T=this._anchor=this._getAnchor(x.y),E=kc(this.options.offset,T),A=v.add(E).round();a._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${tu[T]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&a._showingGlobe()){let v=t.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(V0);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Dc,Style:_n,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:ht,Evented:t.Evented,config:t.config,prewarm:function(){dr().acquire(xt)},clearPrewarmedResources:function(){let f=Ut;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(xt),Ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(f){t.config.ACCESS_TOKEN=f},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(f){t.config.API_URL=f},get workerCount(){return Pt.workerCount},set workerCount(f){Pt.workerCount=f},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){t.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){t.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return iu});var c=l;return c})});var SH=M(()=>{});var VH=M((zXe,jH)=>{var nI=typeof Map=="function"&&Map.prototype,X2=Object.getOwnPropertyDescriptor&&nI?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,w0=nI&&X2&&typeof X2.get=="function"?X2.get:null,Jze=nI&&Map.prototype.forEach,oI=typeof Set=="function"&&Set.prototype,Y2=Object.getOwnPropertyDescriptor&&oI?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,T0=oI&&Y2&&typeof Y2.get=="function"?Y2.get:null,Qze=oI&&Set.prototype.forEach,e3e=typeof WeakMap=="function"&&WeakMap.prototype,Ym=e3e?WeakMap.prototype.has:null,t3e=typeof WeakSet=="function"&&WeakSet.prototype,Km=t3e?WeakSet.prototype.has:null,r3e=typeof WeakRef=="function"&&WeakRef.prototype,IH=r3e?WeakRef.prototype.deref:null,i3e=Boolean.prototype.valueOf,n3e=Object.prototype.toString,o3e=Function.prototype.toString,a3e=String.prototype.match,aI=String.prototype.slice,xl=String.prototype.replace,s3e=String.prototype.toUpperCase,AH=String.prototype.toLowerCase,kH=RegExp.prototype.test,OH=Array.prototype.concat,Ea=Array.prototype.join,l3e=Array.prototype.slice,CH=Math.floor,Q2=typeof BigInt=="function"?BigInt.prototype.valueOf:null,K2=Object.getOwnPropertySymbols,eI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,bp=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Yi=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===bp?"object":"symbol")?Symbol.toStringTag:null,zH=Object.prototype.propertyIsEnumerable,PH=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(s){return s.__proto__}:null);function MH(s,n){if(s===1/0||s===-1/0||s!==s||s&&s>-1e3&&s<1e3||kH.call(/e/,n))return n;var l=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof s=="number"){var o=s<0?-CH(-s):CH(s);if(o!==s){var c=String(o),t=aI.call(n,c.length+1);return xl.call(c,l,"$&_")+"."+xl.call(xl.call(t,/([0-9]{3})/g,"$&_"),/_$/,"")}}return xl.call(n,l,"$&_")}var tI=SH(),qH=tI.custom,RH=FH(qH)?qH:null;jH.exports=function s(n,l,o,c){var t=l||{};if(vl(t,"quoteStyle")&&t.quoteStyle!=="single"&&t.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(vl(t,"maxStringLength")&&(typeof t.maxStringLength=="number"?t.maxStringLength<0&&t.maxStringLength!==1/0:t.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var g=vl(t,"customInspect")?t.customInspect:!0;if(typeof g!="boolean"&&g!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(vl(t,"indent")&&t.indent!==null&&t.indent!=="	"&&!(parseInt(t.indent,10)===t.indent&&t.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(vl(t,"numericSeparator")&&typeof t.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var I=t.numericSeparator;if(typeof n>"u")return"undefined";if(n===null)return"null";if(typeof n=="boolean")return n?"true":"false";if(typeof n=="string")return UH(n,t);if(typeof n=="number"){if(n===0)return 1/0/n>0?"0":"-0";var P=String(n);return I?MH(n,P):P}if(typeof n=="bigint"){var q=String(n)+"n";return I?MH(n,q):q}var L=typeof t.depth>"u"?5:t.depth;if(typeof o>"u"&&(o=0),o>=L&&L>0&&typeof n=="object")return rI(n)?"[Array]":"[Object]";var V=I3e(t,o);if(typeof c>"u")c=[];else if(NH(c,n)>=0)return"[Circular]";function oe(ni,ei,Me){if(ei&&(c=l3e.call(c),c.push(ei)),Me){var tt={depth:t.depth};return vl(t,"quoteStyle")&&(tt.quoteStyle=t.quoteStyle),s(ni,tt,o+1,c)}return s(ni,t,o+1,c)}if(typeof n=="function"&&!DH(n)){var ne=y3e(n),Ie=b0(n,oe);return"[Function"+(ne?": "+ne:" (anonymous)")+"]"+(Ie.length>0?" { "+Ea.call(Ie,", ")+" }":"")}if(FH(n)){var Se=bp?xl.call(String(n),/^(Symbol\(.*\))_[^)]*$/,"$1"):eI.call(n);return typeof n=="object"&&!bp?Xm(Se):Se}if(T3e(n)){for(var Re="<"+AH.call(String(n.nodeName)),Ze=n.attributes||[],et=0;et<Ze.length;et++)Re+=" "+Ze[et].name+"="+BH(u3e(Ze[et].value),"double",t);return Re+=">",n.childNodes&&n.childNodes.length&&(Re+="..."),Re+="</"+AH.call(String(n.nodeName))+">",Re}if(rI(n)){if(n.length===0)return"[]";var He=b0(n,oe);return V&&!S3e(He)?"["+iI(He,V)+"]":"[ "+Ea.call(He,", ")+" ]"}if(h3e(n)){var It=b0(n,oe);return!("cause"in Error.prototype)&&"cause"in n&&!zH.call(n,"cause")?"{ ["+String(n)+"] "+Ea.call(OH.call("[cause]: "+oe(n.cause),It),", ")+" }":It.length===0?"["+String(n)+"]":"{ ["+String(n)+"] "+Ea.call(It,", ")+" }"}if(typeof n=="object"&&g){if(RH&&typeof n[RH]=="function"&&tI)return tI(n,{depth:L-o});if(g!=="symbol"&&typeof n.inspect=="function")return n.inspect()}if(g3e(n)){var Yt=[];return Jze.call(n,function(ni,ei){Yt.push(oe(ei,n,!0)+" => "+oe(ni,n))}),LH("Map",w0.call(n),Yt,V)}if(b3e(n)){var At=[];return Qze.call(n,function(ni){At.push(oe(ni,n))}),LH("Set",T0.call(n),At,V)}if(v3e(n))return J2("WeakMap");if(w3e(n))return J2("WeakSet");if(x3e(n))return J2("WeakRef");if(f3e(n))return Xm(oe(Number(n)));if(m3e(n))return Xm(oe(Q2.call(n)));if(d3e(n))return Xm(i3e.call(n));if(p3e(n))return Xm(oe(String(n)));if(!c3e(n)&&!DH(n)){var Nt=b0(n,oe),wt=PH?PH(n)===Object.prototype:n instanceof Object||n.constructor===Object,Ht=n instanceof Object?"":"null prototype",pi=!wt&&Yi&&Object(n)===n&&Yi in n?aI.call(bl(n),8,-1):Ht?"Object":"",yi=wt||typeof n.constructor!="function"?"":n.constructor.name?n.constructor.name+" ":"",gr=yi+(pi||Ht?"["+Ea.call(OH.call([],pi||[],Ht||[]),": ")+"] ":"");return Nt.length===0?gr+"{}":V?gr+"{"+iI(Nt,V)+"}":gr+"{ "+Ea.call(Nt,", ")+" }"}return String(n)};function BH(s,n,l){var o=(l.quoteStyle||n)==="double"?'"':"'";return o+s+o}function u3e(s){return xl.call(String(s),/"/g,"&quot;")}function rI(s){return bl(s)==="[object Array]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function c3e(s){return bl(s)==="[object Date]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function DH(s){return bl(s)==="[object RegExp]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function h3e(s){return bl(s)==="[object Error]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function p3e(s){return bl(s)==="[object String]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function f3e(s){return bl(s)==="[object Number]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function d3e(s){return bl(s)==="[object Boolean]"&&(!Yi||!(typeof s=="object"&&Yi in s))}function FH(s){if(bp)return s&&typeof s=="object"&&s instanceof Symbol;if(typeof s=="symbol")return!0;if(!s||typeof s!="object"||!eI)return!1;try{return eI.call(s),!0}catch{}return!1}function m3e(s){if(!s||typeof s!="object"||!Q2)return!1;try{return Q2.call(s),!0}catch{}return!1}var _3e=Object.prototype.hasOwnProperty||function(s){return s in this};function vl(s,n){return _3e.call(s,n)}function bl(s){return n3e.call(s)}function y3e(s){if(s.name)return s.name;var n=a3e.call(o3e.call(s),/^function\s*([\w$]+)/);return n?n[1]:null}function NH(s,n){if(s.indexOf)return s.indexOf(n);for(var l=0,o=s.length;l<o;l++)if(s[l]===n)return l;return-1}function g3e(s){if(!w0||!s||typeof s!="object")return!1;try{w0.call(s);try{T0.call(s)}catch{return!0}return s instanceof Map}catch{}return!1}function v3e(s){if(!Ym||!s||typeof s!="object")return!1;try{Ym.call(s,Ym);try{Km.call(s,Km)}catch{return!0}return s instanceof WeakMap}catch{}return!1}function x3e(s){if(!IH||!s||typeof s!="object")return!1;try{return IH.call(s),!0}catch{}return!1}function b3e(s){if(!T0||!s||typeof s!="object")return!1;try{T0.call(s);try{w0.call(s)}catch{return!0}return s instanceof Set}catch{}return!1}function w3e(s){if(!Km||!s||typeof s!="object")return!1;try{Km.call(s,Km);try{Ym.call(s,Ym)}catch{return!0}return s instanceof WeakSet}catch{}return!1}function T3e(s){return!s||typeof s!="object"?!1:typeof HTMLElement<"u"&&s instanceof HTMLElement?!0:typeof s.nodeName=="string"&&typeof s.getAttribute=="function"}function UH(s,n){if(s.length>n.maxStringLength){var l=s.length-n.maxStringLength,o="... "+l+" more character"+(l>1?"s":"");return UH(aI.call(s,0,n.maxStringLength),n)+o}var c=xl.call(xl.call(s,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,E3e);return BH(c,"single",n)}function E3e(s){var n=s.charCodeAt(0),l={8:"b",9:"t",10:"n",12:"f",13:"r"}[n];return l?"\\"+l:"\\x"+(n<16?"0":"")+s3e.call(n.toString(16))}function Xm(s){return"Object("+s+")"}function J2(s){return s+" { ? }"}function LH(s,n,l,o){var c=o?iI(l,o):Ea.call(l,", ");return s+" ("+n+") {"+c+"}"}function S3e(s){for(var n=0;n<s.length;n++)if(NH(s[n],`
`)>=0)return!1;return!0}function I3e(s,n){var l;if(s.indent==="	")l="	";else if(typeof s.indent=="number"&&s.indent>0)l=Ea.call(Array(s.indent+1)," ");else return null;return{base:l,prev:Ea.call(Array(n+1),l)}}function iI(s,n){if(s.length===0)return"";var l=`
`+n.prev+n.base;return l+Ea.call(s,","+l)+`
`+n.prev}function b0(s,n){var l=rI(s),o=[];if(l){o.length=s.length;for(var c=0;c<s.length;c++)o[c]=vl(s,c)?n(s[c],s):""}var t=typeof K2=="function"?K2(s):[],g;if(bp){g={};for(var I=0;I<t.length;I++)g["$"+t[I]]=t[I]}for(var P in s)!vl(s,P)||l&&String(Number(P))===P&&P<s.length||bp&&g["$"+P]instanceof Symbol||(kH.call(/[^\w$]/,P)?o.push(n(P,s)+": "+n(s[P],s)):o.push(P+": "+n(s[P],s)));if(typeof K2=="function")for(var q=0;q<t.length;q++)zH.call(s,t[q])&&o.push("["+n(t[q])+"]: "+n(s[t[q]],s));return o}});var KXe=Ni(vG(),1),JXe=Ni(xG(),1),ZH=Ni(t2(),1);var o0,Xr,kG,wMe,Pm,MG,TMe,r0={},zG=[],EMe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function dl(s,n){for(var l in n)s[l]=n[l];return s}function BG(s){var n=s.parentNode;n&&n.removeChild(s)}function SMe(s,n,l){var o,c,t,g={};for(t in n)t=="key"?o=n[t]:t=="ref"?c=n[t]:g[t]=n[t];if(arguments.length>2&&(g.children=arguments.length>3?o0.call(arguments,2):l),typeof s=="function"&&s.defaultProps!=null)for(t in s.defaultProps)g[t]===void 0&&(g[t]=s.defaultProps[t]);return t0(s,g,o,c,null)}function t0(s,n,l,o,c){var t={type:s,props:n,key:l,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:c??++kG};return c==null&&Xr.vnode!=null&&Xr.vnode(t),t}function FG(){return{current:null}}function qm(s){return s.children}function ip(s,n){this.props=s,this.context=n}function Mm(s,n){if(n==null)return s.__?Mm(s.__,s.__.__k.indexOf(s)+1):null;for(var l;n<s.__k.length;n++)if((l=s.__k[n])!=null&&l.__e!=null)return l.__e;return typeof s.type=="function"?Mm(s):null}function NG(s){var n,l;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,n=0;n<s.__k.length;n++)if((l=s.__k[n])!=null&&l.__e!=null){s.__e=s.__c.base=l.__e;break}return NG(s)}}function qG(s){(!s.__d&&(s.__d=!0)&&Pm.push(s)&&!i0.__r++||MG!==Xr.debounceRendering)&&((MG=Xr.debounceRendering)||setTimeout)(i0)}function i0(){for(var s;i0.__r=Pm.length;)s=Pm.sort(function(n,l){return n.__v.__b-l.__v.__b}),Pm=[],s.some(function(n){var l,o,c,t,g,I;n.__d&&(g=(t=(l=n).__v).__e,(I=l.__P)&&(o=[],(c=dl({},t)).__v=t.__v+1,r2(I,t,c,l.__n,I.ownerSVGElement!==void 0,t.__h!=null?[g]:null,o,g??Mm(t),t.__h),GG(o,t),t.__e!=g&&NG(t)))})}function UG(s,n,l,o,c,t,g,I,P,q){var L,V,oe,ne,Ie,Se,Re,Ze=o&&o.__k||zG,et=Ze.length;for(l.__k=[],L=0;L<n.length;L++)if((ne=l.__k[L]=(ne=n[L])==null||typeof ne=="boolean"?null:typeof ne=="string"||typeof ne=="number"||typeof ne=="bigint"?t0(null,ne,null,null,ne):Array.isArray(ne)?t0(qm,{children:ne},null,null,null):ne.__b>0?t0(ne.type,ne.props,ne.key,ne.ref?ne.ref:null,ne.__v):ne)!=null){if(ne.__=l,ne.__b=l.__b+1,(oe=Ze[L])===null||oe&&ne.key==oe.key&&ne.type===oe.type)Ze[L]=void 0;else for(V=0;V<et;V++){if((oe=Ze[V])&&ne.key==oe.key&&ne.type===oe.type){Ze[V]=void 0;break}oe=null}r2(s,ne,oe=oe||r0,c,t,g,I,P,q),Ie=ne.__e,(V=ne.ref)&&oe.ref!=V&&(Re||(Re=[]),oe.ref&&Re.push(oe.ref,null,ne),Re.push(V,ne.__c||Ie,ne)),Ie!=null?(Se==null&&(Se=Ie),typeof ne.type=="function"&&ne.__k===oe.__k?ne.__d=P=jG(ne,P,s):P=VG(s,ne,oe,Ze,Ie,P),typeof l.type=="function"&&(l.__d=P)):P&&oe.__e==P&&P.parentNode!=s&&(P=Mm(oe))}for(l.__e=Se,L=et;L--;)Ze[L]!=null&&WG(Ze[L],Ze[L]);if(Re)for(L=0;L<Re.length;L++)$G(Re[L],Re[++L],Re[++L])}function jG(s,n,l){for(var o,c=s.__k,t=0;c&&t<c.length;t++)(o=c[t])&&(o.__=s,n=typeof o.type=="function"?jG(o,n,l):VG(l,o,o,c,o.__e,n));return n}function VG(s,n,l,o,c,t){var g,I,P;if(n.__d!==void 0)g=n.__d,n.__d=void 0;else if(l==null||c!=t||c.parentNode==null)e:if(t==null||t.parentNode!==s)s.appendChild(c),g=null;else{for(I=t,P=0;(I=I.nextSibling)&&P<o.length;P+=2)if(I==c)break e;s.insertBefore(c,t),g=t}return g!==void 0?g:c.nextSibling}function IMe(s,n,l,o,c){var t;for(t in l)t==="children"||t==="key"||t in n||n0(s,t,null,l[t],o);for(t in n)c&&typeof n[t]!="function"||t==="children"||t==="key"||t==="value"||t==="checked"||l[t]===n[t]||n0(s,t,n[t],l[t],o)}function RG(s,n,l){n[0]==="-"?s.setProperty(n,l):s[n]=l==null?"":typeof l!="number"||EMe.test(n)?l:l+"px"}function n0(s,n,l,o,c){var t;e:if(n==="style")if(typeof l=="string")s.style.cssText=l;else{if(typeof o=="string"&&(s.style.cssText=o=""),o)for(n in o)l&&n in l||RG(s.style,n,"");if(l)for(n in l)o&&l[n]===o[n]||RG(s.style,n,l[n])}else if(n[0]==="o"&&n[1]==="n")t=n!==(n=n.replace(/Capture$/,"")),n=n.toLowerCase()in s?n.toLowerCase().slice(2):n.slice(2),s.l||(s.l={}),s.l[n+t]=l,l?o||s.addEventListener(n,t?LG:DG,t):s.removeEventListener(n,t?LG:DG,t);else if(n!=="dangerouslySetInnerHTML"){if(c)n=n.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(n!=="href"&&n!=="list"&&n!=="form"&&n!=="tabIndex"&&n!=="download"&&n in s)try{s[n]=l??"";break e}catch{}typeof l=="function"||(l==null||l===!1&&n.indexOf("-")==-1?s.removeAttribute(n):s.setAttribute(n,l))}}function DG(s){this.l[s.type+!1](Xr.event?Xr.event(s):s)}function LG(s){this.l[s.type+!0](Xr.event?Xr.event(s):s)}function r2(s,n,l,o,c,t,g,I,P){var q,L,V,oe,ne,Ie,Se,Re,Ze,et,He,It,Yt,At,Nt,wt=n.type;if(n.constructor!==void 0)return null;l.__h!=null&&(P=l.__h,I=n.__e=l.__e,n.__h=null,t=[I]),(q=Xr.__b)&&q(n);try{e:if(typeof wt=="function"){if(Re=n.props,Ze=(q=wt.contextType)&&o[q.__c],et=q?Ze?Ze.props.value:q.__:o,l.__c?Se=(L=n.__c=l.__c).__=L.__E:("prototype"in wt&&wt.prototype.render?n.__c=L=new wt(Re,et):(n.__c=L=new ip(Re,et),L.constructor=wt,L.render=OMe),Ze&&Ze.sub(L),L.props=Re,L.state||(L.state={}),L.context=et,L.__n=o,V=L.__d=!0,L.__h=[],L._sb=[]),L.__s==null&&(L.__s=L.state),wt.getDerivedStateFromProps!=null&&(L.__s==L.state&&(L.__s=dl({},L.__s)),dl(L.__s,wt.getDerivedStateFromProps(Re,L.__s))),oe=L.props,ne=L.state,V)wt.getDerivedStateFromProps==null&&L.componentWillMount!=null&&L.componentWillMount(),L.componentDidMount!=null&&L.__h.push(L.componentDidMount);else{if(wt.getDerivedStateFromProps==null&&Re!==oe&&L.componentWillReceiveProps!=null&&L.componentWillReceiveProps(Re,et),!L.__e&&L.shouldComponentUpdate!=null&&L.shouldComponentUpdate(Re,L.__s,et)===!1||n.__v===l.__v){for(L.props=Re,L.state=L.__s,n.__v!==l.__v&&(L.__d=!1),L.__v=n,n.__e=l.__e,n.__k=l.__k,n.__k.forEach(function(Ht){Ht&&(Ht.__=n)}),He=0;He<L._sb.length;He++)L.__h.push(L._sb[He]);L._sb=[],L.__h.length&&g.push(L);break e}L.componentWillUpdate!=null&&L.componentWillUpdate(Re,L.__s,et),L.componentDidUpdate!=null&&L.__h.push(function(){L.componentDidUpdate(oe,ne,Ie)})}if(L.context=et,L.props=Re,L.__v=n,L.__P=s,It=Xr.__r,Yt=0,"prototype"in wt&&wt.prototype.render){for(L.state=L.__s,L.__d=!1,It&&It(n),q=L.render(L.props,L.state,L.context),At=0;At<L._sb.length;At++)L.__h.push(L._sb[At]);L._sb=[]}else do L.__d=!1,It&&It(n),q=L.render(L.props,L.state,L.context),L.state=L.__s;while(L.__d&&++Yt<25);L.state=L.__s,L.getChildContext!=null&&(o=dl(dl({},o),L.getChildContext())),V||L.getSnapshotBeforeUpdate==null||(Ie=L.getSnapshotBeforeUpdate(oe,ne)),Nt=q!=null&&q.type===qm&&q.key==null?q.props.children:q,UG(s,Array.isArray(Nt)?Nt:[Nt],n,l,o,c,t,g,I,P),L.base=n.__e,n.__h=null,L.__h.length&&g.push(L),Se&&(L.__E=L.__=null),L.__e=!1}else t==null&&n.__v===l.__v?(n.__k=l.__k,n.__e=l.__e):n.__e=AMe(l.__e,n,l,o,c,t,g,P);(q=Xr.diffed)&&q(n)}catch(Ht){n.__v=null,(P||t!=null)&&(n.__e=I,n.__h=!!P,t[t.indexOf(I)]=null),Xr.__e(Ht,n,l)}}function GG(s,n){Xr.__c&&Xr.__c(n,s),s.some(function(l){try{s=l.__h,l.__h=[],s.some(function(o){o.call(l)})}catch(o){Xr.__e(o,l.__v)}})}function AMe(s,n,l,o,c,t,g,I){var P,q,L,V=l.props,oe=n.props,ne=n.type,Ie=0;if(ne==="svg"&&(c=!0),t!=null){for(;Ie<t.length;Ie++)if((P=t[Ie])&&"setAttribute"in P==!!ne&&(ne?P.localName===ne:P.nodeType===3)){s=P,t[Ie]=null;break}}if(s==null){if(ne===null)return document.createTextNode(oe);s=c?document.createElementNS("http://www.w3.org/2000/svg",ne):document.createElement(ne,oe.is&&oe),t=null,I=!1}if(ne===null)V===oe||I&&s.data===oe||(s.data=oe);else{if(t=t&&o0.call(s.childNodes),q=(V=l.props||r0).dangerouslySetInnerHTML,L=oe.dangerouslySetInnerHTML,!I){if(t!=null)for(V={},Ie=0;Ie<s.attributes.length;Ie++)V[s.attributes[Ie].name]=s.attributes[Ie].value;(L||q)&&(L&&(q&&L.__html==q.__html||L.__html===s.innerHTML)||(s.innerHTML=L&&L.__html||""))}if(IMe(s,oe,V,c,I),L)n.__k=[];else if(Ie=n.props.children,UG(s,Array.isArray(Ie)?Ie:[Ie],n,l,o,c&&ne!=="foreignObject",t,g,t?t[0]:l.__k&&Mm(l,0),I),t!=null)for(Ie=t.length;Ie--;)t[Ie]!=null&&BG(t[Ie]);I||("value"in oe&&(Ie=oe.value)!==void 0&&(Ie!==s.value||ne==="progress"&&!Ie||ne==="option"&&Ie!==V.value)&&n0(s,"value",Ie,V.value,!1),"checked"in oe&&(Ie=oe.checked)!==void 0&&Ie!==s.checked&&n0(s,"checked",Ie,V.checked,!1))}return s}function $G(s,n,l){try{typeof s=="function"?s(n):s.current=n}catch(o){Xr.__e(o,l)}}function WG(s,n,l){var o,c;if(Xr.unmount&&Xr.unmount(s),(o=s.ref)&&(o.current&&o.current!==s.__e||$G(o,null,n)),(o=s.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(t){Xr.__e(t,n)}o.base=o.__P=null,s.__c=void 0}if(o=s.__k)for(c=0;c<o.length;c++)o[c]&&WG(o[c],n,l||typeof s.type!="function");l||s.__e==null||BG(s.__e),s.__=s.__e=s.__d=void 0}function OMe(s,n,l){return this.constructor(s,l)}function ZG(s,n,l){var o,c,t;Xr.__&&Xr.__(s,n),c=(o=typeof l=="function")?null:l&&l.__k||n.__k,t=[],r2(n,s=(!o&&l||n).__k=SMe(qm,null,[s]),c||r0,r0,n.ownerSVGElement!==void 0,!o&&l?[l]:c?null:n.firstChild?o0.call(n.childNodes):null,t,!o&&l?l:c?c.__e:n.firstChild,o),GG(t,s)}o0=zG.slice,Xr={__e:function(s,n,l,o){for(var c,t,g;n=n.__;)if((c=n.__c)&&!c.__)try{if((t=c.constructor)&&t.getDerivedStateFromError!=null&&(c.setState(t.getDerivedStateFromError(s)),g=c.__d),c.componentDidCatch!=null&&(c.componentDidCatch(s,o||{}),g=c.__d),g)return c.__E=c}catch(I){s=I}throw s}},kG=0,wMe=function(s){return s!=null&&s.constructor===void 0},ip.prototype.setState=function(s,n){var l;l=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=dl({},this.state),typeof s=="function"&&(s=s(dl({},l),this.props)),s&&dl(l,s),s!=null&&this.__v&&(n&&this._sb.push(n),qG(this))},ip.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),qG(this))},ip.prototype.render=qm,Pm=[],i0.__r=0,TMe=0;var CMe=(s,n)=>{s.view="log",n.on("view:set",l=>{l!==s.view&&(s.view=l,n.emit(n.STATE_CHANGE))})},HG=CMe;var K7=Ni(n2(),1),J7=Ni(I$(),1),Q7=Ni(O$(),1),{Buffer:yRe}=X$(),{FeedMessage:gRe}=M2(),vRe=5*1024*1024,Y7=["application/octet-stream","application/x-protobuf","application/grtfeed","application/json"],xRe=(s,n)=>{s.feedUrl=null,s.feedSyncStopped=!1,s.feedSyncInterval=30,s.feedSyncing=!1,s.feedError=null,s.feedRawData=null,s.feedData=null;let l=null,o=async g=>{let I=g.headers.get("content-type"),P=I?(0,J7.parse)(I):{};if(P.type&&!Y7.includes(P.type)){let oe=new Error(`invalid content-type \`${P.type}\`, only ${Y7.join(", ")} are supported`);throw oe.response=g,oe}let q=g.headers.get("content-length");if(q&&parseInt(q)>vRe){let oe=new Error("response is too large");throw oe.response=g,oe}let L=yRe.from(await g.arrayBuffer()),V=gRe.decode(L);if(!V||!V.header||!Array.isArray(V.entity)){let oe=new Error("couldn't parse feed");throw oe.rawFeed=L,oe.response=g,oe}s.feedError=null,s.feedRawData=L,s.feedData=V,n.emit("feed:data-change"),n.emit(n.STATE_CHANGE)},c=g=>{s.feedSyncing=g,n.emit(n.STATE_CHANGE)},t=(0,K7.default)(()=>{l=(0,Q7.default)(s.feedUrl,{interval:s.feedSyncInterval*1e3}),l.on("fetch",()=>c(!0)),l.on("fetch-done",()=>c(!1)),l.on("change",g=>{o(g).catch(I=>{s.feedError=I,n.emit(n.STATE_CHANGE)})}),l.on("error",g=>{s.feedError=g,n.emit(n.STATE_CHANGE)}),s.feedSyncStopped&&l.stop()},300);n.on("feed:set-url",g=>{g!==s.feedUrl&&(l&&(l.stop(),l=null),s.feedUrl=g,s.feedSyncing=!1,s.feedRawData=null,s.feedData=null,g!==null&&t(),n.emit("feed:data-change"),n.emit(n.STATE_CHANGE))}),n.on("feed:sync",()=>{!l||l.refetch()}),n.on("feed:stop-sync",()=>{s.feedSyncStopped=!0,l&&l.stop(),n.emit(n.STATE_CHANGE)}),n.on("feed:start-sync",()=>{s.feedSyncStopped=!1,l&&l.start(),n.emit(n.STATE_CHANGE)}),n.on("feed:set-sync-interval",g=>{g=Math.max(g,1),g!==s.feedSyncInterval&&(l&&(l.stop(),l=null),s.feedSyncInterval=g,s.feedUrl!==null&&t(),n.emit(n.STATE_CHANGE))})},eW=xRe;var bRe=(s,n)=>{s.feedLog=[],n.on("feed:data-change",()=>{if(!s.feedData){s.feedLog=[];return}let l=Date.now()/1e3|0,o=s.feedData.header||{},c=(s.feedData.entity||[]).filter(t=>!!t.trip_update).flatMap(t=>(t.trip_update.stop_time_update||[]).map(g=>({entityId:t.id,timestamp:t.trip_update.timestamp||o.timestamp||null,routeId:t.trip_update.trip.route_id,directionId:t.trip_update.trip.direction_id,tripId:t.trip_update.trip.trip_id,vehicleId:t.trip_update.vehicle.id,vehicleLabel:t.trip_update.vehicle.label,stopId:g.stop_id,tArrival:g.arrival.time,delay:g.arrival.delay}))).filter(({tArrival:t})=>t&&t>=l).sort((t,g)=>{let I=t.tArrival-l,P=g.tArrival-l,q=typeof t.delay=="number"?t.delay:0,L=typeof g.delay=="number"?g.delay:0;return I/30===P/30?Math.abs(L)-Math.abs(q):I-P});s.feedLog=c})},tW=bRe;var Vm=Ni(iW(),1),oW=Ni(s2(),1);function nW(s){return s.split(/(%[0-9A-Fa-f]{2})/g).map(function(n){return/%[0-9A-Fa-f]/.test(n)||(n=encodeURI(n).replace(/%5B/g,"[").replace(/%5D/g,"]")),n}).join("")}function hp(s){return encodeURIComponent(s).replace(/[!'()*]/g,function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})}function jm(s,n,l){return n=s==="+"||s==="#"?nW(n):hp(n),l?hp(l)+"="+n:n}function cp(s){return s!=null}function q2(s){return s===";"||s==="&"||s==="?"}function TRe(s,n,l,o){var c=s[l],t=[];if(cp(c)&&c!=="")if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")c=c.toString(),o&&o!=="*"&&(c=c.substring(0,parseInt(o,10))),t.push(jm(n,c,q2(n)?l:null));else if(o==="*")Array.isArray(c)?c.filter(cp).forEach(function(I){t.push(jm(n,I,q2(n)?l:null))}):Object.keys(c).forEach(function(I){cp(c[I])&&t.push(jm(n,c[I],I))});else{var g=[];Array.isArray(c)?c.filter(cp).forEach(function(I){g.push(jm(n,I))}):Object.keys(c).forEach(function(I){cp(c[I])&&(g.push(hp(I)),g.push(jm(n,c[I].toString())))}),q2(n)?t.push(hp(l)+"="+g.join(",")):g.length!==0&&t.push(g.join(","))}else n===";"?cp(c)&&t.push(hp(l)):c===""&&(n==="&"||n==="?")?t.push(hp(l)+"="):c===""&&t.push("");return t}function R2(s){var n=["+","#",".","/",";","?","&"];return{expand:function(l){return s.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(o,c,t){if(c){var g=null,I=[];if(n.indexOf(c.charAt(0))!==-1&&(g=c.charAt(0),c=c.substr(1)),c.split(/,/g).forEach(function(q){var L=/([^:\*]*)(?::(\d+)|(\*))?/.exec(q);I.push.apply(I,TRe(l,g,L[1],L[2]||L[3]))}),g&&g!=="+"){var P=",";return g==="?"?P="&":g!=="#"&&(P=g),(I.length!==0?g:"")+I.join(P)}else return I.join(",")}else return nW(t)})}}}var{Request:ERe,fetch:SRe}=(0,oW.default)(),IRe=(s,n)=>Object.prototype.hasOwnProperty.call(s,n),ARe=(s,n)=>{let l=s?.entity;return Array.isArray(l)?l.some(o=>o.vehicle?.vehicle?.id===n):!1},ORe=(s,n)=>{let l=s?.entity;if(!!Array.isArray(l))return l.some(o=>o.vehicle?.trip?.trip_id===n||o.trip_update?.trip?.trip_id===n)},CRe=(s,n)=>{let l=async(Se,Re={})=>{let Ze=new ERe(Se,{mode:"cors",redirect:"follow",headers:{accept:"application/json"},...Re}),et=await SRe(Ze);if(!et.ok){let He=new Error(`${et.url}: ${et.status} ${et.statusText}`);throw He.req=Ze,He.res=et,He}return await et.json()};s.shapeIdsByTripIdUrl="/shape-ids-by-trip-id.json",n.on("shape-ids-by-trip-id-url:set",Se=>{s.shapeIdsByTripIdUrl!==Se&&(s.shapeIdsByTripIdUrl=Se,g(),n.emit(n.STATE_CHANGE))});let o=new Vm.default,c=async()=>(o=new Vm.default,console.debug(`fetching shape IDs from ${s.shapeIdsByTripIdUrl}`),await l(s.shapeIdsByTripIdUrl,{signal:o.signal})),t={},g=()=>{o.abort(),c().then(Se=>{t=Se,Ie()}).catch(Se=>{console.error("failed to fetch shape IDs",Se)})};s.shapeUrl="/shapes/{shape_id}.geo.json";let I=R2(s.shapeUrl);n.on("shape-url:set",Se=>{s.shapeUrl!==Se&&(s.shapeUrl=Se,I=R2(s.shapeUrl),Ie(),n.emit(n.STATE_CHANGE))}),s.focusedVehicleId=null,s.focusedVehiclePosition=null;let P=!1,q=()=>{if(s.focusedVehicleId===null)return;let Se=ARe(s.feedData,s.focusedVehicleId);if(P&&!Se)s.focusedVehicleId=null,s.focusedVehiclePosition=null,n.emit(n.STATE_CHANGE);else if(!P&&Se){let Re=s.focusedVehicleId,et=(s.feedData?.entity||[]).find(He=>He.vehicle?.vehicle?.id===Re);et?s.focusedVehiclePosition={type:"Feature",properties:{vehicleId:Re},geometry:{type:"Point",coordinates:[et.vehicle.position.longitude,et.vehicle.position.latitude]}}:s.focusedVehiclePosition=null,n.emit(n.STATE_CHANGE)}};n.on("feed:data-change",q),n.on("focus-vehicle-id",Se=>{Se!==s.focusedVehicleId&&(s.focusedVehicleId=Se,s.focusedVehiclePosition=null,q(),n.emit(n.STATE_CHANGE))}),s.focusedTripId=null,s.focusedTripShape=null;let L=!1,V=()=>{if(s.focusedTripId===null)return;let Se=ORe(s.feedData,s.focusedTripId);L&&!Se&&(s.focusedTripId=null,s.focusedTripShape=null,n.emit(n.STATE_CHANGE))};n.on("feed:data-change",V);let oe=new Vm.default,ne=async(Se,Re)=>{oe=new Vm.default;let Ze=I.expand({shape_id:Se});console.debug(`fetching shape ${Se} for trip ${Re} from ${Ze}`);let et=Date.now(),He=await l(Ze,{signal:oe.signal});return console.debug(`fetched shape ${Se} in ${Date.now()-et}ms`),He},Ie=()=>{let Se=s.focusedTripId;if(Se!==null&&(oe.abort(),Se!==null&&IRe(t,Se))){let Re=t[Se];ne(Re,Se).then(Ze=>{s.focusedTripShape=Ze,n.emit(n.STATE_CHANGE)}).catch(Ze=>{console.error(`failed to fetch shape ${Re} for trip ${Se}`,Ze)})}};n.on("focus-trip-id",Se=>{Se!==s.focusedTripId&&(s.focusedTripId=Se,s.focusedTripShape=null,V(),Ie(),n.emit(n.STATE_CHANGE))})},aW=CRe;var aH=Ni(z2(),1),sH=Ni(n2(),1),lH=Ni(F9(),1),g0=Ni(nH(),1),oH=(0,aH.default)(g0.parse),_p=s=>s,xze=s=>s==="true",bze=s=>parseInt(s),uH={feedUrl:{decode:_p,apply:(s,n)=>n.emit("feed:set-url",s)},feedSyncStopped:{decode:xze,apply:(s,n)=>{n.emit(`feed:${s?"stop":"start"}-sync`)}},feedSyncInterval:{decode:bze,apply:(s,n)=>{n.emit("feed:set-sync-interval",s)}},view:{decode:_p,apply:(s,n)=>n.emit("view:set",s)},shapeIdsByTripIdUrl:{decode:_p,apply:(s,n)=>n.emit("shape-ids-by-trip-id-url:set",s)},shapeUrl:{decode:_p,apply:(s,n)=>n.emit("shape-url:set",s)},focusedTripId:{decode:_p,apply:(s,n)=>n.emit("focus-trip-id",s)},focusedVehicleId:{decode:_p,apply:(s,n)=>n.emit("focus-vehicle-id",s)}},V2=s=>(0,lH.default)(s,Object.keys(uH)),wze=(s,n)=>{let l=t=>{for(let[g,I]of Object.entries(t)){let{decode:P,apply:q}=uH[g];q(P(I),n)}n.emit(n.STATE_CHANGE)};window.addEventListener("popstate",t=>{let g=V2(t.state||{});l(g)});let o=(0,sH.default)(()=>{let t=V2(s),g={...oH(location.search.slice(1)),...t},I="?"+(0,g0.stringify)(g);I!==location.search&&history.replaceState(t,"_",I)},500,{leading:!0});n.on(n.STATE_CHANGE,o);let c=V2(oH(location.search.slice(1)));setTimeout(l,1,c)},cH=wze;var hH={private:!0,name:"gtfs-rt-inspector",description:"Web app to inspect & analyze any GTFS Realtime feed.",version:"1.0.0",keywords:["gtfs","realtime","gtfs-rt","public transport","transit"],author:"Jannis R <mail@jannisr.de>",homepage:"https://github.com/derhuerst/gtfs-rt-inspector",repository:"derhuerst/gtfs-rt-inspector",bugs:"https://github.com/derhuerst/gtfs-rt-inspector/issues",license:"ISC",type:"module",engines:{node:">=14"},scripts:{lint:"eslint --ignore-path .gitignore .","build:copy":`cp assets/* $(node -p 'require.resolve("mapbox-gl/dist/mapbox-gl.css")') dist/`,"build:bundle":"esbuild --loader:.js=jsx --jsx-import-source=preact --jsx=automatic --define:process.env.MAPBOX_TOKEN=\\'$MAPBOX_TOKEN\\' --bundle --minify --outfile=dist/main.js --sourcemap --target=chrome96,firefox91,safari14 index.js",build:"npm run build:copy && npm run build:bundle","build:watch":"esbuild --loader:.js=jsx --jsx-import-source=preact --jsx=automatic --define:process.env.MAPBOX_TOKEN=\\'$MAPBOX_TOKEN\\' --bundle --minify --outfile=dist/main.js --sourcemap --target=chrome96,firefox91,safari14 --watch index.js"},dependencies:{"abort-controller":"^3.0.0",buffer:"^6.0.3","content-type":"^1.0.4","core-js":"^3.17.2",events:"^3.2.0","fetch-periodic-sync":"^1.1.2","fetch-ponyfill":"^7.1.0","gtfs-rt-bindings":"^4.0.1",lodash:"^4.17.20","mapbox-gl":"^2.1.1",ms:"^2.1.3","object-inspect":"^1.11.0",preact:"^10.5.7","query-string":"^7.0.1","regenerator-runtime":"^0.13.7","url-template":"^3.1.0"},devDependencies:{esbuild:"^0.15.12",eslint:"^8.12.0"},browserslist:["defaults"]};var Eze=0;function ie(s,n,l,o,c){var t,g,I={};for(g in n)g=="ref"?t=n[g]:I[g]=n[g];var P={type:s,props:I,key:l,ref:t,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Eze,__source:c,__self:o};if(typeof s=="function"&&(t=s.defaultProps))for(g in t)I[g]===void 0&&(I[g]=t[g]);return Xr.vnode&&Xr.vnode(P),P}var Sze=({state:s,emit:n})=>{let l=(q,L)=>{let V=oe=>{oe.metaKey||oe.ctrlKey||(oe.preventDefault(),n("view:set",q))};return ie("li",{class:L?"active":null,children:ie("a",{href:"?view="+q,onClick:V,children:q})})},o=ie("ul",{class:"nav",children:[l("log",s.view==="log"),l("inspector",s.view==="inspector"),l("map",s.view==="map"),ie("li",{children:ie("a",{href:hH.homepage,target:"_parent",title:name+" homepage",children:"?"})})]}),c=q=>{n("feed:set-url",q.target.value)},t=()=>{n("feed:sync")},g=()=>{s.feedSyncStopped?n("feed:start-sync"):n("feed:stop-sync")},I=q=>{let L=parseInt(q.target.value);n("feed:set-sync-interval",L)},P=ie("div",{class:"feed",children:[ie("input",{onInput:c,value:s.feedUrl}),ie("input",{class:"interval",type:"number",min:"1",step:"10",onChange:I,value:s.feedSyncInterval}),ie("button",{class:s.feedSyncing?"sync syncing":"sync",onClick:t,disabled:!s.feedUrl||!!s.feedSyncing,children:ie("span",{children:"\u21BB"})}),ie("button",{onClick:g,disabled:!s.feedUrl,children:s.feedSyncStopped?"\u25B6\uFE0F":"\u23F8"})]});return ie("div",{class:"bar",children:[ie("div",{class:"logo",children:"\u{1F682}\u{1F50D}"}),o,P]})},pH=Sze;var dH=Ni(G2(),1),x0=s=>typeof s!="number"?"?":s===0?"0s":(0,dH.default)(s*1e3);var mH=s=>new Date(s*1e3).toISOString(),Mze=s=>{let{entityId:n,timestamp:l,routeId:o,directionId:c,tripId:t,vehicleId:g,vehicleLabel:I,stopId:P,tArrival:q,delay:L}=s;return ie("tr",{id:"entity-"+n,children:[ie("td",{children:ie("code",{children:n})}),ie("td",{children:mH(l)}),ie("td",{children:ie("code",{children:o})}),ie("td",{children:ie("code",{children:c})}),ie("td",{children:ie("code",{children:t})}),ie("td",{children:ie("code",{children:g})}),ie("td",{children:ie("code",{children:I})}),ie("td",{children:ie("code",{children:P})}),ie("td",{children:mH(q)}),ie("td",{children:x0(L)})]})},qze=({state:s,emit:n})=>{let l=s.feedLog.length,o=s.feedLog.slice(0,1e3);return ie("div",{class:"log",children:[ie("p",{children:["Showing ",o.length,l>o.length?" out of "+l:null," ",ie("code",{children:"StopTimeUpdate"}),"s."]}),ie("table",{children:[ie("thead",{children:[ie("tr",{children:[ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"entity.id",children:"e_id"})})}),ie("th",{rowspan:"2",children:ie("abbr",{title:"stop_time_update[].timestamp or feed timestamp",children:ie("code",{children:"t"})})}),ie("th",{colspan:"2",children:ie("code",{children:"trip"})}),ie("th",{colspan:"3",children:ie("code",{children:"vehicle"})}),ie("th",{colspan:"3",children:ie("code",{children:"stop_time_update"})})]}),ie("tr",{children:[ie("th",{children:ie("code",{children:"route_id"})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"trip.direction_id",children:"dir_id"})})}),ie("th",{children:ie("code",{children:"trip_id"})}),ie("th",{children:ie("code",{children:"id"})}),ie("th",{children:ie("code",{children:"label"})}),ie("th",{children:ie("code",{children:"stop_id"})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"stop_time_update[].arrival.time",children:"arr"})})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"stop_time_update[].arrival.delay",children:"delay"})})})]})]}),ie("tbody",{children:o.map(Mze)})]})]})},_H=qze;var xp=Ni(M2(),1),OHe=Ni(G2(),1);var yH=s=>typeof s!="string"||!s?"?":ie("code",{children:ie("abbr",{title:s,children:[s.slice(4,6),"-",s.slice(6,8)]})}),gH=s=>typeof s!="string"||!s?"?":ie("code",{children:s}),{SCHEDULED:Rze,SKIPPED:Dze,NO_DATA:Lze}=xp.TripUpdate.StopTimeUpdate.ScheduleRelationship,kze=s=>s===Rze?ie("code",{children:ie("abbr",{title:"SCHEDULED",children:"SCHED"})}):s===Dze?ie("code",{children:ie("abbr",{title:"SKIPPED",children:"SKIP"})}):s===Lze?ie("code",{children:ie("abbr",{title:"NO_DATA",children:"NO_DATA"})}):"?",{INCOMING_AT:zze,STOPPED_AT:Bze,IN_TRANSIT_TO:Fze}=xp.VehiclePosition.VehicleStopStatus,Nze=s=>s===zze?ie("code",{children:ie("abbr",{title:"INCOMING_AT",children:"INC_AT"})}):s===Bze?ie("code",{children:ie("abbr",{title:"STOPPED_AT",children:"STOP_AT"})}):s===Fze?ie("code",{children:ie("abbr",{title:"IN_TRANSIT_TO",children:"IN_TR_TO"})}):"?",Uze=s=>{if(!s)return"?";let n=[typeof s.latitude=="number"?s.latitude:"?",typeof s.longitude=="number"?s.longitude:"?"].join(" | "),l=typeof s.latitude=="number"?ie("code",{children:s.latitude.toFixed(3)}):"?",o=typeof s.longitude=="number"?ie("code",{children:s.longitude.toFixed(3)}):"?";return ie("abbr",{title:n,children:[l," ",o]})},{RUNNING_SMOOTHLY:MHe,STOP_AND_GO:qHe,CONGESTION:RHe,SEVERE_CONGESTION:DHe}=xp.VehiclePosition.CongestionLevel,jze=s=>s===1?ie("code",{children:ie("abbr",{title:"RUNNING_SMOOTHLY",children:"SMOOTH"})}):s===2?ie("code",{children:ie("abbr",{title:"STOP_AND_GO",children:"STOP_GO"})}):s===3?ie("code",{children:ie("abbr",{title:"CONGESTION",children:"CONG"})}):s===4?ie("code",{children:ie("abbr",{title:"SEVERE_CONGESTION",children:"SEV_CONG"})}):"?",{EMPTY:LHe,MANY_SEATS_AVAILABLE:kHe,FEW_SEATS_AVAILABLE:zHe,STANDING_ROOM_ONLY:BHe,CRUSHED_STANDING_ROOM_ONLY:FHe,FULL:NHe,NOT_ACCEPTING_PASSENGERS:UHe}=xp.VehiclePosition.OccupancyStatus,Vze=s=>s===0?ie("code",{children:ie("abbr",{title:"EMPTY",children:"EMPTY"})}):s===1?ie("code",{children:ie("abbr",{title:"MANY_SEATS_AVAILABLE",children:"MANY_SEATS"})}):s===2?ie("code",{children:ie("abbr",{title:"FEW_SEATS_AVAILABLE",children:"FEW_SEATS"})}):s===3?ie("code",{children:ie("abbr",{title:"STANDING_ROOM_ONLY",children:"STANDING"})}):s===4?ie("code",{children:ie("abbr",{title:"CRUSHED_STANDING_ROOM_ONLY",children:"CRUSHED"})}):s===5?ie("code",{children:ie("abbr",{title:"FULL",children:"FULL"})}):s===6?ie("code",{children:ie("abbr",{title:"NOT_ACCEPTING_PASSENGERS",children:"NOT_ACCEPT"})}):"?",Gze=(s,n,l)=>ie("a",{href:"#",onClick:c=>{l("focus-vehicle-id",s),l("focus-trip-id",n.trip.trip_id),l("view:set","map"),c.preventDefault()},alt:"show vehicle on the map",children:ie("code",{children:s})}),$ze=(s,n)=>{let l=s.trip_update.trip||{},o=s.trip_update.vehicle||{};return ie("tr",{id:"entity-"+s.id,children:[ie("td",{children:ie("code",{children:s.id})}),ie("td",{children:ie("code",{children:l.route_id})}),ie("td",{children:ie("code",{children:l.direction_id})}),ie("td",{children:ie("code",{children:l.trip_id})}),ie("td",{children:yH(l.start_date)}),ie("td",{children:gH(l.start_time)}),ie("td",{children:kze(l.schedule_relationship)}),ie("td",{children:ie("code",{children:o.id})}),ie("td",{children:ie("code",{children:o.label})}),ie("td",{children:ie("code",{children:o.license_plate})}),ie("td",{children:x0(s.trip_update.delay)})]})},Wze=(s,n)=>{let l=s.entity.filter(o=>!!o.trip_update);return ie("div",{children:[ie("h2",{children:[ie("code",{children:"TripUpdate"}),"s (",l.length,")"]}),ie("table",{class:"trip-updates",children:[ie("thead",{children:[ie("tr",{children:[ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"entity_id",children:"e_id"})})}),ie("th",{colspan:"5",children:ie("code",{children:"trip"})}),ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"schedule_relationship",children:"s_rel"})})}),ie("th",{colspan:"3",children:ie("code",{children:"vehicle"})}),ie("th",{rowspan:"2",children:ie("code",{children:"delay"})})]}),ie("tr",{children:[ie("th",{children:ie("code",{children:"route_id"})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"direction_id",children:"dir_id"})})}),ie("th",{children:ie("code",{children:"trip_id"})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"start_date",children:"st_date"})})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"start_time",children:"st_time"})})}),ie("th",{children:ie("code",{children:"id"})}),ie("th",{children:ie("code",{children:"label"})}),ie("th",{children:ie("abbr",{title:"license_plate",children:ie("code",{children:"lic_pl"})})})]})]}),ie("tbody",{children:l.map($ze)})]})]})},Zze=(s,n)=>{let l=s.vehicle.trip||{},o=s.vehicle.vehicle||{};return ie("tr",{id:"entity-"+s.id,children:[ie("td",{children:ie("code",{children:s.id})}),ie("td",{children:ie("code",{children:l.route_id})}),ie("td",{children:ie("code",{children:l.direction_id})}),ie("td",{children:ie("code",{children:l.trip_id})}),ie("td",{children:yH(l.start_date)}),ie("td",{children:gH(l.start_time)}),ie("td",{children:Gze(o.id,s.vehicle,n)}),ie("td",{children:ie("code",{children:o.label})}),ie("td",{children:ie("code",{children:o.license_plate})}),ie("td",{children:ie("code",{children:s.vehicle.current_stop_sequence})}),ie("td",{children:ie("code",{children:s.vehicle.stop_id})}),ie("td",{children:Nze(s.vehicle.current_status)}),ie("td",{children:Uze(s.vehicle.position)}),ie("td",{children:jze(s.vehicle.congestion_level)}),ie("td",{children:Vze(s.vehicle.occupancy_status)})]})},Hze=(s,n)=>{let l=s.entity.filter(o=>!!o.vehicle);return ie("div",{children:[ie("h2",{children:[ie("code",{children:"VehiclePosition"}),"s (",l.length,")"]}),ie("table",{class:"vehicle-positions",children:[ie("thead",{children:[ie("tr",{children:[ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"entity_id",children:"e_id"})})}),ie("th",{colspan:"5",children:ie("code",{children:"trip"})}),ie("th",{colspan:"3",children:ie("code",{children:"vehicle"})}),ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"current_stop_sequence",children:"st_seq"})})}),ie("th",{rowspan:"2",children:ie("code",{children:"stop_id"})}),ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"current_status",children:"status"})})}),ie("th",{rowspan:"2",children:ie("code",{children:"position"})}),ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"congestion_level",children:"cong_lvl"})})}),ie("th",{rowspan:"2",children:ie("code",{children:ie("abbr",{title:"occupancy_status",children:"occu"})})})]}),ie("tr",{children:[ie("th",{children:ie("code",{children:"route_id"})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"direction_id",children:"dir_id"})})}),ie("th",{children:ie("code",{children:"trip_id"})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"start_date",children:"st_date"})})}),ie("th",{children:ie("code",{children:ie("abbr",{title:"start_time",children:"st_time"})})}),ie("th",{children:ie("code",{children:"id"})}),ie("th",{children:ie("code",{children:"label"})}),ie("th",{children:ie("abbr",{title:"license_plate",children:ie("code",{children:"lic_plate"})})})]})]}),ie("tbody",{children:l.map(o=>Zze(o,n))})]})]})},Xze=({state:s,emit:n})=>{let l=s.feedData;return!Array.isArray(l.entity)||l.entity.length===0?ie("p",{children:["The feed has no ",ie("code",{children:"FeedEntity"}),"s."]}):ie("div",{class:"inspector",children:[Wze(l,n),Hze(l,n)]})},$2=Xze;var Hm=Ni(xH(),1);var bH="/mapbox-gl.css",Yze="/arrow.png",wH=["case",["!=",["get","delay"],null],["interpolate",["linear"],["get","delay"],0,["to-color","#2ecc71"],90,["to-color","#eebb00"],210,["to-color","#ee2200"]],"#e0e0e0"],TH={base:.3,stops:[[9,.3],[15,.8]]};Hm.default.accessToken="pk.eyJ1IjoiY29oYW9sYWluIiwiYSI6ImNrczB0N3B5cjE1cHEzMm85OXBqeDczM3gifQ.5GPhEnu_XJnXUUjgQA_KSQ";setTimeout(()=>{Hm.default.prewarm()},100);var Kze=()=>{if(Array.from(document.head.querySelectorAll('link[rel="stylesheet"]')).find(l=>l.getAttribute("href")===bH))return;console.debug("dynamically inserting Mapbox GL CSS <link>");let n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",bH),document.head.appendChild(n)},H2=class extends ip{constructor(){super(),this.ref=FG()}updateVehiclePositions(){let{feedData:n}=this.props.state,o=(n.entity||[]).filter(I=>I.vehicle&&I.vehicle.position);if(o.length===0)return;let c=this.map.getSource("vehicle-positions");if(!c)return;c.setData({type:"FeatureCollection",features:o.map(I=>({type:"Feature",properties:{vehicleId:I.vehicle.vehicle?.id,trip_id:I.vehicle.trip?.trip_id,delay:I.vehicle.delay},geometry:{type:"Point",coordinates:[I.vehicle.position.longitude,I.vehicle.position.latitude]}}))});let t=[o[0].vehicle.position.longitude,o[0].vehicle.position.latitude],g=new Hm.default.LngLatBounds(t,t);for(let I of o)g.extend([I.vehicle.position.longitude,I.vehicle.position.latitude]);this.map.fitBounds(g,{padding:50})}updateFocusedTripShape(){let{focusedTripShape:n}=this.props.state,l=this.map.getSource("focused-trip-shape");!l||(n===null?l.setData({type:"FeatureCollection",features:[]}):l.setData(n))}updateFocusedVehiclePosition(){let{focusedVehiclePosition:n}=this.props.state,l=this.map.getSource("focused-vehicle-position");!l||(n===null?l.setData({type:"FeatureCollection",features:[]}):l.setData(n))}updateMap(){!this.map||(this.updateVehiclePositions(),this.updateFocusedTripShape(),this.updateFocusedVehiclePosition())}componentDidMount(){let{emit:n}=this.props;Kze(),this.map=new Hm.default.Map({container:this.ref.current,style:"mapbox://styles/mapbox/dark-v10",center:[-74.5,40],zoom:9}),this.map.once("load",()=>{this.map.addSource("vehicle-positions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"vehicle-positions",source:"vehicle-positions",type:"circle",paint:{"circle-radius":{base:1.5,stops:[[1,1],[20,35]]},"circle-color":wH}}),this.map.on("mouseenter","vehicle-positions",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","vehicle-positions",()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click","vehicle-positions",o=>{let c=o.features[0]?.properties.vehicleId||null;n("focus-vehicle-id",c);let t=o.features[0]?.properties.trip_id||null;n("focus-trip-id",t)}),this.map.addSource("focused-trip-shape",{type:"geojson",data:null}),this.map.addLayer({id:"focused-trip-shape",source:"focused-trip-shape",type:"line",paint:{"line-width":{base:1,stops:[[1,.6],[20,4]]},"line-color":"#44a8eb","line-opacity":TH}});let l=this.map;l.loadImage(Yze,(o,c)=>{if(o){console.error("failed to load trip shape arrow",o);return}l.addImage("focused-trip-shape-arrow",c),l.addLayer({id:"focused-trip-shape-arrows",type:"symbol",source:"focused-trip-shape",paint:{"icon-opacity":TH},layout:{"symbol-placement":"line","icon-ignore-placement":!0,"icon-image":"focused-trip-shape-arrow","icon-size":.15}})}),this.map.addSource("focused-vehicle-position",{type:"geojson",data:null}),this.map.addLayer({id:"focused-vehicle-position",source:"focused-vehicle-position",type:"circle",paint:{"circle-radius":{base:5,stops:[[1,5],[20,100]]},"circle-color":wH}}),this.updateMap()})}componentDidUpdate(){this.updateMap()}componentWillUnmount(){this.map&&(this.map.remove(),this.map=null)}render(){return ie("div",{class:"map",ref:this.ref})}},EH=H2;var GH=Ni(VH(),1);var A3e=({state:s,emit:n})=>{let l=s.feedError,o=("	"+l.stack.replace(/\n/g,`	
`)).trim();return ie("div",{class:"error",children:[ie("h2",{children:ie("code",{children:"failed to fetch the feed"})}),ie("pre",{children:ie("code",{children:(0,GH.default)(l)+`
`+o})})]})},$H=A3e;var O3e=({state:s,emit:n})=>{let l={log:_H,inspector:$2,map:EH}[s.view]||$2;return ie("div",{class:"app",children:[ie(pH,{state:s,emit:n}),ie("div",{class:"view",children:s.feedData?ie(l,{state:s,emit:n}):s.feedError?ie($H,{state:s,emit:n}):null})]})},WH=O3e;var wp={},Sa=new ZH.default;Sa.STATE_CHANGE=Symbol("state change");var C3e=Sa.emit.bind(Sa);HG(wp,Sa);eW(wp,Sa);tW(wp,Sa);aW(wp,Sa);cH(wp,Sa);var HH=()=>{ZG(ie(WH,{state:wp,emit:C3e}),document.body)};Sa.on(Sa.STATE_CHANGE,HH);HH();})();
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
//# sourceMappingURL=main.js.map
